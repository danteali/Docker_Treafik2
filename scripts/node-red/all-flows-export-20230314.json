[{"id":"a86052fe.2cfcb","type":"tab","label":"Development","disabled":false,"info":""},{"id":"0cca5f120542a932","type":"tab","label":"Lighting","disabled":false,"info":"","env":[]},{"id":"97bc4677a5be4b40","type":"tab","label":"Presence","disabled":false,"info":"","env":[]},{"id":"69e2d5c8.b334dc","type":"tab","label":"Misc","disabled":false,"info":""},{"id":"a28aa095.d828e","type":"tab","label":"Notifications","disabled":false,"info":""},{"id":"bb37110c.14f0d","type":"tab","label":"Useful Example Flows","disabled":true,"info":""},{"id":"f40271d9.9f445","type":"tab","label":"Archived or Disabled Flows","disabled":true,"info":""},{"id":"fd8eb98d.2d1be8","type":"tab","label":"Examples Downloaded","disabled":true,"info":""},{"id":"2dd3223.7682ade","type":"tab","label":"OLD - Presence","disabled":true,"info":""},{"id":"c4865e43.cbd68","type":"tab","label":"OLD - Lighting","disabled":true,"info":"Old configuration pre-Sept 2022 Home Assistant refresh"},{"id":"c69b5eb8.ce519","type":"group","z":"f40271d9.9f445","name":"","style":{"fill":"#ffdf7f","fill-opacity":"0.37","label":true},"nodes":["902dafbb.5356e","616b6458.f9cdec","5c41d75a.b28628","dd2e8fc0.2b15f","9fc4912.1ca5c7","fdc87852.37e158","fb4b581f.02db98","a7f4c343.47cc2","3facd4c6.e716fc","28faa962.1cead6","db8df199.db814","4cc4b780.1a6758","ae639e72.a6c2a","b31f3d4.22254c","ac8bb60.2a3fe48","351eac6a.9aa984"],"x":22,"y":43},{"id":"ef273204.3ab62","type":"group","z":"f40271d9.9f445","name":"","style":{"fill-opacity":"0.27","label":true,"fill":"#ff0000"},"nodes":["b75f2446.f93748","b78f1543.dbd748","e8033bd1.be11e8","408ec43e.c4fbdc","fdde52aa.aa13d","c1febef9.9aef3","617576bb.499418","11194364.149dad"],"x":10,"y":323},{"id":"823a10f9.ffad9","type":"group","z":"f40271d9.9f445","name":"","style":{"fill":"#c8e7a7","fill-opacity":"0.62","label":true},"nodes":["192e30d3.70bf0f","1166936d.670dad","6dab5ecc.5a474","823e6dfe.64fdd","66911912.a22a78","e89ece18.7af2a","3f0cd162.c775ce","fa67885b.f19238","1df3dbb2.13cc24","cbd04e58.bd0ca","3ecc4bd2.a09de4","6521af21.167ea","7e0d5e4c.43214"],"x":22,"y":643},{"id":"b49d9abe.78dd88","type":"group","z":"f40271d9.9f445","name":"","style":{"fill":"#b797cf","fill-opacity":"0.56","label":true},"nodes":["9ca0923c.afdc3","7afac9b8.7f4ef8","60c1850d.d699dc"],"x":26,"y":1195},{"id":"77f04818.c0bfd8","type":"group","z":"f40271d9.9f445","name":"Old Turn On/Off TV","style":{"fill":"#ffcf3f","fill-opacity":"0.58","label":true},"nodes":["974e2f1e.260ae","a8e6683e.b4d398","a974932e.10235","aadc4356.f295","e0508bc8.1063f8","92bf65b0.d45148","2f4c60bc.1822d","81455679.ead5a8","ec738885.095f38","4a76ad4.1e5da54","3b485fa7.fe4ad","a225493b.f2a218","4c1219ab.b27538","7221388.48f2ec8","ceb71e82.4b99","1c7c17ac.b68088","c0976624.f77568","1ff67987.1ad616","e4991a78.0c3ba8","98ab6ec7.f036","546a1e51.5c3f9","3e3f49e6.be7eb6","5e2b6469.9de28c"],"x":2332,"y":1099},{"id":"1a836572.7c51ab","type":"group","z":"c4865e43.cbd68","name":"Christmas Lights (HA Helper node status only reflects change in main light set status but will turn on/off all)","style":{"fill":"#ffff7f","label":true,"color":"#6f2fa0"},"nodes":["ea7e9f40.5fe5b","760f9aa3.a44374","a7e79632.469c38","5c16d110.6ba42","af617516.bf0758","1fa289a6.1799c6","2bd5999d.98cc86","fbbab013a6523277","e2ab34d2f441f099","5539ed98f71421ba","be363b7997d9d19d","058742e618dc313b","31be43858f90e72c","9bfb1707481830ee","c040e8288f4899d8","924fecaf61d433b9"],"x":78,"y":3595,"w":1644,"h":418},{"id":"f0830a38.efdca8","type":"group","z":"c4865e43.cbd68","name":"","style":{"stroke":"#6f2fa0","label":true,"fill":"#c8e7a7"},"nodes":["6c184314.2b82bc","b35bcace.f65918","7c5a1277881034f6"],"x":78,"y":1181,"w":1706,"h":1094},{"id":"5be5b86a.8f1348","type":"group","z":"2dd3223.7682ade","name":"Set House Empty based on People State","style":{"label":true,"stroke":"#6f2fa0","fill":"#ff0000","color":"#6f2fa0"},"nodes":["717aef8d.09c97","3d67bbae.22c664","6a13784c.b20158","87e4e48f.1f0758","4b6ab39e.d2250c","188687a8.f8e748","8eed6c10.bdb28","aa538a45.484018","d5ba51a1.f4ea9"],"x":38,"y":3489},{"id":"a82a8524.9f3e48","type":"group","z":"2dd3223.7682ade","name":"Set People State - Home","style":{"label":true,"stroke":"#ff0000","fill":"#e3f3d3","fill-opacity":"0.54","color":"#ff0000"},"nodes":["c4ccf6db.b2bb48","98bc40d0.a0fbd","559f93a6.3fa2ec"],"x":32,"y":2405},{"id":"7dd9ed68.c15784","type":"group","z":"2dd3223.7682ade","name":"Set House Occupied based on People State","style":{"label":true,"stroke":"#ff0000","fill":"#92d04f","color":"#ff0000"},"nodes":["dc5817e6.b42838","9dfd69ac.02ef08","45e48405.1cc2ac","7d83906a.3eca7"],"x":38,"y":3193},{"id":"4b535b.81de2ca4","type":"group","z":"2dd3223.7682ade","name":"Set People State - Away","style":{"label":true,"stroke":"#6f2fa0","fill":"#ffbfbf","color":"#6f2fa0"},"nodes":["2484db99.e027b4","853cd0f6.8beb4","22e8b6e5.47fc5a"],"x":32,"y":2789},{"id":"f4485eec.80433","type":"group","z":"f40271d9.9f445","name":"Save & Retreive Encrypted Data","style":{"fill":"#3f93cf","fill-opacity":"0.52","label":true},"nodes":["60eeedcc.b3b4e4","75f35ac5.b3d044"],"x":32,"y":1505},{"id":"dea433c.4083fd","type":"group","z":"bb37110c.14f0d","name":"Log in HA logbook & function to get msg data and create payload","style":{"label":true},"nodes":["fa214ee.90f1cb","785fd6f4.b6a028","32f9348a.d6a1ac","16a4a4b8.ee228b"],"x":38,"y":67},{"id":"e39daceb.48764","type":"group","z":"2dd3223.7682ade","name":"Useful Examples","style":{"label":true,"stroke":"#ffC000","fill":"#d1d1d1","color":"#6f2fa0"},"nodes":["11001d36.026403","ad7a3b73.d4a3c8","e47c7133.0f4cd"],"x":20,"y":17},{"id":"49e6fe11.422c6","type":"group","z":"2dd3223.7682ade","name":"Notify on Ryan heading towards home (see notes)","style":{"label":true,"fill":"#c8e7a7","stroke":"#6f2fa0","color":"#6f2fa0"},"nodes":["a6ff36dc.d6c3b8","9f7b14e0.fbb328","702e892b.66b7d8","3b24077d.333d08","ff2b1ceb.289d5"],"x":32,"y":1025,"info":"On change of state of device (life360 or GMaps)...\n\n1. If 'new' state is away_from and distance is greater than defined number (to eliminate flase positives) then ...\n    - Set entity in HA to flag alerting enabled.\n      This entity is also created by NR.\n    - Set distance value in entity to track how far away device got to. So that can be viewed in HA, Separate NR variables to be used for tracking distances.\n    - Set 'edge' distance variable to track furthest distance in journey\n\n2. If 'new' state is towards then...\n    - Check if latest distance is greater than edge distance var then increase edge distance var. This is becuase sometimes state updates don't come in frequently so state change to towards might end up reporting at a point further than away_from last reported.\n    \n    - Then check if alerting is enabled by querying alrting triggered entity state which would have been enabled above if away_from got far enough from home.\n    If alerting is enabled then...\n\n        - We have defined a 'boundary' distance to treat longer journeys and closer journeys differently. \n        If 'edge' distance is further than 'far' distance then treat as a long journey.\n        \n        For long journeys if latest distance is >25% less than 'edge' distance (i.e. 25% of the way home) then trigger notification and set HA alertng flag entity to off. \n        \n        For short journeys (e.g. dog walking) there is more chance that the journey will have a lot of variance and won't be direct. So notifications only sent if the device has made it 50% of the way home from the furthest point. \n        \n        Note that the HA alerting flag entity will be set to on again if the device starts moving away again per first section above. Then we'll get another notification once device is heading towards home again.\n        \n        *** We may need to add some code to avoid turning on monitoring again unless the device moves a certain distance away. Otherwise we might get a bunch of false positives if the journey hom is not direct. ***\n        "},{"id":"2480fcdb.c671b4","type":"group","z":"2dd3223.7682ade","name":"Notify on Jenna heading towards home (see notes under Ryan's alerting)","style":{"stroke":"#6f2fa0","fill":"#3f93cf","label":true,"color":"#6f2fa0"},"nodes":["6ebd088e.3d3838","f05c157.53e64e8","a0d4a581.479a88","33c3333b.c0385c","1519b2a.a34a94d"],"x":34,"y":1709},{"id":"ee1609dc.862078","type":"group","z":"bb37110c.14f0d","name":"Output data to debug","style":{"label":true},"nodes":["a1fea83f.847648","5e308fde.5b242","5e1c9d44.476e04"],"x":38,"y":439},{"id":"f4e4b003.22427","type":"group","z":"bb37110c.14f0d","name":"Delete / unset variables","style":{"label":true},"nodes":["78f7c893.628148","63bc915.4bb357","30dbb49c.fe393c"],"x":38,"y":559},{"id":"43943956.9495f8","type":"group","z":"bb37110c.14f0d","name":"Get Current State of Entity","style":{"label":true},"nodes":["945d2e80.0b55d","e8542aa8.744cc8","762ccc14.d5c124","683271ed.2d7e7","814a293f.27ed78"],"x":38,"y":751},{"id":"53fa7592.36691c","type":"group","z":"a86052fe.2cfcb","name":"Get Current State of Entity","style":{"label":true},"nodes":["1f44fcd1.fec203","2a91c4cd.3445dc","806acd6b.ff745","729dbfb1.5b28d","2b8f9fb3.c5987"],"x":446,"y":31,"w":868,"h":154},{"id":"e5e5d7a4.fecf88","type":"group","z":"69e2d5c8.b334dc","name":"Update OpenUV Data Every 4 Hours (HA Dependent)","style":{"label":true,"stroke":"#6f2fa0","fill":"#3f93cf","color":"#6f2fa0","fill-opacity":"0.5"},"nodes":["e225e6bc.010ac8","c93ce5d.ee55c18","845bfe9d.68801","375e185f.93e1b8","5c07ae1a.93e0f","14b15e2e.4cc3e2","bc15abe9.8ae958","759dd5d6.40e67c","6898ce83.4afe5","83ec43b63eb3a8b6","143311e5.74610e"],"x":1437,"y":23.000001907348633,"w":785,"h":322},{"id":"96cbb686.cf8058","type":"group","z":"bb37110c.14f0d","name":"Get info on device update","style":{"label":true},"nodes":["2d270b9b.6423f4","8d257a6e.060f98","c02dc4c0.9f9c58","f014197a.48eea8"],"x":38,"y":931},{"id":"1a1c464.2e622ba","type":"group","z":"bb37110c.14f0d","name":"Light colour change mirrored to other light(s)","style":{"label":true},"nodes":["2fa709ec.cdc006","dc54f8f9.94aef8","a33552a1.ea7fa","6952542c.fe317c","13ee9bb4.000184","e0606935.d8d778","116b3bc6.b9f634","e404ba2a.3b1bf8","b18ed48a.10d0f8","b261f3d0.250d1","e48da7ce.e074f8"],"x":38,"y":1075},{"id":"4c692d016af44cb6","type":"group","z":"c4865e43.cbd68","name":"","style":{"fill":"#ffffbf","label":true},"nodes":["794a9eab.51d4e","fa52424f.aa5cc","afbfe317f7b9cc3a"],"x":72,"y":377,"w":2852,"h":326},{"id":"ba02406e46ef1024","type":"group","z":"c4865e43.cbd68","name":"","style":{"label":true,"stroke":"#6f2fa0","fill":"#bfbfbf","color":"#6f2fa0"},"nodes":["47c6376c.3dc848","d2f2a56a.61ef08","e98ad2e1.53155"],"x":72,"y":4037,"w":1796,"h":938},{"id":"a6353282da12ad38","type":"group","z":"fd8eb98d.2d1be8","name":"Morning Lighting Depending on Day of Week from HA Calendar","style":{"label":true},"nodes":["e8f5fb58.f89118","d2310a40.7d51d8","d001c70.7ce0238","ed7f2664.af4078","848e82ca.5f03","66e64a1e.c8ce84","fa18c462.2bd5c8","a37ef7e9.708aa8","7d6eb648.93e3f8","ec9bb865.2a91e8","344e354c.42990a","a2aa50f5.5cb92","40f9dfac.fae8b","72935d22.0eb324","bceacb1d.43b6a8","fc9b9065.c827","eb8fa758.1228a8","ca8115bb.5fd158","af85b53f.0bb108","d296030e.c2e88","b3ec4f9e.4ba1d","e5c90d09.8119","bf5e51d3.37128","d48c9d1c.634ca","7aebad9.f0d8d54","60002366.e4da3c","28031ca0.336ab4","c4945f19.69f57","78a67328.e9e72c","593c4c6e.8f1e74","1ae3495c.b8fec7","adec1c9f.5b5ea","fa5923b6.b4aab"],"x":6,"y":87},{"id":"bd80095bdaede51d","type":"group","z":"fd8eb98d.2d1be8","name":"Home / Away Actions","style":{"label":true},"nodes":["bfa58b17.97f8b8","9feffc83.114ad","e2a06f85.f16fb","f5861311.9df7","b5264d44.4b4ea","e7e9b94e.aba508","70b70245.81071c","f27fe6ca.4facf8","7b0265f4.1a7ddc","f6ebb0d.178a65","bae93d9d.50c96","3c2d0114.198dce","170da324.7cabdd","b78b2b39.9fae08","8e00e05d.7e6f7","e1f28fb1.10bdd","1aa6e2eb.8ece9d","ba1d3e2.dfe44c","444198ab.4900a8","c3a35718.c2d408","f23de0eb.cc9b5","36314410.29a4cc","d969523a.f1c05","9f91fce.3903a","15a3c38b.52289c","dd6f2982.8e88a8","b31f20f7.f43e3","d2f65779.39dbd8","bcc359ba.977a88","260ed891.51b3e8","5095b995.6055e8","33202e8c.43c972","57a65068.d046f","b0f3a9a9.3ad688","463bfd43.96b204","143e65c6.d8564a","7d99605f.bc0a5","c0f7d352.e0cc3","faedc68f.0b6838","665b02b9.1bb99c","8ec59625.577308","e5b1b81a.790018","d2bf4773.c3fa48"],"x":1492,"y":249},{"id":"a5b0e5775de1f17f","type":"group","z":"c4865e43.cbd68","name":"Back Garden","style":{"stroke":"#6f2fa0","fill":"#92d04f","label":true,"color":"#6f2fa0"},"nodes":["5aee7e0abc686870","bed9c56215d257da"],"x":68,"y":725,"w":2048,"h":434},{"id":"04d47dd5ca75ed46","type":"group","z":"a28aa095.d828e","name":"Grafana Alerts","style":{"stroke":"#6f2fa0","fill":"#addb7b","label":true,"color":"#6f2fa0","fill-opacity":"0.5"},"nodes":["55102448b3bba3a6","125859ceaa09c6e9","d4c6e8477a9f2a7d","1a6c23a189218b26","2729d63a33d3b0c7","26730536764a662c","cdc4a2259d61f597","13474dc36e93314b","be2ba35fb010bbc5","3e22a6fb82eef673","2713a023b8c8d47c"],"x":106,"y":1363,"w":1144,"h":274},{"id":"5c70dc07dc72a49e","type":"group","z":"f40271d9.9f445","name":"(Dec 21 pre-update flow) Front Door Lights - Motion Detect / 5-button Ikea / Alexa","style":{"label":true,"color":"#6f2fa0","fill":"#dbcbe7"},"nodes":["e99934000c0c41bb","3be070a749d0b51a","1edba7b17b904a23","4bbbdfa406b1d12d","cd39a597a948bb22","c27291b2272111ca","fd3fd8cd074c3d58","a102d6c623031608","ea82b1a3858d83a1","76a6988493785b3f","f15b7dad8a8c5fa6","d15d21931475e43d","fe83d7a444f90529","c902166650df4ccf","7d0d3ad0550cb041","bf8bcd9739c85cfd","bc138989cb749a2d","37a9d8ea29095758","1cc819eed691763c","5d4b48193c497d5f","91a1aa41680d0b57"],"x":22,"y":3137},{"id":"2b554b192bf0e233","type":"group","z":"f40271d9.9f445","name":"","style":{"fill":"#bfc7d7","fill-opacity":"0.7","label":true},"nodes":["dc747341bb477bc3","611c90b19fbcfa88","6b7571224162e746","bcd1ad16736e133e","3baf21b855479785","075ce852631e8a27","f34bc0f6c456b453","7e0afc14ef855b27","9f7d0e250afa4e58","2d5b9c047d01dc2b","355ba9b5343f8a69","e5e688ccb2821ffd","679a4802021f9629","f06ac9763c070697","277e154275a1f490","994bf86fdc860127","7248ee8e2aa0f56e","b72fd9e16e470fdc","27f2fde9499830f6","2be1d4cbb89c1740","b087fe3a25410931"],"x":38,"y":1975},{"id":"34db8f418e4e34f2","type":"group","z":"f40271d9.9f445","name":"Ring motion detect light trigger","style":{"label":true,"fill":"#ffbfbf"},"nodes":["3410498393024ace","61a8f98898f9f4ee","c49c1eb13f49df82","63392435c8073047","b4265a5c7f2934c7","1b013332450326bb","1e3facf64a475f6f","90dd352a2fc9cbad","0664409110572893","372a022f818d1443","36143433f9fd5402","2866e5eedf142503","ec8c8ab5f8b6addc","671f103f49433a42","344df1ee6fc5c23e"],"x":38,"y":2551},{"id":"1c74523d2b35a2f7","type":"group","z":"bb37110c.14f0d","name":"MQTT vs Zigbee2MQTT vs HomeAssistant","style":{"label":true},"nodes":["7fe1d3a64de8b851","34092f65e4683e6f"],"x":1648,"y":581},{"id":"4b29d4cab874c621","type":"group","z":"bb37110c.14f0d","name":"MQTT to InfluxDB","style":{"fill":"#e3f3d3","label":true},"nodes":["b47174e3.35aef8","a40e9a3cd9abb572"],"x":40,"y":1529},{"id":"8f5e9a1ac7fea624","type":"group","z":"bb37110c.14f0d","name":"Convert time date string to UNIX timestamp","style":{"label":true},"nodes":["8b0c9a233e07c3f9","d192ba6337c30edf","78cce74fc7f14f3b","fd4fb3b74dbb99fc"],"x":38,"y":223},{"id":"ad33077998102cae","type":"group","z":"69e2d5c8.b334dc","name":"Global Debug - Turn On/Off","style":{"label":true,"stroke":"#6f2fa0","fill":"#addb7b","color":"#6f2fa0","fill-opacity":"0.5"},"nodes":["1829db51c724a407","88e781c1c7e47aca","d1592b035b4e1cb9","0311745f4dcce768","5feca0a08f9a7e2b","1c7ff71e0adc97b4","c06d9349f1336eb1"],"x":18,"y":19,"w":778,"h":178},{"id":"82fdf5de.96f998","type":"group","z":"a28aa095.d828e","name":"Annouce Doorbell Motion/Ring (HA Dependent)","style":{"stroke":"#6f2fa0","fill":"#3f93cf","label":true,"color":"#6f2fa0","fill-opacity":"0.8"},"nodes":["18967f36.2d9bd1","99b10cb.902e4f","7c46fe2d.5ed01","9a8e4ac9.573f78","2d6df248.71cfde","e3404b60.a64198","66994a05.9c2e14","af8dd88d.f0c3a8"],"x":106,"y":1098,"w":653,"h":233},{"id":"8bbc612a.3c21c","type":"group","z":"f40271d9.9f445","name":"Turn On/Off TV","style":{"stroke":"#ffC000","fill":"#b797cf","label":true,"color":"#6f2fa0"},"nodes":["bbc611e1.23115","5fb129db.76d978","e493c396.e7279","300b869a.fab05a","ac7cd25f.35d0d","6fc80cfd.e66a34","4870478.23603b8","72a742a3.629cdc","52026761.249d98","d59ca95.2a21a58","b678cc41.7acec","ff252afc.a107b8","129c2a9b.035335","aca9e3a0.700d9","266bf7.901eb40a","35255c12.bc86d4","dd650f83.a82488"],"x":2326,"y":1663},{"id":"7b10225a.94ce1c","type":"group","z":"f40271d9.9f445","name":"Turn On/Off Desktop","style":{"stroke":"#6f2fa0","fill":"#bfc7d7","label":true,"color":"#6f2fa0"},"nodes":["d8d9a83c.16b388","37a09293.8b015e","757e4f34.9886","2f3252dc.aa29be","4729263b.8304c8","a1dd6393.ea697","c0e51d6.e8bffe","5fd401e4.aef69","fd73c95d.55ed58"],"x":1726,"y":51},{"id":"5732b5b7.27115c","type":"group","z":"f40271d9.9f445","name":"TV Sources","style":{"stroke":"#6f2fa0","fill":"#7fb7df","label":true,"color":"#6f2fa0"},"nodes":["1b818000.2352e","c7f4a247.24ddf","ff03c6b0.3ed978","5c3424b6.5bab8c"],"x":2336,"y":2201},{"id":"4a19d79b2d5a2bb4","type":"group","z":"2dd3223.7682ade","name":"Set Home Occupied/Empty","style":{"label":true},"nodes":["df65be84.a0f75","7b60f2b6.27cdfc","cf52b2d6.e0074","47cc65e8.b532ec","36cdd77d.6fba48","16ef8ed0.c51a21","86c4914e.46ed4","8776f42f.33d038","44e9e68b.721c38","e13c454d.5226d8"],"x":782,"y":691},{"id":"af2130d08e75cb82","type":"group","z":"fd8eb98d.2d1be8","name":"Motion Sensor Light","style":{"label":true},"nodes":["58e8440c.272f7c","4cee5be1.01f1e4","ca265bbc.767628","dc1df4b5.cf5178","d774ab82.c6aa98","2f94da4a.cb6d16","3bedb586.df82aa","636194ee.ce808c","c11a7b33.6bd188","ae167d1b.c294"],"x":8,"y":715},{"id":"9d154ea7684d09f5","type":"group","z":"fd8eb98d.2d1be8","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["5a9a2770.35a978","debd8305.ed3d2","278e155e.840a2a","7c996b0b.d86a14","b74d83d8.fe52b","1e3fe9ac.b88986","3ba94139.9f55ae","8b986614.0a2be8","d2936ac5.719838","c6de633f.e3a85","2c4d2270.d3f60e","db831cf.48534e","46a6f0cf.61402","e897ab47.2a0808","500ef57.5ec700c","12023600.180c0a","26617863.a0f118","ee083fb4.e8c7e","505e1331.1e03bc","5e74c7c0.e6f428","99e6b32f.fedb","338695e8.f57f3a","7e857daa.4b9724","51fa5a3a.a12f64","b082ef40.4b3b1","e1c7f601.9c9f28","27720aed.470486","57e61ee7.8e587","b9fb8421.597a48"],"x":10,"y":1015},{"id":"92e3c25dcc813d7b","type":"group","z":"fd8eb98d.2d1be8","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["da21213a.d1c418","2b0eb06f.d7e8d8","c1e6aaab.f19138","9701b7d3.99416","e7886307.9cdb98","1e9a8082.fb1d8f","160d3974.89f507","ba0ba53c.012d6","6c4b46e6.b31dd8","6af8fd01.69823c","9455415e.123a28","a7f3a3f2.b51f38","c474bc9b.e9ff88","5a2b58f6.273f18"],"x":14,"y":1603},{"id":"2cd9006f.99be1","type":"group","z":"fd8eb98d.2d1be8","name":"https://diyfuturism.com/index.php/2017/11/27/useful-sensor-improving-presence-detection-with-node-red/","style":{"label":true},"nodes":["3b49b0a2.cd82e","3244224c.76ee5e","e41335da.593438","d3abc00c.25cd5","9819475f.ab3978","e1737555.a23c78","d0a9ff53.b739a","5283fcc7.605834"],"x":1491.1904487609863,"y":29.0000319480896},{"id":"7ae2baec74b843f8","type":"group","z":"2dd3223.7682ade","name":"https://diyfuturism.com/index.php/2017/11/27/useful-sensor-improving-presence-detection-with-node-red/","style":{"label":true},"nodes":["cccad6f7dbd48fd5","98bd0d0e34bd0557","4cce4fc10baad6c4","a9d531681dfc7d5b","8712669440f61aba","7d4b4bbaeaf9f922","a8c30f61e348d651","ba9faf711a5bbcf5"],"x":39.19044876098633,"y":713.0000319480896},{"id":"d28ddbe75d1348c4","type":"group","z":"fd8eb98d.2d1be8","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["fea522aeb174b991","155c6658a1281d09","a2118161000d8a0b","655976d3c6722809","8a16ac91db3cc434","95df1fbc65f3e087","aade279657681c80","d6ba15f5238880f5","6cdd6c043d922af5","72301d6fb6cbf986"],"x":34,"y":2359},{"id":"e390622a7b33dfa9","type":"group","z":"fd8eb98d.2d1be8","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["6575407dc937af47","42eae770827e1fc7","ede481fd32b8d00b","bab9bbb2506751a3","98124c956d933661","4a9ebcbeaa3ce8c9","5bdf51e40b9dc0a7","459a5d18265a3d0b"],"x":34,"y":2683},{"id":"5db4b4ef341421cc","type":"group","z":"fd8eb98d.2d1be8","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["53fe522fcea3c103","b3a9cdd210d8dab7","9c44a8d556779e26","9f65d7c85c08bf12","be857272ca630221","a43d27559fae9e69","523a5f97627c8abc","70bf5808df69b882","7aa7b352424451a3","73e5d460a6d6c7e2","77255f9479dc65a7","6cde3511b53fa390","3fbbc51a9add2174","e422e53e30242a6d","68dc553e982ba5bb","8dda48a733bc4ee8","61b08add5486844b","fbb346ce9ceb9117","67dd49662e855941","414ada4e37794083","3c8e71a92dbb8a01","c77849b29f043e50","e5827b37b4eff671","bb82b8d0bd7119fa","c8c013a07e3768a8","9c1c1a699cedbff1","dffe94610b879a3f","93ac56ec1733c63a","f8a221db109b7c06","11ce3382c2e40c82","bdf2f18c6a60652b","f2c94157587e74b5","d86bb171b60cd242","d31c227f05f8f2a1","c323b1f65be96888","933c3a5156572c04","bf141dfde5dfa227","b581a305a147b265","b8c11f34c6442db9","e34014dda8a286c3","133b1eef8d13bcbc","927f2b972eab7268","b4816fa70d9b4c21","efedf9a26975dc8b","9c74d7334bfa6b69"],"x":746,"y":2371},{"id":"d80402f2c42e743c","type":"group","z":"fd8eb98d.2d1be8","name":"Refresh cookie","style":{"label":true},"nodes":["28b3f4fa009ab066","805aa0937ac1201a","b8835f773956d0a3"],"x":650,"y":2263},{"id":"e89100b0ca32d393","type":"group","z":"fd8eb98d.2d1be8","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["7d1c2ce39f559d38","176b69cbfc870ff0","ca8fa8714eb9d771","2ae11b10917886b7","f921d40c410b194c","925aae9f79bcc3d3","76f8cde2bd729d39","f923befcb592876f","f75e718fd36f1b54","f2e78d4a29db08a3","dd7a3d34c007b5b0","66390779189a5a80","c51ead7d1e04ba36","58de072ce869a71d","054879f441f415e9","a8288f09613c4826","6ba33188bfa52ccb","df65c111a0e17814","f290b8c5cedc2f19","bc2fefc36ce230ce","6f89af4ba201ffed","2fa77eb67df6f720","74667db224675f7a","aa46650ab1986f45","aa3e2d2aff99a652","bf17cbf411db32e5","b829b1c96cad353d","42c8b7c6a8223e54","ec08a8d64477a083","02a35c6f59cfe44e","753ba34acb84a239","fc25e5d994aae5e6","e6f437c0f59e2ade","599f19f329e3d324","040cfa3ffe916a96","18cf6e3c83b314df","1dfa085f478c6012"],"x":1442,"y":2359},{"id":"877d07a80bb00420","type":"group","z":"fd8eb98d.2d1be8","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["286527ca4217ca2d","8146db0875fc0a2e","fdd249e33ff6ff7d","1e698adf2350851d","67c3fc7b2683cdda","f5be3762662b34e1","7ef9f9aabcbe416c"],"x":42,"y":2923},{"id":"1bcdbf064cc50c63","type":"group","z":"fd8eb98d.2d1be8","name":"LayZSpa Control","style":{"label":true},"nodes":["c74a887cbce25994","257e15b8aa8f0694","3f3ac26936421037","b64acaf378a26911","68a3324baf5dfdc7","9a14adbf6c0fb90b","48be9d6d2e362443","11b834ca1e4ca397","be3e8b2b625dd7b2","7177afaaebbe664c","0733da4a1697fc48","5413f759e85bc8c6","ad4e34943c76c624","05fbd93efdcf1405","1b12a89ae06c9739","50818d85d97258a6","f5188fd31329cf9c","b8615fca969a0e24","bcb2c1565b7116c8","842662cc35a8f537","06227f6df2cb3d11","055e6ac4244b27f4","64c842d42d17b2b2","0b239510c9afba83","b30a3aaaa72a81d1","cd393755680fb808","047fd5dac570516f","1cbf17c57f2cd4db","d41034103013a3fa","8fb7ee16f23564d2","d07c7bea7f0284d2","16e326d89394363d","ef66a65d5a6910e6","f02f71a2f7611f83"],"x":30,"y":3643},{"id":"4a5746f4fb0ac020","type":"group","z":"0cca5f120542a932","name":"Living Room Lights","style":{"label":true,"stroke":"#6f2fa0","fill":"#addb7b","color":"#6f2fa0","fill-opacity":"0.5"},"nodes":["8d0b0ec1b4801c97","71d2baa58251796a","daf51e78a0f6969d","7a91ffc540704bb8","2c6e11d19018c46d","25399037747d1f65","922c1849bd3cd0ad","93e71c32fb680cec","5677a17c78162d59","b659e13e233392dd","77a8679cc543a7b9","27ecf94114eb2def","2af8bdc822948786","70af799233dd8fc2","e2eca1bc25799ad0","4174b29428e51f9a","039a68561a24da09","0f4d519522e4284c","183c13610f1a7441"],"x":42,"y":7,"w":1528,"h":322},{"id":"ed1b3491c6acd9fa","type":"group","z":"0cca5f120542a932","name":"Christmas Lights","style":{"fill":"#addb7b","label":true,"color":"#6f2fa0","fill-opacity":"0.2","stroke":"#b797cf"},"nodes":["aca7b1c67de4884b","e7dfcb3262409b1a","598fe016042ecdb9","059d0f63898aa69e","2d249796a92cd342","664716a5a618b4f6","0f4ce243ea52c834","53615ae336b06c3a","f2a1727d5e505e1c","eae2029044b43b28","b7a5c188fd578655","134663eb2372a705","c3f1f82b7c88359b"],"x":46,"y":343,"w":1520,"h":262},{"id":"25f079f6417379d7","type":"group","z":"0cca5f120542a932","name":"Bin Notification (HA Dependent for Calendar Input)","style":{"label":true,"stroke":"#6f2fa0","fill":"#3f93cf","color":"#6f2fa0","fill-opacity":"0.17"},"nodes":["f1814437504f6e77","507c02a382e9c3fa","79169b6010b5c888","4a7326f8d7674abe","2a23ef84a092fe9b","6ab6b1bbac05af22","b039040247bab72f","fc1b976c85c8a03d","eff72feef44272ea","86f263b41ec005c4","15299f9a7b0aa523","205d2b5a91c27d2f","71443ad5221bcc22","124f80d8a36372b5","db3759f612a083de","845f0b0f7bb7a49a","8bc62e820834730a","4e22bc95157536b6","38f85de2278371b0","07de05601feb960d","43dfe6e5865d2bf3","72ab0f5e1ebdd93f","6afd1c76a5761348"],"x":46,"y":1411,"w":1750,"h":382},{"id":"4d443c555e118a02","type":"group","z":"0cca5f120542a932","name":"Study Lights","style":{"stroke":"#6f2fa0","fill":"#addb7b","fill-opacity":"0.52","label":true,"color":"#6f2fa0"},"nodes":["adc95956c72bdcaf","96616a57e59906f2","831dfd409f1e0ea7","d8fe90488eb31e50","b5ac9a5ad4db00fd","0a63d2e18e8526ec","3a996825e2f3a3b3","e13a4f389c58cb25","296e0188e4ed2cd6","72eea6de9a6a7907","b16f373728d40f11","e986d32bd89c94ca","f60f7cc08cc704d3","a094687cb49aebdc","aa3c36769bc9890e","51f39b15ece228f4","8742cf1d65f8da59","c8d1c7de104f30f9","3ec8a05536f23649","c48d76b5a6e4548f","0d1ac708363d143e","6d110591ad2b55d2","5f90eea1487a2c42","794f671cd449cd27","826f689f17638c0c","7ef5b85afa92722e","9acdffbf93c728b0","488910318239210a","0bac3346f316dae6","e4cc19ee46027f21","86789b7e73a629de","df2912f13bec5178","f393798ffd9f4554","2caa9d9ce8dda9b4","a9b5af6afedb7ce2","b12e3d9f03299e1b","707e6a152c7bea12","90a0f21b31032360","9d90ad0b3adcd1ad","6cbf51e43ce083c7"],"x":34,"y":677,"w":1724,"h":648},{"id":"d51ce67aabf87caf","type":"group","z":"bb37110c.14f0d","name":"MQTT Control","style":{"label":true},"nodes":["143ccab7a3e2586f","b5b0a0302397af24","ff7c1cb2287aa6e0","c53fdd3c3a819565","2fa2451014771f3c"],"x":1634,"y":31},{"id":"7526b80f.838298","type":"group","z":"c4865e43.cbd68","name":"Office Lamp & Server","style":{"fill":"#ffefbf","label":true,"color":"#6f2fa0"},"nodes":["3391a177.0197de","9c59bc53.6d34d","df4c2b73.4d4a98","97b5895.d460b78","53a2290b.d6c1b8","b1e73fd6.cadf2","e71ea60a.d06508","347f62c5.d9214e","3dae3e30.982312","41d69579.006b8c","2668d323.91574c","952d9ea.dc7e46","a5142e69.5362b","1cac89e9.624136","da9dd7d4.301718","bdc78f54.b8686","dd17d442.715458","2959592d.886226","ba2356f7.6a1d78","e7775cab.463ea","41240aba.4a5414","702910e7.94edc","3dbfcf2a.a1978","121837bf.d62768","9cf9b325.9beea","4d6c13a9.8f575c","a5e5180.ff2b7e8","d26823f1.75a3c","1fb2ae80.3de3a2","9e68c58a.7e9b08","871b856c.334518","d36f2e32.3d88f","e81e3e09.660fb","8dba21f0.40ed6","92c7e9ef.34c208","34b1e16d64e3fb38"],"x":90,"y":2767,"w":2202,"h":802},{"id":"b6df7fdabfc8b853","type":"group","z":"c4865e43.cbd68","name":"Bin Notification","style":{"label":true,"stroke":"#6f2fa0","fill":"#c8e7a7","color":"#6f2fa0"},"nodes":["b85923459dfd1cac","adc3f532c37ade6e","0e52de1a9a3a9cf7","988a864440d4424a","1587417d874e9ed4","22b5c945f330261f","50b63aef416a1c93","6bd7fefe71d72485","1d27cfd70038b01d","9bfd5366fa485550","e97ce34e97f69a48","9a4ba2ef754e4538","0b4009ebc3ec5007","27ae56a638e8e3fa","a64389f70317cec8","fc4e70e48bafd945","3995a4f25f28f67e","9564e89e2ed6dd0e","d9407ba1fe4f54d5","7ebc44fcc6914571","2cd7c78743a59cf4","5251150565dfa639","f00f6fdbfee29eca","e43dbcc2b94bd081","d04bbeb7e1ce89bd","953908636faf1361","5311e096a0e878c6"],"x":78,"y":2287,"w":1936,"h":454},{"id":"d0e1bff62bd0d786","type":"group","z":"0cca5f120542a932","name":"Kids Toilet (see notes)","style":{"label":true,"stroke":"#6f2fa0","fill":"#92d04f","color":"#6f2fa0","fill-opacity":"0.46"},"nodes":["e44094797e60fe16","d4d0fbee6e8b754f","e2bd193318ddc080","87a6724eb640b63f","e016887d31f33a58","08c4474a1b21d1b4","5a81f24279216688","f59d1215436f0206","4a32ccb4d485df77","8808d854a8aba9c0","0cd88984d95eaf8f","90cde51cf1cb3130","596479a15ab0efac","0613aeba28fc8dd6","d246ce9946c07722","cff0060a66898b1a","6cf0fc072fee7d0d","e0fd27cab54d890f","5fbda70ff22775a0","f9993e779ca7d2df","5d7bd26ba654df20","efd03b215513e377","af51d654dfd923bc","4b7d6ee5456a37de","d7d2511a929fceb3"],"x":46,"y":1867,"w":2012,"h":442},{"id":"39c3189beb448fe2","type":"group","z":"c4865e43.cbd68","name":"Kids Toilet (see notes)","style":{"label":true,"stroke":"#6f2fa0","fill":"#bfdbef","color":"#6f2fa0"},"nodes":["5779b54785ec6009","f5ab3b5fd890d312","0c0c3b870936dcbf","97e960baf71fb147","29ee8b7e8c47b369","9b8f0e57f880c054","77d315d60320408d","68bddd04e714bc5f","f766f46960a817a3","4f0d07214b07064d","8d34614d416605fc","2c542c2bb7a26291","d80416ceed793161","eb1afbfb83d20c32","c22daa9632fbf86b","7b3c91b17547963a","9d6cc1a2d088a627","31112b097b139258","fec219da756d6c25","08ccf5d43ba39f06","866bc4aaefe9360e"],"x":66,"y":31,"w":1652,"h":322,"info":"When motion detected Sonoff motion sensor sends:\n    msg.payload.occupancy=true\n\nAfter 60s it sends:\n    msg.payload.occupancy=false\n    \nSometimes the sensor won't send a 'false' if motion continues to be detected. Not certain waits until no motion for 60s then sends a 'false' as it seems a bit inconsistent - sometimes motion can occur and 'false' is still sent, sometimes motion occurs and 'true' is sent occasionally to notify of motion but sometimes not.\n\nFlow does:\n- Turn on light with every 'true'. And cancel any off timer.\n- Turn off light Xs after false sent.\n\nWe would usually use 'true' to trigger light off delay and reset delay after every true received.\nBut can't use the 'true' to trigger since the sensor sometimes doesn't re-send 'true' if motion continues after initial detection so delay won't continue to be reset while occupied. \nSo we need to use 'false' as trigger. i.e. turn off light Xs after false sent.\n"},{"id":"b14c70bd13a22c77","type":"group","z":"0cca5f120542a932","name":"Movie Room Lights (Node Red Websocket)","style":{"fill":"#addb7b","label":true,"color":"#6f2fa0","fill-opacity":"0.51"},"nodes":["4d30856b4662dbf1","f0028fc06d9dfdf6","dde082d91a06e3f4","215d6f223efc50ca","5f37298b5856dee5","91b35ac2d2ae7125","9fe81d9e1b47c879","1b7d54f75129da53","42146fe80f4d7877","8cc2a945a5d8bc1b","df7a14e59f713f31","18f7b2f67586d531"],"x":1970,"y":19,"w":1060,"h":286},{"id":"4771de1fd4eaa53a","type":"group","z":"fd8eb98d.2d1be8","name":"Examples: https://github.com/andreypopov/node-red-contrib-zigbee2mqtt","style":{"label":true},"nodes":["123545dd506fb882","4834aa1faa625685","b38b944ffd4e9a66","33e8ef8026f7ecc1","62a13be50b93dcc9","1faf0be4d4395a25","89edc10dcce1d277","7fdcec472ec527db","8b9d391ced3e6d4c","01f67f868cbc9d5b","f79972418404f0bb","6cd3c363497388dc","3cb917c78bc66b0e"],"x":1522,"y":1563},{"id":"586cf944de0582f3","type":"group","z":"0cca5f120542a932","name":"Back Garden","style":{"stroke":"#6f2fa0","fill":"#addb7b","label":true,"color":"#6f2fa0","fill-opacity":"0.5"},"nodes":["2eb8ad990ea06edc","c2ed8da5da09f05b","6583a0554f50f919","dfc90808cc68c628","cabeb01becda0112","aaf5448262adb18f","65b789e89bf08ba5","043296a5ed64f1d9","ed3b9e33f2d6affd","e30221d0384daa13","cda1e3a56813bb46","2c20215aa2bb0469","a6fb90245f7843a6","152c3f01343df6dd","41aee1e1f2c5c22f","006a85ac1aa3c0c0","f2b0d42e800ac1c7","6069a3b3ed649303","fe5cf244cfc5545e","05250ad6357ff117"],"x":1978,"y":343,"w":1356,"h":408},{"id":"e69ed4f88f9bd9cf","type":"group","z":"bb37110c.14f0d","name":"WLED MQTT Control (generally more reliable than WLED nodes)","style":{"label":true},"nodes":["f1fee44499d16b28","0adeff675e297f47","f72c8223b38bbcef","0a785249f52405a4","fc9319335968c634","d0969fe3036edd6d","1f32153e47da949a","e0fe8b257c8c6de8","c45d3a89e5b2da2c","2ca476d4bc3dc4d2","34cbaf9a3153eb9f","d8f4dd9e912d6eef","29f01cca6e432730"],"x":1646,"y":175},{"id":"977b214a85453b89","type":"group","z":"69e2d5c8.b334dc","name":"MQTT -> InfluxDB: ShellyEM Power Metrics","style":{"label":true,"stroke":"#6f2fa0","fill":"#addb7b","color":"#6f2fa0","fill-opacity":"0.5"},"nodes":["1a7ed2852edfb240","7dba86c7dfd29057","6725db69847308b8","d1bc57d7e22f0384","69daadaf9ffad366","8670da64897802d9","c5bf5f1b80c29e79","fa54ebfe539e0bcf","b4357a519b252cb5","615a1e5f685c61f2","9103294e2b823eb9","5b31d2fbb29001e9"],"x":24,"y":666.6667442321777,"w":1276,"h":202},{"id":"3f0fa02f154cbeb4","type":"group","z":"69e2d5c8.b334dc","name":"MQTT -> InfluxDB: Layzspa","style":{"fill":"#addb7b","label":true,"color":"#6f2fa0","stroke":"#6f2fa0","fill-opacity":"0.5"},"nodes":["ee20aa94089fd0e2","640d3dadea37e4b7","9b6da0f863f4e48b","96d0bab40816e0bd","ea184274244d63b2","8380206b5f89a546","85ad5afb7ba46aaf","15cc932cd5c3220d","fc1010f7d1156ea2","3d34159007f4b5ac","a1eaabd8083b975b","7008bb3b2d299d4e"],"x":25,"y":869.9999961853027,"w":1280,"h":238},{"id":"b157c3bc1035f126","type":"group","z":"a28aa095.d828e","name":"HTML5 (HA Dependent)","style":{"fill":"#0070c0","label":true,"stroke":"#6f2fa0","color":"#6f2fa0","fill-opacity":"0.5"},"nodes":["82de70d4.0a2de","a2367f6a.6cf3c","27e3a46.29cd05c","b7b5a030.43b4a","ff2acc95.c2ed9","27b69adf.2bed86","eee4346d.013888","aa1c18c6.f389a8"],"x":982,"y":247,"w":776,"h":190},{"id":"2233ae63732529db","type":"group","z":"a28aa095.d828e","name":"Slack","style":{"fill":"#addb7b","label":true,"stroke":"#6f2fa0","fill-opacity":"0.5","color":"#6f2fa0"},"nodes":["15809d0c.8af793","22e2aab5.889326","3333fe09.707012","a3539d65.622ed","c9d856b3.a72328","137960f4.d1c33f","929d1a8.07eb8e8","e5643e5e5290ee60","b1b7d8e768a32a83"],"x":104,"y":439,"w":766,"h":300},{"id":"57ed8c098b8cac3f","type":"group","z":"a28aa095.d828e","name":"HA Persistent (HA Dependent)","style":{"fill":"#0070c0","label":true,"stroke":"#6f2fa0","fill-opacity":"0.5","color":"#6f2fa0"},"nodes":["940c86c.1c95078","7dc62.83a0739e8","d612569.2504ca8","23e5a679.ec2f2a","5c700ee6.8cc56","7b94c2cc.15bf7c","592b5d1a.cdd014","74e514ad.404f4c"],"x":982,"y":55,"w":776,"h":190},{"id":"ef7d6ad04984274b","type":"group","z":"a28aa095.d828e","name":"Pushbullet","style":{"fill":"#addb7b","label":true,"stroke":"#6f2fa0","fill-opacity":"0.5","color":"#6f2fa0"},"nodes":["a8c64f4e.d5342","b4a7eb88.ff5078","a871bdf8.4acfe","600d3cfa.56bc44","830f32ff.3fea4","4bec32a9.b41a9c","4c8aefb.3f4371","1c9f7475.aee34c"],"x":102,"y":247,"w":768,"h":190},{"id":"042736150ac6c679","type":"group","z":"a28aa095.d828e","name":"Pushover","style":{"fill":"#addb7b","label":true,"stroke":"#6f2fa0","fill-opacity":"0.51","color":"#6f2fa0"},"nodes":["4e0fb3de.b1482c","fc1b6e67.4aa12","1889ad23.6e8d53","c2dc8bc2.91af38","7211d541.a0a3dc","ff831fc1.56908","d30da918.0f6e98","406cb03c.7944c"],"x":102,"y":55,"w":768,"h":190},{"id":"053db0065adad6ce","type":"group","z":"a28aa095.d828e","name":"WebOS TV (HA Dependent)","style":{"fill":"#0070c0","label":true,"stroke":"#6f2fa0","fill-opacity":"0.5","color":"#6f2fa0"},"nodes":["e8eb2c56.b4e45","411c1a67.f9eea4","786cb5a3.bf423c","94bfaf5c.0978c","652dff14.97f94","8438feeb.d173e","2fbeff9e.275e9","8b4afc42.0e06f"],"x":982,"y":439,"w":776,"h":190},{"id":"f929982c.2b26f8","type":"group","z":"69e2d5c8.b334dc","name":"Global Controller Example Use","style":{"stroke":"#6f2fa0","fill":"#addb7b","label":true,"color":"#6f2fa0","fill-opacity":"0.21"},"nodes":["555ebe58.31e22","d775baf6.2e1f88","b9457877.233668"],"x":815.9999961853027,"y":200.0000057220459,"w":582,"h":82},{"id":"465d4051.950e8","type":"group","z":"69e2d5c8.b334dc","name":"Global Controller - Turn On/Off Nodes","style":{"label":true,"stroke":"#6f2fa0","fill":"#addb7b","color":"#6f2fa0","fill-opacity":"0.51"},"nodes":["593b894c.ee6258","69bda2ee.4d0afc","a31f5327.8fa26","85bc969e.b647b8"],"x":817,"y":24.000001907348633,"w":580,"h":178},{"id":"627bac64c8c2cdf5","type":"group","z":"0cca5f120542a932","name":"Front House Lights (HA Depantant for Ring Notifications - can run independently with Z2M motion sensor)","style":{"stroke":"#6f2fa0","fill":"#addb7b","fill-opacity":"0.5","label":true,"color":"#6f2fa0"},"nodes":["ea110a4e2d331f16","ce2dbb1e6320d2d4","96e03b3c1e75dea9","b59ba4887a37b5f0","027a16c7be477f83","299aa1bd9627983d","086352661fbaa28d","da1f545032a7fcf3","6d78105108d30fad","3364dcabf570fc5d","04fd679ceacda523","66bb885e612a3ea6","1c8cab4323af1fb8","52601706ab6bc681","ffc9651b0db40152","3580c3bfdc9620cc"],"x":1982,"y":779,"w":1595,"h":470},{"id":"0d128617d83f618e","type":"group","z":"a28aa095.d828e","name":"Alexa TTS (HA Dependent)","style":{"stroke":"#6f2fa0","fill":"#0070c0","fill-opacity":"0.5","label":true,"color":"#6f2fa0"},"nodes":["fadd5dc415e2cae2","09c999560841044b","7b43ab144b55aa86","3ac311dba53ad4df","6e24879643db0a56","27368ddbc7128c62","c20fb349462e4a9b","433fcb33c1a756bb","ce535e13533769a9","4ef77e0bd7f47552","1ea0d2d7ac9e8eb6","405ffb1980f139a1","60d85e3440e07857","0625f2374df68dda","081e7374c1ee871f","5b2e505106cf3b28","0743bf7674938db4","935459cbef2ff4a9","7b166708acd5a635","7f6d4d73dd7e0d84","0c249ef1692e72bf"],"x":100,"y":763,"w":1750,"h":310},{"id":"a7dd80f9d2d8f91b","type":"group","z":"69e2d5c8.b334dc","name":"Alexa (Remote2) Smarthome Refresh","style":{"stroke":"#6f2fa0","fill":"#addb7b","fill-opacity":"0.51","label":true,"color":"#6f2fa0"},"nodes":["dcbc4afe23f039d0","373c550a9e3f2fc0","0defc3b0867f0a0d","b44474014d7eb730","648de0bc.c21ab","60d267ce.f0f338","25966e44.6e3f92","756625f9a949aba1","e4200f3622ec4f18","bbb134ad08e33b8c","9290f6a102e9a1dd","f9a7c77fc84799a5","2f9dbc6a6456df09","38d94220e476059b"],"x":25,"y":231.00000190734863,"w":757,"h":348.99999809265137},{"id":"7feed53e81537952","type":"group","z":"97bc4677a5be4b40","name":"Home Occupied = No from Input Select","style":{"label":true,"stroke":"#6f2fa0","fill":"#0070c0","color":"#6f2fa0","fill-opacity":"0.49"},"nodes":["f42f5e7d46c775ba","fb61aae79da0fa0e","c0f3db8d3fab4314","9f97dd799991781b","9aa7061b3182929d","7299188e89b2c51f","93b7de0661ac4447","4030816957319569","0ba97afe46c12955","67db55d749f148ef","e06ceecb0109a8a1","cb858ec114d54438","a0a7d67e5f500a6c","11731f87fa7f1359","4cc4048d3234e985","7f1bd0b568a2ded6","71c683d702462ed4"],"x":762,"y":19},{"id":"c628a669137868c5","type":"group","z":"97bc4677a5be4b40","name":"Home Occupied = Yes from Input Select","style":{"label":true,"stroke":"#6f2fa0","fill":"#0070c0","color":"#6f2fa0","fill-opacity":"0.5"},"nodes":["daa57661a17b12e1","114ed36babc5e145","5fea69f0db83da42","a4a51a54765aa03b","755f3ea31e793f87"],"x":26,"y":19},{"id":"1f56a445b8709216","type":"group","z":"97bc4677a5be4b40","name":"Person Occupancy Input Select Updates - triggers input_select change on either a person or bayesian entity update","style":{"stroke":"#6f2fa0","fill":"#0070c0","fill-opacity":"0.5","label":true,"color":"#6f2fa0"},"nodes":["068c1f9af0246cdb","90bd348f211d20ce","18bc8488babae791","70675dbacde30ea8","ece9fb0d40c2b0bc","4f399d9bd6edc8a7","8565866f0bbf2526","2564f627c7144075","a27bfcc13d0d4009","c6fd27de92eb53b0","3b270fb14e34eda4","1cf5b144d8e52b96","3c895f7bc113caf3","7ec72b75a63bba40","5cf184b3c6fcd670","c28ea0520a34e904","905fbd9b54ec1102","3839b37008da27ec","53d29ed9e083a44c","ed4fe02ba92d4d7f","376eeea9b9cced1d"],"x":26,"y":307},{"id":"941c8667b42ee67b","type":"group","z":"97bc4677a5be4b40","name":"Notify on Jenna heading towards home (see notes under Ryan's alerting)","style":{"stroke":"#6f2fa0","fill":"#3f93cf","label":true,"color":"#6f2fa0"},"nodes":["821c58de1b38e2b8","894f21cb4a05c11c","13d5806d2b20f7a7","125661a029168d57","ec17b211cfef25b5"],"x":58,"y":3185},{"id":"5c4bc67a61a0c623","type":"group","z":"97bc4677a5be4b40","name":"Get Global Home Asisstant Helper Values","style":{"stroke":"#ff3f3f","label":true,"color":"#ff3f3f","fill":"#3f93cf","fill-opacity":"0.19"},"nodes":["e33760e4e7d3dd53","b8995515a408d9bd","b144baadecbf43af","99345e74e93a9a4b","8116b0bb278ebeed","fe326331eb0667b2","b31da4f8d98e2434","8302023499b862d5","1ca4b0188821d00b","726812d2ad1ff7bf"],"x":34,"y":595},{"id":"9a56029e74b943d5","type":"group","z":"97bc4677a5be4b40","name":"Manual Alert Toggle -> Alert Enabled State","style":{"stroke":"#ff3f3f","label":true,"color":"#ff3f3f","fill":"#3f93cf","fill-opacity":"0.21"},"nodes":["3a26115c94d2a4f9","c089ecd3ea0c53dc","b2028947f1294dd6","4f829752a174acfe","e633566ef1e97b56","3e423de793232709","ded27b5bdd4eb3d3"],"x":610,"y":739},{"id":"0302ccd0beec3f7a","type":"group","z":"97bc4677a5be4b40","name":"Person Occupancy Input Select Updates - 'simple' method triggers input_select change on either a person or bayesian entity update","style":{"stroke":"#6f2fa0","fill":"#0070c0","fill-opacity":"0.5","label":true,"color":"#6f2fa0"},"nodes":["303ebad9d6ab0cd2","7256681f884a3320","8cef574918069f76","d78603dff3757f05","f51cf7dfdfcdd1f4","3d8750a1b1fde181","04af75d2e3d360a8","610835f6cdfa144b","c6a785de42e43883","c53811a3ec5a9fc4","57c4e58481d8aee1","1a7318ac92f643a3","2b2ab2fc631bb86f","a70c4e016d57132f","7f518c2bf6bddd8f","8209cde1e3aeb21b","17db595b47be1fca","dc401fa640fcac69"],"x":2214,"y":379},{"id":"e4e333fc33cfc20f","type":"group","z":"97bc4677a5be4b40","name":"Proximity Alerts","style":{"stroke":"#6f2fa0","fill":"#3f93cf","fill-opacity":"0.5","label":true,"color":"#6f2fa0"},"nodes":["d823751aefea7171","f92a0f4bd017ea08","dd6c4c46cc9f4a67","3711faee9086da56","9ba76720a1c0c9c0","82d3d8d2c019d36c","a1e3cadf6dd8a9b3","d7a829fd721459d1","54019f53051e28a8","54872030e233d60c","f4dab40bfd288306","032507ce63ae9654","86be7f6f3a62d8a9","0fcfe2320fa12df7","8c3ca342d602df27","507a8a1decb075a5","2616a90fb6be840a","a945216b120f2a16","c276259c78fec910","d7542e1b9c4e03f5","78b4797cd11f289a","def5d96cb9545822","97eed0234d90c6a3","c9f48f1f2325a8ca","634afa7df2b9987a","68d84c1ca24b7181","7894b277675bfbbc","564ba8d5a39e6a8f","3c855854595efac1","80c105534476f45e","af5ec50d5ab11cf1","17da25a035fa7197","cc2cfdda3f16c44c","b866fba6b7813831","995d19da31b7f797","bf55ea5473a528b9","1f236e065f99fad4","c19b5f07f445b8f5","c25c41581224e296","e9d14b3782054870","54545bdc67b829b3","ef79f4dfd8a1b47c","a84b84effb8bfd77","8876707d1bc9769b","c913ca37839dbf1f","8cdca83d77bd1cad","b047c9be2ad9ed97","732f215b87d90f0d","b05c50d1067590a0"],"x":34,"y":919},{"id":"8da5ceef2a869d19","type":"group","z":"97bc4677a5be4b40","name":"Proximity Alert - TESTING","style":{"stroke":"#ff0000","fill":"#9363b7","fill-opacity":"0.5","label":true,"color":"#ff0000"},"nodes":["2901fc3e6f25d545","5a21a6ba71bbb226","3ed070045d176454","4e359952d3a4a198","355e09c90530533b","720df0f6da68fa53","e7254e9b65bfa1f3","829450460b8f17c8","e47c25e031bb295c","94ed4e6641724ede","6738766b6b5b12d7","25be206f3a746cd5","5dd37a85129ad179","5e160afed24d9cff","678cfedafc27d4b2","6eb0831b12dcac04","caf7c03742bda019","3bb2c2bee0fc150f","0bf7111569f6287a","a761f2de9ad7e08f","2a12385434afac28","3418333eef22b4eb","32bf80bc7cc99610","3a786e3cd7b72ee6","c1b2c2db8aa5a6b8","9394e0b178271cd8","023a913e981cb35f","ece89447bf3bbb71","00d489366654315b"],"x":38,"y":1567},{"id":"7c6d6520815fe5fd","type":"group","z":"fd8eb98d.2d1be8","name":"Single Button - Double click & hold - https://discourse.nodered.org/t/how-to-detect-multiple-presses-on-a-single-button/20560/2","style":{"label":true},"nodes":["ec5ca0f9299d0ba5","4b9d4766deaa90e7","a1dd54da5cb86417","21d7c27d3e454a69","4056cf4bd6e0f153","2508e55698064afd","681ffad7ab1fbc7d","38724f1aef3b9b83","8877f6f908515cc7","b6f2f9b68a395ca8","14f2cce6d52c23c2","07145a946b2a1994","dac8816bab69bd44","c12bec7769a66f00","ad847aafca93bda3","9dbbc7aabdb0fd3f","a4696f9962b7f1fd","88ddde581b8fdac0","c048210107bf7d16","a42f0202f06137b0"],"x":33.33331298828125,"y":4489},{"id":"7fd9490ed740e83c","type":"group","z":"fd8eb98d.2d1be8","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["ab569b41f6984ad9","0b01e86466250ec1","73221beb60733643","7f68387f5279c711","0e639cb36a9dc2d7","f6450c9123d5cf36"],"x":38,"y":4807},{"id":"ba082cc01afd5f50","type":"group","z":"bb37110c.14f0d","name":"Button Multi Press","style":{"label":true},"nodes":["12114ed528e1847e","349f5c4194990a3b","f8f672e092a17176","1e842243be69de48","cd66d59c1636d4fa","c73a1b23a0975708","3b100bb37a84f674","f16ca4b72c5eae3f","c7c2944da56b671a","c6f894ef5eabe53c","7d6ae9fa7069cc02","3b214cb98fe9182f","96ca5a776c1fbc39","3cbe36b427e58da7","8068093871829a43","90974a00337390fd","61b599bafcd0f9e1","5c2a35839a60986c","35e366ac16d461d0","626229cff769d867"],"x":1657.3333129882812,"y":1249},{"id":"b5444aad191f3b82","type":"group","z":"a86052fe.2cfcb","name":"","style":{"label":true},"nodes":["b3183be9334c101f","cc46918a51544e4f","8aee6b55dc8d5607","6fe4ad4346db1f09","af13c29c6141b1ec","a4abb82e6708ed2c","ddf52af8e8135ec9","de24387a95ddf26c","f314ece1b01ae013"],"x":1318,"y":2155,"w":600,"h":298},{"id":"ce1d75f78d8602d1","type":"group","z":"a86052fe.2cfcb","name":"Multi Button Press","style":{"label":true},"nodes":["1139a03d.d1ca","900577c3.9deb4","820bd696.fbc028","525e3ec9.3bb6b8","fcb3cb17.693a9","4189a6d1.44073","ba72e20d.299b8","9faf97df.4ce4a","ddd0ab58.0a3e58","ed9739c.0628148","8082f0.4ba02d1","83d02113.4743b8","fbfe53e5.4fcae8","e22efc97.c6b018","d9a249bd.1f82a8","a1783324.3f9f","660d35d0.b41aa4","f91932b.cacfb5","a018a094.13d14","62860129.ec7bd"],"x":105.33331298828125,"y":2149,"w":1118.6666870117188,"h":332},{"id":"dd8630ba295cbfa1","type":"group","z":"a86052fe.2cfcb","name":"Detect Multi Button Press","style":{"label":true},"nodes":["83e4b1cd630aec25","919ce8fad8ad190b","0b94272633e214d7","053c6ea8f53cdd22","fdf2b7761e0db639","1858c37fc42a9755","68fc0d95f568f8f3","1961226b95642688","a99bf89babfd83c1","286f54d99eb85f45","df70fbe4dabf9466","7d6e35e2c5b9990c","3107b6306e25e62d","4918bc86809ae6f7","174de8ff308905b5","3f059a3f7c70071d"],"x":114,"y":1651,"w":1428,"h":454},{"id":"1474554de045623b","type":"group","z":"a86052fe.2cfcb","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["9dc85a4107b28f48","1087354ba8328173","db74110422ba4952","e4fab5da344ace62","fbdd47bc6e462f56","fd7b329ca5ab5160","90fe95e8a65f6e93","0300c1e7cf738421","a0a7d78c5778711d","cafc06a1600a5cbe","2462fc9762fc8cfb","6a73aa8bb222f1bc","0dca1c80767cb528","be676d3c4f189a11","6eb3dc61252353eb","bc688ddd5b4da6b2","5cbd8e095df0cb04","767a3c6056207140","9a1a126ca419dab0","f7a7415019b88b3d","8f3062a48b9c0497","77bdf1187841d2cb","a69624a76cd6d4e8","23652b3d087ee80d","a515787ee77be2db","c0060c10f02b09a4","01fab2a16d349325","8096e72995a0d6f4","8303a678eeed8266","28fb722b7582c630","f6766608c6ecdbd6"],"x":190,"y":823,"w":1768,"h":766},{"id":"ab9771b8ef2a4dfd","type":"group","z":"0cca5f120542a932","name":"Set Motion Sensor Override If Wall Switch Used (and not already motion triggered)","style":{"label":true,"stroke":"#6f2fa0","color":"#6f2fa0","fill":"#c8e7a7","fill-opacity":"0.42"},"nodes":["da6abc2fb5bc9b15","d52bb5a075c4cff1","ef827efae7c443b1","28da953db1b090ba","9d1b280ccb7095cc","b4de0d51163c9c57","97852596869a993b","6a2195a30fc86587","803659e69f8c8fc5","0d6109192ea6c1ee","94aeb7e4d73f3e27","05b15ca03948cffd","6798f61b908f814b","1e8b3851f7729a3d","b4725dda96982e25","4bf484469680cbcb","1fd08be2b2b12dcc"],"x":50,"y":2311,"w":1816,"h":346},{"id":"b47174e3.35aef8","type":"group","z":"bb37110c.14f0d","g":"4b29d4cab874c621","name":"influxDB Data Validation","style":{"fill":"#bfc7d7","label":true},"nodes":["1bb27551.b13a6b","7273324f.7f53ac","a000bc32.2dc19","2dbcfbbd.b61f44","4c6ac117.8bbe6","d16b6be1.138148","a13fc0ed.df4e","dc063c13.07848","e0d6c61d.faee48","91c03b02.b2c198","312b8552.1db4ea","b7c7c8cb.4003d8","79bbe9aa.3a2408","4025e7d.27e6c18","913cf8ef.65c9f8","54b3c063.c132b","c6c65dc9c75e8add","afc875d9a4cbfc88"],"x":66,"y":1915},{"id":"a40e9a3cd9abb572","type":"group","z":"bb37110c.14f0d","g":"4b29d4cab874c621","name":"","style":{"stroke":"#9363b7","label":true,"fill":"#bfc7d7"},"nodes":["2122f69.fdedd0a","bbed4e22.4412b","92e875bf.6d1788","989defec.67621","7804637a.87fb9c","b9c1043b88fac24d"],"x":70,"y":1555},{"id":"853cd0f6.8beb4","type":"group","z":"2dd3223.7682ade","g":"4b535b.81de2ca4","name":"Set Input Select for Jenna to Away if specific devices are Away","style":{"stroke":"#6f2fa0","fill":"#ff7f7f","label":true,"color":"#6f2fa0"},"nodes":["7bfa79fa.2e9ce8","d0fd7422.d287a8","439f30a5.bb4ba","d2ec0f57.65fba","8c509b27.5bac28","17d5e37d15236fc0"],"x":58,"y":2815},{"id":"2484db99.e027b4","type":"group","z":"2dd3223.7682ade","g":"4b535b.81de2ca4","name":"Set Input Select for Ryan to Away if specific devices are Away - conditional entity state from HA too (entity state from combined view of all devices linked to person)","style":{"stroke":"#6f2fa0","fill":"#ff7f7f","label":true,"color":"#6f2fa0"},"nodes":["d4b52d48.b2a18","2dea20f9.1df1","9aad36c8.49e268","4fe0c9b6.4d07e8","fd4e3f34.7f7f9","1d8c212b.785cff","d9790745.64b708","cfef2056.2bdd7","eff188d989797f84"],"x":778,"y":2815},{"id":"b35bcace.f65918","type":"group","z":"c4865e43.cbd68","g":"f0830a38.efdca8","name":"Timed on/off","style":{"fill":"#dbcbe7","label":true,"color":"#6f2fa0"},"nodes":["4c94ed2f.d11c14","71f54b50.da3f04","6832094e.7b7a98","417b3ab2.376d64","ae7952.8a6c86b","88ce8b61.4e9018","c213afb.156205","9c1f21dd.13ec9"],"x":106,"y":1927,"w":1158,"h":322},{"id":"6c184314.2b82bc","type":"group","z":"c4865e43.cbd68","g":"f0830a38.efdca8","name":"Front Door Lights - Motion Detect","style":{"label":true,"color":"#6f2fa0","fill":"#dbcbe7"},"nodes":["203d2459.d5854c","9416fe93.a0eba","910d6574.5aa3a8","693cc4a0.ccd77c","74dd86a5.fd5fe8","840dedb9.5e346","f37a15a6.4f07a8","cae866e7.da4f08","46fde9eb.a1b7b8","b4692fa1bd78f18a","ff8572f6a26f8e3b","1a39611804e84306","705e69ee6042d958","5c9e75faf6d2a740","50eed6c8d941261c","e7324546dca14601","a190b891109ea9f8","a73ae0ce8062b29c"],"x":104,"y":1207,"w":1654,"h":444},{"id":"47c6376c.3dc848","type":"group","z":"c4865e43.cbd68","g":"ba02406e46ef1024","name":"Living Room Lights","style":{"fill":"#addb7b","label":true,"color":"#ff0000"},"nodes":["64d8a2d6.d09ffc","46ad94ff.6208bc","904621c2.a8661","77134325.27633c","f1fcf507.1aa328","732bb821.11f368","fdf09a04.548288","e4a6ba5a.d04e58","3bee2e71.c47b42","a525736b.cdfce","c94cc98e.ef21b8","c53ca04c.8c095","b73d5a37.31c9c8","93a1524abb9f1718","c8dbed699fd9668c","c3c5c8799cf58c6e","9c96163f1e7b9ae4"],"x":98,"y":4063,"w":1744,"h":430},{"id":"d2f2a56a.61ef08","type":"group","z":"c4865e43.cbd68","g":"ba02406e46ef1024","name":"Ikea 5-button - big main toggle button","style":{"stroke":"#6f2fa0","fill":"#ffff7f","label":true,"color":"#0070c0"},"nodes":["33489131.fee59e","3b7d49a3.7e36a6","56591abd.833354","d2497f7f.07ec4","5644946b.3bb84c","c3460df2.41da9","515d2818.4d9078","f15aeda44dc6b330"],"x":106,"y":4711,"w":1160,"h":238},{"id":"c4ccf6db.b2bb48","type":"group","z":"2dd3223.7682ade","g":"a82a8524.9f3e48","name":"Set Input Select for Jenna to Home if specific devices are Home","style":{"label":true,"fill":"#c8e7a7","stroke":"#ff0000","color":"#ff0000"},"nodes":["499d8737.9fac58","f8eee677.55c428","d85d8025.f4acf","9ca4e6e1.0d56b8","37142a8f.ee4686"],"x":58,"y":2431},{"id":"98bc40d0.a0fbd","type":"group","z":"2dd3223.7682ade","g":"a82a8524.9f3e48","name":"Test - Set Input Select for Guest to Home - main switch togglable in HA","style":{"stroke":"#ff0000","fill":"#c8e7a7","label":true,"color":"#ff0000"},"nodes":["2123633e.d3038c","24324cc.9da04b4"],"x":64,"y":2659},{"id":"559f93a6.3fa2ec","type":"group","z":"2dd3223.7682ade","g":"a82a8524.9f3e48","name":"Set Input Select for Ryan to Home if specific devices are Home","style":{"label":true,"stroke":"#ff0000","fill":"#c8e7a7","color":"#ff0000"},"nodes":["8e2b49dd.6985e8","a3a2501e.78344","2fdbc840.3f0e68","631246f3.52eb78","aef5531.f8427b","767c5815.d05d18"],"x":1030,"y":2431},{"id":"22e8b6e5.47fc5a","type":"group","z":"2dd3223.7682ade","g":"4b535b.81de2ca4","name":"Test - Set Input Select for Guest to Away - main switch togglable in HA","style":{"label":true,"stroke":"#6f2fa0","fill":"#ff7f7f","color":"#6f2fa0"},"nodes":["3d2b2863.6c8388","d0b4bab7.c6f218"],"x":62,"y":3043},{"id":"60eeedcc.b3b4e4","type":"group","z":"f40271d9.9f445","g":"f4485eec.80433","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["941743d1.b3b39","1d68bd2d.bf84b3","31066f71.c2a3f","8816ed07.da549","17211ba5.ffd3c4","d4e20de3.5929c"],"x":58,"y":1795},{"id":"75f35ac5.b3d044","type":"group","z":"f40271d9.9f445","g":"f4485eec.80433","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["1f11cde2.b12a52","ce9833c6.1f571","19aed5cd.483e2a","461b3323.15622c","4dbcee24.c4911","ef23dae0.39a3d8","ca56c064.dea37"],"x":62,"y":1531},{"id":"11001d36.026403","type":"group","z":"2dd3223.7682ade","g":"e39daceb.48764","name":"Send message on zone entry - Change State node","style":{"label":true,"color":"#6f2fa0"},"nodes":["873ff1dd.69d22","b268ca11.161318","292d1e39.cb51c2","ed1fd8ec.c762f8"],"x":46,"y":43},{"id":"ad7a3b73.d4a3c8","type":"group","z":"2dd3223.7682ade","g":"e39daceb.48764","name":"Send message on zone entry or exit - Trigger State node","style":{"label":true,"color":"#6f2fa0"},"nodes":["e971240a.705a08","7affcc21.05e6f4","d5501c3b.bfbc5","3b21910e.28f8ae","60019bf7.c9df24","79da2f25.2b641","78e8e95a.c6bb38","3e100dad.211a02","b3378a5d.88d018","67647720.5cc028"],"x":50,"y":235},{"id":"a6ff36dc.d6c3b8","type":"group","z":"2dd3223.7682ade","g":"49e6fe11.422c6","name":"Watch for device moving away further than specified distance and create/update HA entity to enable alerts","style":{"label":true,"stroke":"#ffC000","fill":"#dbcbe7","color":"#6f2fa0"},"nodes":["cdef25c3.e22f18","75a43e8a.3bfe7","19157fa.1c8638","eb2b35eb.702998","19e97ed1.2ed7c1","70e918fb.31eb88"],"x":62,"y":1051},{"id":"702e892b.66b7d8","type":"group","z":"2dd3223.7682ade","g":"49e6fe11.422c6","name":"Query current Distances","style":{"label":true},"nodes":["7a2bf9be.dc4bc8","38edcdec.e42c62"],"x":1838,"y":1543},{"id":"3b24077d.333d08","type":"group","z":"2dd3223.7682ade","g":"49e6fe11.422c6","name":"Watch for device moving towards home and alert if moved specified %","style":{"stroke":"#6f2fa0","fill":"#dbcbe7","label":true,"color":"#6f2fa0"},"nodes":["ae949309.f1b9c","2bbcd898.c29a98","e1c75b3a.6e3f18","d7c5b68.e321d48","4a61189e.533f68","7c989356.d00e1c","a2420d98.df10d","185f092e.a526d7","567baf51.b5e49","eb8986af.06b048","a5e26088.a99d5","4e4ed616.7c7a58","ef53723f.2d4","b302f1ee.82cfe","4199ca7f.b8f7a4","8412cae1.fbb2e8","824ff565.76f938","37177048.eb812"],"x":58,"y":1315},{"id":"f05c157.53e64e8","type":"group","z":"2dd3223.7682ade","g":"2480fcdb.c671b4","name":"Query current Distances","style":{"label":true},"nodes":["62df3c56.bd4554","a47182df.6ae35"],"x":1856,"y":2227},{"id":"a0d4a581.479a88","type":"group","z":"2dd3223.7682ade","g":"2480fcdb.c671b4","name":"Watch for device moving away further than specified distance and create/update HA entity to enable alerts","style":{"stroke":"#ffC000","fill":"#dbcbe7","label":true,"color":"#6f2fa0"},"nodes":["56e2b118.5c627","c9d8c377.ab967","3acbef9f.71dee","f68edde0.09d6","9980f0ab.f1c8a","11d5e8fe.a60e37"],"x":62,"y":1735},{"id":"33c3333b.c0385c","type":"group","z":"2dd3223.7682ade","g":"2480fcdb.c671b4","name":"Watch for device moving towards home and alert if moved specified %","style":{"stroke":"#6f2fa0","fill":"#dbcbe7","label":true,"color":"#6f2fa0"},"nodes":["49bf6984.8aac88","b19491d4.4ae48","58f90542.4c094c","279e319e.c0051e","5217845b.8f06ec","1ac7a4df.818feb","5308ae38.5e4d","2a58e20.f85151e","5281d5e9.5892ac","541c4409.1c53ac","a486c944.923128","f0254a01.8f5908","195f2e9c.dfb031","661bc51f.5d8eac","ad3131a5.3e9a","8474469f.393ae8","a350b714.885898","6b94a1f5.beec7"],"x":60,"y":1951},{"id":"e47c7133.0f4cd","type":"group","z":"2dd3223.7682ade","g":"e39daceb.48764","name":"Get proximity distance","style":{"label":true,"color":"#6f2fa0"},"nodes":["720e20b4.e837","3993b164.6076fe","1606784c.db5768"],"x":50,"y":571},{"id":"1519b2a.a34a94d","type":"group","z":"2dd3223.7682ade","g":"2480fcdb.c671b4","name":"Manually Turn On/Off Alert","style":{"stroke":"#ffC000","fill":"#dbcbe7","label":true,"color":"#6f2fa0"},"nodes":["4727ff75.3ac34","32e431ac.f407ce","6e348688.fa40d8","b7a01b37.941618","d3827a60.e9d4a8"],"x":1330,"y":1735},{"id":"ff2b1ceb.289d5","type":"group","z":"2dd3223.7682ade","g":"49e6fe11.422c6","name":"Manually Turn On/Off Alert","style":{"stroke":"#ffC000","fill":"#dbcbe7","label":true,"color":"#6f2fa0"},"nodes":["fd23941f.6b40a8","860b5118.f6225","14b35ae0.229175","e6197ae9.5c5768","a7c5faab.3781e8"],"x":1330,"y":1063},{"id":"e98ad2e1.53155","type":"group","z":"c4865e43.cbd68","g":"ba02406e46ef1024","name":"Kitchen Fairy Lights","style":{"stroke":"#6f2fa0","fill":"#ffdf7f","label":true,"color":"#6f2fa0"},"nodes":["ecaa7a20.989a48","37fe30c4.a86fa","50a077b0.869518","f1e09968.f05ca8","d5c5a376.86c6d","93dd5b0f.0cd4e8","2a9b9e4e.a27fa2","2cd11fb3.905fa","667daad0cc858e80","18eb07ce843d50d6","0bc143f9fa9aa024"],"x":418,"y":4471,"w":1176,"h":214},{"id":"5aee7e0abc686870","type":"group","z":"c4865e43.cbd68","g":"a5b0e5775de1f17f","name":"Reboot back garden LED strip","style":{"stroke":"#6f2fa0","fill":"#ffff7f","label":true,"color":"#6f2fa0"},"nodes":["e60497eaaeb36ae7","bbaba42ff654e669","ce48406caaf15876"],"x":1666,"y":763,"w":424,"h":190},{"id":"bed9c56215d257da","type":"group","z":"c4865e43.cbd68","g":"a5b0e5775de1f17f","name":"Back Garden Timer","style":{"fill":"#ffcf3f","label":true,"color":"#ff0000"},"nodes":["d6f27916b030116c","e9edaa013335e399","1da24356a36a8ab6","a04201faece5f481","b1e52ac8ae06f2ec","dd67e9976846f0f5","038e75798a524ad8","2af25efbddb9f9eb","d625a64c89b8ba91","4fb51575bac9220b","873d67382981b8c2","e385f743115bf735","e3175a15e12561d1","b6b00ea760b65ce8","bc9f639668057193","b3aa96289a63acfb","3736e13aa588362a","6820cdde4aca097f","006c397d66b80b67","ba122f35fac90dd2"],"x":94,"y":751,"w":1596,"h":382},{"id":"bf8bcd9739c85cfd","type":"group","z":"f40271d9.9f445","g":"5c70dc07dc72a49e","name":"Toggle Motion Detection at Sunrise/Sunset","style":{"label":true,"fill":"#9363b7","color":"#ffC000"},"nodes":["a4699014c7ab3dbc","1f113446a6c34572","6673a9050f5a2fed","256d645783461bb2"],"x":1030,"y":3163},{"id":"7c5a1277881034f6","type":"group","z":"c4865e43.cbd68","g":"f0830a38.efdca8","name":"Alexa / Ikea Button Activation","style":{"stroke":"#6f2fa0","fill":"#dbcbe7","label":true,"color":"#6f2fa0"},"nodes":["795dd1991d81f16f","795d838a6437da93","ec834d127fe7a869","9b85b7e2609b9d26","bd8b56206a81119d","f6f2d0501c58c7cb","66bef51808022751","e14dedaf2d48a062","7f5c4d78913bafc5","f39fd6f11284fdbc","799d24f95394e335"],"x":106,"y":1675,"w":1484,"h":226},{"id":"7fe1d3a64de8b851","type":"group","z":"bb37110c.14f0d","g":"1c74523d2b35a2f7","name":"Kitchen Fairy Lights","style":{"stroke":"#6f2fa0","fill":"#ffdf7f","label":true,"color":"#6f2fa0"},"nodes":["d52557ddbd05b423","788e168e362257f0","12a5b2f9aed671ff","82cf946f25a738c9","1dfa5d28219104ee","b530e2de711bfe80","6ddb24ea79b0efbe","3073187f76502d9b"],"x":1674,"y":607},{"id":"34092f65e4683e6f","type":"group","z":"bb37110c.14f0d","g":"1c74523d2b35a2f7","name":"Kids Toilet (see notes)","style":{"label":true,"stroke":"#6f2fa0","fill":"#bfdbef","color":"#6f2fa0"},"nodes":["44d3ce14fab2b7e9","f0e4738a2a8ed025","e0394a039efbaa99","f9810ab8fc3143ca","905a337b8d7b6f6f","9912903e3dec1c7b","6bf582985491bfca","77dcdb23e6d2e2c5","145ac0cc0669a240","683dedd612679e93","a7cc6bc5947f137f","f79f7cc0d38b9058","b672dca90505c4d0","c4dd8cd29495d7a6","577949bc373783eb","1c4e6bcbad62b805","3530f9499b2d2e4d","bfb9f509ff84ae91","04f8c83bb6ce844d","669290fcba6bd46e","f090d87c0c01264e","d3e39c98909bedf6"],"x":1682,"y":859,"info":"When motion detected Sonoff motion sensor sends:\n    msg.payload.occupancy=true\n\nAfter 60s it sends:\n    msg.payload.occupancy=false\n    \nSometimes the sensor won't send a 'false' if motion continues to be detected. Not certain waits until no motion for 60s then sends a 'false' as it seems a bit inconsistent - sometimes motion can occur and 'false' is still sent, sometimes motion occurs and 'true' is sent occasionally to notify of motion but sometimes not.\n\nFlow does:\n- Turn on light with every 'true'. And cancel any off timer.\n- Turn off light Xs after false sent.\n\nWe would usually use 'true' to trigger light off delay and reset delay after every true received.\nBut can't use the 'true' to trigger since the sensor sometimes doesn't re-send 'true' if motion continues after initial detection so delay won't continue to be reset while occupied. \nSo we need to use 'false' as trigger. i.e. turn off light Xs after false sent.\n"},{"id":"fa52424f.aa5cc","type":"group","z":"c4865e43.cbd68","g":"4c692d016af44cb6","name":"Alexa - Movie Mode","style":{"label":true,"fill":"#3f93cf","color":"#6f2fa0"},"nodes":["a0278a38.fa25d8","c689a791.8edae8","92c45425.a28b08","f87f5dfa.e01ae"],"x":98,"y":403,"w":920,"h":142},{"id":"794a9eab.51d4e","type":"group","z":"c4865e43.cbd68","g":"4c692d016af44cb6","name":"Ikea Dimmer (DISABLED)","style":{"fill":"#3f93cf","label":true,"color":"#6f2fa0"},"nodes":["e03d182e.9679c8","c7fef4b1.4e5ad8","8eb9448d.0af2f8","3ffb2cd.b82f7d4","53cfc109.a6f37","42b195c7.57c87c","38214c2e.2bf244"],"x":1038,"y":403,"w":932,"h":238},{"id":"afbfe317f7b9cc3a","type":"group","z":"c4865e43.cbd68","g":"4c692d016af44cb6","name":"Node Red Websocket","style":{"fill":"#3f93cf","label":true,"color":"#6f2fa0"},"nodes":["d1490f4f9ae4d65b","02ebad81ccf36822","046cb80e239ef061","4e6b5ce831ec8466","92debfc00f93af82","4b45a3c23f824eb0","db0178a8409da0b5"],"x":1994,"y":415,"w":904,"h":262},{"id":"1b818000.2352e","type":"group","z":"f40271d9.9f445","g":"5732b5b7.27115c","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["b44967e4.0904f8","99ee333d.2be1e","c38141dc.8886a","b0fbe5d5.787878","28afee4.de3bf12"],"x":2362,"y":2383},{"id":"c7f4a247.24ddf","type":"group","z":"f40271d9.9f445","g":"5732b5b7.27115c","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["a266a84.e529c58","88f8392.5a486c8","6034cac5.da1034","cc2c6949.61fc48","e15fa29a.ad4eb"],"x":2362,"y":2551},{"id":"ff03c6b0.3ed978","type":"group","z":"f40271d9.9f445","g":"5732b5b7.27115c","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["ba5ebc76.336b2","3c40958a.bbfd1a","cf497f93.bed4d","36667e2c.40ded2","d70275e0.529ca8"],"x":2362,"y":2227},{"id":"5c3424b6.5bab8c","type":"group","z":"f40271d9.9f445","g":"5732b5b7.27115c","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["4e4cb88a.7f7ce8","ce3aedc9.d0e64","c79d6e90.0f5a1","1224e837.f4ba38","594fbd1a.935334"],"x":2362,"y":2713},{"id":"0d1ac708363d143e","type":"group","z":"0cca5f120542a932","g":"4d443c555e118a02","name":"Get Status of Motion Enabled toggle from HA","style":{"stroke":"#ff3f3f","label":true,"color":"#ff3f3f"},"nodes":["b98f41d40de092e8","b0a9c2e78fb0b847"],"x":82,"y":703,"w":408,"h":82},{"id":"2eb8ad990ea06edc","type":"group","z":"0cca5f120542a932","g":"586cf944de0582f3","name":"Reboot back garden LED strip","style":{"stroke":"#6f2fa0","fill":"#ffff7f","label":true,"color":"#6f2fa0","fill-opacity":"0"},"nodes":["65fffd99671c43c9","6fb9d985b3c3e7e2","d5f5c8cf6a839df0"],"x":2094,"y":607,"w":476,"h":118},{"id":"e5643e5e5290ee60","type":"group","z":"a28aa095.d828e","g":"2233ae63732529db","name":"Monitor Slack Workspace","style":{"stroke":"#6f2fa0","label":true,"color":"#6f2fa0"},"nodes":["5fb56e70079c92d8","d753c9702bf34c4d","58123ee08d25cfee"],"x":130,"y":631,"w":504,"h":82},{"id":"52601706ab6bc681","type":"group","z":"0cca5f120542a932","g":"627bac64c8c2cdf5","name":"Get Status of Motion Enabled toggle from HA","style":{"stroke":"#ff3f3f","label":true,"color":"#ff3f3f"},"nodes":["a104c18399c2fd4a","7ec2b37007f411b2"],"x":2394,"y":805,"w":408,"h":82},{"id":"ffc9651b0db40152","type":"group","z":"0cca5f120542a932","g":"627bac64c8c2cdf5","name":"Set Global Var to track Front Door Light status changes","style":{"label":true,"stroke":"#ff3f3f","color":"#ff3f3f"},"nodes":["ed0ec8b77e0dd97b","be0fc09e8cb16634"],"x":3086,"y":805,"w":432,"h":82},{"id":"3580c3bfdc9620cc","type":"group","z":"0cca5f120542a932","g":"627bac64c8c2cdf5","name":"Ikea 5-Button - Toggle Lights On/Off (no auto-off timer) [currently not using]","style":{"label":true,"stroke":"#777777","fill":"#a4a4a4","fill-opacity":"0.26","color":"#777777"},"nodes":["c2c6f7c7aaa8d552","f12b39dca16e839a","57449c87079f9c57","3d943894927e7512","f366feae9882e575","bf7b1d021bf52a41","28c648d01a5936e6"],"x":2354,"y":1045,"w":904,"h":178},{"id":"894f21cb4a05c11c","type":"group","z":"97bc4677a5be4b40","g":"941c8667b42ee67b","name":"Query current Distances","style":{"label":true},"nodes":["64b56c35bb87ca93","21dba3ee06c9d07a"],"x":1880,"y":3703},{"id":"13d5806d2b20f7a7","type":"group","z":"97bc4677a5be4b40","g":"941c8667b42ee67b","name":"Watch for device moving away further than specified distance and create/update HA entity to enable alerts","style":{"stroke":"#ffC000","fill":"#dbcbe7","label":true,"color":"#6f2fa0"},"nodes":["d3e53d38d996037d","71b4a531d881efc5","01f48a084ec3afca","d4c8ed940cb96649","8010c1803782028d","6381e444ac5d0caa"],"x":86,"y":3211},{"id":"125661a029168d57","type":"group","z":"97bc4677a5be4b40","g":"941c8667b42ee67b","name":"Watch for device moving towards home and alert if moved specified %","style":{"stroke":"#6f2fa0","fill":"#dbcbe7","label":true,"color":"#6f2fa0"},"nodes":["16498e681d3a91d2","e16ce8d1baf77dbd","ebcf07ef85f8a347","f3ceb449e8357efd","3fd0c14ecbe8e72f","3b927de2544723db","e5a74dc60c9b9966","75eba99ab9a30ecc","95da1032eec6dd00","8e65fed3de6acd47","d6693d6411c03d4b","fc8581d42e22c82a","95b1f4f68a1e9dfa","9ac5a356cb827bc0","e181281bf05de679","8707f9ed82c05c29","3982544b5ec84c8a","eaa1e5db9f925d7c"],"x":84,"y":3427},{"id":"ec17b211cfef25b5","type":"group","z":"97bc4677a5be4b40","g":"941c8667b42ee67b","name":"Manually Turn On/Off Alert","style":{"stroke":"#ffC000","fill":"#dbcbe7","label":true,"color":"#6f2fa0"},"nodes":["2d26965165caa13d","1460b4bd530e017b","5b10d4faa6fbec6e","6def5187a43b33b4","eb4b92895e0f26aa"],"x":1354,"y":3211},{"id":"f37a15a6.4f07a8","type":"group","z":"c4865e43.cbd68","g":"6c184314.2b82bc","name":"Toggle Motion Detection at Sunrise/Sunset","style":{"label":true,"fill":"#9363b7","color":"#ffC000"},"nodes":["cb528f3e.6d389","7e6a90bb.0a40f","41d7420.a1f89c","c253e55d.4e3a18"],"x":130,"y":1495,"w":846,"h":130},{"id":"3b49c004.6176a","type":"server","name":"Home Assistant - Old","version":5,"addon":false,"rejectUnauthorizedCerts":false,"ha_boolean":"y|yes|true|on|home|open","connectionDelay":true,"cacheJson":true,"heartbeat":false,"heartbeatInterval":"30","areaSelector":"friendlyName","deviceSelector":"friendlyName","entitySelector":"friendlyName","statusSeparator":"at: ","statusYear":"hidden","statusMonth":"short","statusDay":"numeric","statusHourCycle":"h23","statusTimeFormat":"h:m","enableGlobalContextStore":true},{"id":"e96cb00d.af953","type":"mqtt-broker","name":"MQTT","broker":"192.168.0.10","port":"1883","clientid":"nodered","autoConnect":true,"usetls":false,"protocolVersion":"4","keepalive":"60","cleansession":true,"birthTopic":"nodered/status/","birthQos":"0","birthPayload":"hello","birthMsg":{},"closeTopic":"nodered/status/","closeQos":"0","closePayload":"byebye","closeMsg":{},"willTopic":"nodered/status/","willQos":"0","willPayload":"died","willMsg":{},"sessionExpiry":""},{"id":"39451665.94000a","type":"light-scheduler-settings","name":"GPS Coord - Home","latitude":"55.889","longitude":"-3.635"},{"id":"f2eb4ebb.da604","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","reset":false},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"true","lockMenu":"true","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"188079bd.534b86","type":"spotify-auth","z":"fd8eb98d.2d1be8","name":"Spotify OAuth2","scope":"playlist-read-private\nplaylist-modify-private\nplaylist-modify-public\nplaylist-read-collaborative\nuser-modify-playback-state\nuser-read-currently-playing\nuser-read-playback-state\nuser-top-read\nuser-read-recently-played\napp-remote-control\nstreaming\nuser-read-birthdate\nuser-read-email\nuser-read-private\nuser-follow-read\nuser-follow-modify\nuser-library-modify\nuser-library-read"},{"id":"26350208.abcdbe","type":"pushover-keys","name":"Pushover"},{"id":"2d9e1c07.fe99b4","type":"pushbullet-config","name":"Pushbullet"},{"id":"c341166.e0c82e8","type":"alexa-remote-account","name":"Alexa","authMethod":"proxy","proxyOwnIp":"192.168.0.226","proxyPort":"3456","cookieFile":"/data/alexa-remote2.txt","refreshInterval":"3","alexaServiceHost":"alexa.amazon.co.uk","amazonPage":"amazon.co.uk","acceptLanguage":"en-UK","userAgent":"","useWsMqtt":"on","autoInit":"on"},{"id":"e95d0919.911918","type":"ui_link","name":"Link 3","link":"https://ha.mc-guinness.co.uk/lovelace/people--and--device-tracking","icon":"open_in_browser","target":"newtab","order":3},{"id":"f0cc4845.3e9e28","type":"zigbee2mqtt-server","name":"Z2M","host":"192.168.0.10","mqtt_port":"1883","mqtt_username":"","mqtt_password":"","mqtt_qos":"0","tls":"","usetls":false,"base_topic":"zigbee2mqtt"},{"id":"7bea4aa8.d8cdb4","type":"ui_group","name":"Choose","tab":"d90ac71.2bb0038","order":1,"disp":true,"width":"6","collapse":false},{"id":"39eba160.64cc2e","type":"ui_group","name":"Controls","tab":"d90ac71.2bb0038","order":2,"disp":true,"width":"6","collapse":false},{"id":"c67b7b1.78a7c88","type":"ui_group","name":"Music","tab":"d90ac71.2bb0038","order":3,"disp":true,"width":"6","collapse":false},{"id":"d90ac71.2bb0038","type":"ui_tab","name":"Alexa Play Music","icon":"speaker","order":12,"disabled":false,"hidden":false},{"id":"326ce2f.8d02d1e","type":"ui_group","name":"Alexa Speak","tab":"fc4efe2d.639d2","order":1,"disp":true,"width":"6","collapse":false},{"id":"fc4efe2d.639d2","type":"ui_tab","name":"Alexa Speak","icon":"speaker","order":2},{"id":"2315beea.977712","type":"ui_group","name":"To do","tab":"25dc5022.14d9","order":2,"disp":true,"width":6,"collapse":false},{"id":"1654aec2.080031","type":"ui_group","name":"Shopping","tab":"25dc5022.14d9","order":1,"disp":true,"width":6,"collapse":false},{"id":"25dc5022.14d9","type":"ui_tab","name":"Alexa Lists","icon":"list","order":12,"disabled":false,"hidden":false},{"id":"765c4d0d.672094","type":"ui_group","name":"Timers","tab":"8ed3b3d9.bbfcb","order":1,"disp":true,"width":"6","collapse":false},{"id":"8ed3b3d9.bbfcb","type":"ui_tab","name":"Alexa Timers","icon":"fa-clock-o","order":1,"disabled":false,"hidden":false},{"id":"9d9ad3f4.49ce7","type":"influxdb","hostname":"victoriametrics","port":"8428","protocol":"http","database":"nodered","name":"VictoriaMetrics","usetls":false,"tls":"","influxdbVersion":"1.x","url":"","rejectUnauthorized":false},{"id":"156cbaf37034f65b","type":"influxdb","hostname":"influxdb","port":"8086","protocol":"http","database":"nodered","name":"InfluxDB","usetls":false,"tls":"","influxdbVersion":"1.x","url":"http://localhost:8086","rejectUnauthorized":true},{"id":"27519cf66f268968","type":"influxdb","hostname":"vmagent","port":"8429","protocol":"http","database":"nodered","name":"","usetls":false,"tls":"","influxdbVersion":"1.x","url":"http://localhost:8086","rejectUnauthorized":true},{"id":"ebb6b83c7588d734","type":"server","name":"Home Assistant","version":5,"addon":false,"rejectUnauthorizedCerts":false,"ha_boolean":"y|yes|true|on|home|open","connectionDelay":true,"cacheJson":true,"heartbeat":false,"heartbeatInterval":"30","areaSelector":"friendlyName","deviceSelector":"friendlyName","entitySelector":"friendlyName","statusSeparator":"at: ","statusYear":"hidden","statusMonth":"short","statusDay":"numeric","statusHourCycle":"h23","statusTimeFormat":"h:m","enableGlobalContextStore":true},{"id":"a797b70842226842","type":"tradfri-config","name":"Ikea Tradfri","gatewayHost":"192.168.0.103","identity":"tradfri_1664018537530","preSharedKey":"OPCRyBMMKFFX7ZwO"},{"id":"4a2333f3b1c1ed2b","type":"slack-config","name":"Slack"},{"id":"8376297.e425fd8","type":"inject","z":"a86052fe.2cfcb","name":"on","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":86,"y":48,"wires":[[]]},{"id":"258b5841.cbe818","type":"inject","z":"a86052fe.2cfcb","name":"off","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"off","payloadType":"str","x":98,"y":84,"wires":[[]]},{"id":"38336833.14af78","type":"debug","z":"a86052fe.2cfcb","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":302,"y":36,"wires":[]},{"id":"e702410f.caab2","type":"debug","z":"a86052fe.2cfcb","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"data","targetType":"msg","statusVal":"","statusType":"auto","x":312,"y":108,"wires":[]},{"id":"f380ce59.6f90b","type":"debug","z":"a86052fe.2cfcb","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":322,"y":72,"wires":[]},{"id":"1f44fcd1.fec203","type":"api-current-state","z":"a86052fe.2cfcb","g":"53fa7592.36691c","name":"","server":"ebb6b83c7588d734","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.layzspa_energy","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":858,"y":108,"wires":[["2a91c4cd.3445dc","729dbfb1.5b28d","806acd6b.ff745"]]},{"id":"2a91c4cd.3445dc","type":"debug","z":"a86052fe.2cfcb","g":"53fa7592.36691c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1178,"y":72,"wires":[]},{"id":"806acd6b.ff745","type":"debug","z":"a86052fe.2cfcb","g":"53fa7592.36691c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"data","targetType":"msg","statusVal":"","statusType":"auto","x":1188,"y":144,"wires":[]},{"id":"729dbfb1.5b28d","type":"debug","z":"a86052fe.2cfcb","g":"53fa7592.36691c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1198,"y":108,"wires":[]},{"id":"2b8f9fb3.c5987","type":"inject","z":"a86052fe.2cfcb","g":"53fa7592.36691c","name":"Get current state","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":572,"y":108,"wires":[["1f44fcd1.fec203"]]},{"id":"214ea877.1e91a8","type":"inject","z":"a86052fe.2cfcb","name":"Go!","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":110,"y":120,"wires":[[]]},{"id":"4c96c2991dfbde4f","type":"tradfri-monitor","z":"a86052fe.2cfcb","gateway":"a797b70842226842","name":"","x":1202,"y":444,"wires":[["f01fc27ccd0c1ead"]]},{"id":"f01fc27ccd0c1ead","type":"debug","z":"a86052fe.2cfcb","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1382,"y":384,"wires":[]},{"id":"942d8226aa021d85","type":"tradfri-state","z":"a86052fe.2cfcb","gateway":"a797b70842226842","name":"","accessories":["65539","65560","65539","65560"],"groups":[],"logInputErrors":true,"x":1230,"y":540,"wires":[["04203029c9562c5d"]]},{"id":"04203029c9562c5d","type":"debug","z":"a86052fe.2cfcb","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1410,"y":492,"wires":[]},{"id":"fa8ef0623a777fdf","type":"inject","z":"a86052fe.2cfcb","name":"on","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":1034,"y":504,"wires":[["942d8226aa021d85"]]},{"id":"469c1313757ef4c1","type":"inject","z":"a86052fe.2cfcb","name":"on","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":1010,"y":384,"wires":[["1050429512547ec6"]]},{"id":"1050429512547ec6","type":"tradfri-light-control","z":"a86052fe.2cfcb","gateway":"a797b70842226842","name":"","action":"{\"onOff\":true}","accessories":[],"groups":[],"logInputErrors":true,"x":1174,"y":372,"wires":[]},{"id":"c433583bc4d99bc9","type":"inject","z":"a86052fe.2cfcb","name":"off","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"off","payloadType":"str","x":1002,"y":324,"wires":[["1050429512547ec6"]]},{"id":"b3183be9334c101f","type":"http response","z":"a86052fe.2cfcb","g":"b5444aad191f3b82","name":"Websocket Response","statusCode":"200","headers":{},"x":1508,"y":2412,"wires":[]},{"id":"cc46918a51544e4f","type":"http in","z":"a86052fe.2cfcb","g":"b5444aad191f3b82","name":"webhook-kids-toilet-switch-on","url":"/webhook-kids-toilet-switch-on","method":"get","upload":false,"swaggerDoc":"","x":1464,"y":2196,"wires":[["b3183be9334c101f","a4abb82e6708ed2c"]]},{"id":"8aee6b55dc8d5607","type":"http in","z":"a86052fe.2cfcb","g":"b5444aad191f3b82","name":"webhook-kids-toilet-switch-off","url":"/webhook-kids-toilet-switch-off","method":"get","upload":false,"swaggerDoc":"","x":1464,"y":2232,"wires":[["ddf52af8e8135ec9","b3183be9334c101f"]]},{"id":"6fe4ad4346db1f09","type":"http in","z":"a86052fe.2cfcb","g":"b5444aad191f3b82","name":"webhook-kids-toilet-output-on","url":"/webhook-kids-toilet-output-on","method":"get","upload":false,"swaggerDoc":"","x":1476,"y":2268,"wires":[["de24387a95ddf26c","b3183be9334c101f"]]},{"id":"af13c29c6141b1ec","type":"http in","z":"a86052fe.2cfcb","g":"b5444aad191f3b82","name":"webhook-kids-toilet-output-off","url":"/webhook-kids-toilet-output-off","method":"get","upload":false,"swaggerDoc":"","x":1488,"y":2304,"wires":[["f314ece1b01ae013","b3183be9334c101f"]]},{"id":"a4abb82e6708ed2c","type":"debug","z":"a86052fe.2cfcb","g":"b5444aad191f3b82","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1822,"y":2196,"wires":[]},{"id":"ddf52af8e8135ec9","type":"debug","z":"a86052fe.2cfcb","g":"b5444aad191f3b82","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1822,"y":2232,"wires":[]},{"id":"de24387a95ddf26c","type":"debug","z":"a86052fe.2cfcb","g":"b5444aad191f3b82","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1818,"y":2280,"wires":[]},{"id":"f314ece1b01ae013","type":"debug","z":"a86052fe.2cfcb","g":"b5444aad191f3b82","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1814,"y":2316,"wires":[]},{"id":"1139a03d.d1ca","type":"change","z":"a86052fe.2cfcb","g":"ce1d75f78d8602d1","name":"Reset","rules":[{"t":"set","p":"reset","pt":"msg","to":"foo","tot":"str"},{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":538,"y":2340,"wires":[["fcb3cb17.693a9"]]},{"id":"900577c3.9deb4","type":"inject","z":"a86052fe.2cfcb","g":"ce1d75f78d8602d1","name":"Reset","repeat":"","crontab":"","once":true,"onceDelay":"0.5","topic":"","payload":"","payloadType":"date","x":358,"y":2300,"wires":[["1139a03d.d1ca"]]},{"id":"820bd696.fbc028","type":"debug","z":"a86052fe.2cfcb","g":"ce1d75f78d8602d1","name":"Four presses","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1108,"y":2440,"wires":[]},{"id":"525e3ec9.3bb6b8","type":"inject","z":"a86052fe.2cfcb","g":"ce1d75f78d8602d1","name":"Start","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":201.33331298828125,"y":2271.111083984375,"wires":[["fcb3cb17.693a9","ba72e20d.299b8"]]},{"id":"fcb3cb17.693a9","type":"counter","z":"a86052fe.2cfcb","g":"ce1d75f78d8602d1","name":"","init":"0","step":"1","lower":"","upper":"","mode":"increment","outputs":"1","x":548,"y":2270,"wires":[["9faf97df.4ce4a"]]},{"id":"4189a6d1.44073","type":"switch","z":"a86052fe.2cfcb","g":"ce1d75f78d8602d1","name":"count presses","property":"count","propertyType":"flow","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"},{"t":"eq","v":"3","vt":"num"},{"t":"eq","v":"4","vt":"num"}],"checkall":"true","repair":false,"outputs":4,"x":718,"y":2380,"wires":[["83d02113.4743b8"],["fbfe53e5.4fcae8"],["e22efc97.c6b018"],["d9a249bd.1f82a8"]],"info":"Just expand the flow.count to how ever many\npresses you want/need."},{"id":"ba72e20d.299b8","type":"trigger","z":"a86052fe.2cfcb","g":"ce1d75f78d8602d1","name":"","op1":"","op2":"0","op1type":"nul","op2type":"str","duration":"1","extend":true,"units":"s","reset":"","bytopic":"all","outputs":1,"x":368,"y":2380,"wires":[["62860129.ec7bd","4189a6d1.44073"]]},{"id":"9faf97df.4ce4a","type":"change","z":"a86052fe.2cfcb","g":"ce1d75f78d8602d1","name":"Flow set","rules":[{"t":"set","p":"count","pt":"flow","to":"count","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":698,"y":2270,"wires":[["a018a094.13d14"]]},{"id":"ddd0ab58.0a3e58","type":"debug","z":"a86052fe.2cfcb","g":"ce1d75f78d8602d1","name":"Tripple press","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1108,"y":2400,"wires":[]},{"id":"ed9739c.0628148","type":"debug","z":"a86052fe.2cfcb","g":"ce1d75f78d8602d1","name":"Double press","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1108,"y":2360,"wires":[]},{"id":"8082f0.4ba02d1","type":"debug","z":"a86052fe.2cfcb","g":"ce1d75f78d8602d1","name":"Single Press","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1108,"y":2320,"wires":[]},{"id":"83d02113.4743b8","type":"change","z":"a86052fe.2cfcb","g":"ce1d75f78d8602d1","name":"Single Press","rules":[{"t":"set","p":"payload","pt":"msg","to":"Single Press","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":928,"y":2320,"wires":[["8082f0.4ba02d1"]]},{"id":"fbfe53e5.4fcae8","type":"change","z":"a86052fe.2cfcb","g":"ce1d75f78d8602d1","name":"Double Press","rules":[{"t":"set","p":"payload","pt":"msg","to":"Double Press","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":938,"y":2360,"wires":[["ed9739c.0628148"]]},{"id":"e22efc97.c6b018","type":"change","z":"a86052fe.2cfcb","g":"ce1d75f78d8602d1","name":"Tripple Press","rules":[{"t":"set","p":"payload","pt":"msg","to":"Tripple Press","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":928,"y":2400,"wires":[["ddd0ab58.0a3e58"]]},{"id":"d9a249bd.1f82a8","type":"change","z":"a86052fe.2cfcb","g":"ce1d75f78d8602d1","name":"Four Press","rules":[{"t":"set","p":"payload","pt":"msg","to":"Four Press","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":928,"y":2440,"wires":[["820bd696.fbc028"]]},{"id":"a1783324.3f9f","type":"comment","z":"a86052fe.2cfcb","g":"ce1d75f78d8602d1","name":"DELAY - Readme","info":"The DELAY time has to be a bit longer than how\nlong it takes you to press the button the\nmaximum number of times.\nRead information in the SWITCH node too!","x":748,"y":2190,"wires":[]},{"id":"660d35d0.b41aa4","type":"comment","z":"a86052fe.2cfcb","g":"ce1d75f78d8602d1","name":"Input","info":"","x":358,"y":2230,"wires":[]},{"id":"f91932b.cacfb5","type":"comment","z":"a86052fe.2cfcb","g":"ce1d75f78d8602d1","name":"Outputs","info":"Debug nodes are here now, but just connect\nthem to what ever you want.\nThe messages sent are in the nodes just before\nthe debug nodes.\n","x":1088,"y":2280,"wires":[]},{"id":"a018a094.13d14","type":"debug","z":"a86052fe.2cfcb","g":"ce1d75f78d8602d1","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"count","targetType":"msg","x":928,"y":2270,"wires":[]},{"id":"62860129.ec7bd","type":"delay","z":"a86052fe.2cfcb","g":"ce1d75f78d8602d1","name":"Delay","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":358,"y":2340,"wires":[["1139a03d.d1ca"]]},{"id":"83e4b1cd630aec25","type":"debug","z":"a86052fe.2cfcb","g":"dd8630ba295cbfa1","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":550,"y":1692,"wires":[]},{"id":"919ce8fad8ad190b","type":"trigger","z":"a86052fe.2cfcb","g":"dd8630ba295cbfa1","name":"delay","op1":"","op2":"reset","op1type":"nul","op2type":"str","duration":"3","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":606,"y":1896,"wires":[["0b94272633e214d7"]],"info":"The delay will be extended with every message / klick. With this behaver it is possible to detect also longer sequences of clicks."},{"id":"0b94272633e214d7","type":"change","z":"a86052fe.2cfcb","g":"dd8630ba295cbfa1","name":"Reset","rules":[{"t":"set","p":"reset","pt":"msg","to":"foo","tot":"str"},{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":746,"y":1896,"wires":[["053c6ea8f53cdd22","1961226b95642688"]]},{"id":"053c6ea8f53cdd22","type":"counter","z":"a86052fe.2cfcb","g":"dd8630ba295cbfa1","name":"button counter","init":"0","step":"1","lower":"","upper":"","mode":"increment","outputs":1,"x":856,"y":1836,"wires":[["fdf2b7761e0db639"]]},{"id":"fdf2b7761e0db639","type":"function","z":"a86052fe.2cfcb","g":"dd8630ba295cbfa1","name":"click actions","func":"var newMsg = {payload: null, topic: null};\n\n// click action\nswitch(msg.count)\n{\n    case 0: //do nothing after reset the counter to zero\n        break;\n        \n    case 1: // single click action\n        node.warn(\"Kids Toilet Light - Motion Override - 1 Click\");\n        break;\n    \n    case 2: // double click action\n        newMsg.topic = \"2 clicks\";\n        newMsg.payload = \"on\";\n        break;\n    \n    case 3: // three clicks action\n        newMsg.topic = \"3 clicks\";\n        newMsg.payload = \"on\";\n        break;\n    \n    default: // more clicks action\n        node.warn(\"Kids Toilet Light - Motion Override - 4 Clicks\");\n        break;\n}\n\n\nif(newMsg.topic !== null){          // send if a action should perform\n    return newMsg;\n}","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is deployed.\nconst dimmingTopic = \"dimming\";\ncontext.set(dimmingTopic, 200); ","finalize":"","libs":[],"x":1046,"y":1836,"wires":[["1858c37fc42a9755","df70fbe4dabf9466"]]},{"id":"1858c37fc42a9755","type":"debug","z":"a86052fe.2cfcb","g":"dd8630ba295cbfa1","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1194,"y":1884,"wires":[]},{"id":"68fc0d95f568f8f3","type":"inject","z":"a86052fe.2cfcb","g":"dd8630ba295cbfa1","name":"Test Counter","props":[{"p":"banana","v":"nice!","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":790,"y":1704,"wires":[["053c6ea8f53cdd22","919ce8fad8ad190b"]]},{"id":"1961226b95642688","type":"debug","z":"a86052fe.2cfcb","g":"dd8630ba295cbfa1","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":894,"y":1944,"wires":[]},{"id":"a99bf89babfd83c1","type":"trigger-state","z":"a86052fe.2cfcb","d":true,"g":"dd8630ba295cbfa1","name":"","server":"ebb6b83c7588d734","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"switch.kids_toilet_light_shelly1pm_02","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"inputs":1,"outputs":2,"customoutputs":[],"outputinitially":true,"state_type":"str","enableInput":true,"x":330,"y":1776,"wires":[["83e4b1cd630aec25","053c6ea8f53cdd22","919ce8fad8ad190b"],["286f54d99eb85f45"]]},{"id":"286f54d99eb85f45","type":"change","z":"a86052fe.2cfcb","g":"dd8630ba295cbfa1","name":"Light Off: Set Override = False","rules":[{"t":"set","p":"kids-toilet-motion-override","pt":"flow","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":298,"y":1896,"wires":[["3107b6306e25e62d"]]},{"id":"df70fbe4dabf9466","type":"change","z":"a86052fe.2cfcb","g":"dd8630ba295cbfa1","name":"Set Override = True","rules":[{"t":"set","p":"kids-toilet-motion-override","pt":"flow","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1234,"y":1764,"wires":[["7d6e35e2c5b9990c"]]},{"id":"7d6e35e2c5b9990c","type":"debug","z":"a86052fe.2cfcb","g":"dd8630ba295cbfa1","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1446,"y":1764,"wires":[]},{"id":"3107b6306e25e62d","type":"debug","z":"a86052fe.2cfcb","g":"dd8630ba295cbfa1","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":514,"y":1980,"wires":[]},{"id":"4918bc86809ae6f7","type":"inject","z":"a86052fe.2cfcb","g":"dd8630ba295cbfa1","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"0.5","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":766,"y":2064,"wires":[["174de8ff308905b5"]]},{"id":"174de8ff308905b5","type":"switch","z":"a86052fe.2cfcb","g":"dd8630ba295cbfa1","name":"Allow if Override=False","property":"kids-toilet-motion-override","propertyType":"flow","rules":[{"t":"false"}],"checkall":"true","repair":false,"outputs":1,"x":1010,"y":2064,"wires":[["3f059a3f7c70071d"]]},{"id":"3f059a3f7c70071d","type":"debug","z":"a86052fe.2cfcb","g":"dd8630ba295cbfa1","name":"","active":true,"tosidebar":false,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1238,"y":2064,"wires":[]},{"id":"9dc85a4107b28f48","type":"mqtt in","z":"a86052fe.2cfcb","d":true,"g":"1474554de045623b","name":"","topic":"shellies/shelly1pm-kids-toilet/relay/0/command","qos":"2","datatype":"auto-detect","broker":"e96cb00d.af953","nl":false,"rap":true,"rh":0,"inputs":0,"x":1022,"y":948,"wires":[["1087354ba8328173","e4fab5da344ace62","db74110422ba4952"]]},{"id":"1087354ba8328173","type":"debug","z":"a86052fe.2cfcb","g":"1474554de045623b","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1282,"y":888,"wires":[]},{"id":"db74110422ba4952","type":"change","z":"a86052fe.2cfcb","g":"1474554de045623b","name":"Motion Triggered - Set Var to Prevent Override Change","rules":[{"t":"set","p":"kids-toilet-motion-triggered-prevent-override","pt":"flow","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1532,"y":948,"wires":[["28fb722b7582c630"]]},{"id":"e4fab5da344ace62","type":"trigger","z":"a86052fe.2cfcb","g":"1474554de045623b","name":"","op1":"","op2":"reset","op1type":"nul","op2type":"str","duration":"3","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1220,"y":1032,"wires":[["fbdd47bc6e462f56"]],"info":"The delay will be extended with every message / klick. With this behaver it is possible to detect also longer sequences of clicks."},{"id":"fbdd47bc6e462f56","type":"change","z":"a86052fe.2cfcb","g":"1474554de045623b","name":"Set Var to Allow Override Change","rules":[{"t":"set","p":"kids-toilet-motion-triggered-prevent-override","pt":"flow","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1468,"y":1020,"wires":[["f6766608c6ecdbd6"]]},{"id":"fd7b329ca5ab5160","type":"trigger-state","z":"a86052fe.2cfcb","d":true,"g":"1474554de045623b","name":"","server":"ebb6b83c7588d734","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"switch.kids_toilet_light_shelly1pm_02","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"inputs":1,"outputs":2,"customoutputs":[],"outputinitially":true,"state_type":"str","enableInput":true,"x":406,"y":1248,"wires":[["0300c1e7cf738421","c0060c10f02b09a4"],["a0a7d78c5778711d","01fab2a16d349325"]]},{"id":"90fe95e8a65f6e93","type":"change","z":"a86052fe.2cfcb","g":"1474554de045623b","name":"Set Override = True","rules":[{"t":"set","p":"kids-toilet-motion-override","pt":"flow","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":966,"y":1224,"wires":[["6a73aa8bb222f1bc","9a1a126ca419dab0","8096e72995a0d6f4"]]},{"id":"0300c1e7cf738421","type":"switch","z":"a86052fe.2cfcb","g":"1474554de045623b","name":"If Override Allowed","property":"kids-toilet-motion-triggered-prevent-override","propertyType":"flow","rules":[{"t":"neq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":738,"y":1224,"wires":[["90fe95e8a65f6e93","23652b3d087ee80d"]]},{"id":"a0a7d78c5778711d","type":"change","z":"a86052fe.2cfcb","g":"1474554de045623b","name":"Light Off: Set Override = False","rules":[{"t":"set","p":"kids-toilet-motion-override","pt":"flow","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":806,"y":1308,"wires":[["a515787ee77be2db","8096e72995a0d6f4"]]},{"id":"cafc06a1600a5cbe","type":"inject","z":"a86052fe.2cfcb","g":"1474554de045623b","name":"Test Counter","props":[{"p":"banana","v":"nice!","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":478,"y":1140,"wires":[["0300c1e7cf738421"]]},{"id":"2462fc9762fc8cfb","type":"mqtt out","z":"a86052fe.2cfcb","d":true,"g":"1474554de045623b","name":"","topic":"","qos":"2","retain":"true","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"e96cb00d.af953","x":1510,"y":1308,"wires":[]},{"id":"6a73aa8bb222f1bc","type":"change","z":"a86052fe.2cfcb","g":"1474554de045623b","name":"Toilet Light Off","rules":[{"t":"set","p":"topic","pt":"msg","to":"shellies/shelly1pm-kids-toilet/relay/0/command","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"off","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1172,"y":1224,"wires":[["2462fc9762fc8cfb","bc688ddd5b4da6b2","f7a7415019b88b3d"]]},{"id":"0dca1c80767cb528","type":"change","z":"a86052fe.2cfcb","g":"1474554de045623b","name":"Toilet Light On","rules":[{"t":"set","p":"topic","pt":"msg","to":"shellies/shelly1pm-kids-toilet/relay/0/command","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"on","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1768,"y":1224,"wires":[["2462fc9762fc8cfb","a69624a76cd6d4e8"]]},{"id":"be676d3c4f189a11","type":"change","z":"a86052fe.2cfcb","g":"1474554de045623b","name":"Toilet Light On","rules":[{"t":"set","p":"topic","pt":"msg","to":"shellies/shelly1pm-kids-toilet/relay/0/command","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"on","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1384,"y":1224,"wires":[["5cbd8e095df0cb04","8f3062a48b9c0497"]]},{"id":"6eb3dc61252353eb","type":"change","z":"a86052fe.2cfcb","g":"1474554de045623b","name":"Toilet Light Off","rules":[{"t":"set","p":"topic","pt":"msg","to":"shellies/shelly1pm-kids-toilet/relay/0/command","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"off","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1576,"y":1224,"wires":[["767a3c6056207140","77bdf1187841d2cb"]]},{"id":"bc688ddd5b4da6b2","type":"stoptimer","z":"a86052fe.2cfcb","g":"1474554de045623b","duration":"1","units":"Second","payloadtype":"num","payloadval":"0","name":"","x":1264,"y":1152,"wires":[["be676d3c4f189a11"],[]]},{"id":"5cbd8e095df0cb04","type":"stoptimer","z":"a86052fe.2cfcb","g":"1474554de045623b","duration":"1","units":"Second","payloadtype":"num","payloadval":"0","name":"","x":1484,"y":1152,"wires":[["6eb3dc61252353eb"],[]]},{"id":"767a3c6056207140","type":"stoptimer","z":"a86052fe.2cfcb","g":"1474554de045623b","duration":"1","units":"Second","payloadtype":"num","payloadval":"0","name":"","x":1688,"y":1152,"wires":[["0dca1c80767cb528"],[]]},{"id":"9a1a126ca419dab0","type":"debug","z":"a86052fe.2cfcb","g":"1474554de045623b","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1130,"y":1380,"wires":[]},{"id":"f7a7415019b88b3d","type":"debug","z":"a86052fe.2cfcb","g":"1474554de045623b","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1298,"y":1380,"wires":[]},{"id":"8f3062a48b9c0497","type":"debug","z":"a86052fe.2cfcb","g":"1474554de045623b","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1502,"y":1380,"wires":[]},{"id":"77bdf1187841d2cb","type":"debug","z":"a86052fe.2cfcb","g":"1474554de045623b","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1678,"y":1380,"wires":[]},{"id":"a69624a76cd6d4e8","type":"debug","z":"a86052fe.2cfcb","g":"1474554de045623b","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1862,"y":1380,"wires":[]},{"id":"23652b3d087ee80d","type":"debug","z":"a86052fe.2cfcb","g":"1474554de045623b","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":842,"y":1368,"wires":[]},{"id":"a515787ee77be2db","type":"debug","z":"a86052fe.2cfcb","g":"1474554de045623b","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":986,"y":1452,"wires":[]},{"id":"c0060c10f02b09a4","type":"debug","z":"a86052fe.2cfcb","g":"1474554de045623b","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":634,"y":1368,"wires":[]},{"id":"01fab2a16d349325","type":"debug","z":"a86052fe.2cfcb","g":"1474554de045623b","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":634,"y":1416,"wires":[]},{"id":"8096e72995a0d6f4","type":"function","z":"a86052fe.2cfcb","g":"1474554de045623b","name":"Output Global Variable Values","func":"node.warn(\"kids-toilet-motion-triggered-prevent-override = \" + flow.get('kids-toilet-motion-triggered-prevent-override'));\nnode.warn(\"kids-toilet-motion-override = \" + flow.get('kids-toilet-motion-override'));\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1366,"y":1476,"wires":[[]]},{"id":"8303a678eeed8266","type":"inject","z":"a86052fe.2cfcb","g":"1474554de045623b","name":"Trigger","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"1","payloadType":"str","x":1162,"y":1548,"wires":[["8096e72995a0d6f4"]]},{"id":"28fb722b7582c630","type":"debug","z":"a86052fe.2cfcb","g":"1474554de045623b","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1730,"y":864,"wires":[]},{"id":"f6766608c6ecdbd6","type":"debug","z":"a86052fe.2cfcb","g":"1474554de045623b","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1730,"y":1008,"wires":[]},{"id":"8d0b0ec1b4801c97","type":"bigtimer","z":"0cca5f120542a932","g":"4a5746f4fb0ac020","outtopic":"","outpayload1":"on","outpayload2":"off","name":"Big Timer","comment":"","lat":"55.8938","lon":"-3.6232","starttime":"5004","endtime":"15","starttime2":0,"endtime2":0,"startoff":"-30","endoff":"10","startoff2":0,"endoff2":0,"offs":0,"outtext1":"","outtext2":"","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"day6":0,"month6":0,"day7":0,"month7":0,"day8":0,"month8":0,"day9":0,"month9":0,"day10":0,"month10":0,"day11":0,"month11":0,"day12":0,"month12":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"d6":0,"w6":0,"xday1":0,"xmonth1":0,"xday2":0,"xmonth2":0,"xday3":0,"xmonth3":0,"xday4":0,"xmonth4":0,"xday5":0,"xmonth5":0,"xday6":0,"xmonth6":0,"xday7":"","xmonth7":"","xday8":"","xmonth8":"","xday9":"","xmonth9":"","xday10":"","xmonth10":"","xday11":"","xmonth11":"","xday12":"","xmonth12":"","xd1":0,"xw1":0,"xd2":0,"xw2":0,"xd3":0,"xw3":0,"xd4":0,"xw4":0,"xd5":0,"xw5":0,"xd6":0,"xw6":0,"suspend":false,"random":true,"randon1":false,"randoff1":false,"randon2":false,"randoff2":false,"repeat":false,"atstart":true,"odd":false,"even":false,"x":764,"y":156,"wires":[["71d2baa58251796a","2c6e11d19018c46d","2af8bdc822948786","70af799233dd8fc2","0f4d519522e4284c"],[],[]]},{"id":"71d2baa58251796a","type":"zigbee2mqtt-out","z":"0cca5f120542a932","g":"4a5746f4fb0ac020","name":"Z2M Lidl Socket 3 - Living Room Fairy Lights","server":"f0cc4845.3e9e28","friendly_name":"z2m_lidl_socket03 (HG06337)","device_id":"0x842e14fffedba132","command":"state","commandType":"z2m_cmd","payload":"payload","payloadType":"msg","optionsValue":"","optionsType":"nothing","x":1370,"y":192,"wires":[]},{"id":"daf51e78a0f6969d","type":"tradfri-light-control","z":"0cca5f120542a932","g":"4a5746f4fb0ac020","gateway":"a797b70842226842","name":"Ikea Light Control","action":"{}","accessories":[""],"groups":[],"logInputErrors":true,"x":1450,"y":96,"wires":[]},{"id":"7a91ffc540704bb8","type":"alexa-remote-smarthome","z":"0cca5f120542a932","g":"4a5746f4fb0ac020","name":"Tuya Diffuser - Turn Off","account":"c341166.e0c82e8","config":{"option":"action","value":[{"entity":"6ff88a98-7a2d-4f96-af41-5f9ee4655a8c","action":"turnOff"}]},"outputs":1,"x":1430,"y":288,"wires":[[]]},{"id":"2c6e11d19018c46d","type":"switch","z":"0cca5f120542a932","g":"4a5746f4fb0ac020","name":"on/off?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1250,"y":288,"wires":[[],["7a91ffc540704bb8"]]},{"id":"25399037747d1f65","type":"alexa-local","z":"0cca5f120542a932","g":"4a5746f4fb0ac020","devicename":"Kitchen Fairy Lights","inputtrigger":false,"x":726,"y":240,"wires":[["70af799233dd8fc2"]]},{"id":"922c1849bd3cd0ad","type":"server-state-changed","z":"0cca5f120542a932","g":"4a5746f4fb0ac020","name":"HA Helper - Living Room Lights","server":"ebb6b83c7588d734","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.nr_living_room_lights","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":206,"y":156,"wires":[["039a68561a24da09"]]},{"id":"77a8679cc543a7b9","type":"inject","z":"0cca5f120542a932","g":"4a5746f4fb0ac020","name":"Off (Override Timer Until Next On/Off Event)","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"off","payloadType":"str","x":266,"y":252,"wires":[["8d0b0ec1b4801c97"]]},{"id":"b659e13e233392dd","type":"inject","z":"0cca5f120542a932","g":"4a5746f4fb0ac020","name":"On (Override Timer Until Next On/Off Event)","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":266,"y":216,"wires":[["8d0b0ec1b4801c97"]]},{"id":"93e71c32fb680cec","type":"function","z":"0cca5f120542a932","g":"4a5746f4fb0ac020","name":"Living Rm Light Change","func":"// Tradfri monitor will pass message on all Tradfri state changes\n// Code below checks whether the state change is one of the living room light devices\n// and passed matching on/off payload to override the Big Timer state\n// i.e. Turning on/off one of the lving room ikea lights will also turn on/off\n// all the other devices in the living room lights automation.\n\n\n// Device 65539 = Living Room Big Lamp (Bulb)\n// Device 65560 = Living Room Small Lamp (Socket)\n\nvar triggerDevices = [65539, 65560];\n\nfor (var i = 0; i < triggerDevices.length; i++) {\n\n    // If the state change is for one of the devices in our array\n    if (msg.topic == String(triggerDevices[i]) ) {\n\n        // Check if lightbulb key is defined i.e. is this a bulb?\n        if (msg.payload.lightbulb !== undefined) {\n            \n            // Check if bulb has been turned on or off\n            if (msg.payload.lightbulb.isOn == true) {\n                var newMsg = { payload: \"on\" }\n            } else {\n                var newMsg = { payload: \"off\" }\n            }\n        }\n\n        // Check if plug key is defined i.e. is this a plug?\n        if (msg.payload.plug !== undefined) {\n            \n            // Check if plug has been turned on or off\n            if (msg.payload.plug.isOn == true) {\n                var newMsg = { payload: \"on\" }\n            } else {\n                var newMsg = { payload: \"off\" }\n            }\n        }\n\n        // Return new message\n        return newMsg;\n    }\n}\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":330,"y":96,"wires":[["8d0b0ec1b4801c97"]]},{"id":"5677a17c78162d59","type":"tradfri-monitor","z":"0cca5f120542a932","g":"4a5746f4fb0ac020","gateway":"a797b70842226842","name":"","x":138,"y":60,"wires":[["93e71c32fb680cec"]]},{"id":"27ecf94114eb2def","type":"tradfri-switch-control","z":"0cca5f120542a932","g":"4a5746f4fb0ac020","gateway":"a797b70842226842","name":"Ikea Switch Control","action":"","accessories":["",""],"groups":[],"logInputErrors":true,"x":1450,"y":144,"wires":[]},{"id":"2af8bdc822948786","type":"function","z":"0cca5f120542a932","g":"4a5746f4fb0ac020","name":"Format msg: Ikea","func":"// Device 65539 = Living Room Big Lamp (Bulb)\n// Device 65560 = Living Room Small Lamp (Plug Socket)\n\n// Add relevant device IDs to pass to arrays below\n// these will be used in newmessage payloads to tell\n// Ikea bulb/switch nodes which devices to turn on/off\nvar bulbTopics = [65539];\nvar plugTopics = [65560];\n\n\n// Debounce\n// Check when node last triggered and don't execute again within X seconds\n// Just in case since Ikea Monitor can trigger on state changes of either\n// device so we might get multiple signals.\n\n// Note - we have separate debounce nodes to prevent the update to HA Helper input_bool\n// toggle in HA triggering a manual on/off message to Big Timer when the input_bool\n// state is updated by this flow turning on/off.\nvar debounceMillisec = 3000;\n\nvar nowTime = new Date();    // var set to date/time now\n\n// Get last time this node was triggered\nvar lastTrigger = global.get('lastLivingLightsTrigger');\n\n// Set global var to track last trigger time for debouncing\nglobal.set('lastLivingLightsTrigger', nowTime);\n\n// If lastTrigger value exists, calc time since last triggered\n// or else set it really high to allow triggering\nif (lastTrigger != undefined) {\n    var sinceLastTrigger = nowTime.getTime() - lastTrigger.getTime();\n} else {\n    var sinceLastTrigger = 1000000000000;\n}\n\n// ************** DEBUG (must come before 'return') **************\nif (global.get('debug') == true) {\n    node.warn(\"LIVING RM LIGHTS: Last Triggered: \" + lastTrigger);\n    node.warn(\"LIVING RM LIGHTS: Since Last Trigger: \" + sinceLastTrigger);\n}\n// ****************************************************************\n\nif (sinceLastTrigger < debounceMillisec) {\n    // ************** DEBUG (must come before 'return') **************\n    if (global.get('debug') == true) {\n        node.warn(\"LIVING RM LIGHTS: Time since last triggered below threshold: \" + debounceMillisec);\n    }\n    // ****************************************************************\n    return [null, null];\n} else {\n\n    // Parse payload input - needs to be true/false for bulb input messages\n    if (msg.payload == \"on\") {\n        var bulbOnOff = true;\n    } else if (msg.payload == \"off\") {\n        var bulbOnOff = false;\n    }\n\n    // Payload to turn on/off bulbs\n    var bulbMsg = {\n        \"topic\": bulbTopics,\n            \"payload\": {\n                \"onOff\": bulbOnOff\n            }\n    }\n\n    // Payload to turn on/off plugs\n    var plugMsg = {\n        \"topic\": plugTopics,\n        \"payload\": msg.payload\n    }\n    \n    return [bulbMsg, plugMsg];\n}","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1250,"y":120,"wires":[["daf51e78a0f6969d"],["27ecf94114eb2def"]]},{"id":"aca7b1c67de4884b","type":"server-state-changed","z":"0cca5f120542a932","g":"ed1b3491c6acd9fa","name":"HA Helper - Christmas Lights","server":"ebb6b83c7588d734","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.nr_christmas_lights","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":192,"y":396,"wires":[["b7a5c188fd578655"]]},{"id":"e7dfcb3262409b1a","type":"alexa-local","z":"0cca5f120542a932","g":"ed1b3491c6acd9fa","devicename":"Christmas Lights","inputtrigger":true,"x":426,"y":444,"wires":[["c3f1f82b7c88359b"]]},{"id":"70af799233dd8fc2","type":"zigbee2mqtt-out","z":"0cca5f120542a932","g":"4a5746f4fb0ac020","name":"Z2M Lidl Socket 1 - Kitchen Fairy Lights","server":"f0cc4845.3e9e28","friendly_name":"z2m_lidl_socket01_kitchen_Fairy_lights (HG06337)","device_id":"0xec1bbdfffeb07bed","command":"state","commandType":"z2m_cmd","payload":"payload","payloadType":"msg","optionsValue":"","optionsType":"nothing","x":1356,"y":240,"wires":[]},{"id":"e2eca1bc25799ad0","type":"api-call-service","z":"0cca5f120542a932","g":"4a5746f4fb0ac020","name":"Update HA Helper","server":"ebb6b83c7588d734","version":5,"debugenabled":false,"domain":"input_boolean","service":"toggle","areaId":[],"deviceId":[],"entityId":["input_boolean.nr_living_room_lights"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"payload","output_location_type":"none","x":1454,"y":48,"wires":[[]]},{"id":"4174b29428e51f9a","type":"function","z":"0cca5f120542a932","g":"4a5746f4fb0ac020","name":"HA Helper Input","func":"// Template (from node help text)\n// We can set most of these values in Node itself and only pass those\n// additional that are needed.\n//var newMsg= {\n//    payload : {\n//        domain : \"homeassistant\",\n//        service : \"turn_on\",\n//        target : {\n//            area_id : [\"kitchen\"],\n//            device_id : [\"8932894082930482903\"],\n//            entity_id : [\"light.kitchen\", \"switch.garage_light\"]\n//        },\n//        data : {\n//            brightness_pct : 50\n//        }\n//    }\n//}\n\n// Parse payload input - needs to be turn_on / turn_off\nif (msg.payload == \"on\") {\n    var onOff = \"turn_on\";\n} else if (msg.payload == \"off\") {\n    var onOff = \"turn_off\";\n}\n\n\n// Template (from node help text)\n// We can set most of these values in Node itself and only pass those\n// additional that are needed.\nvar newMsg= {\n    payload : {\n        service : onOff\n    }\n}\n\n// Return new message\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1272,"y":48,"wires":[["e2eca1bc25799ad0"]]},{"id":"059d0f63898aa69e","type":"function","z":"0cca5f120542a932","g":"ed1b3491c6acd9fa","name":"HA Helper Input","func":"// Template (from node help text)\n// We can set most of these values in Node itself and only pass those\n// additional that are needed.\n//var newMsg= {\n//    payload : {\n//        domain : \"homeassistant\",\n//        service : \"turn_on\",\n//        target : {\n//            area_id : [\"kitchen\"],\n//            device_id : [\"8932894082930482903\"],\n//            entity_id : [\"light.kitchen\", \"switch.garage_light\"]\n//        },\n//        data : {\n//            brightness_pct : 50\n//        }\n//    }\n//}\n\n// Parse payload input - needs to be turn_on / turn_off\nif (msg.payload == \"on\") {\n    var onOff = \"turn_on\";\n} else if (msg.payload == \"off\") {\n    var onOff = \"turn_off\";\n}\n\n\n// Template (from node help text)\n// We can set most of these values in Node itself and only pass those\n// additional that are needed.\nvar newMsg= {\n    payload : {\n        service : onOff\n    }\n}\n\n// Return new message\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1268,"y":384,"wires":[["598fe016042ecdb9"]]},{"id":"598fe016042ecdb9","type":"api-call-service","z":"0cca5f120542a932","g":"ed1b3491c6acd9fa","name":"Update HA Helper","server":"ebb6b83c7588d734","version":5,"debugenabled":false,"domain":"input_boolean","service":"toggle","areaId":[],"deviceId":[],"entityId":["input_boolean.nr_christmas_lights"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"payload","output_location_type":"none","x":1450,"y":384,"wires":[[]]},{"id":"2d249796a92cd342","type":"zigbee2mqtt-out","z":"0cca5f120542a932","g":"ed1b3491c6acd9fa","name":"Z2M Lidl Socket 02","server":"f0cc4845.3e9e28","friendly_name":"z2m_lidl_socket02 (HG06337)","device_id":"0x842e14fffecd07d2","command":"state","commandType":"z2m_cmd","payload":"payload","payloadType":"msg","optionsValue":"","optionsType":"nothing","x":1446,"y":432,"wires":[]},{"id":"664716a5a618b4f6","type":"zigbee2mqtt-out","z":"0cca5f120542a932","g":"ed1b3491c6acd9fa","name":"Z2M Ikea Socket 04","server":"f0cc4845.3e9e28","friendly_name":"z2m_ikea_outlet04 (E1603/E1702/E1708)","device_id":"0x000d6ffffe2cf1fe","command":"state","commandType":"z2m_cmd","payload":"payload","payloadType":"msg","optionsValue":"","optionsType":"nothing","x":1436,"y":480,"wires":[]},{"id":"0f4ce243ea52c834","type":"zigbee2mqtt-out","z":"0cca5f120542a932","g":"ed1b3491c6acd9fa","name":"Z2M Ikea Socket 03","server":"f0cc4845.3e9e28","friendly_name":"z2m_ikea_outlet03 (E1603/E1702/E1708)","device_id":"0x000d6ffffeddab8d","command":"state","commandType":"z2m_cmd","payload":"payload","payloadType":"msg","optionsValue":"","optionsType":"nothing","x":1436,"y":528,"wires":[]},{"id":"f2a1727d5e505e1c","type":"inject","z":"0cca5f120542a932","g":"ed1b3491c6acd9fa","name":"Off (Override Timer Until Next On/Off Event)","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"off","payloadType":"str","x":346,"y":528,"wires":[["c3f1f82b7c88359b"]]},{"id":"53615ae336b06c3a","type":"inject","z":"0cca5f120542a932","g":"ed1b3491c6acd9fa","name":"On (Override Timer Until Next On/Off Event)","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":346,"y":492,"wires":[["c3f1f82b7c88359b"]]},{"id":"f1814437504f6e77","type":"trigger-state","z":"0cca5f120542a932","g":"25f079f6417379d7","name":"Bin Calendar Change State?","server":"ebb6b83c7588d734","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"calendar.bin_collection","entityidfiltertype":"exact","debugenabled":false,"constraints":[],"inputs":1,"outputs":2,"customoutputs":[],"outputinitially":true,"state_type":"str","enableInput":true,"x":192,"y":1608,"wires":[["507c02a382e9c3fa","4a7326f8d7674abe"],[]]},{"id":"507c02a382e9c3fa","type":"debug","z":"0cca5f120542a932","g":"25f079f6417379d7","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":386,"y":1536,"wires":[]},{"id":"79169b6010b5c888","type":"inject","z":"0cca5f120542a932","g":"25f079f6417379d7","name":"Test (update values esp. date)","props":[{"p":"data.event.new_state.attributes.message","v":"Blue Bin","vt":"str"},{"p":"data.event.new_state.attributes.offset_reached","v":"true","vt":"bool"},{"p":"payload"},{"p":"data.event.new_state.attributes.start_time","v":"2022-09-21 13:00:00","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"off","payloadType":"str","x":240,"y":1656,"wires":[["4a7326f8d7674abe"]]},{"id":"4a7326f8d7674abe","type":"function","z":"0cca5f120542a932","g":"25f079f6417379d7","name":"Parse calendar msg data","func":"//--------------------------------------------------------------------\n// What we want to do:\n// 1. Get Event details\n// 2. Parse Event Name for bin colour: bin_colour\n//        - save in msg object @ msg.data.colour\n// 3. Do datetime calcs \n//      - calc notification off datetime: bin_notify_off_datetime\n//      - now vs event start \n//          - if event started and passed bin_notify_off_datetime then:\n//              - save bin_notify = false in msg object @ msg.data.notify\n//          - if event started but not passed bin_notify_off_datetime then:\n//              - save bin_notify = true in msg object @ msg.data.notify\n//      - now vs notification off datetime\n//          - if bin_notify_off_datetime passed then:\n//              - save bin_notify = false in msg object @ msg.data.notify\n// 4. Check for offset_reached = true\n//      - if NOT passed bin_notify_off_datetime then:\n//          - save bin_notify = true in msg object @ msg.data.notify\n// 5. Return msg object on Output 1 if bin_notify = true\n//    and  Output 1 if bin_notify = false\n//    Msg object now conatins extra fields:\n//          - bin_colour @ msg.data.colour\n//          - bin_notify @ msg.data.notify\n// 6. Output 1 goes to a switch node to parse bin_colour and turn on lights\n// 7. Output 2 goes to a node to turn off lights.\n//--------------------------------------------------------------------\n\n// Note that global debug variable used to determine  if we output any of the debug text below.\n// Variable can be set at top of 'Useful Example Flows' tab\n\n\n\n// 1. Get Event details\n    var bin_event_name = msg.data.event.new_state.attributes.message;\n    var bin_event_offset_reached = msg.data.event.new_state.attributes.offset_reached;\n    var bin_event_started = msg.payload;\n    var bin_event_start_datetime = new Date( msg.data.event.new_state.attributes.start_time );\n\n    // Set initial variable to track notification status\n    var bin_notify = false\n    // Save this flag in msg data at msg.data.notify\n    msg.data[\"notify\"] = false;  \n\n    // ************** DEBUG (must come before 'returns') **************\n    if ( global.get('debug') == true ) {\n        node.warn(\"BINS - 1. Event Name: \" + bin_event_name );\n        node.warn(\"BINS - 1. Offset Reached: \" + bin_event_offset_reached );\n        node.warn(\"BINS - 1. Event Started: \" + bin_event_started );\n        node.warn(\"BINS - 1. Start DateTime: \" + bin_event_start_datetime );\n    }\n    // ****************************************************************\n\n//--------------------------------------------------------------------\n\n// 2. Parse Event Name for bin colour: bin_colour\n//        - save in msg object @ msg.data.colour\n\n    // Get first 4 characters of event name\n    var bin_event_name_subst = bin_event_name.substring(0, 4);\n    \n    // Check substring for colour match\n    if ( bin_event_name_subst == \"Blue\") {\n        var bin_colour=\"blue\";\n    } else if ( bin_event_name_subst == \"Brow\") {\n        var bin_colour=\"brown\";\n    } else if ( bin_event_name_subst == \"Grey\") {\n        var bin_colour=\"grey\";\n    } else if ( bin_event_name_subst == \"Green\") {\n        var bin_colour=\"green\";\n    } else if ( bin_event_name_subst == \"Test\") {\n        var bin_colour=\"test\";\n    }\n\n    // Add colour to event message details at msg.data.colour\n    msg.data[\"colour\"] = bin_colour;\n\n    // ************** DEBUG (must come before 'returns') **************\n    if ( global.get('debug') == true ) {\n        //node.warn(\"BINS - 2. Event Name Substring: \" + bin_event_name_subst );\n        node.warn(\"BINS - 2. bin_colour: \" + bin_colour );\n        //node.warn(\"BINS - 2. msg.data.colour: \" + msg.data.colour );\n    }\n    // ****************************************************************\n\n//--------------------------------------------------------------------\n\n// 3. Do datetime calcs \n//      - calc notification off datetime: bin_notify_off_datetime\n//      - now vs event start \n//          - if event started and passed bin_notify_off_datetime then:\n//              - save bin_notify = false in msg object @ msg.data.notify\n//          - if event started but NOT passed bin_notify_off_datetime then:\n//              - save bin_notify = true in msg object @ msg.data.notify\n//      - now vs notification off datetime\n//          - if bin_notify_off_datetime passed then:\n//              - save bin_notify = false in msg object @ msg.data.notify\n\n    var bin_now_datetime = new Date();    // var set to date/time now\n\n\n    // Calc notification end datetime = event start + 9 hrs\n    var bin_event_start_timestamp = bin_event_start_datetime.getTime();  //start time in unix epoch\n    var bin_notify_off_timestamp = bin_event_start_timestamp + (3600*3000); // Add 3 hours to get to 9am on bin day\n    var bin_notify_off_datetime = new Date(bin_notify_off_timestamp);\n\n\n    // Check current datetime against bin_event_start_timestamp\n    // If event start passed then check if light should be on i.e. notify if not yet passed\n    // Note: getTime() method returns a number that represents the milliseconds between the Unix epoch and the given date.\n    var bin_event_start_diff_mili = bin_now_datetime.getTime() - bin_notify_off_datetime.getTime();\n    var bin_event_start_diff_h = new Date(bin_event_start_diff_mili).getHours();\n    var bin_event_start_diff_m = new Date(bin_event_start_diff_mili).getMinutes();\n    var bin_event_start_diff_h = Number((bin_event_start_diff_h<10) ? '0' + bin_event_start_diff_h : bin_event_start_diff_h);\n    var bin_event_start_diff_m = Number((bin_event_start_diff_m<10) ? '0' + bin_event_start_diff_m : bin_event_start_diff_m);\n    var bin_event_start_diff_hm = bin_event_start_diff_h + ':' + bin_event_start_diff_m;\n\n    if ( bin_event_start_datetime <= bin_now_datetime ) {\n        //if ( global.get('debug') == true ) {\n        //    node.warn(\"BINS - Event Start Has Passed\");\n        //}\n        \n        // If event start passed then check if light should be on i.e. notify off not yet passed\n        if ( bin_notify_off_datetime <= bin_now_datetime ) {\n            //if ( global.get('debug') == true ) {\n            //    node.warn(\"BINS - Event Start Passed & Notify Off Passed - Turn Off Light!\");\n            //}\n            \n            // Set variable to track that notification should be off\n            bin_notify = false\n\n            // Save this flag in msg data at msg.data.notify\n            msg.data[\"notify\"] = false; \n\n        } else if ( bin_now_datetime < bin_notify_off_datetime ) {\n            //if ( global.get('debug') == true ) {\n            //    node.warn(\"BINS - Event Start Passed & Notify Off NOT Passed - Turn On Light!\");\n            //}\n            \n            // Set variable to track that notification should be on\n            bin_notify = true\n\n            // Save this flag in msg data at msg.data.notify\n            msg.data[\"notify\"] = true; \n        }\n\n    } else {\n        //if ( global.get('debug') == true ) {\n        //    node.warn(\"BINS - Event Starting in (HH:MM): \" + bin_event_start_diff_hm);\n        //}\n        \n    }\n\n\n    // ************** DEBUG (must come before 'returns') **************\n    if ( global.get('debug') == true ) {\n        node.warn(\"BINS - 3a. Current DateTime: \" + bin_now_datetime );\n        node.warn(\"BINS - 3a. Notification Off Date Time: \" + bin_notify_off_datetime );\n        node.warn(\"BINS - 3a. Event Start Difference (HH:MM): \" + bin_event_start_diff_hm );\n        node.warn(\"BINS - 3a. bin_notify: \" + bin_notify );\n        node.warn(\"BINS - 3a. msg.data.notify: \" + msg.data.notify );\n    }\n    // ****************************************************************\n\n\n    // Check current datetime against bin_notify_off_datetime\n    // If notify_off passed then turn off light\n    var bin_notify_off_diff_mili = bin_now_datetime.getTime() - bin_notify_off_datetime.getTime();\n    var bin_notify_off_diff_h = new Date(bin_notify_off_diff_mili).getHours();\n    var bin_notify_off_diff_m = new Date(bin_notify_off_diff_mili).getMinutes();\n    var bin_notify_off_diff_h = Number((bin_notify_off_diff_h<10) ? '0' + bin_notify_off_diff_h : bin_notify_off_diff_h);\n    var bin_notify_off_diff_m = Number((bin_notify_off_diff_m<10) ? '0' + bin_notify_off_diff_m : bin_notify_off_diff_m);\n    var bin_notify_off_diff_hm = bin_notify_off_diff_h + ':' + bin_notify_off_diff_m;\n\n    if ( bin_notify_off_datetime <= bin_now_datetime ) {\n\n        //node.warn(\"BINS - Turn off light!\");\n\n        // Set variable to track that notification should be off\n        bin_notify = false\n\n        // Save this flag in msg data at msg.data.notify\n        msg.data[\"notify\"] = false; \n\n    } else {\n        \n        //node.warn(\"BINS - Turn Off Light In (HH:MM): \" + bin_notify_off_diff_hm);\n\n    }\n\n    // ************** DEBUG (must come before 'returns') **************\n    if ( global.get('debug') == true ) {\n        node.warn(\"BINS - 3b. Notification Off Difference (HH:MM): \" + bin_notify_off_diff_hm );\n        node.warn(\"BINS - 3b. bin_notify: \" + bin_notify );\n        node.warn(\"BINS - 3b. msg.data.notify: \" + msg.data.notify );\n    }\n    // ****************************************************************\n\n//--------------------------------------------------------------------\n\n// 4. Check for offset_reached = true\n//      - if NOT passed bin_notify_off_datetime then:\n//          - save bin_notify = true in msg object @ msg.data.notify\n\nif ( bin_event_offset_reached == true ) {\n    if ( bin_now_datetime < bin_notify_off_datetime ) {\n    \n        // Set variable to track that notification should be on\n        bin_notify = true\n\n        // Save this flag in msg data at msg.data.notify\n        msg.data[\"notify\"] = true;  \n    \n    }\n\n}\n\n    // ************** DEBUG (must come before 'returns') **************\n    if ( global.get('debug') == true ) {\n        node.warn(\"BINS - 4. Offset Reached: \" + bin_event_offset_reached );\n        node.warn(\"BINS - 4. bin_notify: \" + bin_notify );\n        node.warn(\"BINS - 4. msg.data.notify: \" + msg.data.notify );\n    }\n    // ****************************************************************\n\n\n//--------------------------------------------------------------------\n\n// 5. Return msg object on Output 1 if bin_notify = true\n//    and  Output 1 if bin_notify = false\n//    Msg object now conatins extra fields:\n//          - bin_colour @ msg.data.colour\n//          - bin_notify @ msg.data.notify\n\nif ( bin_notify == true ) {\n    return [ msg, null ];\n} else if ( bin_notify == false ) {\n    return [ null, msg ];\n}\n\n\n\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":478,"y":1608,"wires":[["eff72feef44272ea","2a23ef84a092fe9b"],["86f263b41ec005c4","db3759f612a083de"]]},{"id":"2a23ef84a092fe9b","type":"switch","z":"0cca5f120542a932","g":"25f079f6417379d7","name":"Do something based on bin colour (e.g. turn on light)","property":"data.colour","propertyType":"msg","rules":[{"t":"eq","v":"test","vt":"str"},{"t":"eq","v":"blue","vt":"str"},{"t":"eq","v":"brown","vt":"str"},{"t":"eq","v":"grey","vt":"str"},{"t":"eq","v":"green","vt":"str"}],"checkall":"true","repair":false,"outputs":5,"x":868,"y":1548,"wires":[["6ab6b1bbac05af22"],["205d2b5a91c27d2f"],["71443ad5221bcc22"],["124f80d8a36372b5"],["38f85de2278371b0"]]},{"id":"6ab6b1bbac05af22","type":"debug","z":"0cca5f120542a932","g":"25f079f6417379d7","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1034,"y":1476,"wires":[]},{"id":"b039040247bab72f","type":"function","z":"0cca5f120542a932","d":true,"g":"25f079f6417379d7","name":"Set Notification Message","func":"message=\"Put Out Bin - \" + msg.data.colour;\nglobal.set('notification_msg',message);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1598,"y":1572,"wires":[["fc1b976c85c8a03d"]]},{"id":"fc1b976c85c8a03d","type":"link out","z":"0cca5f120542a932","g":"25f079f6417379d7","name":"Front Door Motion","links":["4e0fb3de.b1482c"],"x":1755,"y":1632,"wires":[]},{"id":"eff72feef44272ea","type":"debug","z":"0cca5f120542a932","g":"25f079f6417379d7","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":562,"y":1536,"wires":[]},{"id":"86f263b41ec005c4","type":"debug","z":"0cca5f120542a932","g":"25f079f6417379d7","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":566,"y":1668,"wires":[]},{"id":"15299f9a7b0aa523","type":"function","z":"0cca5f120542a932","d":true,"g":"25f079f6417379d7","name":"Set Notification Message","func":"message=\"Bin notification off!\";\nglobal.set('notification_msg',message);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1598,"y":1680,"wires":[["fc1b976c85c8a03d"]]},{"id":"205d2b5a91c27d2f","type":"wled2","z":"0cca5f120542a932","g":"25f079f6417379d7","address":"192.168.30.26","brightness":128,"delay":0,"color1":"#0048ff","color2":"#ffffff","color3":"#ffffff","effect":"28","effectIntensity":128,"effectSpeed":128,"name":"Bin Notification (D1-04) - Blue","palette":"2","preset":0,"state":"on","x":1298,"y":1500,"wires":[["b039040247bab72f"]]},{"id":"71443ad5221bcc22","type":"wled2","z":"0cca5f120542a932","g":"25f079f6417379d7","address":"192.168.30.26","brightness":128,"delay":0,"color1":"#de7300","color2":"#ffffff","color3":"#ffffff","effect":"28","effectIntensity":128,"effectSpeed":128,"name":"Bin Notification (D1-04) - Brown","palette":"2","preset":0,"state":"on","x":1300,"y":1548,"wires":[["b039040247bab72f"]]},{"id":"124f80d8a36372b5","type":"wled2","z":"0cca5f120542a932","g":"25f079f6417379d7","address":"192.168.30.26","brightness":128,"delay":0,"color1":"#c90079","color2":"#ffffff","color3":"#ffffff","effect":"28","effectIntensity":128,"effectSpeed":128,"name":"Bin Notification (D1-04) - Black","palette":"2","preset":0,"state":"on","x":1300,"y":1596,"wires":[["b039040247bab72f"]]},{"id":"db3759f612a083de","type":"wled2","z":"0cca5f120542a932","g":"25f079f6417379d7","address":"192.168.30.26","brightness":128,"delay":0,"color1":"#c90079","color2":"#ffffff","color3":"#ffffff","effect":"28","effectIntensity":128,"effectSpeed":128,"name":"Bin Notification (D1-04) - OFF","palette":"0","preset":0,"state":"off","x":1306,"y":1716,"wires":[["15299f9a7b0aa523"]]},{"id":"845f0b0f7bb7a49a","type":"inject","z":"0cca5f120542a932","g":"25f079f6417379d7","name":"Test","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":1222,"y":1452,"wires":[["205d2b5a91c27d2f"]]},{"id":"8bc62e820834730a","type":"inject","z":"0cca5f120542a932","g":"25f079f6417379d7","name":"Test","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":1510,"y":1452,"wires":[["124f80d8a36372b5"]]},{"id":"4e22bc95157536b6","type":"inject","z":"0cca5f120542a932","g":"25f079f6417379d7","name":"Test","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":1366,"y":1452,"wires":[["71443ad5221bcc22"]]},{"id":"38f85de2278371b0","type":"wled2","z":"0cca5f120542a932","g":"25f079f6417379d7","address":"192.168.30.26","brightness":128,"delay":0,"color1":"#00ff00","color2":"#ffffff","color3":"#ffffff","effect":"28","effectIntensity":128,"effectSpeed":128,"name":"Bin Notification (D1-04) - Green","palette":"2","preset":0,"state":"on","x":1304,"y":1644,"wires":[["b039040247bab72f"]]},{"id":"07de05601feb960d","type":"inject","z":"0cca5f120542a932","g":"25f079f6417379d7","name":"Test","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":1654,"y":1452,"wires":[["38f85de2278371b0"]]},{"id":"b98f41d40de092e8","type":"server-state-changed","z":"0cca5f120542a932","g":"0d1ac708363d143e","name":"Motion Enabled?","server":"ebb6b83c7588d734","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.nr_study_motion_enable","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":188,"y":744,"wires":[["b0a9c2e78fb0b847"]]},{"id":"b0a9c2e78fb0b847","type":"change","z":"0cca5f120542a932","g":"0d1ac708363d143e","name":"Set Variable","rules":[{"t":"set","p":"study_motion_enabled","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":394,"y":744,"wires":[[]]},{"id":"adc95956c72bdcaf","type":"zigbee2mqtt-in","z":"0cca5f120542a932","g":"4d443c555e118a02","name":"Z2M Ikea Motion 01 - Office","server":"f0cc4845.3e9e28","friendly_name":"z2m_ikea_motiondetector01_office (E1525/E1745)","device_id":"0x90fd9ffffe8f18c0","state":"occupancy","outputAtStartup":true,"filterChanges":true,"enableMultiple":false,"x":180,"y":1116,"wires":[["e13a4f389c58cb25"]]},{"id":"96616a57e59906f2","type":"zigbee2mqtt-out","z":"0cca5f120542a932","g":"4d443c555e118a02","name":"Z2M Ikea Socket 01 - Office Lamp","server":"f0cc4845.3e9e28","friendly_name":"z2m_ikea_outlet01_office_lamp (E1603/E1702/E1708)","device_id":"0x000d6ffffe270f7a","command":"state","commandType":"z2m_cmd","payload":"payload","payloadType":"msg","optionsValue":"","optionsType":"nothing","x":1580,"y":924,"wires":[]},{"id":"831dfd409f1e0ea7","type":"switch","z":"0cca5f120542a932","g":"4d443c555e118a02","name":"Motion Enabled (HA Toggle)?","property":"study_motion_enabled","propertyType":"global","rules":[{"t":"eq","v":"off","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":468,"y":1116,"wires":[[],["826f689f17638c0c"]],"info":"'Failsafe' by using 'otherwise'\r\noutput.\r\nRequires HA Motion Enabled to\r\nreturn 'off' in other flow to\r\ndisable our flow i.e. flow still\r\nworks even if HA unavailable."},{"id":"d8fe90488eb31e50","type":"trigger","z":"0cca5f120542a932","g":"4d443c555e118a02","name":"","op1":"on","op2":"off","op1type":"str","op2type":"str","duration":"300","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":862,"y":1116,"wires":[["3a996825e2f3a3b3"]],"info":"Linking to the 10s timer simply to minimise\ncomplexity of flow. \n\nNo real impact to operation except adds 10s on to this timer before turning off lights."},{"id":"b5ac9a5ad4db00fd","type":"zigbee2mqtt-in","z":"0cca5f120542a932","g":"4d443c555e118a02","name":"Z2M Ikea Switch 01 - Office","server":"f0cc4845.3e9e28","friendly_name":"z2m_ikea_switch01_office_lamp (E1743)","device_id":"0x000d6ffffe2a5a91","state":"0","outputAtStartup":true,"filterChanges":true,"enableMultiple":false,"x":192,"y":864,"wires":[["0a63d2e18e8526ec"]]},{"id":"0a63d2e18e8526ec","type":"switch","z":"0cca5f120542a932","g":"4d443c555e118a02","name":"Parse Switch Message","property":"payload.action","propertyType":"msg","rules":[{"t":"eq","v":"brightness_move_up","vt":"str"},{"t":"eq","v":"brightness_move_down","vt":"str"},{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":436,"y":864,"wires":[["e986d32bd89c94ca"],["f60f7cc08cc704d3"],["a9b5af6afedb7ce2"],["3a996825e2f3a3b3"]]},{"id":"3a996825e2f3a3b3","type":"function","z":"0cca5f120542a932","g":"4d443c555e118a02","name":"Clean msg","func":"// CLEAN UP ON/OFF MESSAGES\n// Parse various messages to make sure on/off state is in msg.payload\n\n// GENERAL\n// Convert any msg.payload=true/false into on/off\nif (msg.payload == true) {\n    return { payload: \"on\" };\n} else if (msg.payload == false) {\n    return { payload: \"off\" };\n}\n\n// Z2M IKEA SWITCHES\n// Create usable msg.payload=on/off from z2m Ikea switch messages.\n// z2m switch msg has it's on/off value in msg.payload.action but we\n// want it in msg.payload\nif (msg.payload.action !== undefined) {\n    return { payload: msg.payload.action };\n} else {\n    return msg;\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1074,"y":960,"wires":[["96616a57e59906f2","c48d76b5a6e4548f","c8d1c7de104f30f9","0bac3346f316dae6","e4cc19ee46027f21","6cbf51e43ce083c7"]]},{"id":"e13a4f389c58cb25","type":"switch","z":"0cca5f120542a932","g":"4d443c555e118a02","name":"Occupied?","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":242,"y":1080,"wires":[["831dfd409f1e0ea7"],[]],"info":"'Failsafe' by using 'otherwise'\r\noutput.\r\nRequires HA Motion Enabled to\r\nreturn 'off' in other flow to\r\ndisable our flow i.e. flow still\r\nworks even if HA unavailable."},{"id":"296e0188e4ed2cd6","type":"server-state-changed","z":"0cca5f120542a932","g":"4d443c555e118a02","name":"HA Helper - Office Lights","server":"ebb6b83c7588d734","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.nr_study_lights","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":214,"y":936,"wires":[["90a0f21b31032360"]]},{"id":"72eea6de9a6a7907","type":"function","z":"0cca5f120542a932","g":"4d443c555e118a02","name":"HA Helper Input","func":"// Function to convert msg.payload=on/off into turn_on/turn_off value usable by\n// HA Call Service node.\n// In Call Service node, set all values except 'service' which will beo overridden/\n// provided by this function.\n\n// Template for passing data to Call Service node (from Call Service node help text)\n// We can set most of these values in Call Service node itself and only pass those\n// additional that are needed.\n//var newMsg= {\n//    payload : {\n//        domain : \"homeassistant\",\n//        service : \"turn_on\",\n//        target : {\n//            area_id : [\"kitchen\"],\n//            device_id : [\"8932894082930482903\"],\n//            entity_id : [\"light.kitchen\", \"switch.garage_light\"]\n//        },\n//        data : {\n//            brightness_pct : 50\n//        }\n//    }\n//}\n\n// Parse payload input - needs to be turn_on / turn_off\nif (msg.payload == \"on\") {\n    var onOff = \"turn_on\";\n} else if (msg.payload == \"off\") {\n    var onOff = \"turn_off\";\n}\n\n// Template (from node help text)\n// We can set most of these values in Node itself and only pass those\n// additional that are needed.\nvar newMsg= {\n    payload : {\n        service : onOff\n    }\n}\n\n// Return new message\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1444,"y":780,"wires":[["b16f373728d40f11"]]},{"id":"b16f373728d40f11","type":"api-call-service","z":"0cca5f120542a932","g":"4d443c555e118a02","name":"Update HA Helper","server":"ebb6b83c7588d734","version":5,"debugenabled":false,"domain":"input_boolean","service":"toggle","areaId":[],"deviceId":[],"entityId":["input_boolean.nr_study_lights"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"payload","output_location_type":"none","x":1626,"y":780,"wires":[[]]},{"id":"e986d32bd89c94ca","type":"api-call-service","z":"0cca5f120542a932","g":"4d443c555e118a02","name":"Motion Sensing ON","server":"ebb6b83c7588d734","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.nr_study_motion_enable"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"payload","output_location_type":"none","x":762,"y":756,"wires":[[]]},{"id":"f60f7cc08cc704d3","type":"api-call-service","z":"0cca5f120542a932","g":"4d443c555e118a02","name":"Motion Sensing OFF","server":"ebb6b83c7588d734","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.nr_study_motion_enable"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"payload","output_location_type":"none","x":752,"y":804,"wires":[[]]},{"id":"a094687cb49aebdc","type":"alexa-local","z":"0cca5f120542a932","g":"4d443c555e118a02","devicename":"Study Lights","inputtrigger":true,"x":470,"y":972,"wires":[["3a996825e2f3a3b3"]]},{"id":"aa3c36769bc9890e","type":"wled2","z":"0cca5f120542a932","d":true,"g":"4d443c555e118a02","address":"192.168.30.20","brightness":"255","delay":0,"color1":"#ffffff","color2":"#ffffff","color3":"#ffffff","effect":0,"effectIntensity":128,"effectSpeed":"170","name":"WLED - Server Lights On","palette":"50","preset":"1","state":"off","x":1622,"y":1284,"wires":[[]]},{"id":"51f39b15ece228f4","type":"wled2","z":"0cca5f120542a932","d":true,"g":"4d443c555e118a02","address":"192.168.30.24","brightness":"255","delay":0,"color1":"#ffffff","color2":"#ffffff","color3":"#ffffff","effect":0,"effectIntensity":128,"effectSpeed":"170","name":"WLED - D1 Mini #2","palette":"50","preset":"5","state":"off","x":1638,"y":1236,"wires":[[]]},{"id":"8742cf1d65f8da59","type":"wled2","z":"0cca5f120542a932","d":true,"g":"4d443c555e118a02","address":"192.168.30.27","brightness":"255","delay":0,"color1":"#ffffff","color2":"#ffffff","color3":"#ffffff","effect":0,"effectIntensity":128,"effectSpeed":"170","name":"WLED - Study Desk","palette":"50","preset":"1","state":"off","x":1628,"y":1188,"wires":[[]]},{"id":"c8d1c7de104f30f9","type":"zigbee2mqtt-out","z":"0cca5f120542a932","g":"4d443c555e118a02","name":"Z2M Ikea Socket 02 - Tetris Clock","server":"f0cc4845.3e9e28","friendly_name":"z2m_ikea_outlet02 (E1603/E1702/E1708)","device_id":"0x000d6ffffe0e4d95","command":"state","commandType":"z2m_cmd","payload":"payload","payloadType":"msg","optionsValue":"","optionsType":"nothing","x":1580,"y":972,"wires":[]},{"id":"3ec8a05536f23649","type":"function","z":"0cca5f120542a932","d":true,"g":"4d443c555e118a02","name":"Format msg: WLED","func":"// Convert msg.payload=on/off into format wled can accept:\n// msg.state.payload=on/off\n\n// Obviously many more properties can be passed to wledlights so may need to account for those in future.\n// https://flows.nodered.org/node/node-red-contrib-wled2\n\nvar newMsg ={\n    payload : {\n        state : msg.payload\n    }\n}\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1406,"y":1236,"wires":[["8742cf1d65f8da59","51f39b15ece228f4","aa3c36769bc9890e"]]},{"id":"c48d76b5a6e4548f","type":"zigbee2mqtt-out","z":"0cca5f120542a932","d":true,"g":"4d443c555e118a02","name":"Z2M Ikea RGB Bulb - Office","server":"f0cc4845.3e9e28","friendly_name":"z2m_ikea_rgb_study (LED1624G9)","device_id":"0x842e14fffe5df97d","command":"state","commandType":"z2m_cmd","payload":"payload","payloadType":"msg","optionsValue":"","optionsType":"nothing","x":1560,"y":876,"wires":[]},{"id":"9d90ad0b3adcd1ad","type":"inject","z":"0cca5f120542a932","g":"4d443c555e118a02","name":"On","props":[{"p":"payload.action","v":"on","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":142,"y":816,"wires":[["0a63d2e18e8526ec"]]},{"id":"6d110591ad2b55d2","type":"inject","z":"0cca5f120542a932","g":"4d443c555e118a02","name":"Off","props":[{"p":"payload.action","v":"off","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":286,"y":816,"wires":[["0a63d2e18e8526ec"]]},{"id":"5f90eea1487a2c42","type":"inject","z":"0cca5f120542a932","d":true,"g":"4d443c555e118a02","name":"Off","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"off","payloadType":"str","x":1226,"y":1260,"wires":[["3ec8a05536f23649"]]},{"id":"794f671cd449cd27","type":"inject","z":"0cca5f120542a932","d":true,"g":"4d443c555e118a02","name":"On","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":1226,"y":1212,"wires":[["3ec8a05536f23649"]]},{"id":"43dfe6e5865d2bf3","type":"alexa-local","z":"0cca5f120542a932","g":"25f079f6417379d7","devicename":"Bin Notification","inputtrigger":true,"x":236,"y":1752,"wires":[["6afd1c76a5761348"]]},{"id":"72ab0f5e1ebdd93f","type":"inject","z":"0cca5f120542a932","g":"25f079f6417379d7","name":"off","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"off","payloadType":"str","x":266,"y":1704,"wires":[["6afd1c76a5761348"]]},{"id":"6afd1c76a5761348","type":"switch","z":"0cca5f120542a932","g":"25f079f6417379d7","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":422,"y":1752,"wires":[[],["db3759f612a083de"]]},{"id":"e44094797e60fe16","type":"switch","z":"0cca5f120542a932","g":"d0e1bff62bd0d786","name":"","property":"payload.occupancy","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"false","repair":false,"outputs":2,"x":446,"y":2088,"wires":[["6cf0fc072fee7d0d","5d7bd26ba654df20"],["e016887d31f33a58","08c4474a1b21d1b4","5d7bd26ba654df20"]]},{"id":"d4d0fbee6e8b754f","type":"zigbee2mqtt-in","z":"0cca5f120542a932","g":"d0e1bff62bd0d786","name":"Sonoff Motion - Kids Toilet","server":"f0cc4845.3e9e28","friendly_name":"z2m_son_motion01_kids_toilet (SNZB-03)","device_id":"0x00124b0022683b4b","state":"0","outputAtStartup":true,"filterChanges":true,"enableMultiple":false,"x":182,"y":2076,"wires":[["8808d854a8aba9c0"]]},{"id":"e2bd193318ddc080","type":"mqtt out","z":"0cca5f120542a932","g":"d0e1bff62bd0d786","name":"","topic":"","qos":"2","retain":"true","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"e96cb00d.af953","x":1890,"y":2088,"wires":[]},{"id":"87a6724eb640b63f","type":"debug","z":"0cca5f120542a932","g":"d0e1bff62bd0d786","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1154,"y":2268,"wires":[]},{"id":"e016887d31f33a58","type":"debug","z":"0cca5f120542a932","g":"d0e1bff62bd0d786","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":594,"y":2268,"wires":[]},{"id":"08c4474a1b21d1b4","type":"trigger","z":"0cca5f120542a932","g":"d0e1bff62bd0d786","name":"Timer: Set MQTT Payload = OFF","op1":"on","op2":"off","op1type":"str","op2type":"str","duration":"120","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1028,"y":2184,"wires":[["87a6724eb640b63f","cff0060a66898b1a","e0fd27cab54d890f","f9993e779ca7d2df"]]},{"id":"5a81f24279216688","type":"change","z":"0cca5f120542a932","g":"d0e1bff62bd0d786","name":"Set MQTT topic = Toilet Light","rules":[{"t":"set","p":"topic","pt":"msg","to":"shellies/shelly1pm-kids-toilet/relay/0/command","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1660,"y":2088,"wires":[["e2bd193318ddc080","85b733ca0a5966e6"]]},{"id":"f59d1215436f0206","type":"inject","z":"0cca5f120542a932","g":"d0e1bff62bd0d786","name":"Occupancy = false","props":[{"p":"payload.occupancy","v":"false","vt":"bool"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":298,"y":1968,"wires":[["e44094797e60fe16"]]},{"id":"4a32ccb4d485df77","type":"inject","z":"0cca5f120542a932","g":"d0e1bff62bd0d786","name":"Occupancy = true","props":[{"p":"payload.occupancy","v":"true","vt":"bool"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":308,"y":1932,"wires":[["e44094797e60fe16"]]},{"id":"8808d854a8aba9c0","type":"time-range-switch","z":"0cca5f120542a932","g":"d0e1bff62bd0d786","name":"Night time?","lat":"55.8938","lon":"-3.6232","startTime":"sunsetStart","endTime":"sunriseEnd","startOffset":"-30","endOffset":"30","x":338,"y":2172,"wires":[["e44094797e60fe16"],[]]},{"id":"0cd88984d95eaf8f","type":"inject","z":"0cca5f120542a932","g":"d0e1bff62bd0d786","name":"Off","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"shellies/shelly1pm-kids-toilet/relay/0/command","payload":"off","payloadType":"str","x":1766,"y":2196,"wires":[["e2bd193318ddc080"]]},{"id":"90cde51cf1cb3130","type":"inject","z":"0cca5f120542a932","g":"d0e1bff62bd0d786","name":"On","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"shellies/shelly1pm-kids-toilet/relay/0/command","payload":"on","payloadType":"str","x":1766,"y":2160,"wires":[["e2bd193318ddc080"]]},{"id":"4d30856b4662dbf1","type":"http in","z":"0cca5f120542a932","g":"b14c70bd13a22c77","name":"Webhook - Movie Room Lights","url":"/webhook-movie-room-lights","method":"post","upload":false,"swaggerDoc":"","x":2126,"y":96,"wires":[["f0028fc06d9dfdf6","dde082d91a06e3f4","5f37298b5856dee5"]]},{"id":"f0028fc06d9dfdf6","type":"http response","z":"0cca5f120542a932","g":"b14c70bd13a22c77","name":"Websocket Response","statusCode":"200","headers":{},"x":2156,"y":132,"wires":[]},{"id":"dde082d91a06e3f4","type":"debug","z":"0cca5f120542a932","g":"b14c70bd13a22c77","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2326,"y":156,"wires":[]},{"id":"215d6f223efc50ca","type":"alexa-local","z":"0cca5f120542a932","g":"b14c70bd13a22c77","devicename":"Movie Lights","inputtrigger":true,"x":2186,"y":204,"wires":[["dde082d91a06e3f4","91b35ac2d2ae7125"]]},{"id":"18f7b2f67586d531","type":"comment","z":"0cca5f120542a932","d":true,"g":"b14c70bd13a22c77","name":"Dimmer Control - Notes","info":"This flow should be triggered on by 'Z2M Ikea Dimmer 03' dimmer paired with z2m.\nBut we have paired the dimmer directly with the light group in Z2M so no need for an automation.","x":2156,"y":264,"wires":[]},{"id":"5f37298b5856dee5","type":"function","z":"0cca5f120542a932","g":"b14c70bd13a22c77","name":"Webhook Input to Payloads","func":"// Incoming webhook should have message format:\n// msg.payload.state=on/off\n// msg.data.brightness_pct=0-100\n\n// Can't control more than one setting with each Z2M output so need to pass\n// different outputs for state and brightness\n\n// To be safe, check brightness value exists before processing\nif (msg.payload.data.brightness_pct !== undefined) {\n    var briPercent = msg.payload.data.brightness_pct;\n    var briValue = Number(briPercent) / 100 * 255;\n} else {\n    var briValue = 255;\n}\n\n// Set brightness to 0 if state is 'off'\n// Not sure if this is required but just to be safe in case\n// a brightness value overrides an off state\nif ( msg.payload.state == \"off\") {\n    var briValue = 0;\n}\n\n// OUTPUT 1 - Define state output message\nvar msgState = {\n    payload: msg.payload.state\n}\n\n// OUTPUT 2 - Define brightness output message\nvar msgBri = {\n    payload : briValue\n}\n\nreturn [msgState, msgBri];\n\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2448,"y":96,"wires":[["9fe81d9e1b47c879","df7a14e59f713f31"],["1b7d54f75129da53","42146fe80f4d7877"]]},{"id":"91b35ac2d2ae7125","type":"function","z":"0cca5f120542a932","g":"b14c70bd13a22c77","name":"Alexa Input to Payloads","func":"// Incoming Alexa msg should be:\n// msg.payload=on/off\n// msg.bri=0-100\n\n// Can't control more than one setting with each Z2M output so need to pass\n// different outputs for state and brightness\n\n// To be safe, check brightness value exists before processing\nif (msg.bri !== undefined) {\n    var briPercent = msg.bri;\n    var briValue = Number(briPercent) / 100 * 255;\n} else {\n    var briValue = 255;\n}\n\n// Set brightness to 0 if state is 'off'\n// Not sure if this is required but just to be safe in case\n// a brightness value overrides an off state\nif ( msg.payload == \"off\") {\n    var briValue = 0;\n}\n\nreturn {payload : msg.payload.state, payload : briValue};","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2438,"y":204,"wires":[["9fe81d9e1b47c879"],["1b7d54f75129da53","42146fe80f4d7877","8cc2a945a5d8bc1b"]]},{"id":"9fe81d9e1b47c879","type":"zigbee2mqtt-out","z":"0cca5f120542a932","g":"b14c70bd13a22c77","name":"Z2M Movie Room - Light Group - On/Off","server":"f0cc4845.3e9e28","friendly_name":"Lights_MovieRoom","device_id":"1","command":"state","commandType":"z2m_cmd","payload":"payload","payloadType":"msg","optionsValue":"","optionsType":"nothing","x":2824,"y":120,"wires":[]},{"id":"1b7d54f75129da53","type":"zigbee2mqtt-out","z":"0cca5f120542a932","g":"b14c70bd13a22c77","name":"Z2M Movie Room - Light Group - Brightness","server":"f0cc4845.3e9e28","friendly_name":"Lights_MovieRoom","device_id":"1","command":"brightness","commandType":"z2m_cmd","payload":"payload","payloadType":"msg","optionsValue":"","optionsType":"nothing","x":2834,"y":168,"wires":[]},{"id":"42146fe80f4d7877","type":"debug","z":"0cca5f120542a932","g":"b14c70bd13a22c77","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2542,"y":156,"wires":[]},{"id":"8cc2a945a5d8bc1b","type":"debug","z":"0cca5f120542a932","g":"b14c70bd13a22c77","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2626,"y":240,"wires":[]},{"id":"df7a14e59f713f31","type":"debug","z":"0cca5f120542a932","g":"b14c70bd13a22c77","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2630,"y":60,"wires":[]},{"id":"65fffd99671c43c9","type":"http request","z":"0cca5f120542a932","g":"2eb8ad990ea06edc","name":"Reboot WLED","method":"GET","ret":"txt","paytoqs":"ignore","url":"http://192.168.30.29/win&RB","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":2464,"y":660,"wires":[[]]},{"id":"6fb9d985b3c3e7e2","type":"inject","z":"0cca5f120542a932","g":"2eb8ad990ea06edc","name":"Go!","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":2210,"y":684,"wires":[["65fffd99671c43c9"]]},{"id":"d5f5c8cf6a839df0","type":"eztimer","z":"0cca5f120542a932","d":true,"g":"2eb8ad990ea06edc","name":"Daily @ 8am","debug":false,"autoname":"08:00:00","tag":"eztimer","suspended":false,"sendEventsOnSuspend":false,"lat":"55.8938","lon":"-3.6232","timerType":"2","startupMessage":false,"ontype":"2","ontimesun":"dawn","ontimetod":"08:00:00","onpropertytype":"msg","onproperty":"payload","onvaluetype":"num","onvalue":1,"onoffset":0,"onrandomoffset":0,"onsuppressrepeats":false,"offtype":"1","offtimesun":"dusk","offtimetod":"dusk","offduration":"00:01:00","offpropertytype":"msg","offproperty":"payload","offvaluetype":"num","offvalue":0,"offoffset":0,"offrandomoffset":0,"offsuppressrepeats":false,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"sun":true,"x":2190,"y":648,"wires":[["65fffd99671c43c9"]]},{"id":"c2ed8da5da09f05b","type":"bigtimer","z":"0cca5f120542a932","g":"586cf944de0582f3","outtopic":"","outpayload1":"on","outpayload2":"off","name":"Big Timer","comment":"","lat":"55.8938","lon":"-3.6232","starttime":"5004","endtime":"1395","starttime2":0,"endtime2":0,"startoff":"-30","endoff":"15","startoff2":0,"endoff2":0,"offs":0,"outtext1":"","outtext2":"","timeout":"720","sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"day6":0,"month6":0,"day7":0,"month7":0,"day8":0,"month8":0,"day9":0,"month9":0,"day10":0,"month10":0,"day11":0,"month11":0,"day12":0,"month12":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"d6":0,"w6":0,"xday1":0,"xmonth1":0,"xday2":0,"xmonth2":0,"xday3":0,"xmonth3":0,"xday4":0,"xmonth4":0,"xday5":0,"xmonth5":0,"xday6":0,"xmonth6":0,"xday7":"","xmonth7":"","xday8":"","xmonth8":"","xday9":"","xmonth9":"","xday10":"","xmonth10":"","xday11":"","xmonth11":"","xday12":"","xmonth12":"","xd1":0,"xw1":0,"xd2":0,"xw2":0,"xd3":0,"xw3":0,"xd4":0,"xw4":0,"xd5":0,"xw5":0,"xd6":0,"xw6":0,"suspend":false,"random":true,"randon1":false,"randoff1":false,"randon2":false,"randoff2":false,"repeat":false,"atstart":true,"odd":false,"even":false,"x":2576,"y":480,"wires":[["65b789e89bf08ba5","cda1e3a56813bb46","41aee1e1f2c5c22f","006a85ac1aa3c0c0"],["fe5cf244cfc5545e","cda1e3a56813bb46","65b789e89bf08ba5"],[]]},{"id":"6583a0554f50f919","type":"inject","z":"0cca5f120542a932","g":"586cf944de0582f3","name":"On (Override Timer Until Next On/Off Event)","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":2290,"y":420,"wires":[["c2ed8da5da09f05b"]]},{"id":"dfc90808cc68c628","type":"inject","z":"0cca5f120542a932","g":"586cf944de0582f3","name":"Off (Override Timer Until Next On/Off Event)","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"off","payloadType":"str","x":2290,"y":456,"wires":[["c2ed8da5da09f05b"]]},{"id":"cabeb01becda0112","type":"server-state-changed","z":"0cca5f120542a932","g":"586cf944de0582f3","name":"HA Helper - Back Garden Lights","server":"ebb6b83c7588d734","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.nr_back_garden_lights","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":2134,"y":552,"wires":[["f2b0d42e800ac1c7"]]},{"id":"aaf5448262adb18f","type":"alexa-local","z":"0cca5f120542a932","g":"586cf944de0582f3","devicename":"Back Garden Lights","inputtrigger":true,"x":2370,"y":504,"wires":[["c2ed8da5da09f05b"]]},{"id":"65b789e89bf08ba5","type":"change","z":"0cca5f120542a932","d":true,"g":"586cf944de0582f3","name":"Set MQTT topic - Wall Net","rules":[{"t":"set","p":"topic","pt":"msg","to":"shellies/shelly1pm-garden-wall-net/relay/0/command","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2890,"y":468,"wires":[["043296a5ed64f1d9","152c3f01343df6dd"]]},{"id":"043296a5ed64f1d9","type":"mqtt out","z":"0cca5f120542a932","g":"586cf944de0582f3","name":"","topic":"","qos":"2","retain":"true","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"e96cb00d.af953","x":3090,"y":492,"wires":[]},{"id":"e30221d0384daa13","type":"function","z":"0cca5f120542a932","d":true,"g":"586cf944de0582f3","name":"Format msg: WLED","func":"// Convert msg.payload=on/off into format wled can accept:\n// msg.state.payload=on/off\n\n// Obviously many more properties can be passed to wledlights so may need to account for those in future.\n// https://flows.nodered.org/node/node-red-contrib-wled2\n\nvar newMsg ={\n    payload : {\n        state : msg.payload\n    }\n}\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2846,"y":564,"wires":[["ed3b9e33f2d6affd"]]},{"id":"ed3b9e33f2d6affd","type":"wled2","z":"0cca5f120542a932","d":true,"g":"586cf944de0582f3","address":"192.168.30.28","brightness":"255","delay":0,"color1":"#ffffff","color2":"#ffffff","color3":"#ffffff","effect":0,"effectIntensity":128,"effectSpeed":"170","name":"WLED - Wall Strip","palette":"50","preset":"1","state":"toggle","x":3050,"y":564,"wires":[[]]},{"id":"cda1e3a56813bb46","type":"change","z":"0cca5f120542a932","g":"586cf944de0582f3","name":"Set MQTT topic - WLED Wall Strip","rules":[{"t":"set","p":"topic","pt":"msg","to":"wled/garden-wall","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2860,"y":516,"wires":[["152c3f01343df6dd","043296a5ed64f1d9"]]},{"id":"2c20215aa2bb0469","type":"function","z":"0cca5f120542a932","g":"586cf944de0582f3","name":"HA Helper Input","func":"// Function to convert msg.payload=on/off into turn_on/turn_off value usable by\n// HA Call Service node.\n// In Call Service node, set all values except 'service' which will beo overridden/\n// provided by this function.\n\n// Template for passing data to Call Service node (from Call Service node help text)\n// We can set most of these values in Call Service node itself and only pass those\n// additional that are needed.\n//var newMsg= {\n//    payload : {\n//        domain : \"homeassistant\",\n//        service : \"turn_on\",\n//        target : {\n//            area_id : [\"kitchen\"],\n//            device_id : [\"8932894082930482903\"],\n//            entity_id : [\"light.kitchen\", \"switch.garage_light\"]\n//        },\n//        data : {\n//            brightness_pct : 50\n//        }\n//    }\n//}\n\n// Parse payload input - needs to be turn_on / turn_off\nif (msg.payload == \"on\") {\n    var onOff = \"turn_on\";\n} else if (msg.payload == \"off\") {\n    var onOff = \"turn_off\";\n}\n\n// Template (from node help text)\n// We can set most of these values in Node itself and only pass those\n// additional that are needed.\nvar newMsg= {\n    payload : {\n        service : onOff\n    }\n}\n\n// Return new message\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3024,"y":420,"wires":[["a6fb90245f7843a6"]]},{"id":"a6fb90245f7843a6","type":"api-call-service","z":"0cca5f120542a932","g":"586cf944de0582f3","name":"Update HA Helper","server":"ebb6b83c7588d734","version":5,"debugenabled":false,"domain":"input_boolean","service":"toggle","areaId":[],"deviceId":[],"entityId":["input_boolean.nr_back_garden_lights"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"payload","output_location_type":"none","x":3218,"y":420,"wires":[[]]},{"id":"152c3f01343df6dd","type":"debug","z":"0cca5f120542a932","g":"586cf944de0582f3","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3218,"y":492,"wires":[]},{"id":"ea110a4e2d331f16","type":"trigger-state","z":"0cca5f120542a932","g":"627bac64c8c2cdf5","name":"Door Bell Motion?","server":"ebb6b83c7588d734","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.front_door_motion","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"bool","comparatorValue":"true"}],"inputs":1,"outputs":2,"customoutputs":[],"outputinitially":true,"state_type":"habool","enableInput":true,"x":2190,"y":912,"wires":[["ce2dbb1e6320d2d4"],[]]},{"id":"a104c18399c2fd4a","type":"server-state-changed","z":"0cca5f120542a932","g":"52601706ab6bc681","name":"Motion Enabled?","server":"ebb6b83c7588d734","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.nr_front_door_motion_enable","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":2500,"y":846,"wires":[["7ec2b37007f411b2"]]},{"id":"7ec2b37007f411b2","type":"change","z":"0cca5f120542a932","g":"52601706ab6bc681","name":"Set Variable","rules":[{"t":"set","p":"front_door_motion_enabled","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2706,"y":846,"wires":[[]]},{"id":"ce2dbb1e6320d2d4","type":"switch","z":"0cca5f120542a932","g":"627bac64c8c2cdf5","name":"Motion Enabled (HA Toggle)?","property":"front_door_motion_enabled","propertyType":"global","rules":[{"t":"eq","v":"off","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":2484,"y":966,"wires":[[],["66bb885e612a3ea6"]],"info":"'Failsafe' by using 'otherwise'\r\noutput.\r\nRequires HA Motion Enabled to\r\nreturn 'off' in other flow to\r\ndisable our flow i.e. flow still\r\nworks even if HA unavailable."},{"id":"96e03b3c1e75dea9","type":"zigbee2mqtt-in","z":"0cca5f120542a932","g":"627bac64c8c2cdf5","name":"Z2M Ikea Motion 02 - Front Door","server":"f0cc4845.3e9e28","friendly_name":"z2m_ikea_motiondetector02_frontdoor (E1525/E1745)","device_id":"0x842e14fffe1c48eb","state":"occupancy","outputAtStartup":true,"filterChanges":true,"enableMultiple":false,"x":2138,"y":1008,"wires":[["b59ba4887a37b5f0"]]},{"id":"b59ba4887a37b5f0","type":"switch","z":"0cca5f120542a932","g":"627bac64c8c2cdf5","name":"Occupied?","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":2206,"y":972,"wires":[["ce2dbb1e6320d2d4"],[]],"info":"'Failsafe' by using 'otherwise'\r\noutput.\r\nRequires HA Motion Enabled to\r\nreturn 'off' in other flow to\r\ndisable our flow i.e. flow still\r\nworks even if HA unavailable."},{"id":"027a16c7be477f83","type":"trigger","z":"0cca5f120542a932","g":"627bac64c8c2cdf5","name":"","op1":"on","op2":"off","op1type":"str","op2type":"str","duration":"60","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2926,"y":966,"wires":[["6d78105108d30fad","da1f545032a7fcf3"]],"info":"Linking to the 10s timer simply to minimise\ncomplexity of flow. \n\nNo real impact to operation except adds 10s on to this timer before turning off lights."},{"id":"299aa1bd9627983d","type":"alexa-local","z":"0cca5f120542a932","g":"627bac64c8c2cdf5","devicename":"Front Door Lights","inputtrigger":true,"x":2178,"y":1104,"wires":[["3364dcabf570fc5d"]]},{"id":"086352661fbaa28d","type":"mqtt out","z":"0cca5f120542a932","g":"627bac64c8c2cdf5","name":"Send MQTT","topic":"","qos":"2","retain":"true","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"e96cb00d.af953","x":3481,"y":974,"wires":[]},{"id":"da1f545032a7fcf3","type":"change","z":"0cca5f120542a932","g":"627bac64c8c2cdf5","name":"Set MQTT topic - Tasmo - Garage","rules":[{"t":"set","p":"topic","pt":"msg","to":"tasmo-shelly1-garage-outside/cmnd/Power","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":3203,"y":998,"wires":[["086352661fbaa28d"]]},{"id":"6d78105108d30fad","type":"change","z":"0cca5f120542a932","g":"627bac64c8c2cdf5","name":"Set MQTT topic - Tasmo - Front Door","rules":[{"t":"set","p":"topic","pt":"msg","to":"tasmo-shelly1pm-frontdoor/cmnd/POWER","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":3213,"y":938,"wires":[["086352661fbaa28d"]]},{"id":"3364dcabf570fc5d","type":"switch","z":"0cca5f120542a932","g":"627bac64c8c2cdf5","name":"On/Off?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":2217,"y":1068,"wires":[["ce2dbb1e6320d2d4"],[]],"info":"'Failsafe' by using 'otherwise'\r\noutput.\r\nRequires HA Motion Enabled to\r\nreturn 'off' in other flow to\r\ndisable our flow i.e. flow still\r\nworks even if HA unavailable."},{"id":"04fd679ceacda523","type":"inject","z":"0cca5f120542a932","g":"627bac64c8c2cdf5","name":"Off","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"off","payloadType":"str","x":2942,"y":858,"wires":[["6d78105108d30fad","da1f545032a7fcf3"]]},{"id":"66bb885e612a3ea6","type":"time-range-switch","z":"0cca5f120542a932","g":"627bac64c8c2cdf5","name":"Night time?","lat":"55.8938","lon":"-3.6232","startTime":"sunsetStart","endTime":"sunriseEnd","startOffset":"-30","endOffset":"30","x":2726,"y":966,"wires":[["027a16c7be477f83"],[]]},{"id":"826f689f17638c0c","type":"time-range-switch","z":"0cca5f120542a932","g":"4d443c555e118a02","name":"Night time?","lat":"55.8938","lon":"-3.6232","startTime":"sunsetStart","endTime":"sunriseEnd","startOffset":"-30","endOffset":"30","x":682,"y":1116,"wires":[["d8fe90488eb31e50"],[]]},{"id":"1c8cab4323af1fb8","type":"inject","z":"0cca5f120542a932","g":"627bac64c8c2cdf5","name":"On","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":2230,"y":858,"wires":[["ce2dbb1e6320d2d4"]]},{"id":"ed0ec8b77e0dd97b","type":"mqtt in","z":"0cca5f120542a932","g":"ffc9651b0db40152","name":"Front Door Light State","topic":"tasmo-shelly1pm-frontdoor/stat/POWER","qos":"2","datatype":"auto-detect","broker":"e96cb00d.af953","nl":false,"rap":true,"rh":0,"inputs":0,"x":3212,"y":846,"wires":[["be0fc09e8cb16634"]]},{"id":"be0fc09e8cb16634","type":"change","z":"0cca5f120542a932","g":"ffc9651b0db40152","name":"Set Variable","rules":[{"t":"set","p":"front_door_onoff","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":3422,"y":846,"wires":[[]]},{"id":"c2c6f7c7aaa8d552","type":"switch","z":"0cca5f120542a932","d":true,"g":"3580c3bfdc9620cc","name":"Lights Already On (Global Var)?","property":"front_door_onoff","propertyType":"global","rules":[{"t":"eq","v":"ON","vt":"str"},{"t":"eq","v":"OFF","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":2974,"y":1134,"wires":[["f366feae9882e575"],["bf7b1d021bf52a41"]]},{"id":"f12b39dca16e839a","type":"switch","z":"0cca5f120542a932","d":true,"g":"3580c3bfdc9620cc","name":"Parse Switch Message","property":"payload.action","propertyType":"msg","rules":[{"t":"eq","v":"toggle","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":2708,"y":1134,"wires":[["c2c6f7c7aaa8d552"]]},{"id":"57449c87079f9c57","type":"json","z":"0cca5f120542a932","d":true,"g":"3580c3bfdc9620cc","name":"","property":"payload","action":"","pretty":false,"x":2538,"y":1134,"wires":[["f12b39dca16e839a"]]},{"id":"3d943894927e7512","type":"mqtt in","z":"0cca5f120542a932","d":true,"g":"3580c3bfdc9620cc","name":"Ikea 5-button Switch","topic":"zigbee2mqtt/z2m_ikea_5button02_htpc","qos":"2","datatype":"auto","broker":"e96cb00d.af953","nl":false,"rap":false,"inputs":0,"x":2470,"y":1086,"wires":[["57449c87079f9c57"]]},{"id":"f366feae9882e575","type":"change","z":"0cca5f120542a932","d":true,"g":"3580c3bfdc9620cc","name":"msg.payload=off","rules":[{"t":"set","p":"payload","pt":"msg","to":"off","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":3152,"y":1110,"wires":[["6d78105108d30fad","da1f545032a7fcf3"]]},{"id":"bf7b1d021bf52a41","type":"change","z":"0cca5f120542a932","d":true,"g":"3580c3bfdc9620cc","name":"msg.payload=on","rules":[{"t":"set","p":"payload","pt":"msg","to":"on","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":3152,"y":1158,"wires":[["da1f545032a7fcf3","6d78105108d30fad"]]},{"id":"28c648d01a5936e6","type":"inject","z":"0cca5f120542a932","d":true,"g":"3580c3bfdc9620cc","name":"Test Toggle","props":[{"p":"payload.action","v":"toggle","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":2530,"y":1182,"wires":[["f12b39dca16e839a"]]},{"id":"7ef5b85afa92722e","type":"mqtt out","z":"0cca5f120542a932","g":"4d443c555e118a02","name":"MQTT","topic":"","qos":"2","retain":"true","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"e96cb00d.af953","x":1666,"y":1032,"wires":[]},{"id":"9acdffbf93c728b0","type":"change","z":"0cca5f120542a932","g":"4d443c555e118a02","name":"Topic=Desk & PL=1","rules":[{"t":"set","p":"topic","pt":"msg","to":"wled/study-desk/api","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"PL=1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1422,"y":1020,"wires":[["7ef5b85afa92722e"]]},{"id":"488910318239210a","type":"change","z":"0cca5f120542a932","g":"4d443c555e118a02","name":"Topic=Desk","rules":[{"t":"set","p":"topic","pt":"msg","to":"wled/study-desk","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1402,"y":1056,"wires":[["7ef5b85afa92722e"]]},{"id":"0bac3346f316dae6","type":"switch","z":"0cca5f120542a932","g":"4d443c555e118a02","name":"on/off?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1250,"y":1032,"wires":[["9acdffbf93c728b0"],["488910318239210a","86789b7e73a629de","df2912f13bec5178","f393798ffd9f4554"]]},{"id":"e4cc19ee46027f21","type":"api-call-service","z":"0cca5f120542a932","g":"4d443c555e118a02","name":"Nanoleaf","server":"ebb6b83c7588d734","version":5,"debugenabled":false,"domain":"light","service":"toggle","areaId":[],"deviceId":[],"entityId":["light.nanoleaf"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1500,"y":828,"wires":[[]]},{"id":"86789b7e73a629de","type":"change","z":"0cca5f120542a932","g":"4d443c555e118a02","name":"Topic=Server","rules":[{"t":"set","p":"topic","pt":"msg","to":"wled/server","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1402,"y":1092,"wires":[["7ef5b85afa92722e"]]},{"id":"df2912f13bec5178","type":"change","z":"0cca5f120542a932","g":"4d443c555e118a02","name":"Topic=Strip","rules":[{"t":"set","p":"topic","pt":"msg","to":"wled/study-strip","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1402,"y":1128,"wires":[["7ef5b85afa92722e"]]},{"id":"f393798ffd9f4554","type":"change","z":"0cca5f120542a932","g":"4d443c555e118a02","name":"Topic=Bin","rules":[{"t":"set","p":"topic","pt":"msg","to":"wled/bin","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1392,"y":1164,"wires":[["7ef5b85afa92722e"]]},{"id":"2caa9d9ce8dda9b4","type":"comment","z":"0cca5f120542a932","g":"4d443c555e118a02","name":"note","info":"Study WLED\nUsing MQTT messages since the WLED package is not as reliable for some reason.\n\nOnly need to turn on one device since they are all in a synced group (except Bin).\nSending a Playlist command will trun a device on and the others will sync.\n\nReally only need to turn off one device too but sometimes a device will miss the\nmessage, or get stuck on for some reason so just for resilience we're turning all off.","x":1246,"y":1008,"wires":[]},{"id":"a9b5af6afedb7ce2","type":"timed-counter","z":"0cca5f120542a932","g":"4d443c555e118a02","name":"Count Presses","timelimit":"750","timeunit":1,"withhold":true,"fixedtimeout":false,"pertopic":false,"x":656,"y":864,"wires":[["b12e3d9f03299e1b"]]},{"id":"b12e3d9f03299e1b","type":"switch","z":"0cca5f120542a932","g":"4d443c555e118a02","name":"Single/Double?","property":"count","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":832,"y":864,"wires":[["707e6a152c7bea12"],["3a996825e2f3a3b3"]],"info":"Just expand the flow.count to how ever many\npresses you want/need."},{"id":"707e6a152c7bea12","type":"function","z":"0cca5f120542a932","g":"4d443c555e118a02","name":"Clean msg","func":"// CLEAN UP ON/OFF MESSAGES\n// Parse various messages to make sure on/off state is in msg.payload\n\n// GENERAL\n// Convert any msg.payload=true/false into on/off\nif (msg.payload == true) {\n    return { payload: \"on\" };\n} else if (msg.payload == false) {\n    return { payload: \"off\" };\n}\n\n// Z2M IKEA SWITCHES\n// Create usable msg.payload=on/off from z2m Ikea switch messages.\n// z2m switch msg has it's on/off value in msg.payload.action but we\n// want it in msg.payload\nif (msg.payload.action !== undefined) {\n    return { payload: msg.payload.action };\n} else {\n    return msg;\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1070,"y":864,"wires":[["96616a57e59906f2"]]},{"id":"41aee1e1f2c5c22f","type":"debug","z":"0cca5f120542a932","g":"586cf944de0582f3","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2766,"y":612,"wires":[]},{"id":"006a85ac1aa3c0c0","type":"function","z":"0cca5f120542a932","g":"586cf944de0582f3","name":"\"Debounce\" Start","func":"// Should be used in conjuction with: \"Debounce\" Stop\n\n// ================================================================================================\n\n// This pair of nodes prevents actions taking place within too short a period defined by variable\n// debounceMillisec in '\"Debounce\" Stop' node.\n\n// Example use case... Back Garden Lights \n// Without the 'debounce' nodes:\n//  1. Big Timer turns on lights at randomised offset at dusk everyday\n//  2. This updates the HA Helper nput_boolean in Home Assistant to reflect current state of lights\n//  3. The input_bool toggle update is detected by Node Red as a state change and triggers an 'on\n//     override' message to be sent to the Big Timer node.\n//     The lights stay on but the 'on override' message is treated as a manual override and Big\n//     Timer will stay on until the next scheduled timer trigger which is turning the lights off\n//     at the specified time - not an obvious issue but it removes the randomised offset for the\n//     off timer.\n//  4. When the un-randomised off messageis sent by Big Timer, it gaain updates the HA Helper\n//     toggle in HA and this again is detected as a state change by Node Red and triggers an 'off\n//     override' to be sent to Big Timer. This causes Big Timer to keep the lights off until the \n//     next scheduled on trigger i.e. it again removes the randomisation of turning the lights on.\n//  5. Without the debounce nodes, we get two on messages every time the lights are turned on and\n//     off (unless turned on/off by the HA toggle).\n\n// It is also generally 'cleaner' and more sensible to avoid creating code or automation 'loops'.\n// We ould easily get into the position where we accidentally create an infinite loop (e.g. if a\n// flow toggles a HA input_boolean and that is state change is detected and triggers the same\n// flow).\n\n// ================================================================================================\n\n// Set flow var to track last trigger time for debouncing - must have unique flow var names for\n// each set of debounce nodes in the same flow.\n// Update flow.get var name in '\"Debounce\" Stop' node to match this.\n\nflow.set('debounceNode', new Date());\n\n// ************** DEBUG (must come before 'return') **************\nif (global.get('debug') == true) {\n    node.warn(\"Debounce - Start Node @ \" + flow.get('debounceNode') );\n}\n// ****\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2822,"y":420,"wires":[["2c20215aa2bb0469"]]},{"id":"f2b0d42e800ac1c7","type":"function","z":"0cca5f120542a932","g":"586cf944de0582f3","name":"\"Debounce\" Stop","func":"// Should be used in conjuction with: \"Debounce\" Start\n\n// ================================================================================================\n\n// This pair of nodes prevents actions taking place within too short a period defined by variable\n// debounceMillisec in '\"Debounce\" Stop' node.\n\n// Example use case... Back Garden Lights \n// Without the 'debounce' nodes:\n//  1. Big Timer turns on lights at randomised offset at dusk everyday\n//  2. This updates the HA Helper nput_boolean in Home Assistant to reflect current state of lights\n//  3. The input_bool toggle update is detected by Node Red as a state change and triggers an 'on\n//     override' message to be sent to the Big Timer node.\n//     The lights stay on but the 'on override' message is treated as a manual override and Big\n//     Timer will stay on until the next scheduled timer trigger which is turning the lights off\n//     at the specified time - not an obvious issue but it removes the randomised offset for the\n//     off timer.\n//  4. When the un-randomised off messageis sent by Big Timer, it gaain updates the HA Helper\n//     toggle in HA and this again is detected as a state change by Node Red and triggers an 'off\n//     override' to be sent to Big Timer. This causes Big Timer to keep the lights off until the \n//     next scheduled on trigger i.e. it again removes the randomisation of turning the lights on.\n//  5. Without the debounce nodes, we get two on messages every time the lights are turned on and\n//     off (unless turned on/off by the HA toggle).\n\n// It is also generally 'cleaner' and more sensible to avoid creating code or automation 'loops'.\n// We ould easily get into the position where we accidentally create an infinite loop (e.g. if a\n// flow toggles a HA input_boolean and that is state change is detected and triggers the same\n// flow).\n\n// ================================================================================================\n\n// Define debounce period\nvar debounceMillisec = 3000;\n\n// var set to date/time now\nvar nowTime = new Date();    \n\n// Get time when '\"Debounce\" Start' was triggered for comparison\nvar lastTrigger = flow.get('debounceNode');\n\n\n// If lastTrigger value exists, calc time difference\n// or else set it really high to allow triggering\nif (lastTrigger != undefined) {\n    var sinceLastTrigger = nowTime.getTime() - lastTrigger.getTime();\n} else {\n    var sinceLastTrigger = 1000000000000;\n}\n\n// ************** DEBUG (must come before 'return') **************\nif (global.get('debug') == true) {\n    node.warn(\"Debounce - Start time: \" + lastTrigger);\n    node.warn(\"Debounce - Time Since Start: \" + sinceLastTrigger);\n    node.warn(\"Debounce - Debounce Period: \" + debounceMillisec);\n}\n// ****************************************************************\n\nif (sinceLastTrigger < debounceMillisec) {\n    // ************** DEBUG (must come before 'return') **************\n    if (global.get('debug') == true) {\n        node.warn(\"Debounce - Message Blocked!\");\n    }\n    // ****************************************************************   \n} else {\n    // ************** DEBUG (must come before 'return') **************\n    if (global.get('debug') == true) {\n        node.warn(\"Debounce - Message Not Blocked!\");\n    }\n    // ****************************************************************\n\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2366,"y":552,"wires":[["c2ed8da5da09f05b","6069a3b3ed649303"]]},{"id":"6069a3b3ed649303","type":"debug","z":"0cca5f120542a932","g":"586cf944de0582f3","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2538,"y":576,"wires":[]},{"id":"fe5cf244cfc5545e","type":"debug","z":"0cca5f120542a932","g":"586cf944de0582f3","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2770,"y":648,"wires":[]},{"id":"05250ad6357ff117","type":"inject","z":"0cca5f120542a932","g":"586cf944de0582f3","name":"Timer (Reset any overrides)","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"timer","payloadType":"str","x":2336,"y":384,"wires":[["c2ed8da5da09f05b"]]},{"id":"0f4d519522e4284c","type":"function","z":"0cca5f120542a932","g":"4a5746f4fb0ac020","name":"\"Debounce\" Start","func":"// Should be used in conjuction with: \"Debounce\" Stop\n\n// ================================================================================================\n\n// This pair of nodes prevents actions taking place within too short a period defined by variable\n// debounceMillisec in '\"Debounce\" Stop' node.\n\n// Example use case... Back Garden Lights \n// Without the 'debounce' nodes:\n//  1. Big Timer turns on lights at randomised offset at dusk everyday\n//  2. This updates the HA Helper nput_boolean in Home Assistant to reflect current state of lights\n//  3. The input_bool toggle update is detected by Node Red as a state change and triggers an 'on\n//     override' message to be sent to the Big Timer node.\n//     The lights stay on but the 'on override' message is treated as a manual override and Big\n//     Timer will stay on until the next scheduled timer trigger which is turning the lights off\n//     at the specified time - not an obvious issue but it removes the randomised offset for the\n//     off timer.\n//  4. When the un-randomised off messageis sent by Big Timer, it gaain updates the HA Helper\n//     toggle in HA and this again is detected as a state change by Node Red and triggers an 'off\n//     override' to be sent to Big Timer. This causes Big Timer to keep the lights off until the \n//     next scheduled on trigger i.e. it again removes the randomisation of turning the lights on.\n//  5. Without the debounce nodes, we get two on messages every time the lights are turned on and\n//     off (unless turned on/off by the HA toggle).\n\n// It is also generally 'cleaner' and more sensible to avoid creating code or automation 'loops'.\n// We ould easily get into the position where we accidentally create an infinite loop (e.g. if a\n// flow toggles a HA input_boolean and that is state change is detected and triggers the same\n// flow).\n\n// ================================================================================================\n\n// Set flow var to track last trigger time for debouncing - must have unique flow var names for\n// each set of debounce nodes in the same flow.\n// Update flow.get var name in '\"Debounce\" Stop' node to match this.\n\nflow.set('debounceNode', new Date());\n\n// ************** DEBUG (must come before 'return') **************\nif (global.get('debug') == true) {\n    node.warn(\"Debounce - Start Node @ \" + flow.get('debounceNode') );\n}\n// ****\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1086,"y":48,"wires":[["4174b29428e51f9a"]]},{"id":"039a68561a24da09","type":"function","z":"0cca5f120542a932","g":"4a5746f4fb0ac020","name":"\"Debounce\" Stop","func":"// Should be used in conjuction with: \"Debounce\" Start\n\n// ================================================================================================\n\n// This pair of nodes prevents actions taking place within too short a period defined by variable\n// debounceMillisec in '\"Debounce\" Stop' node.\n\n// Example use case... Back Garden Lights \n// Without the 'debounce' nodes:\n//  1. Big Timer turns on lights at randomised offset at dusk everyday\n//  2. This updates the HA Helper nput_boolean in Home Assistant to reflect current state of lights\n//  3. The input_bool toggle update is detected by Node Red as a state change and triggers an 'on\n//     override' message to be sent to the Big Timer node.\n//     The lights stay on but the 'on override' message is treated as a manual override and Big\n//     Timer will stay on until the next scheduled timer trigger which is turning the lights off\n//     at the specified time - not an obvious issue but it removes the randomised offset for the\n//     off timer.\n//  4. When the un-randomised off messageis sent by Big Timer, it gaain updates the HA Helper\n//     toggle in HA and this again is detected as a state change by Node Red and triggers an 'off\n//     override' to be sent to Big Timer. This causes Big Timer to keep the lights off until the \n//     next scheduled on trigger i.e. it again removes the randomisation of turning the lights on.\n//  5. Without the debounce nodes, we get two on messages every time the lights are turned on and\n//     off (unless turned on/off by the HA toggle).\n\n// It is also generally 'cleaner' and more sensible to avoid creating code or automation 'loops'.\n// We ould easily get into the position where we accidentally create an infinite loop (e.g. if a\n// flow toggles a HA input_boolean and that is state change is detected and triggers the same\n// flow).\n\n// ================================================================================================\n\n// Define debounce period\nvar debounceMillisec = 3000;\n\n// var set to date/time now\nvar nowTime = new Date();    \n\n// Get time when '\"Debounce\" Start' was triggered for comparison\nvar lastTrigger = flow.get('debounceNode');\n\n\n// If lastTrigger value exists, calc time difference\n// or else set it really high to allow triggering\nif (lastTrigger != undefined) {\n    var sinceLastTrigger = nowTime.getTime() - lastTrigger.getTime();\n} else {\n    var sinceLastTrigger = 1000000000000;\n}\n\n// ************** DEBUG (must come before 'return') **************\nif (global.get('debug') == true) {\n    node.warn(\"Debounce - Start time: \" + lastTrigger);\n    node.warn(\"Debounce - Time Since Start: \" + sinceLastTrigger);\n    node.warn(\"Debounce - Debounce Period: \" + debounceMillisec);\n}\n// ****************************************************************\n\nif (sinceLastTrigger < debounceMillisec) {\n    // ************** DEBUG (must come before 'return') **************\n    if (global.get('debug') == true) {\n        node.warn(\"Debounce - Message Blocked!\");\n    }\n    // ****************************************************************   \n} else {\n    // ************** DEBUG (must come before 'return') **************\n    if (global.get('debug') == true) {\n        node.warn(\"Debounce - Message Not Blocked!\");\n    }\n    // ****************************************************************\n\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":438,"y":156,"wires":[["8d0b0ec1b4801c97"]]},{"id":"90a0f21b31032360","type":"function","z":"0cca5f120542a932","g":"4d443c555e118a02","name":"\"Debounce\" Stop","func":"// Should be used in conjuction with: \"Debounce\" Start\n\n// ================================================================================================\n\n// This pair of nodes prevents actions taking place within too short a period defined by variable\n// debounceMillisec in '\"Debounce\" Stop' node.\n\n// Example use case... Back Garden Lights \n// Without the 'debounce' nodes:\n//  1. Big Timer turns on lights at randomised offset at dusk everyday\n//  2. This updates the HA Helper nput_boolean in Home Assistant to reflect current state of lights\n//  3. The input_bool toggle update is detected by Node Red as a state change and triggers an 'on\n//     override' message to be sent to the Big Timer node.\n//     The lights stay on but the 'on override' message is treated as a manual override and Big\n//     Timer will stay on until the next scheduled timer trigger which is turning the lights off\n//     at the specified time - not an obvious issue but it removes the randomised offset for the\n//     off timer.\n//  4. When the un-randomised off messageis sent by Big Timer, it gaain updates the HA Helper\n//     toggle in HA and this again is detected as a state change by Node Red and triggers an 'off\n//     override' to be sent to Big Timer. This causes Big Timer to keep the lights off until the \n//     next scheduled on trigger i.e. it again removes the randomisation of turning the lights on.\n//  5. Without the debounce nodes, we get two on messages every time the lights are turned on and\n//     off (unless turned on/off by the HA toggle).\n\n// It is also generally 'cleaner' and more sensible to avoid creating code or automation 'loops'.\n// We ould easily get into the position where we accidentally create an infinite loop (e.g. if a\n// flow toggles a HA input_boolean and that is state change is detected and triggers the same\n// flow).\n\n// ================================================================================================\n\n// Define debounce period\nvar debounceMillisec = 3000;\n\n// var set to date/time now\nvar nowTime = new Date();    \n\n// Get time when '\"Debounce\" Start' was triggered for comparison\nvar lastTrigger = flow.get('debounceNode');\n\n\n// If lastTrigger value exists, calc time difference\n// or else set it really high to allow triggering\nif (lastTrigger != undefined) {\n    var sinceLastTrigger = nowTime.getTime() - lastTrigger.getTime();\n} else {\n    var sinceLastTrigger = 1000000000000;\n}\n\n// ************** DEBUG (must come before 'return') **************\nif (global.get('debug') == true) {\n    node.warn(\"Debounce - Start time: \" + lastTrigger);\n    node.warn(\"Debounce - Time Since Start: \" + sinceLastTrigger);\n    node.warn(\"Debounce - Debounce Period: \" + debounceMillisec);\n}\n// ****************************************************************\n\nif (sinceLastTrigger < debounceMillisec) {\n    // ************** DEBUG (must come before 'return') **************\n    if (global.get('debug') == true) {\n        node.warn(\"Debounce - Message Blocked!\");\n    }\n    // ****************************************************************   \n} else {\n    // ************** DEBUG (must come before 'return') **************\n    if (global.get('debug') == true) {\n        node.warn(\"Debounce - Message Not Blocked!\");\n    }\n    // ****************************************************************\n\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":438,"y":936,"wires":[["3a996825e2f3a3b3"]]},{"id":"6cbf51e43ce083c7","type":"function","z":"0cca5f120542a932","g":"4d443c555e118a02","name":"\"Debounce\" Start","func":"// Should be used in conjuction with: \"Debounce\" Stop\n\n// ================================================================================================\n\n// This pair of nodes prevents actions taking place within too short a period defined by variable\n// debounceMillisec in '\"Debounce\" Stop' node.\n\n// Example use case... Back Garden Lights \n// Without the 'debounce' nodes:\n//  1. Big Timer turns on lights at randomised offset at dusk everyday\n//  2. This updates the HA Helper nput_boolean in Home Assistant to reflect current state of lights\n//  3. The input_bool toggle update is detected by Node Red as a state change and triggers an 'on\n//     override' message to be sent to the Big Timer node.\n//     The lights stay on but the 'on override' message is treated as a manual override and Big\n//     Timer will stay on until the next scheduled timer trigger which is turning the lights off\n//     at the specified time - not an obvious issue but it removes the randomised offset for the\n//     off timer.\n//  4. When the un-randomised off messageis sent by Big Timer, it gaain updates the HA Helper\n//     toggle in HA and this again is detected as a state change by Node Red and triggers an 'off\n//     override' to be sent to Big Timer. This causes Big Timer to keep the lights off until the \n//     next scheduled on trigger i.e. it again removes the randomisation of turning the lights on.\n//  5. Without the debounce nodes, we get two on messages every time the lights are turned on and\n//     off (unless turned on/off by the HA toggle).\n\n// It is also generally 'cleaner' and more sensible to avoid creating code or automation 'loops'.\n// We ould easily get into the position where we accidentally create an infinite loop (e.g. if a\n// flow toggles a HA input_boolean and that is state change is detected and triggers the same\n// flow).\n\n// ================================================================================================\n\n// Set flow var to track last trigger time for debouncing - must have unique flow var names for\n// each set of debounce nodes in the same flow.\n// Update flow.get var name in '\"Debounce\" Stop' node to match this.\n\nflow.set('debounceNode', new Date());\n\n// ************** DEBUG (must come before 'return') **************\nif (global.get('debug') == true) {\n    node.warn(\"Debounce - Start Node @ \" + flow.get('debounceNode') );\n}\n// ****\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1254,"y":780,"wires":[["72eea6de9a6a7907"]]},{"id":"eae2029044b43b28","type":"function","z":"0cca5f120542a932","g":"ed1b3491c6acd9fa","name":"\"Debounce\" Start","func":"// Should be used in conjuction with: \"Debounce\" Stop\n\n// ================================================================================================\n\n// This pair of nodes prevents actions taking place within too short a period defined by variable\n// debounceMillisec in '\"Debounce\" Stop' node.\n\n// Example use case... Back Garden Lights \n// Without the 'debounce' nodes:\n//  1. Big Timer turns on lights at randomised offset at dusk everyday\n//  2. This updates the HA Helper nput_boolean in Home Assistant to reflect current state of lights\n//  3. The input_bool toggle update is detected by Node Red as a state change and triggers an 'on\n//     override' message to be sent to the Big Timer node.\n//     The lights stay on but the 'on override' message is treated as a manual override and Big\n//     Timer will stay on until the next scheduled timer trigger which is turning the lights off\n//     at the specified time - not an obvious issue but it removes the randomised offset for the\n//     off timer.\n//  4. When the un-randomised off messageis sent by Big Timer, it gaain updates the HA Helper\n//     toggle in HA and this again is detected as a state change by Node Red and triggers an 'off\n//     override' to be sent to Big Timer. This causes Big Timer to keep the lights off until the \n//     next scheduled on trigger i.e. it again removes the randomisation of turning the lights on.\n//  5. Without the debounce nodes, we get two on messages every time the lights are turned on and\n//     off (unless turned on/off by the HA toggle).\n\n// It is also generally 'cleaner' and more sensible to avoid creating code or automation 'loops'.\n// We ould easily get into the position where we accidentally create an infinite loop (e.g. if a\n// flow toggles a HA input_boolean and that is state change is detected and triggers the same\n// flow).\n\n// ================================================================================================\n\n// Set flow var to track last trigger time for debouncing - must have unique flow var names for\n// each set of debounce nodes in the same flow.\n// Update flow.get var name in '\"Debounce\" Stop' node to match this.\n\nflow.set('debounceNode', new Date());\n\n// ************** DEBUG (must come before 'return') **************\nif (global.get('debug') == true) {\n    node.warn(\"Debounce - Start Node @ \" + flow.get('debounceNode') );\n}\n// ****\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1086,"y":384,"wires":[["059d0f63898aa69e"]]},{"id":"b7a5c188fd578655","type":"function","z":"0cca5f120542a932","g":"ed1b3491c6acd9fa","name":"\"Debounce\" Stop","func":"// Should be used in conjuction with: \"Debounce\" Start\n\n// ================================================================================================\n\n// This pair of nodes prevents actions taking place within too short a period defined by variable\n// debounceMillisec in '\"Debounce\" Stop' node.\n\n// Example use case... Back Garden Lights \n// Without the 'debounce' nodes:\n//  1. Big Timer turns on lights at randomised offset at dusk everyday\n//  2. This updates the HA Helper nput_boolean in Home Assistant to reflect current state of lights\n//  3. The input_bool toggle update is detected by Node Red as a state change and triggers an 'on\n//     override' message to be sent to the Big Timer node.\n//     The lights stay on but the 'on override' message is treated as a manual override and Big\n//     Timer will stay on until the next scheduled timer trigger which is turning the lights off\n//     at the specified time - not an obvious issue but it removes the randomised offset for the\n//     off timer.\n//  4. When the un-randomised off messageis sent by Big Timer, it gaain updates the HA Helper\n//     toggle in HA and this again is detected as a state change by Node Red and triggers an 'off\n//     override' to be sent to Big Timer. This causes Big Timer to keep the lights off until the \n//     next scheduled on trigger i.e. it again removes the randomisation of turning the lights on.\n//  5. Without the debounce nodes, we get two on messages every time the lights are turned on and\n//     off (unless turned on/off by the HA toggle).\n\n// It is also generally 'cleaner' and more sensible to avoid creating code or automation 'loops'.\n// We ould easily get into the position where we accidentally create an infinite loop (e.g. if a\n// flow toggles a HA input_boolean and that is state change is detected and triggers the same\n// flow).\n\n// ================================================================================================\n\n// Define debounce period\nvar debounceMillisec = 3000;\n\n// var set to date/time now\nvar nowTime = new Date();    \n\n// Get time when '\"Debounce\" Start' was triggered for comparison\nvar lastTrigger = flow.get('debounceNode');\n\n\n// If lastTrigger value exists, calc time difference\n// or else set it really high to allow triggering\nif (lastTrigger != undefined) {\n    var sinceLastTrigger = nowTime.getTime() - lastTrigger.getTime();\n} else {\n    var sinceLastTrigger = 1000000000000;\n}\n\n// ************** DEBUG (must come before 'return') **************\nif (global.get('debug') == true) {\n    node.warn(\"Debounce - Start time: \" + lastTrigger);\n    node.warn(\"Debounce - Time Since Start: \" + sinceLastTrigger);\n    node.warn(\"Debounce - Debounce Period: \" + debounceMillisec);\n}\n// ****************************************************************\n\nif (sinceLastTrigger < debounceMillisec) {\n    // ************** DEBUG (must come before 'return') **************\n    if (global.get('debug') == true) {\n        node.warn(\"Debounce - Message Blocked!\");\n    }\n    // ****************************************************************   \n} else {\n    // ************** DEBUG (must come before 'return') **************\n    if (global.get('debug') == true) {\n        node.warn(\"Debounce - Message Not Blocked!\");\n    }\n    // ****************************************************************\n\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":426,"y":396,"wires":[["c3f1f82b7c88359b"]]},{"id":"596479a15ab0efac","type":"change","z":"0cca5f120542a932","g":"d0e1bff62bd0d786","name":"(Re)Start Timer & Set MQTT Payload = ON","rules":[{"t":"set","p":"payload","pt":"msg","to":"on","tot":"str"},{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":846,"y":2088,"wires":[["08c4474a1b21d1b4","cff0060a66898b1a","f9993e779ca7d2df"]]},{"id":"134663eb2372a705","type":"inject","z":"0cca5f120542a932","g":"ed1b3491c6acd9fa","name":"Timer (Reset any overrides)","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"timer","payloadType":"str","x":396,"y":564,"wires":[["c3f1f82b7c88359b"]]},{"id":"183c13610f1a7441","type":"inject","z":"0cca5f120542a932","g":"4a5746f4fb0ac020","name":"Timer (Reset any overrides)","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"timer","payloadType":"str","x":315,"y":288,"wires":[["8d0b0ec1b4801c97"]]},{"id":"c3f1f82b7c88359b","type":"bigtimer","z":"0cca5f120542a932","g":"ed1b3491c6acd9fa","outtopic":"","outpayload1":"on","outpayload2":"off","name":"Big Timer","comment":"","lat":"55.8938","lon":"-3.6232","starttime":"5004","endtime":"15","starttime2":0,"endtime2":0,"startoff":"-30","endoff":"10","startoff2":0,"endoff2":0,"offs":0,"outtext1":"","outtext2":"","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"day6":0,"month6":0,"day7":0,"month7":0,"day8":0,"month8":0,"day9":0,"month9":0,"day10":0,"month10":0,"day11":0,"month11":0,"day12":0,"month12":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"d6":0,"w6":0,"xday1":0,"xmonth1":0,"xday2":0,"xmonth2":0,"xday3":0,"xmonth3":0,"xday4":0,"xmonth4":0,"xday5":0,"xmonth5":0,"xday6":0,"xmonth6":0,"xday7":"","xmonth7":"","xday8":"","xmonth8":"","xday9":"","xmonth9":"","xday10":"","xmonth10":"","xday11":"","xmonth11":"","xday12":"","xmonth12":"","xd1":0,"xw1":0,"xd2":0,"xw2":0,"xd3":0,"xw3":0,"xd4":0,"xw4":0,"xd5":0,"xw5":0,"xd6":0,"xw6":0,"suspend":false,"random":true,"randon1":false,"randoff1":false,"randon2":false,"randoff2":false,"repeat":false,"atstart":true,"odd":false,"even":false,"x":732,"y":456,"wires":[["eae2029044b43b28","2d249796a92cd342","664716a5a618b4f6","0f4ce243ea52c834"],[],[]]},{"id":"0613aeba28fc8dd6","type":"comment","z":"0cca5f120542a932","g":"d0e1bff62bd0d786","name":"Override Motion Sensor Notes (needs updated!)","info":"\n\n# Override Motion sensor\nWe want to override the motion sensor to stop light turning off while using shower.\nIdeally we would just override motion if the wall switch had been used.\nWhen the motion sensor turns on the light it is actually sending an MQTT message to turn on the Shelly switch.\nSo we can't use the wall switch as a trigger to enable the override since we get the same message from the switch whether it is turned on manually or via MQTT.\n\nNote that if we had smart bulbs in the toilet we could turn them on directly with the motion sensor and therefore easily use the wall switch for manual override.\nSee examples of using wall switch for override: \n* https://discourse.nodered.org/t/disable-flow-injection-using-a-button-on-the-dashboard/55006 \n* https://discourse.nodered.org/t/enable-or-disable-processing-or-flows/23379/11\n\nInstead we will use 2 fast switch activations to enable the override.\n\n## Detect Wall SWitch Activating Twice\nFirst we need to detect when the wall switch is used. We can do this with:\n* The Shelly palette set to 'polling' mode to poll the Wall Switch.\nHowever we would need to set the polling frequency very high which might cause issues with too many queries and probably can't detect multiple quick activations.\n* Home Assistant 'Trigger State' node (more enhanced version of the 'Changed State' node) detecting the Shelly Wall Switch\nIt will output a payload matching the switch state i.e. on/off\n\nWe will use the 'counter' node to count switch events (https://flows.nodered.org/node/node-red-contrib-counter)\n - See this thread: https://discourse.nodered.org/t/how-to-detect-multiple-presses-on-a-single-button/20560/41 \n - This note and the following mini-conversation are useful: https://discourse.nodered.org/t/how-to-detect-multiple-presses-on-a-single-button/20560/5\n_(We could also try this palette and pretend our switch is a button: https://discourse.nodered.org/t/announce-node-red-contrib-button-events-version-2-0-0-beta/66159 - this includes a way to 'train' the node for how long it takes for each 'button press')_\n\nSee the nodes we have setup for details on how the 'counter' node is used to detect two fast switches.\nThe override is triggered by switching the lights on and off multiple times. Once triggered a flow variable will be set override='true'/'false' status (other non-variable based methods are also detailed below).\n\nThe override is turned off once the lights next turn off - there must be at least 2 secs of no switches before turning off the lights will also disable the override (just in case we get overexcited and switch too many times).\n\n**Note that the wall switch detection sometimes arrives up to a minute late** - we need to factor that into any solution.\nWe will allow the motion detection to detect movement and turn on the light but 'block' the off message until the override ends.\n\n---\n\n## Implement Override\nWe can solve this a few ways but all are based on blocking or droping the flow traffic before the OFF message is sent by MQTT.\n\n### Using Variables\nWe can use a flow variable to hold the current state of whether the motion sensor override is 'true' or 'false'.\nPer above, once override switches detected, the var will be set to override='true'.\nUse a 'Switch' node after the off-timer to check the variable value and only allow the message through if var is not 'true'.\nThe var gets reset to 'false' whenever the light state next changes to off.\n\n### Using Traffic Light node\nThe Traffic Light node can be downloaded from: https://flows.nodered.org/node/node-red-contrib-traffic\nIt stops traffic based on whether it is set to 'passing' or 'blocking' mode.\nThe mode of the node can be set by sending it a specific message. \nThe Traffic Node would be placed after the off-timer to 'block' the off message when motion sensor is overridden.\nWe would set the Traffic node to 'blocking' if the override is triggered (per above notes).\nAnd set the Traffic Node to 'passing' whenever the light state next changes to off.\n\n### Using a Gate node\nThis is very similar to the Traffic node above but with a bit more functionality.\nWe would use it in exactly the same way.\nIt can be downloaded from: https://flows.nodered.org/node/node-red-contrib-queue-gate\nAnd it is a slightly more enhanced version of: https://flows.nodered.org/node/node-red-contrib-simple-gate\n - the enhanced one can queue messages for sending once the gate 'opens'\n\n\n**We have decided to use the variable-based method outlined above since it is not reliant on additional community nodes.**","x":1852,"y":1908,"wires":[]},{"id":"d246ce9946c07722","type":"comment","z":"0cca5f120542a932","g":"d0e1bff62bd0d786","name":"Notes","info":"When motion detected Sonoff motion sensor sends:\n    msg.payload.occupancy=true\n\nAfter 60s it sends:\n    msg.payload.occupancy=false\n    \nSometimes the sensor won't send a 'false' if motion continues to be detected. \nNot certain waits until no motion for 60s then sends a 'false' as it seems a\nbit inconsistent - sometimes motion can occur and 'false' is still sent,\nsometimes motion occurs and 'true' is sent occasionally to notify of motion\nbut sometimes not.\n\nFlow primarily does:\n - Turn on light with every 'true'. And reset the off timer to start countdown\n   again.\n - Turn off light Xs after last 'false' payload.\n - Override motion-based off messages - override enabled by using wall switch\n   twice quickly - see specific override notes.\n\nWe would usually use 'true' to start the timer to turn off the light, and to\nreset the timer after every true received.\nBut can't use the 'true' to trigger since the sensor sometimes doesn't\nre-send 'true' if motion continues after initial detection so delay won't\ncontinue to be reset while occupied. \nSo we need to use 'false' as trigger. i.e. turn off light Xs after false sent.\n","x":134,"y":1908,"wires":[]},{"id":"da6abc2fb5bc9b15","type":"trigger-state","z":"0cca5f120542a932","g":"ab9771b8ef2a4dfd","name":"","server":"ebb6b83c7588d734","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"switch.kids_toilet_light_shelly1pm_02","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"inputs":1,"outputs":2,"customoutputs":[],"outputinitially":true,"state_type":"str","enableInput":true,"x":266,"y":2496,"wires":[["28da953db1b090ba","b4de0d51163c9c57"],["ef827efae7c443b1","9d1b280ccb7095cc","0d6109192ea6c1ee","1fd08be2b2b12dcc"]]},{"id":"d52bb5a075c4cff1","type":"change","z":"0cca5f120542a932","g":"ab9771b8ef2a4dfd","name":"Set MOTION_OVERRIDE = true","rules":[{"t":"set","p":"nr_kids_toilet_motion_override","pt":"flow","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1018,"y":2448,"wires":[["97852596869a993b","94aeb7e4d73f3e27"]]},{"id":"ef827efae7c443b1","type":"change","z":"0cca5f120542a932","g":"ab9771b8ef2a4dfd","name":"Set MOTION_OVERRIDE = false","rules":[{"t":"set","p":"nr_kids_toilet_motion_override","pt":"flow","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":676,"y":2532,"wires":[["4bf484469680cbcb"]]},{"id":"28da953db1b090ba","type":"switch","z":"0cca5f120542a932","g":"ab9771b8ef2a4dfd","name":"Check MOTION_TRIGGERED State","property":"nr_kids_toilet_motion_triggered","propertyType":"flow","rules":[{"t":"true"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":690,"y":2448,"wires":[[],["d52bb5a075c4cff1"]]},{"id":"cff0060a66898b1a","type":"switch","z":"0cca5f120542a932","g":"d0e1bff62bd0d786","name":"Check MOTION_OVERRIDE State","property":"nr_kids_toilet_motion_override","propertyType":"flow","rules":[{"t":"true"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1292,"y":2088,"wires":[[],["5a81f24279216688","5fbda70ff22775a0"]]},{"id":"9d1b280ccb7095cc","type":"change","z":"0cca5f120542a932","g":"ab9771b8ef2a4dfd","name":"Set MOTION_TRIGGERED = false","rules":[{"t":"set","p":"nr_kids_toilet_motion_triggered","pt":"flow","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":676,"y":2580,"wires":[["4bf484469680cbcb"]]},{"id":"6cf0fc072fee7d0d","type":"change","z":"0cca5f120542a932","g":"d0e1bff62bd0d786","name":"Set MOTION_TRIGGERED = true","rules":[{"t":"set","p":"nr_kids_toilet_motion_triggered","pt":"flow","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":620,"y":2184,"wires":[["596479a15ab0efac"]]},{"id":"b4de0d51163c9c57","type":"debug","z":"0cca5f120542a932","g":"ab9771b8ef2a4dfd","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":590,"y":2412,"wires":[]},{"id":"e0fd27cab54d890f","type":"change","z":"0cca5f120542a932","g":"d0e1bff62bd0d786","name":"Set MOTION_TRIGGERED = false","rules":[{"t":"set","p":"nr_kids_toilet_motion_triggered","pt":"flow","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1364,"y":2184,"wires":[[]]},{"id":"97852596869a993b","type":"trigger","z":"0cca5f120542a932","g":"ab9771b8ef2a4dfd","name":"Light off max 45m","op1":"on","op2":"off","op1type":"str","op2type":"str","duration":"45","extend":true,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1286,"y":2448,"wires":[["6a2195a30fc86587"]]},{"id":"6a2195a30fc86587","type":"change","z":"0cca5f120542a932","g":"ab9771b8ef2a4dfd","name":"Set MQTT topic & payload - Light off","rules":[{"t":"set","p":"topic","pt":"msg","to":"shellies/shelly1pm-kids-toilet/relay/0/command","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"off","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1554,"y":2448,"wires":[["803659e69f8c8fc5"]]},{"id":"803659e69f8c8fc5","type":"mqtt out","z":"0cca5f120542a932","g":"ab9771b8ef2a4dfd","name":"","topic":"","qos":"2","retain":"true","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"e96cb00d.af953","x":1790,"y":2448,"wires":[]},{"id":"0d6109192ea6c1ee","type":"change","z":"0cca5f120542a932","g":"ab9771b8ef2a4dfd","name":"Reset Light Off Timer","rules":[{"t":"set","p":"reset","pt":"msg","to":"foo","tot":"str"},{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1048,"y":2496,"wires":[["97852596869a993b"]]},{"id":"4bf484469680cbcb","type":"function","z":"0cca5f120542a932","g":"ab9771b8ef2a4dfd","name":"Variable Values","func":"\nvar override = flow.get('nr_kids_toilet_motion_override');\nvar motion = flow.get('nr_kids_toilet_motion_triggered');\n\n//var nowTime = new Date().toLocaleTimeString(); // = HH:MM:SS AM/PM\nvar nowTime = ((\"0\" + new Date().getHours()).slice(-2) + \":\" + (\"0\" + new Date().getMinutes()).slice(-2) + \":\" + (\"0\" + new Date().getSeconds()).slice(-2));\n\n\nvar msg_motion = {\n    payload: nowTime + \" Motion Triggered: \" + flow.get('nr_kids_toilet_motion_triggered')\n}\n\nvar msg_override = {\n    payload: nowTime + \" Motion Override: \" + flow.get('nr_kids_toilet_motion_triggered')\n}\n\nreturn [msg_motion, msg_override];\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":940,"y":2556,"wires":[["b4725dda96982e25"],["1e8b3851f7729a3d"]]},{"id":"1e8b3851f7729a3d","type":"debug","z":"0cca5f120542a932","g":"ab9771b8ef2a4dfd","name":"Payload Value","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1132,"y":2580,"wires":[]},{"id":"b4725dda96982e25","type":"debug","z":"0cca5f120542a932","g":"ab9771b8ef2a4dfd","name":"Payload Value","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1132,"y":2532,"wires":[]},{"id":"94aeb7e4d73f3e27","type":"function","z":"0cca5f120542a932","g":"ab9771b8ef2a4dfd","name":"Variable Values","func":"\nvar override = flow.get('nr_kids_toilet_motion_override');\nvar motion = flow.get('nr_kids_toilet_motion_triggered');\n\n//var nowTime = new Date().toLocaleTimeString(); // = HH:MM:SS AM/PM\nvar nowTime = ((\"0\" + new Date().getHours()).slice(-2) + \":\" + (\"0\" + new Date().getMinutes()).slice(-2) + \":\" + (\"0\" + new Date().getSeconds()).slice(-2));\n\n\nvar msg_motion = {\n    payload: nowTime + \" Motion Triggered: \" + flow.get('nr_kids_toilet_motion_triggered')\n}\n\nvar msg_override = {\n    payload: nowTime + \" Motion Override: \" + flow.get('nr_kids_toilet_motion_triggered')\n}\n\nreturn [msg_motion, msg_override];\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1276,"y":2376,"wires":[["05b15ca03948cffd"],["6798f61b908f814b"]]},{"id":"6798f61b908f814b","type":"debug","z":"0cca5f120542a932","g":"ab9771b8ef2a4dfd","name":"Payload Value","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1468,"y":2400,"wires":[]},{"id":"05b15ca03948cffd","type":"debug","z":"0cca5f120542a932","g":"ab9771b8ef2a4dfd","name":"Payload Value","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1468,"y":2352,"wires":[]},{"id":"5d7bd26ba654df20","type":"function","z":"0cca5f120542a932","g":"d0e1bff62bd0d786","name":"Variable Values","func":"\nvar override = flow.get('nr_kids_toilet_motion_override');\nvar motion = flow.get('nr_kids_toilet_motion_triggered');\n\n//var nowTime = new Date().toLocaleTimeString(); // = HH:MM:SS AM/PM\nvar nowTime = ((\"0\" + new Date().getHours()).slice(-2) + \":\" + (\"0\" + new Date().getMinutes()).slice(-2) + \":\" + (\"0\" + new Date().getSeconds()).slice(-2));\n\n\nvar msg_motion = {\n    payload: nowTime + \" Motion Triggered: \" + flow.get('nr_kids_toilet_motion_triggered')\n}\n\nvar msg_override = {\n    payload: nowTime + \" Motion Override: \" + flow.get('nr_kids_toilet_motion_triggered')\n}\n\nreturn [msg_motion, msg_override];\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":768,"y":1992,"wires":[["efd03b215513e377"],["83ca3420ca5d7886"]]},{"id":"83ca3420ca5d7886","type":"debug","z":"0cca5f120542a932","name":"Payload Value","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":956,"y":2016,"wires":[]},{"id":"efd03b215513e377","type":"debug","z":"0cca5f120542a932","g":"d0e1bff62bd0d786","name":"Payload Value","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":960,"y":1968,"wires":[]},{"id":"5fbda70ff22775a0","type":"debug","z":"0cca5f120542a932","g":"d0e1bff62bd0d786","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1534,"y":2268,"wires":[]},{"id":"f9993e779ca7d2df","type":"function","z":"0cca5f120542a932","g":"d0e1bff62bd0d786","name":"Variable Values","func":"\nvar override = flow.get('nr_kids_toilet_motion_override');\nvar motion = flow.get('nr_kids_toilet_motion_triggered');\n\n//var nowTime = new Date().toLocaleTimeString(); // = HH:MM:SS AM/PM\nvar nowTime = ((\"0\" + new Date().getHours()).slice(-2) + \":\" + (\"0\" + new Date().getMinutes()).slice(-2) + \":\" + (\"0\" + new Date().getSeconds()).slice(-2));\n\n\nvar msg_motion = {\n    payload: nowTime + \" Motion Triggered: \" + flow.get('nr_kids_toilet_motion_triggered')\n}\n\nvar msg_override = {\n    payload: nowTime + \" Motion Override: \" + flow.get('nr_kids_toilet_motion_triggered')\n}\n\nreturn [msg_motion, msg_override];\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1272,"y":1992,"wires":[["4b7d6ee5456a37de"],["af51d654dfd923bc"]]},{"id":"af51d654dfd923bc","type":"debug","z":"0cca5f120542a932","g":"d0e1bff62bd0d786","name":"Payload Value","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1448,"y":2016,"wires":[]},{"id":"4b7d6ee5456a37de","type":"debug","z":"0cca5f120542a932","g":"d0e1bff62bd0d786","name":"Payload Value","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1448,"y":1968,"wires":[]},{"id":"85b733ca0a5966e6","type":"function","z":"0cca5f120542a932","name":"Variable Values","func":"\nvar override = flow.get('nr_kids_toilet_motion_override');\nvar motion = flow.get('nr_kids_toilet_motion_triggered');\n\n//var nowTime = new Date().toLocaleTimeString(); // = HH:MM:SS AM/PM\nvar nowTime = ((\"0\" + new Date().getHours()).slice(-2) + \":\" + (\"0\" + new Date().getMinutes()).slice(-2) + \":\" + (\"0\" + new Date().getSeconds()).slice(-2));\n\n\nvar msg_motion = {\n    payload: nowTime + \" Motion Triggered: \" + flow.get('nr_kids_toilet_motion_triggered')\n}\n\nvar msg_override = {\n    payload: nowTime + \" Motion Override: \" + flow.get('nr_kids_toilet_motion_triggered')\n}\n\nreturn [msg_motion, msg_override];\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1752,"y":1992,"wires":[["e755284becba3bf7"],["f1b26df1ce438904"]]},{"id":"f1b26df1ce438904","type":"debug","z":"0cca5f120542a932","name":"Payload Value","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1932,"y":2016,"wires":[]},{"id":"e755284becba3bf7","type":"debug","z":"0cca5f120542a932","name":"Payload Value","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1932,"y":1968,"wires":[]},{"id":"1fd08be2b2b12dcc","type":"debug","z":"0cca5f120542a932","g":"ab9771b8ef2a4dfd","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":586,"y":2616,"wires":[]},{"id":"d7d2511a929fceb3","type":"inject","z":"0cca5f120542a932","g":"d0e1bff62bd0d786","name":"Trigger","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"1","payloadType":"str","x":582,"y":1932,"wires":[["5d7bd26ba654df20"]]},{"id":"f42f5e7d46c775ba","type":"api-current-state","z":"97bc4677a5be4b40","g":"7feed53e81537952","name":"If Guest Bool Off","server":"ebb6b83c7588d734","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.home_guest","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1780,"y":60,"wires":[["9aa7061b3182929d"],[]]},{"id":"fb61aae79da0fa0e","type":"api-current-state","z":"97bc4677a5be4b40","g":"7feed53e81537952","name":"If Jenna Select Away","server":"ebb6b83c7588d734","version":3,"outputs":2,"halt_if":"Away","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_select.home_jenna","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1264,"y":60,"wires":[["93b7de0661ac4447"],[]]},{"id":"c0f3db8d3fab4314","type":"server-state-changed","z":"97bc4677a5be4b40","g":"7feed53e81537952","name":"Guest Present - Input Bool Off","server":"ebb6b83c7588d734","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.home_guest","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":924,"y":252,"wires":[["11731f87fa7f1359"],[]]},{"id":"9f97dd799991781b","type":"server-state-changed","z":"97bc4677a5be4b40","g":"7feed53e81537952","name":"Ryan Present - Input Select Away","server":"ebb6b83c7588d734","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_select.home_ryan","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"Away","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":926,"y":60,"wires":[["fb61aae79da0fa0e"],[]]},{"id":"9aa7061b3182929d","type":"api-call-service","z":"97bc4677a5be4b40","g":"7feed53e81537952","name":"Set Home Empty","server":"ebb6b83c7588d734","version":5,"debugenabled":false,"domain":"input_select","service":"select_option","areaId":[],"deviceId":[],"entityId":["input_select.home_occupied"],"data":"{\"option\":\"No\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":2010,"y":108,"wires":[[]]},{"id":"daa57661a17b12e1","type":"api-call-service","z":"97bc4677a5be4b40","g":"c628a669137868c5","name":"Set Home Occupied (Input Select)","server":"ebb6b83c7588d734","version":5,"debugenabled":false,"domain":"input_select","service":"select_option","areaId":[],"deviceId":[],"entityId":["input_select.home_occupied"],"data":"{\"option\":\"Yes\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":580,"y":120,"wires":[[]]},{"id":"114ed36babc5e145","type":"server-state-changed","z":"97bc4677a5be4b40","g":"c628a669137868c5","name":"Guest Present - Input Bool On","server":"ebb6b83c7588d734","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.home_guest","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":172,"y":208,"wires":[["daa57661a17b12e1"],[]]},{"id":"5fea69f0db83da42","type":"server-state-changed","z":"97bc4677a5be4b40","g":"c628a669137868c5","name":"Jenna Present - Input Select Home","server":"ebb6b83c7588d734","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_select.home_jenna","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"Home","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":192,"y":108,"wires":[["daa57661a17b12e1"],[]]},{"id":"a4a51a54765aa03b","type":"server-state-changed","z":"97bc4677a5be4b40","g":"c628a669137868c5","name":"Ryan Present - Input Select Home","server":"ebb6b83c7588d734","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_select.home_ryan","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"Home","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":192,"y":60,"wires":[["daa57661a17b12e1"],[]]},{"id":"755f3ea31e793f87","type":"server-state-changed","z":"97bc4677a5be4b40","g":"c628a669137868c5","name":"James Present - Input Select Home","server":"ebb6b83c7588d734","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_select.home_james","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"Home","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":192,"y":156,"wires":[["daa57661a17b12e1"],[]]},{"id":"7299188e89b2c51f","type":"api-current-state","z":"97bc4677a5be4b40","g":"7feed53e81537952","name":"If Ryan Select Away","server":"ebb6b83c7588d734","version":3,"outputs":2,"halt_if":"Away","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_select.home_ryan","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1276,"y":144,"wires":[["4030816957319569"],[]]},{"id":"93b7de0661ac4447","type":"api-current-state","z":"97bc4677a5be4b40","g":"7feed53e81537952","name":"If James Select Away","server":"ebb6b83c7588d734","version":3,"outputs":2,"halt_if":"Away","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_select.home_james","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1540,"y":60,"wires":[["f42f5e7d46c775ba"],[]]},{"id":"4030816957319569","type":"api-current-state","z":"97bc4677a5be4b40","g":"7feed53e81537952","name":"If James Select Away","server":"ebb6b83c7588d734","version":3,"outputs":2,"halt_if":"Away","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_select.home_james","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1544,"y":108,"wires":[["0ba97afe46c12955"],[]]},{"id":"0ba97afe46c12955","type":"api-current-state","z":"97bc4677a5be4b40","g":"7feed53e81537952","name":"If Guest Bool Off","server":"ebb6b83c7588d734","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.home_guest","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1768,"y":120,"wires":[["9aa7061b3182929d"],[]]},{"id":"e06ceecb0109a8a1","type":"api-current-state","z":"97bc4677a5be4b40","g":"7feed53e81537952","name":"If Ryan Select Away","server":"ebb6b83c7588d734","version":3,"outputs":2,"halt_if":"Away","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_select.home_ryan","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1268,"y":192,"wires":[["67db55d749f148ef"],[]]},{"id":"67db55d749f148ef","type":"api-current-state","z":"97bc4677a5be4b40","g":"7feed53e81537952","name":"If Jenna Select Away","server":"ebb6b83c7588d734","version":3,"outputs":2,"halt_if":"Away","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_select.home_jenna","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1496,"y":192,"wires":[["cb858ec114d54438"],[]]},{"id":"cb858ec114d54438","type":"api-current-state","z":"97bc4677a5be4b40","g":"7feed53e81537952","name":"If Guest Bool Off","server":"ebb6b83c7588d734","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.home_guest","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1768,"y":192,"wires":[["9aa7061b3182929d"],[]]},{"id":"a0a7d67e5f500a6c","type":"api-current-state","z":"97bc4677a5be4b40","g":"7feed53e81537952","name":"If Jenna Select Away","server":"ebb6b83c7588d734","version":3,"outputs":2,"halt_if":"Away","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_select.home_jenna","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1532,"y":252,"wires":[["4cc4048d3234e985"],[]]},{"id":"11731f87fa7f1359","type":"api-current-state","z":"97bc4677a5be4b40","g":"7feed53e81537952","name":"If Ryan Select Away","server":"ebb6b83c7588d734","version":3,"outputs":2,"halt_if":"Away","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_select.home_ryan","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1268,"y":252,"wires":[["a0a7d67e5f500a6c"],[]]},{"id":"4cc4048d3234e985","type":"api-current-state","z":"97bc4677a5be4b40","g":"7feed53e81537952","name":"If James Select Away","server":"ebb6b83c7588d734","version":3,"outputs":2,"halt_if":"Away","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_select.home_james","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1772,"y":252,"wires":[["9aa7061b3182929d"],[]]},{"id":"7f1bd0b568a2ded6","type":"server-state-changed","z":"97bc4677a5be4b40","g":"7feed53e81537952","name":"Jenna Present - Input Select Home","server":"ebb6b83c7588d734","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_select.home_jenna","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"Away","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":928,"y":144,"wires":[["7299188e89b2c51f"],[]]},{"id":"71c683d702462ed4","type":"server-state-changed","z":"97bc4677a5be4b40","g":"7feed53e81537952","name":"James Present - Input Select Home","server":"ebb6b83c7588d734","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_select.home_james","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"Away","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":928,"y":192,"wires":[["e06ceecb0109a8a1"],[]]},{"id":"6dfc35edafecc11c","type":"server-state-changed","z":"97bc4677a5be4b40","d":true,"name":"Ryan Home/Away - Bayesian","server":"ebb6b83c7588d734","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.ryan_home_bayesian","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":228,"y":3972,"wires":[["722d5a761d662d55","c59ed23a1494a859"],["722d5a761d662d55","685a92d32a8d63fe","f3f2e609fad95226"]]},{"id":"a752834f929ccbfb","type":"server-state-changed","z":"97bc4677a5be4b40","d":true,"name":"Ryan Home/Away - Person","server":"ebb6b83c7588d734","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"person.ryan","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"home","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":218,"y":4152,"wires":[["49718850f5597d20","c59ed23a1494a859"],["49718850f5597d20","654f07f831dd4751","f1736f2840fb79b1"]]},{"id":"daf9cecbe13b36ad","type":"api-call-service","z":"97bc4677a5be4b40","d":true,"name":"Set Ryan Away (Input Select)","server":"ebb6b83c7588d734","version":5,"debugenabled":false,"domain":"input_select","service":"select_option","areaId":[],"deviceId":[],"entityId":["input_select.home_ryan"],"data":"{\"option\":\"Away\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":948,"y":4056,"wires":[[]]},{"id":"685a92d32a8d63fe","type":"api-current-state","z":"97bc4677a5be4b40","d":true,"name":"If Person Home/Away","server":"ebb6b83c7588d734","version":3,"outputs":2,"halt_if":"home","halt_if_type":"str","halt_if_compare":"is","entity_id":"person.ryan","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":568,"y":3972,"wires":[[],["daf9cecbe13b36ad"]]},{"id":"654f07f831dd4751","type":"api-current-state","z":"97bc4677a5be4b40","d":true,"name":"If Bayesian Home/Away","server":"ebb6b83c7588d734","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.ryan_home_bayesian","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":578,"y":4152,"wires":[[],["daf9cecbe13b36ad"]]},{"id":"f1736f2840fb79b1","type":"function","z":"97bc4677a5be4b40","d":true,"name":"Set Notification Message","func":"var message=\"Ryan Left Home - Person\";\nglobal.set('notification_msg',message);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":578,"y":4200,"wires":[["6cd5e6cf82fb7a86"]]},{"id":"6cd5e6cf82fb7a86","type":"link out","z":"97bc4677a5be4b40","d":true,"name":"Front Door Motion","links":["4e0fb3de.b1482c"],"x":771,"y":4200,"wires":[]},{"id":"f3f2e609fad95226","type":"function","z":"97bc4677a5be4b40","d":true,"name":"Set Notification Message","func":"var message=\"Ryan Left Home - Bayesian\";\nglobal.set('notification_msg',message);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":578,"y":3924,"wires":[["08066f334d4ab20c"]]},{"id":"08066f334d4ab20c","type":"link out","z":"97bc4677a5be4b40","d":true,"name":"Front Door Motion","links":["4e0fb3de.b1482c"],"x":771,"y":3924,"wires":[]},{"id":"c59ed23a1494a859","type":"api-call-service","z":"97bc4677a5be4b40","d":true,"name":"Set Ryan Home (Input Select)","server":"ebb6b83c7588d734","version":5,"debugenabled":false,"domain":"input_select","service":"select_option","areaId":[],"deviceId":[],"entityId":["input_select.home_ryan"],"data":"{\"option\":\"Home\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":598,"y":4056,"wires":[[]]},{"id":"722d5a761d662d55","type":"debug","z":"97bc4677a5be4b40","d":true,"name":"debug 2","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":300,"y":3912,"wires":[]},{"id":"49718850f5597d20","type":"debug","z":"97bc4677a5be4b40","d":true,"name":"debug 3","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":300,"y":4212,"wires":[]},{"id":"511d8137a1e7b0df","type":"server-state-changed","z":"97bc4677a5be4b40","d":true,"name":"Jenna Home/Away - Bayesian","server":"ebb6b83c7588d734","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.jenna_home_bayesian","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":228,"y":4416,"wires":[["bec0f09c7e409d7c","562f4a4464cd9759"],["bec0f09c7e409d7c","e30657ab23da8d14","f1c00f1bb279a7d3"]]},{"id":"ef842b8474bc9c9a","type":"server-state-changed","z":"97bc4677a5be4b40","d":true,"name":"Jenna Home/Away - Person","server":"ebb6b83c7588d734","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"person.jenna","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"home","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":228,"y":4596,"wires":[["ca3d9e72ce871a76","562f4a4464cd9759"],["ca3d9e72ce871a76","fa908acf9a238007","9a9150029f1baa97"]]},{"id":"801a4c2c6afb090b","type":"api-call-service","z":"97bc4677a5be4b40","d":true,"name":"Set Jenna Away (Input Select)","server":"ebb6b83c7588d734","version":5,"debugenabled":false,"domain":"input_select","service":"select_option","areaId":[],"deviceId":[],"entityId":["input_select.home_jenna"],"data":"{\"option\":\"Away\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":958,"y":4500,"wires":[[]]},{"id":"e30657ab23da8d14","type":"api-current-state","z":"97bc4677a5be4b40","d":true,"name":"If Person Home/Away","server":"ebb6b83c7588d734","version":3,"outputs":2,"halt_if":"home","halt_if_type":"str","halt_if_compare":"is","entity_id":"person.jenna","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":568,"y":4416,"wires":[[],["801a4c2c6afb090b"]]},{"id":"fa908acf9a238007","type":"api-current-state","z":"97bc4677a5be4b40","d":true,"name":"If Bayesian Home/Away","server":"ebb6b83c7588d734","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.jenna_home_bayesian","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":578,"y":4596,"wires":[[],["801a4c2c6afb090b"]]},{"id":"9a9150029f1baa97","type":"function","z":"97bc4677a5be4b40","d":true,"name":"Set Notification Message","func":"var message =\"Jenna  Left Home - Person\";\nglobal.set('notification_msg',message);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":578,"y":4644,"wires":[["2461ea03aebb8824"]]},{"id":"2461ea03aebb8824","type":"link out","z":"97bc4677a5be4b40","d":true,"name":"Front Door Motion","links":["4e0fb3de.b1482c"],"x":771,"y":4644,"wires":[]},{"id":"f1c00f1bb279a7d3","type":"function","z":"97bc4677a5be4b40","d":true,"name":"Set Notification Message","func":"var message =\"Jenna  Left Home - Bayesian\";\nglobal.set('notification_msg',message);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":578,"y":4368,"wires":[["f42fd28b932916c1"]]},{"id":"f42fd28b932916c1","type":"link out","z":"97bc4677a5be4b40","d":true,"name":"Front Door Motion","links":["4e0fb3de.b1482c"],"x":771,"y":4368,"wires":[]},{"id":"562f4a4464cd9759","type":"api-call-service","z":"97bc4677a5be4b40","d":true,"name":"Set Ryan Home (Input Select)","server":"ebb6b83c7588d734","version":5,"debugenabled":false,"domain":"input_select","service":"select_option","areaId":[],"deviceId":[],"entityId":["input_select.home_jenna"],"data":"{\"option\":\"Home\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":598,"y":4500,"wires":[[]]},{"id":"bec0f09c7e409d7c","type":"debug","z":"97bc4677a5be4b40","d":true,"name":"debug 6","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":300,"y":4356,"wires":[]},{"id":"ca3d9e72ce871a76","type":"debug","z":"97bc4677a5be4b40","d":true,"name":"debug 7","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":300,"y":4656,"wires":[]},{"id":"068c1f9af0246cdb","type":"switch","z":"97bc4677a5be4b40","g":"1f56a445b8709216","name":"Bayes Home/Away?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1096,"y":516,"wires":[["90bd348f211d20ce"],["7ec72b75a63bba40"]]},{"id":"90bd348f211d20ce","type":"api-call-service","z":"97bc4677a5be4b40","g":"1f56a445b8709216","name":"Set Input Select = Home","server":"ebb6b83c7588d734","version":5,"debugenabled":false,"domain":"input_select","service":"select_option","areaId":[],"deviceId":[],"entityId":["{{flow.occupancy_select}}"],"data":"{\"option\":\"Home\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1630,"y":432,"wires":[["a27bfcc13d0d4009","ed4fe02ba92d4d7f"]]},{"id":"18bc8488babae791","type":"api-call-service","z":"97bc4677a5be4b40","g":"1f56a445b8709216","name":"Set Input Select = Away","server":"ebb6b83c7588d734","version":5,"debugenabled":false,"domain":"input_select","service":"select_option","areaId":[],"deviceId":[],"entityId":["{{flow.occupancy_select}}"],"data":"{\"option\":\"Away\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1630,"y":480,"wires":[["a27bfcc13d0d4009","376eeea9b9cced1d","70675dbacde30ea8"]]},{"id":"70675dbacde30ea8","type":"function","z":"97bc4677a5be4b40","g":"1f56a445b8709216","name":"Set Notification Message","func":"if (flow.get('occupancy_name') !== undefined) {\n    var message = flow.get('occupancy_name') + \" Left Home\";\n    global.set('notification_msg',message);\n    return msg;\n}\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1942,"y":480,"wires":[["ece9fb0d40c2b0bc"]]},{"id":"ece9fb0d40c2b0bc","type":"link out","z":"97bc4677a5be4b40","g":"1f56a445b8709216","name":"Front Door Motion","links":["4e0fb3de.b1482c"],"x":2091,"y":480,"wires":[]},{"id":"4f399d9bd6edc8a7","type":"switch","z":"97bc4677a5be4b40","g":"1f56a445b8709216","name":"Person or Bayes Input?","property":"topic","propertyType":"msg","rules":[{"t":"cont","v":"person","vt":"str"},{"t":"cont","v":"binary_sensor","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":862,"y":456,"wires":[["8565866f0bbf2526"],["068c1f9af0246cdb"]]},{"id":"8565866f0bbf2526","type":"switch","z":"97bc4677a5be4b40","g":"1f56a445b8709216","name":"Person Home/Away?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"home","vt":"str"},{"t":"eq","v":"not_home","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1096,"y":396,"wires":[["3c895f7bc113caf3"],["18bc8488babae791"]]},{"id":"2564f627c7144075","type":"comment","z":"97bc4677a5be4b40","g":"1f56a445b8709216","name":"Notes","info":"Uses person or bayesian wildcard change nodes to trigger.\n\nThe flow will check which person the event is aligned to and set\nrelevant variables to identify the corresponding HA entities to\nquery/update.\n\nA second layer of checks can be enabled by adding in a check\nfor the relevant bayes/person entity so that both person AND\nbayes have to be home/away before input_select is updated.\n- Enabled addditional checks as too many false positives on\nshort distance travel e.g. church","x":102,"y":348,"wires":[]},{"id":"821c58de1b38e2b8","type":"ha-entity","z":"97bc4677a5be4b40","d":true,"g":"941c8667b42ee67b","name":"Proximity - Home - Jenna - Set Alert On/Off","server":"3b49c004.6176a","version":2,"debugenabled":false,"outputs":1,"entityType":"binary_sensor","config":[{"property":"name","value":"proximity_home_jenna_alert_triggered"},{"property":"device_class","value":""},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"payload","stateType":"msg","attributes":[{"property":"distance","value":"payload.data.distance","valueType":"msg"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":1910,"y":3504,"wires":[[]]},{"id":"64b56c35bb87ca93","type":"function","z":"97bc4677a5be4b40","d":true,"g":"894f21cb4a05c11c","name":"Query Distances","func":"node.warn(\"proximity_jenna_home_dist_edge=\" + global.get('proximity_jenna_home_dist_edge') );\nnode.warn(\"proximity_jenna_home_dist_new=\" + global.get('proximity_jenna_home_dist_new') );\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1986,"y":3780,"wires":[[]]},{"id":"21dba3ee06c9d07a","type":"inject","z":"97bc4677a5be4b40","d":true,"g":"894f21cb4a05c11c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1992,"y":3744,"wires":[["64b56c35bb87ca93"]]},{"id":"d3e53d38d996037d","type":"trigger-state","z":"97bc4677a5be4b40","d":true,"g":"13d5806d2b20f7a7","name":"Trigger State - Proximity Jenna to Home - If Moving Away > 750m","server":"3b49c004.6176a","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"proximity.home_jenna","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":">","comparatorValueDatatype":"num","comparatorValue":"750"},{"targetType":"this_entity","targetValue":"","propertyType":"property","propertyValue":"new_state.attributes.dir_of_travel","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"away_from"}],"inputs":1,"outputs":2,"customoutputs":[],"outputinitially":true,"state_type":"str","enableInput":true,"x":528,"y":3360,"wires":[["71b4a531d881efc5","01f48a084ec3afca"],[]]},{"id":"71b4a531d881efc5","type":"debug","z":"97bc4677a5be4b40","d":true,"g":"13d5806d2b20f7a7","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":698,"y":3336,"wires":[]},{"id":"01f48a084ec3afca","type":"function","z":"97bc4677a5be4b40","d":true,"g":"13d5806d2b20f7a7","name":"Save distance variable (proximity_jenna_home_dist_edge)","func":"// Set jenna_towards_dist variable to distance away\nglobal.set('proximity_jenna_home_dist_edge',msg.payload);\n\n// Setup payload to change state of input bool entity being \n// created by NR\n\nmsg.payload = {\n    \"state\":\"on\",\n    \"data\": {\n        \"distance\":msg.payload\n    }\n};\ndelete msg.data;\n\n\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1074,"y":3360,"wires":[["d4c8ed940cb96649","821c58de1b38e2b8"]],"info":"Set up a Poll State node with debug reading msg.data and make changes you want in HA.\nPoll State of entity to see details of entity settings\nCopy json paths and values from debug and copy into this function as the msg.payload.\n\nOr do the same with a Trigger State node which will show the old and new values when you update the entity in HA."},{"id":"d4c8ed940cb96649","type":"debug","z":"97bc4677a5be4b40","d":true,"g":"13d5806d2b20f7a7","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1226,"y":3336,"wires":[]},{"id":"8010c1803782028d","type":"inject","z":"97bc4677a5be4b40","d":true,"g":"13d5806d2b20f7a7","name":"Set old/new state = Stat (10) -> Away From (800)","props":[{"p":"entity","v":"proximity.home_jenna","vt":"str"},{"p":"old_dist","v":"10","vt":"str"},{"p":"old_dir","v":"stationary","vt":"str"},{"p":"new_dist","v":"800","vt":"str"},{"p":"new_dir","v":"away_from","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":312,"y":3252,"wires":[["6381e444ac5d0caa"]]},{"id":"6381e444ac5d0caa","type":"function","z":"97bc4677a5be4b40","d":true,"g":"13d5806d2b20f7a7","name":"Test - Change State","func":"msg.payload={\n  \"entity_id\": msg.entity,\n  \"old_state\": {\n        \"state\": msg.old_dist,\n        \"attributes\": {\n          \"dir_of_travel\": msg.old_dir\n        },\n  },\n  \"new_state\": {\n        \"state\": msg.new_dist,\n        \"attributes\": {\n          \"dir_of_travel\": msg.new_dir\n        },\n  }\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":402,"y":3288,"wires":[["d3e53d38d996037d"]]},{"id":"16498e681d3a91d2","type":"trigger-state","z":"97bc4677a5be4b40","d":true,"g":"125661a029168d57","name":"Trigger State - Proximity Jenna to Home - If Moving Towards","server":"3b49c004.6176a","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"proximity.home_jenna","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"property","propertyValue":"new_state.attributes.dir_of_travel","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"towards"}],"inputs":1,"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","enableInput":true,"x":448,"y":3492,"wires":[["3b927de2544723db","d6693d6411c03d4b"],[]]},{"id":"e16ce8d1baf77dbd","type":"api-current-state","z":"97bc4677a5be4b40","d":true,"g":"125661a029168d57","name":"Check if Jenna marked Far Away","server":"3b49c004.6176a","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.proximity_home_jenna_alert_triggered","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":920,"y":3492,"wires":[["ebcf07ef85f8a347","e5a74dc60c9b9966"],[]]},{"id":"ebcf07ef85f8a347","type":"debug","z":"97bc4677a5be4b40","d":true,"g":"125661a029168d57","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":986,"y":3468,"wires":[]},{"id":"f3ceb449e8357efd","type":"function","z":"97bc4677a5be4b40","d":true,"g":"125661a029168d57","name":"Test - Change State","func":"msg.payload={\n  \"entity_id\": msg.entity,\n  \"old_state\": {\n        \"state\": msg.old_dist,\n        \"attributes\": {\n          \"dir_of_travel\": msg.old_dir\n        },\n  },\n  \"new_state\": {\n        \"state\": msg.new_dist,\n        \"attributes\": {\n          \"dir_of_travel\": msg.new_dir\n        },\n  }\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":210,"y":3636,"wires":[["16498e681d3a91d2"]]},{"id":"3fd0c14ecbe8e72f","type":"inject","z":"97bc4677a5be4b40","d":true,"g":"125661a029168d57","name":"Set old/new state = Away From (1200) -> Towards (900)","props":[{"p":"entity","v":"proximity.home_jenna","vt":"str"},{"p":"old_dist","v":"1200","vt":"str"},{"p":"old_dir","v":"away_from","vt":"str"},{"p":"new_dist","v":"900","vt":"str"},{"p":"new_dir","v":"towards","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":332,"y":3672,"wires":[["f3ceb449e8357efd"]]},{"id":"3b927de2544723db","type":"function","z":"97bc4677a5be4b40","d":true,"g":"125661a029168d57","name":"Save/Update distance variables","func":"// If heading towards home but dist away is further than\n// previous distance then update distance variable.\n\n\nglobal.set('proximity_jenna_home_dist_new', msg.payload);\n\ndistance_new=msg.payload;\ndistance_edge=global.get('proximity_jenna_home_dist_edge');\n\nif ( parseFloat(distance_new) > parseFloat(distance_edge) ) {\n    global.set('proximity_jenna_home_dist_edge', msg.payload);\n} \n\ndelete msg.data;\n\nreturn msg;\n","outputs":1,"noerr":4,"initialize":"","finalize":"","libs":[],"x":706,"y":3552,"wires":[["e16ce8d1baf77dbd"]]},{"id":"e5a74dc60c9b9966","type":"function","z":"97bc4677a5be4b40","d":true,"g":"125661a029168d57","name":"Send Notification and Set Alert Entity to off?","func":"// Send notifications if: \n// 1. Long distances: \n    // Distance_edge has reached more than distance_far\n        // if dist_new has dropped 33% from dist_edge\n// 2. short distances (if dist_edge < dist_far):\n        // if dist_new has dropped 50% from dist_edge\n\ndistance_far=2000;\ndistance_edge=global.get('proximity_jenna_home_dist_edge');\ndistance_new=global.get('proximity_jenna_home_dist_new');\n\nif ( parseFloat(distance_edge) > distance_far ) {\n   if ( ( parseFloat(distance_new) / parseFloat(distance_edge) ) < 0.33 ) {\n       msg.payload = {\n           \"state\":\"off\",\n           \"data\": {\n               \"distance\":distance_new,\n               \"send_msg\":\"yes\"\n               \n           }\n        };\n        return msg;\n   }  \n} else {\n    if ( ( parseFloat(distance_new) / parseFloat(distance_edge) ) < 0.5 ) {\n       msg.payload = {\n           \"state\":\"off\",\n           \"data\": {\n               \"distance\":distance_new,\n               \"send_msg\":\"yes\"\n               \n           }\n           \n       };\n       return msg;\n    }\n}\n\n\n","outputs":1,"noerr":11,"initialize":"","finalize":"","libs":[],"x":1190,"y":3552,"wires":[["fc8581d42e22c82a","8707f9ed82c05c29","821c58de1b38e2b8"]]},{"id":"75eba99ab9a30ecc","type":"inject","z":"97bc4677a5be4b40","d":true,"g":"125661a029168d57","name":"Set old/new state = Towards (900) -> Towards (1600)","props":[{"p":"entity","v":"proximity.home_jenna","vt":"str"},{"p":"old_dist","v":"900","vt":"str"},{"p":"old_dir","v":"towards","vt":"str"},{"p":"new_dist","v":"1600","vt":"str"},{"p":"new_dir","v":"towards","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":322,"y":3708,"wires":[["f3ceb449e8357efd"]]},{"id":"95da1032eec6dd00","type":"inject","z":"97bc4677a5be4b40","d":true,"g":"125661a029168d57","name":"Set old/new state = Towards (1600) -> Towards (1400)","props":[{"p":"entity","v":"proximity.home_jenna","vt":"str"},{"p":"old_dist","v":"1600","vt":"str"},{"p":"old_dir","v":"towards","vt":"str"},{"p":"new_dist","v":"1400","vt":"str"},{"p":"new_dir","v":"towards","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":332,"y":3744,"wires":[["f3ceb449e8357efd"]]},{"id":"8e65fed3de6acd47","type":"inject","z":"97bc4677a5be4b40","d":true,"g":"125661a029168d57","name":"Set old/new state = Towards (1400) -> Towards (790)","props":[{"p":"entity","v":"proximity.home_jenna","vt":"str"},{"p":"old_dist","v":"1400","vt":"str"},{"p":"old_dir","v":"towards","vt":"str"},{"p":"new_dist","v":"790","vt":"str"},{"p":"new_dir","v":"towards","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":322,"y":3780,"wires":[["f3ceb449e8357efd"]]},{"id":"d6693d6411c03d4b","type":"debug","z":"97bc4677a5be4b40","d":true,"g":"125661a029168d57","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":590,"y":3468,"wires":[]},{"id":"fc8581d42e22c82a","type":"debug","z":"97bc4677a5be4b40","d":true,"g":"125661a029168d57","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1286,"y":3528,"wires":[]},{"id":"95b1f4f68a1e9dfa","type":"inject","z":"97bc4677a5be4b40","d":true,"g":"125661a029168d57","name":"Set old/new state = Away From (800) -> Towards (4000)","props":[{"p":"entity","v":"proximity.home_jenna","vt":"str"},{"p":"old_dist","v":"800","vt":"str"},{"p":"old_dir","v":"away_from","vt":"str"},{"p":"new_dist","v":"4000","vt":"str"},{"p":"new_dir","v":"towards","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":776,"y":3672,"wires":[["f3ceb449e8357efd"]]},{"id":"9ac5a356cb827bc0","type":"inject","z":"97bc4677a5be4b40","d":true,"g":"125661a029168d57","name":"Set old/new state = Towards (4000) -> Towards (3500)","props":[{"p":"entity","v":"proximity.home_jenna","vt":"str"},{"p":"old_dist","v":"4000","vt":"str"},{"p":"old_dir","v":"towards","vt":"str"},{"p":"new_dist","v":"3500","vt":"str"},{"p":"new_dir","v":"towards","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":776,"y":3708,"wires":[["f3ceb449e8357efd"]]},{"id":"e181281bf05de679","type":"inject","z":"97bc4677a5be4b40","d":true,"g":"125661a029168d57","name":"Set old/new state = Towards (3500) -> Towards (1900)","props":[{"p":"entity","v":"proximity.home_jenna","vt":"str"},{"p":"old_dist","v":"3500","vt":"str"},{"p":"old_dir","v":"towards","vt":"str"},{"p":"new_dist","v":"1900","vt":"str"},{"p":"new_dir","v":"towards","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":776,"y":3744,"wires":[["f3ceb449e8357efd"]]},{"id":"8707f9ed82c05c29","type":"function","z":"97bc4677a5be4b40","d":true,"g":"125661a029168d57","name":"Set Notification Content","func":"//Only send alert if dist_new proximity > 50m\n// disable false positive alerts!\n\ndistance_new=msg.payload.data.distance;\n\nif ( parseFloat(distance_new) > 50 ) {\n    \n    message=\"Jenna heading home: \" + msg.payload.data.distance + \"m\";\n    global.set('notification_msg',message);\n\n    sound=\"bike\";\n    global.set('notification_sound',sound);\n\n    device=\"OnePlus8T\";\n    global.set('notification_device',device);\n\n    return msg;\n}\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1394,"y":3636,"wires":[["3982544b5ec84c8a","eaa1e5db9f925d7c"]]},{"id":"3982544b5ec84c8a","type":"link out","z":"97bc4677a5be4b40","d":true,"g":"125661a029168d57","name":"Test - Pushover","links":["4e0fb3de.b1482c"],"x":1611,"y":3636,"wires":[]},{"id":"eaa1e5db9f925d7c","type":"debug","z":"97bc4677a5be4b40","d":true,"g":"125661a029168d57","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1442,"y":3600,"wires":[]},{"id":"2d26965165caa13d","type":"server-state-changed","z":"97bc4677a5be4b40","d":true,"g":"ec17b211cfef25b5","name":"Proximity Alerting - Manual Trigger - Jenna","server":"3b49c004.6176a","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.proximity_home_jenna_alert_triggered_manual","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":1540,"y":3252,"wires":[["eb4b92895e0f26aa"],["1460b4bd530e017b"]]},{"id":"1460b4bd530e017b","type":"api-current-state","z":"97bc4677a5be4b40","d":true,"g":"ec17b211cfef25b5","name":"Get Current Distance","server":"3b49c004.6176a","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"proximity.home_jenna","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1636,"y":3300,"wires":[["5b10d4faa6fbec6e"]]},{"id":"5b10d4faa6fbec6e","type":"function","z":"97bc4677a5be4b40","d":true,"g":"ec17b211cfef25b5","name":"Set msg to Alert Off and with Distance","func":"msg.payload = {\n   \"state\":\"off\",\n   \"data\": {\n       \"distance\":msg.payload,\n       }\n    };\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1590,"y":3348,"wires":[["821c58de1b38e2b8"]]},{"id":"6def5187a43b33b4","type":"function","z":"97bc4677a5be4b40","d":true,"g":"ec17b211cfef25b5","name":"Set msg to Alert On and with Distance","func":"msg.payload = {\n   \"state\":\"on\",\n   \"data\": {\n       \"distance\":msg.payload,\n       }\n    };\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1926,"y":3348,"wires":[["821c58de1b38e2b8"]]},{"id":"eb4b92895e0f26aa","type":"api-current-state","z":"97bc4677a5be4b40","d":true,"g":"ec17b211cfef25b5","name":"Get Current Distance","server":"3b49c004.6176a","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"proximity.home_jenna","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1972,"y":3300,"wires":[["6def5187a43b33b4"]]},{"id":"e33760e4e7d3dd53","type":"server-state-changed","z":"97bc4677a5be4b40","g":"5c4bc67a61a0c623","name":"Distance Before Alert Enabled?","server":"ebb6b83c7588d734","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_number.nr_proximity_alert_enabled_distance","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":194,"y":636,"wires":[["b8995515a408d9bd"]]},{"id":"b8995515a408d9bd","type":"change","z":"97bc4677a5be4b40","g":"5c4bc67a61a0c623","name":"Set Variable","rules":[{"t":"set","p":"nr_proximity_alert_enabled_distance","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":446,"y":636,"wires":[[]]},{"id":"d823751aefea7171","type":"trigger-state","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"Proximity Changed (Wildcard)","server":"ebb6b83c7588d734","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"proximity.","entityidfiltertype":"substring","debugenabled":false,"constraints":[],"inputs":0,"outputs":2,"customoutputs":[],"outputinitially":true,"state_type":"str","enableInput":false,"x":180,"y":1056,"wires":[["c9f48f1f2325a8ca"],["c9f48f1f2325a8ca"]]},{"id":"f92a0f4bd017ea08","type":"change","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"Set Jenna Vars","rules":[{"t":"set","p":"occupancy_name","pt":"flow","to":"Jenna","tot":"str"},{"t":"set","p":"occupancy_person","pt":"flow","to":"person.jenna","tot":"str"},{"t":"set","p":"occupancy_bayes","pt":"flow","to":"binary_sensor.jenna_home_bayesian","tot":"str"},{"t":"set","p":"occupancy_select","pt":"flow","to":"input_select.home_jenna","tot":"str"},{"t":"set","p":"nr_proxomity_alert_manual_toggle","pt":"flow","to":"input_boolean.nr_proxomity_alert_manual_toggle_jenna","tot":"str"},{"t":"set","p":"nr_proximity_alert_enabled","pt":"flow","to":"counter.nr_proximity_alert_enabled_jenna","tot":"str"},{"t":"set","p":"nr_proximity_max_trip_distance","pt":"flow","to":"counter.nr_proximity_max_trip_distance_jenna","tot":"str"},{"t":"set","p":"nr_proximity_alert_enabled_yet_for_trip","pt":"flow","to":"counter.nr_proximity_alert_enabled_yet_for_trip_jenna","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":448,"y":1188,"wires":[["82d3d8d2c019d36c"]]},{"id":"726812d2ad1ff7bf","type":"function","z":"97bc4677a5be4b40","g":"5c4bc67a61a0c623","name":"Output Global Variable Values","func":"node.warn(\"nr_proximity_alert_enabled_distance = \" + global.get('nr_proximity_alert_enabled_distance'));\nnode.warn(\"nr_proximity_long_trip_distance = \" + global.get('nr_proximity_long_trip_distance'));\nnode.warn(\"nr_proximity_alert_send_return_perc_short = \" + global.get('nr_proximity_alert_send_return_perc_short'));\nnode.warn(\"nr_proximity_alert_send_return_perc_long = \" + global.get('nr_proximity_alert_send_return_perc_long'));\nnode.warn(\"prox_alert_trip_triggered = \" + global.get('prox_alert_trip_triggered'));\n\nnode.warn(\"proximity_test_person = \" + global.get('proximity_test_person'));\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":446,"y":876,"wires":[[]]},{"id":"1ca4b0188821d00b","type":"inject","z":"97bc4677a5be4b40","g":"5c4bc67a61a0c623","name":"Trigger","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"1","payloadType":"str","x":134,"y":876,"wires":[["726812d2ad1ff7bf"]]},{"id":"b144baadecbf43af","type":"server-state-changed","z":"97bc4677a5be4b40","g":"5c4bc67a61a0c623","name":"'Long' Trip Begins At?","server":"ebb6b83c7588d734","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_number.nr_proximity_long_trip_distance","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":164,"y":696,"wires":[["8116b0bb278ebeed"]]},{"id":"8116b0bb278ebeed","type":"change","z":"97bc4677a5be4b40","g":"5c4bc67a61a0c623","name":"Set Variable","rules":[{"t":"set","p":"nr_proximity_long_trip_distance","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":446,"y":696,"wires":[[]]},{"id":"99345e74e93a9a4b","type":"server-state-changed","z":"97bc4677a5be4b40","g":"5c4bc67a61a0c623","name":"Send Alert At Return % - Short Trip?","server":"ebb6b83c7588d734","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_number.nr_proximity_alert_send_return_perc_short","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":200,"y":756,"wires":[["fe326331eb0667b2"]]},{"id":"fe326331eb0667b2","type":"change","z":"97bc4677a5be4b40","g":"5c4bc67a61a0c623","name":"Set Variable","rules":[{"t":"set","p":"nr_proximity_alert_send_return_perc_short","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":446,"y":756,"wires":[[]]},{"id":"8302023499b862d5","type":"change","z":"97bc4677a5be4b40","g":"5c4bc67a61a0c623","name":"Set Variable","rules":[{"t":"set","p":"nr_proximity_alert_send_return_perc_long","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":446,"y":816,"wires":[[]]},{"id":"b31da4f8d98e2434","type":"server-state-changed","z":"97bc4677a5be4b40","g":"5c4bc67a61a0c623","name":"Send Alert At Return % - Long Trip?","server":"ebb6b83c7588d734","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_number.nr_proximity_alert_send_return_perc_long","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":200,"y":816,"wires":[["8302023499b862d5"]]},{"id":"dd6c4c46cc9f4a67","type":"switch","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"Moving Towards/Away?","property":"prox_dir","propertyType":"flow","rules":[{"t":"eq","v":"away_from","vt":"str"},{"t":"eq","v":"towards","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":970,"y":1224,"wires":[["3711faee9086da56","cc2cfdda3f16c44c"],["9ba76720a1c0c9c0","d7542e1b9c4e03f5"]]},{"id":"3711faee9086da56","type":"debug","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"debug 22","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":984,"y":1140,"wires":[]},{"id":"9ba76720a1c0c9c0","type":"debug","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"debug 23","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":984,"y":1176,"wires":[]},{"id":"82d3d8d2c019d36c","type":"api-current-state","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"Get Existing Max Dist","server":"ebb6b83c7588d734","version":3,"outputs":1,"halt_if":"","halt_if_type":"num","halt_if_compare":"is","entity_id":"{{flow.nr_proximity_max_trip_distance}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"distance.max_initial","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":676,"y":1224,"wires":[["d7a829fd721459d1","c276259c78fec910"]]},{"id":"a1e3cadf6dd8a9b3","type":"debug","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"debug 29","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":912,"y":1320,"wires":[]},{"id":"d7a829fd721459d1","type":"debug","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"debug 30","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":716,"y":1188,"wires":[]},{"id":"2901fc3e6f25d545","type":"function","z":"97bc4677a5be4b40","g":"8da5ceef2a869d19","name":"Create Proximity Message (see notes)","func":"var proxMsg = {\n  //\"topic\": msg.topic,\n  \"topic\": global.get('proximity_test_person'),\n  \"payload\": msg.payload,\n  \"data\":\n  {\n    \"event_type\": \"state_changed\",\n    //\"entity_id\": \"proximity.home_jenna\",\n    \"entity_id\": global.get('proximity_test_person'),\n    \"event\":\n    {\n      \"entity_id\": \"proximity.home_jenna\",\n      \"old_state\":\n      {\n        \"entity_id\": \"proximity.home_jenna\",\n        \"state\": msg.data.event.old_state.state,\n        \"attributes\":\n        {\n          \"dir_of_travel\": msg.data.event.old_state.attributes.dir_of_travel,\n          \"nearest\": \"google_maps_107993763956471805595\",\n          \"unit_of_measurement\": \"m\",\n          \"friendly_name\": \"home_jenna\"\n        },\n        \"last_changed\": \"2022-09-26T09:13:58.223179+00:00\",\n        \"last_updated\": \"2022-09-26T09:13:58.223179+00:00\",\n        \"context\":\n        {\n          \"id\": \"01GDWH666FKGG8W3Y38CV2SW04\",\n          \"parent_id\": null,\n          \"user_id\": null\n        },\n        \"original_state\": \"7\"\n      },\n      \"new_state\":\n      {\n        \"entity_id\": \"proximity.home_jenna\",\n        \"state\": msg.payload,\n        \"attributes\":\n        {\n          \"dir_of_travel\": msg.data.event.new_state.attributes.dir_of_travel,\n          \"nearest\": \"google_maps_107993763956471805595\",\n          \"unit_of_measurement\": \"m\",\n          \"friendly_name\": \"home_jenna\"\n        },\n        \"last_changed\": \"2022-09-26T09:14:58.199649+00:00\",\n        \"last_updated\": \"2022-09-26T09:14:58.199649+00:00\",\n        \"context\":\n        {\n          \"id\": \"01GDWH80RQRZWWAJ8J1AAFNW5A\",\n          \"parent_id\": null,\n          \"user_id\": null\n        },\n        \"original_state\": \"6\",\n        \"timeSinceChangedMs\": 2076\n      }\n    },\n    \"origin\": \"LOCAL\",\n    \"time_fired\": \"2022-09-26T09:14:58.199649+00:00\",\n    \"context\":\n    {\n      \"id\": \"01GDWH80RQRZWWAJ8J1AAFNW5A\",\n      \"parent_id\": null,\n      \"user_id\": null\n    }\n  },\n  \"_msgid\": \"260c92c63e7a664b\"\n}\n\n\nreturn proxMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":666,"y":1800,"wires":[["00d489366654315b"]],"info":"FULL PROXIMITY STATE NODE OUTPUT\r\n\r\n{\r\n    \"topic\": \"proximity.home_jenna\",\r\n    \"payload\": \"6\",\r\n    \"data\":\r\n    {\r\n        \"event_type\": \"state_changed\",\r\n        \"entity_id\": \"proximity.home_jenna\",\r\n        \"event\":\r\n        {\r\n            \"entity_id\": \"proximity.home_jenna\",\r\n            \"old_state\":\r\n            {\r\n                \"entity_id\": \"proximity.home_jenna\",\r\n                \"state\": \"7\",\r\n                \"attributes\":\r\n                {\r\n                    \"dir_of_travel\": \"stationary\",\r\n                    \"nearest\": \"google_maps_107993763956471805595\",\r\n                    \"unit_of_measurement\": \"m\",\r\n                    \"friendly_name\": \"home_jenna\"\r\n                },\r\n                \"last_changed\": \"2022-09-26T09:13:58.223179+00:00\",\r\n                \"last_updated\": \"2022-09-26T09:13:58.223179+00:00\",\r\n                \"context\":\r\n                {\r\n                    \"id\": \"01GDWH666FKGG8W3Y38CV2SW04\",\r\n                    \"parent_id\": null,\r\n                    \"user_id\": null\r\n                },\r\n                \"original_state\": \"7\"\r\n            },\r\n            \"new_state\":\r\n            {\r\n                \"entity_id\": \"proximity.home_jenna\",\r\n                \"state\": \"6\",\r\n                \"attributes\":\r\n                {\r\n                    \"dir_of_travel\": \"stationary\",\r\n                    \"nearest\": \"google_maps_107993763956471805595\",\r\n                    \"unit_of_measurement\": \"m\",\r\n                    \"friendly_name\": \"home_jenna\"\r\n                },\r\n                \"last_changed\": \"2022-09-26T09:14:58.199649+00:00\",\r\n                \"last_updated\": \"2022-09-26T09:14:58.199649+00:00\",\r\n                \"context\":\r\n                {\r\n                    \"id\": \"01GDWH80RQRZWWAJ8J1AAFNW5A\",\r\n                    \"parent_id\": null,\r\n                    \"user_id\": null\r\n                },\r\n                \"original_state\": \"6\",\r\n                \"timeSinceChangedMs\": 2076\r\n            }\r\n        },\r\n        \"origin\": \"LOCAL\",\r\n        \"time_fired\": \"2022-09-26T09:14:58.199649+00:00\",\r\n        \"context\":\r\n        {\r\n            \"id\": \"01GDWH80RQRZWWAJ8J1AAFNW5A\",\r\n            \"parent_id\": null,\r\n            \"user_id\": null\r\n        }\r\n    },\r\n    \"_msgid\": \"260c92c63e7a664b\"\r\n}"},{"id":"5a21a6ba71bbb226","type":"inject","z":"97bc4677a5be4b40","g":"8da5ceef2a869d19","name":"Test: - Stationary (0) -> Away (300)","props":[{"p":"payload"},{"p":"data.event.new_state.attributes.dir_of_travel","v":"away_from","vt":"str"},{"p":"data.event.old_state.state","v":"0","vt":"str"},{"p":"data.event.old_state.attributes.dir_of_travel","v":"stationary","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"300","payloadType":"str","x":224,"y":1608,"wires":[["2901fc3e6f25d545"]]},{"id":"54019f53051e28a8","type":"api-call-service","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"Update Max Dist","server":"ebb6b83c7588d734","version":5,"debugenabled":false,"domain":"counter","service":"configure","areaId":[],"deviceId":[],"entityId":["{{flow.nr_proximity_max_trip_distance}}"],"data":"{\"value\": {{flow.prox_dist}} }","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1544,"y":996,"wires":[["c913ca37839dbf1f"]]},{"id":"3a26115c94d2a4f9","type":"trigger-state","z":"97bc4677a5be4b40","g":"9a56029e74b943d5","name":"Manual Alert Toggle Changed - Jenna","server":"ebb6b83c7588d734","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"input_boolean.nr_proxomity_alert_manual_toggle","entityidfiltertype":"substring","debugenabled":false,"constraints":[],"inputs":0,"outputs":4,"customoutputs":[{"messageType":"payload","messageValue":"\"1\"","messageValueType":"json","comparatorPropertyType":"current_state","comparatorPropertyValue":"new_state.state","comparatorType":"is","comparatorValue":"on","comparatorValueDataType":"str"},{"messageType":"payload","messageValue":"\"0\"","messageValueType":"json","comparatorPropertyType":"current_state","comparatorPropertyValue":"new_state.state","comparatorType":"is","comparatorValue":"off","comparatorValueDataType":"str"}],"outputinitially":true,"state_type":"str","enableInput":false,"x":786,"y":828,"wires":[[],[],["c089ecd3ea0c53dc"],["c089ecd3ea0c53dc"]]},{"id":"4f829752a174acfe","type":"api-call-service","z":"97bc4677a5be4b40","g":"9a56029e74b943d5","name":"Update Alert Enabled Status - Jenna","server":"ebb6b83c7588d734","version":5,"debugenabled":false,"domain":"counter","service":"configure","areaId":[],"deviceId":[],"entityId":["counter.nr_proximity_alert_enabled_jenna"],"data":"{\"value\": {{flow.alert_enabled}} }","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1434,"y":780,"wires":[["ded27b5bdd4eb3d3"]]},{"id":"b2028947f1294dd6","type":"switch","z":"97bc4677a5be4b40","g":"9a56029e74b943d5","name":"Person?","property":"topic","propertyType":"msg","rules":[{"t":"cont","v":"jenna","vt":"str"},{"t":"cont","v":"ryan","vt":"str"},{"t":"cont","v":"james","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":1188,"y":828,"wires":[["4f829752a174acfe"],["e633566ef1e97b56"],["3e423de793232709"]]},{"id":"c089ecd3ea0c53dc","type":"change","z":"97bc4677a5be4b40","g":"9a56029e74b943d5","name":"Set Flow Var","rules":[{"t":"set","p":"alert_enabled","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1030,"y":828,"wires":[["b2028947f1294dd6"]]},{"id":"e633566ef1e97b56","type":"api-call-service","z":"97bc4677a5be4b40","g":"9a56029e74b943d5","name":"Update Alert Enabled Status - Ryan","server":"ebb6b83c7588d734","version":5,"debugenabled":false,"domain":"counter","service":"configure","areaId":[],"deviceId":[],"entityId":["counter.nr_proximity_alert_enabled_ryan"],"data":"{\"value\": {{flow.alert_enabled}} }","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1420,"y":828,"wires":[["ded27b5bdd4eb3d3"]]},{"id":"3e423de793232709","type":"api-call-service","z":"97bc4677a5be4b40","g":"9a56029e74b943d5","name":"Update Alert Enabled Status - James","server":"ebb6b83c7588d734","version":5,"debugenabled":false,"domain":"counter","service":"configure","areaId":[],"deviceId":[],"entityId":["counter.nr_proximity_alert_enabled_james"],"data":"{\"value\": {{flow.alert_enabled}} }","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1434,"y":876,"wires":[["ded27b5bdd4eb3d3"]]},{"id":"ded27b5bdd4eb3d3","type":"change","z":"97bc4677a5be4b40","g":"9a56029e74b943d5","name":"Delete Flow Var","rules":[{"t":"delete","p":"alert_enabled","pt":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":1684,"y":828,"wires":[[]]},{"id":"54872030e233d60c","type":"api-call-service","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"Enable Alerting","server":"ebb6b83c7588d734","version":5,"debugenabled":false,"domain":"counter","service":"configure","areaId":[],"deviceId":[],"entityId":["{{flow.nr_proximity_alert_enabled}}"],"data":"{\"value\": \"1\" }","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":2012,"y":1032,"wires":[["8cdca83d77bd1cad"]]},{"id":"f4dab40bfd288306","type":"switch","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"Person?","property":"topic","propertyType":"msg","rules":[{"t":"cont","v":"jenna","vt":"str"},{"t":"cont","v":"ryan","vt":"str"},{"t":"cont","v":"james","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":276,"y":1224,"wires":[["f92a0f4bd017ea08"],["c19b5f07f445b8f5"],["c25c41581224e296"]]},{"id":"3ed070045d176454","type":"inject","z":"97bc4677a5be4b40","g":"8da5ceef2a869d19","name":"Test: - Away (600) -> Away (950)","props":[{"p":"payload"},{"p":"data.event.new_state.attributes.dir_of_travel","v":"away_from","vt":"str"},{"p":"data.event.old_state.state","v":"600","vt":"str"},{"p":"data.event.old_state.attributes.dir_of_travel","v":"away_from","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"950","payloadType":"str","x":214,"y":1680,"wires":[["2901fc3e6f25d545"]]},{"id":"4e359952d3a4a198","type":"inject","z":"97bc4677a5be4b40","g":"8da5ceef2a869d19","name":"Test:  - Away (950) -> Away (5000)","props":[{"p":"topic","vt":"str"},{"p":"payload"},{"p":"data.event.new_state.attributes.dir_of_travel","v":"away_from","vt":"str"},{"p":"data.event.old_state.state","v":"950","vt":"num"},{"p":"data.event.old_state.attributes.dir_of_travel","v":"away_from","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"proximity.home_jenna","payload":"5000","payloadType":"num","x":214,"y":1716,"wires":[["2901fc3e6f25d545"]]},{"id":"355e09c90530533b","type":"inject","z":"97bc4677a5be4b40","g":"8da5ceef2a869d19","name":"Test: - Away (5000) -> Away (12000)","props":[{"p":"payload"},{"p":"data.event.new_state.attributes.dir_of_travel","v":"away_from","vt":"str"},{"p":"data.event.old_state.state","v":"5000","vt":"str"},{"p":"data.event.old_state.attributes.dir_of_travel","v":"away_from","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"12000","payloadType":"str","x":224,"y":1752,"wires":[["2901fc3e6f25d545"]]},{"id":"720df0f6da68fa53","type":"inject","z":"97bc4677a5be4b40","g":"8da5ceef2a869d19","name":"Test: - Away (600) -> Towards (300)","props":[{"p":"payload"},{"p":"data.event.new_state.attributes.dir_of_travel","v":"towards","vt":"str"},{"p":"data.event.old_state.state","v":"600","vt":"str"},{"p":"data.event.old_state.attributes.dir_of_travel","v":"away_from","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"300","payloadType":"str","x":228,"y":1884,"wires":[["2901fc3e6f25d545"]]},{"id":"e7254e9b65bfa1f3","type":"inject","z":"97bc4677a5be4b40","g":"8da5ceef2a869d19","name":"Test: - Away (950) -> Towards (600)","props":[{"p":"payload"},{"p":"data.event.new_state.attributes.dir_of_travel","v":"towards","vt":"str"},{"p":"data.event.old_state.state","v":"950","vt":"str"},{"p":"data.event.old_state.attributes.dir_of_travel","v":"away_from","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"600","payloadType":"str","x":228,"y":1920,"wires":[["2901fc3e6f25d545"]]},{"id":"829450460b8f17c8","type":"inject","z":"97bc4677a5be4b40","g":"8da5ceef2a869d19","name":"Test: - Away (5000) -> Towards (950)","props":[{"p":"payload"},{"p":"data.event.new_state.attributes.dir_of_travel","v":"towards","vt":"str"},{"p":"data.event.old_state.state","v":"5000","vt":"str"},{"p":"data.event.old_state.attributes.dir_of_travel","v":"away_from","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"950","payloadType":"str","x":228,"y":1956,"wires":[["2901fc3e6f25d545"]]},{"id":"e47c25e031bb295c","type":"inject","z":"97bc4677a5be4b40","g":"8da5ceef2a869d19","name":"Test: - Away (300) -> Towards (0)","props":[{"p":"payload"},{"p":"data.event.new_state.attributes.dir_of_travel","v":"towards","vt":"str"},{"p":"data.event.old_state.state","v":"300","vt":"str"},{"p":"data.event.old_state.attributes.dir_of_travel","v":"away_from","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"0","payloadType":"str","x":218,"y":1848,"wires":[["2901fc3e6f25d545"]]},{"id":"94ed4e6641724ede","type":"inject","z":"97bc4677a5be4b40","g":"8da5ceef2a869d19","name":"Test: - Away (12000) -> Away (20000)","props":[{"p":"payload"},{"p":"data.event.new_state.attributes.dir_of_travel","v":"away_from","vt":"str"},{"p":"data.event.old_state.state","v":"12000","vt":"str"},{"p":"data.event.old_state.attributes.dir_of_travel","v":"away_from","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"20000","payloadType":"str","x":234,"y":1788,"wires":[["2901fc3e6f25d545"]]},{"id":"6738766b6b5b12d7","type":"inject","z":"97bc4677a5be4b40","g":"8da5ceef2a869d19","name":"Test: - Away (12000) -> Towards (5000)","props":[{"p":"payload"},{"p":"data.event.new_state.attributes.dir_of_travel","v":"towards","vt":"str"},{"p":"data.event.old_state.state","v":"12000","vt":"str"},{"p":"data.event.old_state.attributes.dir_of_travel","v":"away_from","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"5000","payloadType":"str","x":238,"y":1992,"wires":[["2901fc3e6f25d545"]]},{"id":"25be206f3a746cd5","type":"inject","z":"97bc4677a5be4b40","g":"8da5ceef2a869d19","name":"Test: - Away (20000) -> Towards (12000)","props":[{"p":"payload"},{"p":"data.event.new_state.attributes.dir_of_travel","v":"towards","vt":"str"},{"p":"data.event.old_state.state","v":"20000","vt":"str"},{"p":"data.event.old_state.attributes.dir_of_travel","v":"away_from","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"12000","payloadType":"str","x":248,"y":2028,"wires":[["2901fc3e6f25d545"]]},{"id":"5dd37a85129ad179","type":"inject","z":"97bc4677a5be4b40","g":"8da5ceef2a869d19","name":"Test: - Away (300) -> Away (600)","props":[{"p":"payload"},{"p":"data.event.new_state.attributes.dir_of_travel","v":"away_from","vt":"str"},{"p":"data.event.old_state.state","v":"600","vt":"str"},{"p":"data.event.old_state.attributes.dir_of_travel","v":"away_from","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"600","payloadType":"str","x":214,"y":1644,"wires":[["2901fc3e6f25d545"]]},{"id":"032507ce63ae9654","type":"api-call-service","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"Update Manual Toggle","server":"ebb6b83c7588d734","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_on","areaId":[],"deviceId":[],"entityId":["{{flow.nr_proxomity_alert_manual_toggle}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":2032,"y":1080,"wires":[[]]},{"id":"86be7f6f3a62d8a9","type":"api-call-service","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"Disable Alerting","server":"ebb6b83c7588d734","version":5,"debugenabled":false,"domain":"counter","service":"configure","areaId":[],"deviceId":[],"entityId":["{{flow.nr_proximity_alert_enabled}}"],"data":"{\"value\": \"0\" }","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":2012,"y":1428,"wires":[[]]},{"id":"0fcfe2320fa12df7","type":"api-call-service","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"Update Manual Toggle","server":"ebb6b83c7588d734","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.nr_proxomity_alert_manual_toggle}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":2032,"y":1476,"wires":[[]]},{"id":"8c3ca342d602df27","type":"api-current-state","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"Has Alert Been Enabled Yet For Trip?","server":"ebb6b83c7588d734","version":3,"outputs":2,"halt_if":"0","halt_if_type":"num","halt_if_compare":"is","entity_id":"{{flow.nr_proximity_alert_enabled_yet_for_trip}}","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"alert_enabled_yet_for_trip","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":1614,"y":1080,"wires":[["54872030e233d60c","032507ce63ae9654","507a8a1decb075a5","ef79f4dfd8a1b47c","732f215b87d90f0d"],[]]},{"id":"507a8a1decb075a5","type":"api-call-service","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"Update Trip Alert Enabled Flag","server":"ebb6b83c7588d734","version":5,"debugenabled":false,"domain":"counter","service":"configure","areaId":[],"deviceId":[],"entityId":["{{flow.nr_proximity_alert_enabled_yet_for_trip}}"],"data":"{\"value\": \"1\" }","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":2062,"y":1128,"wires":[[]]},{"id":"2616a90fb6be840a","type":"api-call-service","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"Update Trip Alert Enabled Flag","server":"ebb6b83c7588d734","version":5,"debugenabled":false,"domain":"counter","service":"configure","areaId":[],"deviceId":[],"entityId":["{{flow.nr_proximity_alert_enabled_yet_for_trip}}"],"data":"{\"value\": \"0\" }","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":2062,"y":1524,"wires":[[]]},{"id":"a945216b120f2a16","type":"api-call-service","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"Update Max Dist","server":"ebb6b83c7588d734","version":5,"debugenabled":false,"domain":"counter","service":"configure","areaId":[],"deviceId":[],"entityId":["{{flow.nr_proximity_max_trip_distance}}"],"data":"{\"value\": {{flow.prox_dist}} }","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":2012,"y":1380,"wires":[["b047c9be2ad9ed97"]]},{"id":"c276259c78fec910","type":"function","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"Set Flow Vars (ensure dist numeric)","func":"// Set flow vars & make sure any numbers are numeric\nflow.set('prox_dist', Number(msg.payload));\nflow.set('prox_dir', msg.data.event.new_state.attributes.dir_of_travel);\nflow.set('prox_dist_old', Number(msg.data.event.old_state.state));\nflow.set('prox_dir_old', msg.data.event.old_state.attributes.dir_of_travel);\nflow.set('dist_max', Number(msg.distance.max_initial));\n\n// Set msg object numbers to numeric\nmsg.payload = Number(msg.payload);\nmsg.data.event.new_state.state = Number(msg.payload);\nmsg.data.event.old_state.state = Number(msg.data.event.old_state.state);\nmsg.distance.max_initial = Number(msg.distance.max_initial);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":808,"y":1296,"wires":[["a1e3cadf6dd8a9b3","dd6c4c46cc9f4a67"]]},{"id":"d7542e1b9c4e03f5","type":"switch","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"Distance vs Max Dist & Enable Alert Dist","property":"prox_dist","propertyType":"flow","rules":[{"t":"gt","v":"dist_max","vt":"flow"},{"t":"lt","v":"dist_max","vt":"flow"},{"t":"gt","v":"nr_proximity_alert_enabled_distance","vt":"global"},{"t":"lt","v":"nr_proximity_alert_enabled_distance","vt":"global"}],"checkall":"true","repair":false,"outputs":4,"x":1220,"y":1392,"wires":[["68d84c1ca24b7181"],["78b4797cd11f289a","7894b277675bfbbc"],["af5ec50d5ab11cf1"],["a945216b120f2a16","86be7f6f3a62d8a9","0fcfe2320fa12df7","2616a90fb6be840a","17da25a035fa7197"]]},{"id":"78b4797cd11f289a","type":"function","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"Alert Triggered?","func":"\nvar destination = flow.get('destination');\nvar personName = flow.get('occupancy_name');\nvar distNow = flow.get('prox_dist');\nvar distMax = flow.get('dist_max');\nvar tripLong = global.get('nr_proximity_long_trip_distance');\nvar tripShort = global.get('nr_proximity_alert_enabled_distance');\nvar percLong = global.get('nr_proximity_alert_send_return_perc_long');\nvar percShort = global.get('nr_proximity_alert_send_return_perc_short');\n\n\nif (distMax >= tripLong) {\n// Long trip.\n    \n    // Current dist returned to alerting zone i.e. X % of max dist?\n    if (distNow < (distMax * percLong / 100) ) {\n        var notifyTitle = \"Proximity Alert: \" + destination + \" - \" + personName + \" (\" + distNow + \"m )\";\n        var notifyMessage = \"Proximity: \" + personName + \" is \" + distNow + \"m from \" + destination + \".\\r\\nMaximum trip distance: \" + distMax + \"m (long trip - long trip boundary @ \" + tripLong + \"m).\\r\\nAlert triggered at \" + percLong + \"% of max distance.\\r\\nAlert enabled \" + tripShort + \"m from \" + destination + \".\";\n    }\n\n} else if (distMax >= tripShort) {\n// Short trip.\n\n    // Current dist returned to alerting zone i.e. X % of max dist?\n    if (distNow < (distMax * percShort / 100)) {\n        var notifyTitle = \"Proximity Alert: \" + destination + \" - \" + personName + \" (\" + distNow + \"m )\";\n        var notifyMessage = \"Proximity: \" + personName + \" is \" + distNow + \"m from \" + destination + \".\\r\\nMaximum trip distance: \" + distMax + \"m (short trip - long trip boundary @ \" + tripLong + \"m) \\r\\nAlert triggered at \" + percShort + \"% of max distance.\\r\\nAlert enabled \" + tripShort + \"m from \" + destination + \".\";\n    }\n\n}\n\n// If current dist matches alert criteria (above)\nif (notifyTitle != undefined) {\n    // Add notification details to msg\n    msg['alert'] = {\n        send: 1,\n        title: notifyTitle,\n        message: notifyMessage\n    }\n\n    // Set global notification vars to pass to notification agents\n    global.set('notification_title', notifyTitle);\n    global.set('notification_msg', notifyMessage);\n        \n    return [msg, null];\n\n} else {\n// Trip doesn't match criteria for alerting\n\n    msg['alert'] = {\n        send: 0,\n        title: \"\",\n        message: \"\"\n    }\n    return [null, msg];\n}\n\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1544,"y":1356,"wires":[["634afa7df2b9987a","564ba8d5a39e6a8f"],[]]},{"id":"def5d96cb9545822","type":"comment","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"","info":"We log whether alert has been enabled for this trip - this is\nnot reset until alert is sent or trip distance goes back below\nminimum trip distance.\nReason we log is to allow the manual toggling of alerting via\nthe HA input_bool (e.g. input_boolean.nr_proxomity_alert_manual_toggle_jenna).\n\nWithout logging whether alert has been enabled for the trip, and\ntesting agsint that before enabling alerting, the alert would be\nre-enabled every time the distance was above minimum dist - even if\nthe alert was disabled manually in HA.","x":1692,"y":1056,"wires":[]},{"id":"97eed0234d90c6a3","type":"change","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"Set Home Vars","rules":[{"t":"set","p":"destination","pt":"flow","to":"Home","tot":"str"},{"t":"set","p":"destination","pt":"msg","to":"Home","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":388,"y":1128,"wires":[["f4dab40bfd288306"]]},{"id":"c9f48f1f2325a8ca","type":"switch","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"Destination?","property":"topic","propertyType":"msg","rules":[{"t":"cont","v":"home","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":218,"y":1128,"wires":[["97eed0234d90c6a3"],[]]},{"id":"634afa7df2b9987a","type":"debug","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"debug 46","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1552,"y":1320,"wires":[]},{"id":"68d84c1ca24b7181","type":"debug","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"debug 48","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1276,"y":1308,"wires":[]},{"id":"7894b277675bfbbc","type":"debug","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"debug 49","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1276,"y":1344,"wires":[]},{"id":"564ba8d5a39e6a8f","type":"api-current-state","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"Alert Enabled?","server":"ebb6b83c7588d734","version":3,"outputs":2,"halt_if":"1","halt_if_type":"num","halt_if_compare":"is","entity_id":"{{flow.nr_proximity_alert_enabled}}","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"alert_enabled","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":1756,"y":1356,"wires":[["3c855854595efac1","80c105534476f45e","a945216b120f2a16","86be7f6f3a62d8a9","0fcfe2320fa12df7","2616a90fb6be840a"],[]]},{"id":"3c855854595efac1","type":"debug","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"debug 50","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1764,"y":1320,"wires":[]},{"id":"80c105534476f45e","type":"link out","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"Front Door Motion","mode":"link","links":["4e0fb3de.b1482c"],"x":2027,"y":1332,"wires":[]},{"id":"af5ec50d5ab11cf1","type":"debug","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"debug 52","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1276,"y":1440,"wires":[]},{"id":"17da25a035fa7197","type":"debug","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"debug 53","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1288,"y":1476,"wires":[]},{"id":"cc2cfdda3f16c44c","type":"switch","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"Distance vs Max Dist & Enable Alert Dist","property":"prox_dist","propertyType":"flow","rules":[{"t":"gt","v":"dist_max","vt":"flow"},{"t":"lt","v":"dist_max","vt":"flow"},{"t":"gt","v":"nr_proximity_alert_enabled_distance","vt":"global"},{"t":"lt","v":"nr_proximity_alert_enabled_distance","vt":"global"}],"checkall":"true","repair":false,"outputs":4,"x":1220,"y":1044,"wires":[["54019f53051e28a8","995d19da31b7f797"],["b866fba6b7813831"],["8c3ca342d602df27","bf55ea5473a528b9"],["1f236e065f99fad4"]]},{"id":"b866fba6b7813831","type":"debug","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"debug 54","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1284,"y":996,"wires":[]},{"id":"995d19da31b7f797","type":"debug","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"debug 55","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1284,"y":960,"wires":[]},{"id":"bf55ea5473a528b9","type":"debug","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"debug 56","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1284,"y":1092,"wires":[]},{"id":"1f236e065f99fad4","type":"debug","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"debug 57","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1284,"y":1128,"wires":[]},{"id":"c19b5f07f445b8f5","type":"change","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"Set Ryan Vars","rules":[{"t":"set","p":"occupancy_name","pt":"flow","to":"Ryan","tot":"str"},{"t":"set","p":"occupancy_person","pt":"flow","to":"person.ryan","tot":"str"},{"t":"set","p":"occupancy_bayes","pt":"flow","to":"binary_sensor.ryan_home_bayesian","tot":"str"},{"t":"set","p":"occupancy_select","pt":"flow","to":"input_select.home_ryan","tot":"str"},{"t":"set","p":"nr_proxomity_alert_manual_toggle","pt":"flow","to":"input_boolean.nr_proxomity_alert_manual_toggle_ryan","tot":"str"},{"t":"set","p":"nr_proximity_alert_enabled","pt":"flow","to":"counter.nr_proximity_alert_enabled_ryan","tot":"str"},{"t":"set","p":"nr_proximity_max_trip_distance","pt":"flow","to":"counter.nr_proximity_max_trip_distance_ryan","tot":"str"},{"t":"set","p":"nr_proximity_alert_enabled_yet_for_trip","pt":"flow","to":"counter.nr_proximity_alert_enabled_yet_for_trip_ryan","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":448,"y":1224,"wires":[["82d3d8d2c019d36c"]]},{"id":"c25c41581224e296","type":"change","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"Set James Vars","rules":[{"t":"set","p":"occupancy_name","pt":"flow","to":"James","tot":"str"},{"t":"set","p":"occupancy_person","pt":"flow","to":"person.james","tot":"str"},{"t":"set","p":"occupancy_bayes","pt":"flow","to":"binary_sensor.james_home_bayesian","tot":"str"},{"t":"set","p":"occupancy_select","pt":"flow","to":"input_select.home_james","tot":"str"},{"t":"set","p":"nr_proxomity_alert_manual_toggle","pt":"flow","to":"input_boolean.nr_proxomity_alert_manual_toggle_james","tot":"str"},{"t":"set","p":"nr_proximity_alert_enabled","pt":"flow","to":"counter.nr_proximity_alert_enabled_james","tot":"str"},{"t":"set","p":"nr_proximity_max_trip_distance","pt":"flow","to":"counter.nr_proximity_max_trip_distance_james","tot":"str"},{"t":"set","p":"nr_proximity_alert_enabled_yet_for_trip","pt":"flow","to":"counter.nr_proximity_alert_enabled_yet_for_trip_james","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":448,"y":1260,"wires":[["82d3d8d2c019d36c"]]},{"id":"e9d14b3782054870","type":"comment","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"Notes","info":"Flow is triggered by changes in Proximity values from Home Assistant.\nThe flow uses name of proximity entity to detect Destination and Person.\nFlow variables are set for each person to tell Node Red which HA\nentities are relevant in terms of getting and updating trip info.\n\nHA Helpers are used to define global trip values e.g. trip dist\nbefore alerts are enabled, alert when person returns by X% of max \ntrip dist.\n\nMore HA Helpers are used to track trip details for each person so\nthat Node Red knows when to send alert.\n\n\nHOME ASSISTANT HELPERS REQUIRED (GLOBAL)\nEntity ID: input_number.nr_proximity_alert_enabled_distance\n    Name: Proximity - Distance Before Alert Enabled (Node Red)\n    Icon: mdi:map-marker-distance\n\nEntity ID: input_number.nr_proximity_long_trip_distance\n    Name: Proximity - Long Trip Begins At (Node Red)\n    Icon: mdi:map-marker-distance\n\nEntity ID: input_number.nr_proximity_alert_send_return_perc_short\n    Name: Proximity - Short Trip Alert At % (Node Red)\n    Icon: mdi:social-distance-2-meters\n\nEntity ID: input_number.nr_proximity_alert_send_return_perc_long\n    Name: Proximity - Long Trip Alert At % (Node Red)\n    Icon: mdi:social-distance-2-meters\n\n\nHOME ASSISTANT HELPERS REQUIRED (PER PERSON)\nEntity ID: input_boolean.nr_proxomity_alert_manual_toggle_ryan\n    Name: Proximity - Manual Alert Toggle - Ryan (Node Red)\n    Icon: mdi:message-cog\n\nEntity ID: counter.nr_proximity_alert_enabled_ryan\n    Name: Proximity - Alert Enabled - Ryan? (Node Red)\n    Icon: mdi:bell-alert\n    Min: 0\n    Max: 1\n    Step: 1\n\nEntity ID: counter.nr_proximity_max_trip_distance_ryan\n    Name: Proximity - Max Trip Distance - Ryan? (Node Red)\n    Icon: mdi:counter\n    Min: 0\n    Max: \n    Step: 1\n\nEntity ID: counter.counter_nr_proximity_alert_enabled_yet_for_trip_ryan\n    Name: Proximity - Has Alert Been Enabled During This Trip - Ryan? (Node Red)\n    Icon: mdi:account-check\n    Min: 0\n    Max: 1\n    Step: 1\n\n\n\nFLOW VARIABLES USED (& EXAMPLE VALUES):\n    SET DESTINATION VARS\n        flow.destination = Home\n\n    SET PERSON VARS\n    Has more vars than actually needed in this flow as we use the same node to\n    define vars for the Home/Away input_select update flows.\n        occupancy_name = Ryan\n        occupancy_person = person.ryan\n        occupancy_bayes = binary_sensor.ryan_home_bayesian\n        occupancy_select = input_select.home_ryan\n        nr_proxomity_alert_manual_toggle = input_boolean.nr_proxomity_alert_manual_toggle_ryan\n        nr_proximity_alert_enabled = counter.nr_proximity_alert_enabled_ryan\n        nr_proximity_max_trip_distance = counter.nr_proximity_max_trip_distance_ryan\n        nr_proximity_alert_enabled_yet_for_trip = counter.nr_proximity_alert_enabled_yet_for_trip_ryan\n\n    SET FLOW VARS\n    Node input is from a 'Get State' query node running against the person's\n    max trip dist HA entity e.g. counter.nr_proximity_max_trip_distance_ryan\n        prox_dist = flow.set('prox_dist', Number(msg.payload));\n        prox_dir = flow.set('prox_dir', msg.data.event.new_state.attributes.dir_of_travel);\n        prox_dist_old = flow.set('prox_dist_old', Number(msg.data.event.old_state.state));\n        prox_dir_old = flow.set('prox_dir_old', msg.data.event.old_state.attributes.dir_of_travel);\n        max_dist_initial = flow.set('dist_max', Number(msg.distance.max_initial));\n","x":118,"y":972,"wires":[]},{"id":"5e160afed24d9cff","type":"change","z":"97bc4677a5be4b40","g":"8da5ceef2a869d19","name":"Set Jenna Vars","rules":[{"t":"set","p":"occupancy_name","pt":"flow","to":"Jenna","tot":"str"},{"t":"set","p":"occupancy_person","pt":"flow","to":"person.jenna","tot":"str"},{"t":"set","p":"occupancy_bayes","pt":"flow","to":"binary_sensor.jenna_home_bayesian","tot":"str"},{"t":"set","p":"occupancy_select","pt":"flow","to":"input_select.home_jenna","tot":"str"},{"t":"set","p":"nr_proxomity_alert_manual_toggle","pt":"flow","to":"input_boolean.nr_proxomity_alert_manual_toggle_jenna","tot":"str"},{"t":"set","p":"nr_proximity_alert_enabled","pt":"flow","to":"counter.nr_proximity_alert_enabled_jenna","tot":"str"},{"t":"set","p":"nr_proximity_max_trip_distance","pt":"flow","to":"counter.nr_proximity_max_trip_distance_jenna","tot":"str"},{"t":"set","p":"nr_proximity_alert_enabled_yet_for_trip","pt":"flow","to":"counter.nr_proximity_alert_enabled_yet_for_trip_jenna","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":944,"y":1908,"wires":[["3418333eef22b4eb","0bf7111569f6287a","a761f2de9ad7e08f","2a12385434afac28"]]},{"id":"678cfedafc27d4b2","type":"switch","z":"97bc4677a5be4b40","g":"8da5ceef2a869d19","name":"Person?","property":"topic","propertyType":"msg","rules":[{"t":"cont","v":"jenna","vt":"str"},{"t":"cont","v":"ryan","vt":"str"},{"t":"cont","v":"james","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":768,"y":1944,"wires":[["5e160afed24d9cff"],["6eb0831b12dcac04"],["caf7c03742bda019"]]},{"id":"6eb0831b12dcac04","type":"change","z":"97bc4677a5be4b40","g":"8da5ceef2a869d19","name":"Set Ryan Vars","rules":[{"t":"set","p":"occupancy_name","pt":"flow","to":"Ryan","tot":"str"},{"t":"set","p":"occupancy_person","pt":"flow","to":"person.ryan","tot":"str"},{"t":"set","p":"occupancy_bayes","pt":"flow","to":"binary_sensor.ryan_home_bayesian","tot":"str"},{"t":"set","p":"occupancy_select","pt":"flow","to":"input_select.home_ryan","tot":"str"},{"t":"set","p":"nr_proxomity_alert_manual_toggle","pt":"flow","to":"input_boolean.nr_proxomity_alert_manual_toggle_ryan","tot":"str"},{"t":"set","p":"nr_proximity_alert_enabled","pt":"flow","to":"counter.nr_proximity_alert_enabled_ryan","tot":"str"},{"t":"set","p":"nr_proximity_max_trip_distance","pt":"flow","to":"counter.nr_proximity_max_trip_distance_ryan","tot":"str"},{"t":"set","p":"nr_proximity_alert_enabled_yet_for_trip","pt":"flow","to":"counter.nr_proximity_alert_enabled_yet_for_trip_ryan","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":948,"y":1944,"wires":[["3418333eef22b4eb","0bf7111569f6287a","a761f2de9ad7e08f","2a12385434afac28"]]},{"id":"caf7c03742bda019","type":"change","z":"97bc4677a5be4b40","g":"8da5ceef2a869d19","name":"Set James Vars","rules":[{"t":"set","p":"occupancy_name","pt":"flow","to":"James","tot":"str"},{"t":"set","p":"occupancy_person","pt":"flow","to":"person.james","tot":"str"},{"t":"set","p":"occupancy_bayes","pt":"flow","to":"binary_sensor.james_home_bayesian","tot":"str"},{"t":"set","p":"occupancy_select","pt":"flow","to":"input_select.home_james","tot":"str"},{"t":"set","p":"nr_proxomity_alert_manual_toggle","pt":"flow","to":"input_boolean.nr_proxomity_alert_manual_toggle_james","tot":"str"},{"t":"set","p":"nr_proximity_alert_enabled","pt":"flow","to":"counter.nr_proximity_alert_enabled_james","tot":"str"},{"t":"set","p":"nr_proximity_max_trip_distance","pt":"flow","to":"counter.nr_proximity_max_trip_distance_james","tot":"str"},{"t":"set","p":"nr_proximity_alert_enabled_yet_for_trip","pt":"flow","to":"counter.nr_proximity_alert_enabled_yet_for_trip_james","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":948,"y":1980,"wires":[["2a12385434afac28","a761f2de9ad7e08f","0bf7111569f6287a","3418333eef22b4eb"]]},{"id":"3bb2c2bee0fc150f","type":"inject","z":"97bc4677a5be4b40","g":"8da5ceef2a869d19","name":"Reset Jenna","props":[{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"proximity.home_jenna","x":610,"y":1908,"wires":[["678cfedafc27d4b2"]]},{"id":"0bf7111569f6287a","type":"api-call-service","z":"97bc4677a5be4b40","g":"8da5ceef2a869d19","name":"Disable Alerting","server":"ebb6b83c7588d734","version":5,"debugenabled":false,"domain":"counter","service":"configure","areaId":[],"deviceId":[],"entityId":["{{flow.nr_proximity_alert_enabled}}"],"data":"{\"value\": \"0\" }","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1156,"y":1920,"wires":[[]]},{"id":"a761f2de9ad7e08f","type":"api-call-service","z":"97bc4677a5be4b40","g":"8da5ceef2a869d19","name":"Update Manual Toggle","server":"ebb6b83c7588d734","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.nr_proxomity_alert_manual_toggle}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1180,"y":1968,"wires":[[]]},{"id":"2a12385434afac28","type":"api-call-service","z":"97bc4677a5be4b40","g":"8da5ceef2a869d19","name":"Update Trip Alert Enabled Flag","server":"ebb6b83c7588d734","version":5,"debugenabled":false,"domain":"counter","service":"configure","areaId":[],"deviceId":[],"entityId":["{{flow.nr_proximity_alert_enabled_yet_for_trip}}"],"data":"{\"value\": \"0\" }","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1214,"y":2016,"wires":[[]]},{"id":"3418333eef22b4eb","type":"api-call-service","z":"97bc4677a5be4b40","g":"8da5ceef2a869d19","name":"Update Max Dist","server":"ebb6b83c7588d734","version":5,"debugenabled":false,"domain":"counter","service":"configure","areaId":[],"deviceId":[],"entityId":["{{flow.nr_proximity_max_trip_distance}}"],"data":"{\"value\": 0 }","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1156,"y":1872,"wires":[[]]},{"id":"32bf80bc7cc99610","type":"inject","z":"97bc4677a5be4b40","g":"8da5ceef2a869d19","name":"Reset Ryan","props":[{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"proximity.home_ryan","x":610,"y":1944,"wires":[["678cfedafc27d4b2"]]},{"id":"3a786e3cd7b72ee6","type":"inject","z":"97bc4677a5be4b40","g":"8da5ceef2a869d19","name":"Reset James","props":[{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"proximity.home_james","x":610,"y":1980,"wires":[["678cfedafc27d4b2"]]},{"id":"c1b2c2db8aa5a6b8","type":"change","z":"97bc4677a5be4b40","g":"8da5ceef2a869d19","name":"Set Global Var - Proximity Test Person","rules":[{"t":"set","p":"proximity_test_person","pt":"global","to":"topic","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":894,"y":1668,"wires":[[]]},{"id":"9394e0b178271cd8","type":"inject","z":"97bc4677a5be4b40","g":"8da5ceef2a869d19","name":"Use Jenna for Testing","props":[{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"proximity.home_jenna","x":628,"y":1740,"wires":[["c1b2c2db8aa5a6b8"]]},{"id":"023a913e981cb35f","type":"inject","z":"97bc4677a5be4b40","g":"8da5ceef2a869d19","name":"Use Ryan for Testing","props":[{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"proximity.home_ryan","x":614,"y":1668,"wires":[["c1b2c2db8aa5a6b8"]]},{"id":"ece89447bf3bbb71","type":"inject","z":"97bc4677a5be4b40","g":"8da5ceef2a869d19","name":"Use James for Testing","props":[{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"proximity.home_james","x":628,"y":1704,"wires":[["c1b2c2db8aa5a6b8"]]},{"id":"00d489366654315b","type":"link out","z":"97bc4677a5be4b40","g":"8da5ceef2a869d19","name":"Proximity Test Output","mode":"link","links":["54545bdc67b829b3"],"x":933,"y":1800,"wires":[]},{"id":"54545bdc67b829b3","type":"link in","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"Proximity Test Input","links":["00d489366654315b"],"x":285,"y":1020,"wires":[["c9f48f1f2325a8ca"]]},{"id":"ef79f4dfd8a1b47c","type":"debug","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"debug 60","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1692,"y":1116,"wires":[]},{"id":"a84b84effb8bfd77","type":"link in","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"Proximity - Delete Flow Vars","links":["c913ca37839dbf1f","8cdca83d77bd1cad","b047c9be2ad9ed97","a27bfcc13d0d4009"],"x":1935,"y":1248,"wires":[["8876707d1bc9769b"]]},{"id":"8876707d1bc9769b","type":"change","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"Delete Flow Vars","rules":[{"t":"delete","p":"destination","pt":"flow"},{"t":"delete","p":"occupancy_name","pt":"flow"},{"t":"delete","p":"occupancy_person","pt":"flow"},{"t":"delete","p":"occupancy_bayes","pt":"flow"},{"t":"delete","p":"occupancy_select","pt":"flow"},{"t":"delete","p":"nr_proxomity_alert_manual_toggle","pt":"flow"},{"t":"delete","p":"nr_proximity_alert_enabled","pt":"flow"},{"t":"delete","p":"nr_proximity_max_trip_distance","pt":"flow"},{"t":"delete","p":"nr_proximity_alert_enabled_yet_for_trip","pt":"flow"},{"t":"delete","p":"prox_dist","pt":"flow"},{"t":"delete","p":"prox_dir","pt":"flow"},{"t":"delete","p":"prox_dist_old","pt":"flow"},{"t":"delete","p":"prox_dir_old","pt":"flow"},{"t":"delete","p":"max_dist_initial","pt":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":2064,"y":1248,"wires":[[]]},{"id":"c913ca37839dbf1f","type":"link out","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"Proximity - Delete Flow Vars","mode":"link","links":["a84b84effb8bfd77"],"x":1761,"y":996,"wires":[]},{"id":"8cdca83d77bd1cad","type":"link out","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"Proximity - Delete Flow Vars","mode":"link","links":["a84b84effb8bfd77"],"x":2177,"y":1032,"wires":[]},{"id":"b047c9be2ad9ed97","type":"link out","z":"97bc4677a5be4b40","g":"e4e333fc33cfc20f","name":"Proximity - Delete Flow Vars","mode":"link","links":["a84b84effb8bfd77"],"x":2189,"y":1380,"wires":[]},{"id":"303ebad9d6ab0cd2","type":"trigger-state","z":"97bc4677a5be4b40","d":true,"g":"0302ccd0beec3f7a","name":"Ryan Home/Away (Bayesian)?","server":"ebb6b83c7588d734","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.ryan_home_bayesian","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"inputs":0,"outputs":2,"customoutputs":[],"outputinitially":true,"state_type":"str","enableInput":false,"x":2388,"y":468,"wires":[["7256681f884a3320"],["7256681f884a3320"]]},{"id":"7256681f884a3320","type":"change","z":"97bc4677a5be4b40","d":true,"g":"0302ccd0beec3f7a","name":"Ryan - Set Person's Vars","rules":[{"t":"set","p":"occupancy_name","pt":"msg","to":"Ryan","tot":"str"},{"t":"set","p":"occupancy_person","pt":"flow","to":"person.ryan","tot":"str"},{"t":"set","p":"occupancy_bayes","pt":"flow","to":"binary_sensor.ryan_home_bayesian","tot":"str"},{"t":"set","p":"occupancy_select","pt":"flow","to":"input_select.home_ryan","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2646,"y":492,"wires":[["2b2ab2fc631bb86f"]]},{"id":"8cef574918069f76","type":"change","z":"97bc4677a5be4b40","d":true,"g":"0302ccd0beec3f7a","name":"Jenna - Set Person's Vars","rules":[{"t":"set","p":"occupancy_name","pt":"flow","to":"Jenna","tot":"str"},{"t":"set","p":"occupancy_person","pt":"flow","to":"person.jenna","tot":"str"},{"t":"set","p":"occupancy_bayes","pt":"flow","to":"binary_sensor.jenna_home_bayesian","tot":"str"},{"t":"set","p":"occupancy_select","pt":"flow","to":"input_select.home_jenna","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2642,"y":600,"wires":[["2b2ab2fc631bb86f"]]},{"id":"d78603dff3757f05","type":"trigger-state","z":"97bc4677a5be4b40","d":true,"g":"0302ccd0beec3f7a","name":"Jenna Home/Away (Bayesian)?","server":"ebb6b83c7588d734","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.jenna_home_bayesian","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"home"}],"inputs":0,"outputs":2,"customoutputs":[],"outputinitially":true,"state_type":"str","enableInput":false,"x":2378,"y":564,"wires":[["8cef574918069f76"],["8cef574918069f76"]]},{"id":"f51cf7dfdfcdd1f4","type":"switch","z":"97bc4677a5be4b40","d":true,"g":"0302ccd0beec3f7a","name":"Bayes Home/Away?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":3260,"y":648,"wires":[["3d8750a1b1fde181"],["04af75d2e3d360a8"]]},{"id":"3d8750a1b1fde181","type":"api-call-service","z":"97bc4677a5be4b40","d":true,"g":"0302ccd0beec3f7a","name":"Set Input Select = Home","server":"ebb6b83c7588d734","version":5,"debugenabled":false,"domain":"input_select","service":"select_option","areaId":[],"deviceId":[],"entityId":["{{flow.occupancy_select}}"],"data":"{\"option\":\"Home\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":3670,"y":576,"wires":[["610835f6cdfa144b"]]},{"id":"04af75d2e3d360a8","type":"api-call-service","z":"97bc4677a5be4b40","d":true,"g":"0302ccd0beec3f7a","name":"Set Input Select = Away","server":"ebb6b83c7588d734","version":5,"debugenabled":false,"domain":"input_select","service":"select_option","areaId":[],"deviceId":[],"entityId":["{{flow.occupancy_select}}"],"data":"{\"option\":\"Away\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":3670,"y":624,"wires":[["c6a785de42e43883","610835f6cdfa144b"]]},{"id":"610835f6cdfa144b","type":"change","z":"97bc4677a5be4b40","d":true,"g":"0302ccd0beec3f7a","name":"Delete Flow Variables","rules":[{"t":"delete","p":"occupancy_name","pt":"flow"},{"t":"delete","p":"occupancy_person","pt":"flow"},{"t":"delete","p":"occupancy_bayes","pt":"flow"},{"t":"delete","p":"occupancy_select","pt":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":4093,"y":600,"wires":[[]]},{"id":"c6a785de42e43883","type":"function","z":"97bc4677a5be4b40","d":true,"g":"0302ccd0beec3f7a","name":"Set Notification Message","func":"var message = flow.get('occupancy_name') + \" Left Home\";\nglobal.set('notification_msg',message);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4099,"y":672,"wires":[["c53811a3ec5a9fc4"]]},{"id":"c53811a3ec5a9fc4","type":"link out","z":"97bc4677a5be4b40","d":true,"g":"0302ccd0beec3f7a","name":"Front Door Motion","links":["4e0fb3de.b1482c"],"x":4248,"y":672,"wires":[]},{"id":"57c4e58481d8aee1","type":"change","z":"97bc4677a5be4b40","d":true,"g":"0302ccd0beec3f7a","name":"James - Set Person's Vars","rules":[{"t":"set","p":"occupancy_name","pt":"flow","to":"James","tot":"str"},{"t":"set","p":"occupancy_person","pt":"flow","to":"person.james","tot":"str"},{"t":"set","p":"occupancy_bayes","pt":"flow","to":"binary_sensor.james_home_bayesian","tot":"str"},{"t":"set","p":"occupancy_select","pt":"flow","to":"input_select.home_james","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2656,"y":708,"wires":[["2b2ab2fc631bb86f"]]},{"id":"1a7318ac92f643a3","type":"trigger-state","z":"97bc4677a5be4b40","d":true,"g":"0302ccd0beec3f7a","name":"James Home/Away (Bayesian)?","server":"ebb6b83c7588d734","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.james_home_bayesian","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"home"}],"inputs":0,"outputs":2,"customoutputs":[],"outputinitially":true,"state_type":"str","enableInput":false,"x":2378,"y":684,"wires":[["57c4e58481d8aee1"],["57c4e58481d8aee1"]]},{"id":"2b2ab2fc631bb86f","type":"switch","z":"97bc4677a5be4b40","d":true,"g":"0302ccd0beec3f7a","name":"Person or Bayes Input?","property":"topic","propertyType":"msg","rules":[{"t":"cont","v":"person","vt":"str"},{"t":"cont","v":"binary_sensor","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":3026,"y":600,"wires":[["a70c4e016d57132f"],["f51cf7dfdfcdd1f4"]]},{"id":"a70c4e016d57132f","type":"switch","z":"97bc4677a5be4b40","d":true,"g":"0302ccd0beec3f7a","name":"Person Home/Away?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"home","vt":"str"},{"t":"eq","v":"not_home","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":3260,"y":552,"wires":[["3d8750a1b1fde181"],["04af75d2e3d360a8"]]},{"id":"7f518c2bf6bddd8f","type":"trigger-state","z":"97bc4677a5be4b40","d":true,"g":"0302ccd0beec3f7a","name":"Ryan Home/Away (Person)?","server":"ebb6b83c7588d734","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"person.ryan","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"home"}],"inputs":0,"outputs":2,"customoutputs":[],"outputinitially":true,"state_type":"str","enableInput":false,"x":2388,"y":516,"wires":[["7256681f884a3320"],["7256681f884a3320"]]},{"id":"8209cde1e3aeb21b","type":"trigger-state","z":"97bc4677a5be4b40","d":true,"g":"0302ccd0beec3f7a","name":"Jenna Home/Away (Person)?","server":"ebb6b83c7588d734","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"person.jenna","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"home"}],"inputs":0,"outputs":2,"customoutputs":[],"outputinitially":true,"state_type":"str","enableInput":false,"x":2388,"y":624,"wires":[["8cef574918069f76"],["8cef574918069f76"]]},{"id":"17db595b47be1fca","type":"trigger-state","z":"97bc4677a5be4b40","d":true,"g":"0302ccd0beec3f7a","name":"James Home/Away (Person)?","server":"ebb6b83c7588d734","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"person.james","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"home"}],"inputs":0,"outputs":2,"customoutputs":[],"outputinitially":true,"state_type":"str","enableInput":false,"x":2388,"y":732,"wires":[["57c4e58481d8aee1"],["57c4e58481d8aee1"]]},{"id":"dc401fa640fcac69","type":"comment","z":"97bc4677a5be4b40","d":true,"g":"0302ccd0beec3f7a","name":"Notes","info":"Any person or bayesian input can be used to trigger this flow.\n\nThe flow will check whether input was triggered by state change\nof either a person or bayesian entity then will set input_select\nto match input state change.\n\nThe second node needs to be manually updated with entity IDs\nassociated with the person. The same node can be used for\neither a person or bayesian input. ","x":2290,"y":420,"wires":[]},{"id":"a27bfcc13d0d4009","type":"link out","z":"97bc4677a5be4b40","g":"1f56a445b8709216","name":"Proximity - Delete Flow Vars","mode":"link","links":["a84b84effb8bfd77"],"x":1851,"y":432,"wires":[]},{"id":"3b270fb14e34eda4","type":"trigger-state","z":"97bc4677a5be4b40","g":"1f56a445b8709216","name":"Bayesian Home/Away Changed (Wildcard)","server":"ebb6b83c7588d734","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"_bayesian","entityidfiltertype":"substring","debugenabled":false,"constraints":[],"inputs":0,"outputs":2,"customoutputs":[],"outputinitially":true,"state_type":"str","enableInput":false,"x":220,"y":408,"wires":[["5cf184b3c6fcd670","53d29ed9e083a44c"],["5cf184b3c6fcd670","53d29ed9e083a44c"]]},{"id":"5cf184b3c6fcd670","type":"switch","z":"97bc4677a5be4b40","g":"1f56a445b8709216","name":"Person?","property":"topic","propertyType":"msg","rules":[{"t":"cont","v":"jenna","vt":"str"},{"t":"cont","v":"ryan","vt":"str"},{"t":"cont","v":"james","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":480,"y":456,"wires":[["c28ea0520a34e904"],["905fbd9b54ec1102"],["3839b37008da27ec"]]},{"id":"c28ea0520a34e904","type":"change","z":"97bc4677a5be4b40","g":"1f56a445b8709216","name":"Set Jenna Vars","rules":[{"t":"set","p":"occupancy_name","pt":"flow","to":"Jenna","tot":"str"},{"t":"set","p":"occupancy_person","pt":"flow","to":"person.jenna","tot":"str"},{"t":"set","p":"occupancy_bayes","pt":"flow","to":"binary_sensor.jenna_home_bayesian","tot":"str"},{"t":"set","p":"occupancy_select","pt":"flow","to":"input_select.home_jenna","tot":"str"},{"t":"set","p":"nr_proxomity_alert_manual_toggle","pt":"flow","to":"input_boolean.nr_proxomity_alert_manual_toggle_jenna","tot":"str"},{"t":"set","p":"nr_proximity_alert_enabled","pt":"flow","to":"counter.nr_proximity_alert_enabled_jenna","tot":"str"},{"t":"set","p":"nr_proximity_max_trip_distance","pt":"flow","to":"counter.nr_proximity_max_trip_distance_jenna","tot":"str"},{"t":"set","p":"nr_proximity_alert_enabled_yet_for_trip","pt":"flow","to":"counter.nr_proximity_alert_enabled_yet_for_trip_jenna","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":644,"y":420,"wires":[["4f399d9bd6edc8a7"]]},{"id":"905fbd9b54ec1102","type":"change","z":"97bc4677a5be4b40","g":"1f56a445b8709216","name":"Set Ryan Vars","rules":[{"t":"set","p":"occupancy_name","pt":"flow","to":"Ryan","tot":"str"},{"t":"set","p":"occupancy_person","pt":"flow","to":"person.ryan","tot":"str"},{"t":"set","p":"occupancy_bayes","pt":"flow","to":"binary_sensor.ryan_home_bayesian","tot":"str"},{"t":"set","p":"occupancy_select","pt":"flow","to":"input_select.home_ryan","tot":"str"},{"t":"set","p":"nr_proxomity_alert_manual_toggle","pt":"flow","to":"input_boolean.nr_proxomity_alert_manual_toggle_ryan","tot":"str"},{"t":"set","p":"nr_proximity_alert_enabled","pt":"flow","to":"counter.nr_proximity_alert_enabled_ryan","tot":"str"},{"t":"set","p":"nr_proximity_max_trip_distance","pt":"flow","to":"counter.nr_proximity_max_trip_distance_ryan","tot":"str"},{"t":"set","p":"nr_proximity_alert_enabled_yet_for_trip","pt":"flow","to":"counter.nr_proximity_alert_enabled_yet_for_trip_ryan","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":644,"y":456,"wires":[["4f399d9bd6edc8a7"]]},{"id":"3839b37008da27ec","type":"change","z":"97bc4677a5be4b40","g":"1f56a445b8709216","name":"Set James Vars","rules":[{"t":"set","p":"occupancy_name","pt":"flow","to":"James","tot":"str"},{"t":"set","p":"occupancy_person","pt":"flow","to":"person.james","tot":"str"},{"t":"set","p":"occupancy_bayes","pt":"flow","to":"binary_sensor.james_home_bayesian","tot":"str"},{"t":"set","p":"occupancy_select","pt":"flow","to":"input_select.home_james","tot":"str"},{"t":"set","p":"nr_proxomity_alert_manual_toggle","pt":"flow","to":"input_boolean.nr_proxomity_alert_manual_toggle_james","tot":"str"},{"t":"set","p":"nr_proximity_alert_enabled","pt":"flow","to":"counter.nr_proximity_alert_enabled_james","tot":"str"},{"t":"set","p":"nr_proximity_max_trip_distance","pt":"flow","to":"counter.nr_proximity_max_trip_distance_james","tot":"str"},{"t":"set","p":"nr_proximity_alert_enabled_yet_for_trip","pt":"flow","to":"counter.nr_proximity_alert_enabled_yet_for_trip_james","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":644,"y":492,"wires":[["4f399d9bd6edc8a7"]]},{"id":"c6fd27de92eb53b0","type":"trigger-state","z":"97bc4677a5be4b40","d":true,"g":"1f56a445b8709216","name":"Person Home/Away Changed (Wildcard)","server":"ebb6b83c7588d734","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"person.","entityidfiltertype":"substring","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is_not","comparatorValueDatatype":"prevEntity","comparatorValue":"state"}],"inputs":0,"outputs":2,"customoutputs":[],"outputinitially":true,"state_type":"str","enableInput":false,"x":220,"y":468,"wires":[["5cf184b3c6fcd670"],[]]},{"id":"1cf5b144d8e52b96","type":"server-state-changed","z":"97bc4677a5be4b40","d":true,"g":"1f56a445b8709216","name":"Person Home/Away Changed (Wildcard)","server":"ebb6b83c7588d734","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"person.","entityidfiltertype":"substring","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":220,"y":516,"wires":[["5cf184b3c6fcd670"]]},{"id":"3c895f7bc113caf3","type":"api-current-state","z":"97bc4677a5be4b40","g":"1f56a445b8709216","name":"Get Bayes Home/Away","server":"ebb6b83c7588d734","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.occupancy_bayes}}","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":1358,"y":384,"wires":[["90bd348f211d20ce"],[]]},{"id":"7ec72b75a63bba40","type":"api-current-state","z":"97bc4677a5be4b40","g":"1f56a445b8709216","name":"Get Person Home/Away","server":"ebb6b83c7588d734","version":3,"outputs":2,"halt_if":"home","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.occupancy_person}}","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":1358,"y":528,"wires":[[],["18bc8488babae791"]]},{"id":"732f215b87d90f0d","type":"function","z":"97bc4677a5be4b40","d":true,"g":"e4e333fc33cfc20f","name":"Set Notification Message","func":"var destination = flow.get('destination');\nvar personName = flow.get('occupancy_name');\nvar distNow = flow.get('prox_dist');\nvar distMax = flow.get('dist_max');\nvar tripLong = global.get('nr_proximity_long_trip_distance');\nvar tripShort = global.get('nr_proximity_alert_enabled_distance');\nvar percLong = global.get('nr_proximity_alert_send_return_perc_long');\nvar percShort = global.get('nr_proximity_alert_send_return_perc_short');\n\nvar notifyTitle = personName + \" left \" + destination;\nvar notifyMessage = personName + \" is \" + distNow + \"m from \" + destination + \".\\r\\nAlerting now enabled for return journey.\";\n\n// Add notification details to msg\nmsg['alert'] = {\n    send: 1,\n    title: notifyTitle,\n    message: notifyMessage\n}\n\n// Set global notification vars to pass to notification agents\nglobal.set('notification_title', notifyTitle);\nglobal.set('notification_msg', notifyMessage);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2042,"y":1176,"wires":[["b05c50d1067590a0"]]},{"id":"b05c50d1067590a0","type":"link out","z":"97bc4677a5be4b40","d":true,"g":"e4e333fc33cfc20f","name":"Front Door Motion","links":["4e0fb3de.b1482c"],"x":2173,"y":1176,"wires":[]},{"id":"53d29ed9e083a44c","type":"debug","z":"97bc4677a5be4b40","g":"1f56a445b8709216","name":"debug 61","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":296,"y":384,"wires":[]},{"id":"ed4fe02ba92d4d7f","type":"debug","z":"97bc4677a5be4b40","g":"1f56a445b8709216","name":"debug 62","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1644,"y":396,"wires":[]},{"id":"376eeea9b9cced1d","type":"debug","z":"97bc4677a5be4b40","g":"1f56a445b8709216","name":"debug 64","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1644,"y":528,"wires":[]},{"id":"e225e6bc.010ac8","type":"eztimer","z":"69e2d5c8.b334dc","g":"e5e5d7a4.fecf88","name":"OpenUV Update (01:00)","debug":false,"autoname":"01:00","tag":"eztimer","topic":"","suspended":false,"sendEventsOnSuspend":false,"latLongSource":"manual","latLongHaZone":"zone.home","lat":"55.8938","lon":"-3.6232","timerType":"2","startupMessage":false,"ontype":"2","ontimesun":"dawn","ontimetod":"01:00","onpropertytype":"msg","onproperty":"payload","onvaluetype":"num","onvalue":1,"onoffset":0,"onrandomoffset":0,"onsuppressrepeats":false,"offtype":"1","offtimesun":"dusk","offtimetod":"dusk","offduration":"00:01:00","offpropertytype":"msg","offproperty":"payload","offvaluetype":"num","offvalue":0,"offoffset":0,"offrandomoffset":0,"offsuppressrepeats":false,"resend":false,"resendInterval":"1m","mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"sun":true,"x":1573,"y":124.00000190734863,"wires":[["83ec43b63eb3a8b6"]]},{"id":"c93ce5d.ee55c18","type":"inject","z":"69e2d5c8.b334dc","g":"e5e5d7a4.fecf88","name":"Test","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1597,"y":64.00000190734863,"wires":[["83ec43b63eb3a8b6"]]},{"id":"845bfe9d.68801","type":"api-call-service","z":"69e2d5c8.b334dc","d":true,"g":"e5e5d7a4.fecf88","name":"OpenUV - Update UV Index","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"openuv","service":"update_uv_index_data","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1895,"y":304.00000190734863,"wires":[[]]},{"id":"375e185f.93e1b8","type":"api-call-service","z":"69e2d5c8.b334dc","d":true,"g":"e5e5d7a4.fecf88","name":"OpenUV - Update UV Protection","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"openuv","service":"update_protection_data","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1905,"y":268.00000190734863,"wires":[[]]},{"id":"5c07ae1a.93e0f","type":"eztimer","z":"69e2d5c8.b334dc","g":"e5e5d7a4.fecf88","name":"OpenUV Update (09:00)","debug":false,"autoname":"09:00","tag":"eztimer","suspended":false,"sendEventsOnSuspend":false,"lat":"55.8938","lon":"-3.6232","timerType":"2","startupMessage":false,"ontype":"2","ontimesun":"dawn","ontimetod":"09:00","onpropertytype":"msg","onproperty":"payload","onvaluetype":"num","onvalue":1,"onoffset":0,"onrandomoffset":0,"onsuppressrepeats":false,"offtype":"1","offtimesun":"dusk","offtimetod":"dusk","offduration":"00:01:00","offpropertytype":"msg","offproperty":"payload","offvaluetype":"num","offvalue":0,"offoffset":0,"offrandomoffset":0,"offsuppressrepeats":false,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"sun":true,"x":1573,"y":196.00000190734863,"wires":[["83ec43b63eb3a8b6"]]},{"id":"14b15e2e.4cc3e2","type":"eztimer","z":"69e2d5c8.b334dc","g":"e5e5d7a4.fecf88","name":"OpenUV Update (13:00)","debug":false,"autoname":"13:00","tag":"eztimer","suspended":false,"sendEventsOnSuspend":false,"lat":"55.8938","lon":"-3.6232","timerType":"2","startupMessage":false,"ontype":"2","ontimesun":"dawn","ontimetod":"13:00","onpropertytype":"msg","onproperty":"payload","onvaluetype":"num","onvalue":1,"onoffset":0,"onrandomoffset":0,"onsuppressrepeats":false,"offtype":"1","offtimesun":"dusk","offtimetod":"dusk","offduration":"00:01:00","offpropertytype":"msg","offproperty":"payload","offvaluetype":"num","offvalue":0,"offoffset":0,"offrandomoffset":0,"offsuppressrepeats":false,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"sun":true,"x":1573,"y":232.00000190734863,"wires":[["83ec43b63eb3a8b6"]]},{"id":"bc15abe9.8ae958","type":"eztimer","z":"69e2d5c8.b334dc","g":"e5e5d7a4.fecf88","name":"OpenUV Update (17:00)","debug":false,"autoname":"17:00","tag":"eztimer","suspended":false,"sendEventsOnSuspend":false,"lat":"55.8938","lon":"-3.6232","timerType":"2","startupMessage":false,"ontype":"2","ontimesun":"dawn","ontimetod":"17:00","onpropertytype":"msg","onproperty":"payload","onvaluetype":"num","onvalue":1,"onoffset":0,"onrandomoffset":0,"onsuppressrepeats":false,"offtype":"1","offtimesun":"dusk","offtimetod":"dusk","offduration":"00:01:00","offpropertytype":"msg","offproperty":"payload","offvaluetype":"num","offvalue":0,"offoffset":0,"offrandomoffset":0,"offsuppressrepeats":false,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"sun":true,"x":1573,"y":268.00000190734863,"wires":[["83ec43b63eb3a8b6"]]},{"id":"759dd5d6.40e67c","type":"eztimer","z":"69e2d5c8.b334dc","g":"e5e5d7a4.fecf88","name":"OpenUV Update (21:00)","debug":false,"autoname":"21:00","tag":"eztimer","suspended":false,"sendEventsOnSuspend":false,"lat":"55.8938","lon":"-3.6232","timerType":"2","startupMessage":false,"ontype":"2","ontimesun":"dawn","ontimetod":"21:00","onpropertytype":"msg","onproperty":"payload","onvaluetype":"num","onvalue":1,"onoffset":0,"onrandomoffset":0,"onsuppressrepeats":false,"offtype":"1","offtimesun":"dusk","offtimetod":"dusk","offduration":"00:01:00","offpropertytype":"msg","offproperty":"payload","offvaluetype":"num","offvalue":0,"offoffset":0,"offrandomoffset":0,"offsuppressrepeats":false,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"sun":true,"x":1573,"y":304.00000190734863,"wires":[["83ec43b63eb3a8b6"]]},{"id":"6898ce83.4afe5","type":"eztimer","z":"69e2d5c8.b334dc","g":"e5e5d7a4.fecf88","name":"OpenUV Update (05:00)","debug":false,"autoname":"05:00","tag":"eztimer","suspended":false,"sendEventsOnSuspend":false,"lat":"55.8938","lon":"-3.6232","timerType":"2","startupMessage":false,"ontype":"2","ontimesun":"dawn","ontimetod":"05:00","onpropertytype":"msg","onproperty":"payload","onvaluetype":"num","onvalue":1,"onoffset":0,"onrandomoffset":0,"onsuppressrepeats":false,"offtype":"1","offtimesun":"dusk","offtimetod":"dusk","offduration":"00:01:00","offpropertytype":"msg","offproperty":"payload","offvaluetype":"num","offvalue":0,"offoffset":0,"offrandomoffset":0,"offsuppressrepeats":false,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"sun":true,"x":1573,"y":160.00000190734863,"wires":[["83ec43b63eb3a8b6"]]},{"id":"648de0bc.c21ab","type":"alexa-remote-init","z":"69e2d5c8.b334dc","g":"a7dd80f9d2d8f91b","name":"","account":"c341166.e0c82e8","option":"refresh","x":487,"y":362,"wires":[["25966e44.6e3f92"]]},{"id":"60d267ce.f0f338","type":"inject","z":"69e2d5c8.b334dc","g":"a7dd80f9d2d8f91b","name":"Trigger","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":121,"y":362,"wires":[["756625f9a949aba1"]]},{"id":"25966e44.6e3f92","type":"debug","z":"69e2d5c8.b334dc","g":"a7dd80f9d2d8f91b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":685,"y":362,"wires":[]},{"id":"1a7ed2852edfb240","type":"mqtt in","z":"69e2d5c8.b334dc","g":"977b214a85453b89","name":"","topic":"shellies/shellyem-wholehousepower/#","qos":"2","datatype":"auto","broker":"e96cb00d.af953","nl":false,"rap":false,"inputs":0,"x":240,"y":766.9999961853027,"wires":[["d1bc57d7e22f0384","b4357a519b252cb5"]]},{"id":"7dba86c7dfd29057","type":"comment","z":"69e2d5c8.b334dc","g":"977b214a85453b89","name":"Shelly EM (see note)","info":"https://hazymat.co.uk/2020/12/shelly-em-power-monitoring-in-grafana-influx/\n\nShelly EM docs for MQTT here:\n\nhttps://shelly-api-docs.shelly.cloud/#shelly-em-overview\n\nThis flow assumes we have two current clamps connected. If we only have one, we'd need to just change the JOIN node to send the message after receiving 7 parts, not 14 parts.\n\n(The Shelly EM has 7 different electricity monitoring metrics per current clamp sensor)\n","x":140,"y":726.9999961853027,"wires":[]},{"id":"6725db69847308b8","type":"join","z":"69e2d5c8.b334dc","g":"977b214a85453b89","name":"Join messages","mode":"custom","build":"object","property":"payload","propertyType":"msg","key":"key","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"7","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"num","reduceFixup":"","x":560,"y":766.9999961853027,"wires":[["69daadaf9ffad366","c5bf5f1b80c29e79"]]},{"id":"d1bc57d7e22f0384","type":"function","z":"69e2d5c8.b334dc","g":"977b214a85453b89","name":"Prep message","func":"// This function preps msg.key, and converts the payload to a number.\n// example incoming MQTT path: shellies/my_shelly_em/emeter/0/energy\n\n// The below IF statement basically filters out the relay stuff which\n// would come in on a shorter path (see shelly docs)\nif (msg.topic.split(\"/\")[4] !== undefined) {\n    // combine the current clamp ID with the measurement name\n    // prepare msg.key for the JOIN node to follow \n    msg.key = msg.topic.split(\"/\")[3] + \"_\" + msg.topic.split(\"/\")[4]    \n    // convert measurement to number\n    msg.payload = Number(msg.payload)\n    return msg;\n}\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":419,"y":827.6667442321777,"wires":[["6725db69847308b8","fa54ebfe539e0bcf"]]},{"id":"69daadaf9ffad366","type":"change","z":"69e2d5c8.b334dc","g":"977b214a85453b89","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"my_shelly_em","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":757,"y":767.6667442321777,"wires":[["8670da64897802d9","615a1e5f685c61f2","9103294e2b823eb9"]]},{"id":"8670da64897802d9","type":"debug","z":"69e2d5c8.b334dc","g":"977b214a85453b89","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":800,"y":826.9999961853027,"wires":[]},{"id":"c5bf5f1b80c29e79","type":"debug","z":"69e2d5c8.b334dc","g":"977b214a85453b89","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":809,"y":707.6667442321777,"wires":[]},{"id":"fa54ebfe539e0bcf","type":"debug","z":"69e2d5c8.b334dc","g":"977b214a85453b89","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":617,"y":827.6667442321777,"wires":[]},{"id":"b4357a519b252cb5","type":"debug","z":"69e2d5c8.b334dc","g":"977b214a85453b89","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":461,"y":707.6667442321777,"wires":[]},{"id":"615a1e5f685c61f2","type":"influxdb out","z":"69e2d5c8.b334dc","d":true,"g":"977b214a85453b89","influxdb":"156cbaf37034f65b","name":"","measurement":"shellyem","precision":"","retentionPolicy":"","database":"","retentionPolicyV18Flux":"","org":"","bucket":"","x":1104,"y":766.9999961853027,"wires":[]},{"id":"9103294e2b823eb9","type":"influxdb out","z":"69e2d5c8.b334dc","g":"977b214a85453b89","influxdb":"27519cf66f268968","name":"","measurement":"shellyem","precision":"","retentionPolicy":"","database":"","retentionPolicyV18Flux":"","org":"","bucket":"","x":1124,"y":802.9999961853027,"wires":[]},{"id":"ee20aa94089fd0e2","type":"influxdb out","z":"69e2d5c8.b334dc","g":"3f0fa02f154cbeb4","influxdb":"27519cf66f268968","name":"","measurement":"layzspa","precision":"","retentionPolicy":"","database":"","retentionPolicyV18Flux":"","org":"","bucket":"","x":1129,"y":946.9999961853027,"wires":[]},{"id":"640d3dadea37e4b7","type":"function","z":"69e2d5c8.b334dc","g":"3f0fa02f154cbeb4","name":"Parse MQTT","func":"var tags;\nvar fields;\n\ntags = {\n}\n\nfields = {\n    temp: msg.payload[\"TMP\"],\n    target: msg.payload[\"TGT\"],\n    locked: msg.payload[\"LCK\"],\n    air: msg.payload[\"AIR\"],\n    celsius: msg.payload[\"UNT\"],\n    heating: msg.payload[\"RED\"],\n    heater: msg.payload[\"GRN\"] || msg.payload[\"RED\"],\n    filter: msg.payload[\"FLT\"],\n    power: msg.payload[\"PWR\"],\n    ch1: msg.payload[\"CH1\"],\n    ch2: msg.payload[\"CH2\"],\n    ch3: msg.payload[\"CH3\"],\n    brightness: msg.payload[\"BRT\"]\n    //jets: msg.payload[\"HJT\"],\n    //content: msg.payload[\"CONTENT\"],\n}\n\nmsg.payload = [\n    fields,\n    tags\n]\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":435,"y":910.9999961853027,"wires":[["ee20aa94089fd0e2","96d0bab40816e0bd","ea184274244d63b2"]]},{"id":"9b6da0f863f4e48b","type":"mqtt in","z":"69e2d5c8.b334dc","g":"3f0fa02f154cbeb4","name":"","topic":"layzspa/message","qos":"2","datatype":"json","broker":"e96cb00d.af953","nl":false,"rap":false,"inputs":0,"x":135,"y":910.9999961853027,"wires":[["640d3dadea37e4b7"]]},{"id":"96d0bab40816e0bd","type":"debug","z":"69e2d5c8.b334dc","g":"3f0fa02f154cbeb4","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":737,"y":994.9999961853027,"wires":[]},{"id":"ea184274244d63b2","type":"link out","z":"69e2d5c8.b334dc","d":true,"g":"3f0fa02f154cbeb4","name":"layzspa - Validate InfluxDB","mode":"link","links":["c6c65dc9c75e8add"],"x":802,"y":910.9999961853027,"wires":[]},{"id":"8380206b5f89a546","type":"function","z":"69e2d5c8.b334dc","g":"3f0fa02f154cbeb4","name":"Parse MQTT","func":"var tags;\nvar fields;\n\ntags = {\n}\n\nfields = {\n    time: msg.payload[\"TIME\"],\n    time_clorine: msg.payload[\"CLTIME\"],\n    time_filter: msg.payload[\"FTIME\"],\n    uptime: msg.payload[\"UPTIME\"],\n    time_pump: msg.payload[\"PUMPTIME\"],\n    time_heat: msg.payload[\"HEATINGTIME\"],\n    time_air: msg.payload[\"AIRTIME\"],\n    cost: msg.payload[\"COST\"],\n    interval_filter: msg.payload[\"FINT\"],\n    interval_chlorine: msg.payload[\"CLINT\"],\n    kwh: msg.payload[\"KWH\"],\n    tttt: msg.payload[\"TTTT\"]\n    //time_jet: msg.payload[\"JETTIME\"],\n    //content: msg.payload[\"CONTENT\"],\n    //minclk: msg.payload[\"MINCLK\"]\n}\n\nmsg.payload = [\n    fields,\n    tags\n]\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":435,"y":970.9999961853027,"wires":[["96d0bab40816e0bd","ee20aa94089fd0e2","ea184274244d63b2"]]},{"id":"85ad5afb7ba46aaf","type":"mqtt in","z":"69e2d5c8.b334dc","g":"3f0fa02f154cbeb4","name":"","topic":"layzspa/times","qos":"2","datatype":"json","broker":"e96cb00d.af953","nl":false,"rap":false,"inputs":0,"x":125,"y":970.9999961853027,"wires":[["8380206b5f89a546"]]},{"id":"15cc932cd5c3220d","type":"function","z":"69e2d5c8.b334dc","g":"3f0fa02f154cbeb4","name":"Parse MQTT","func":"var tags;\nvar fields;\n\ntags = {\n}\n\nfields = {\n    rssi: msg.payload[\"RSSI\"]\n    //content: msg.payload[\"CONTENT\"],\n    //mqtt: msg.payload[\"MQTT\"],\n    //button: msg.payload[\"PressedButton\"],\n    //hasjets: msg.payload[\"HASJETS\"],\n    //ip: msg.payload[\"IP\"],\n    //ssid: msg.payload[\"SSID\"],\n    //firmware: msg.payload[\"FW\"],\n    //model: msg.payload[\"MODEL\"]\n}\n\nmsg.payload = [\n    fields,\n    tags\n]\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":435,"y":1018.9999961853027,"wires":[["96d0bab40816e0bd","ee20aa94089fd0e2","ea184274244d63b2"]]},{"id":"fc1010f7d1156ea2","type":"mqtt in","z":"69e2d5c8.b334dc","g":"3f0fa02f154cbeb4","name":"","topic":"layzspa/other","qos":"2","datatype":"json","broker":"e96cb00d.af953","nl":false,"rap":false,"inputs":0,"x":125,"y":1018.9999961853027,"wires":[["15cc932cd5c3220d"]]},{"id":"dcbc4afe23f039d0","type":"alexa-remote-init","z":"69e2d5c8.b334dc","g":"a7dd80f9d2d8f91b","name":"","account":"c341166.e0c82e8","option":"initialise","x":465,"y":272.00000190734863,"wires":[["0defc3b0867f0a0d"]]},{"id":"373c550a9e3f2fc0","type":"inject","z":"69e2d5c8.b334dc","g":"a7dd80f9d2d8f91b","name":"Trigger","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":121,"y":272.00000190734863,"wires":[["b44474014d7eb730"]]},{"id":"0defc3b0867f0a0d","type":"debug","z":"69e2d5c8.b334dc","g":"a7dd80f9d2d8f91b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":683,"y":272.00000190734863,"wires":[]},{"id":"e4200f3622ec4f18","type":"inject","z":"69e2d5c8.b334dc","g":"a7dd80f9d2d8f91b","name":"Trigger","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":122,"y":455,"wires":[["38d94220e476059b"]]},{"id":"bbb134ad08e33b8c","type":"debug","z":"69e2d5c8.b334dc","g":"a7dd80f9d2d8f91b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":686,"y":503,"wires":[]},{"id":"9290f6a102e9a1dd","type":"alexa-remote-smarthome","z":"69e2d5c8.b334dc","g":"a7dd80f9d2d8f91b","name":"","account":"c341166.e0c82e8","config":{"option":"get","value":"devices"},"outputs":1,"x":486,"y":467,"wires":[["bbb134ad08e33b8c"]]},{"id":"f9a7c77fc84799a5","type":"alexa-remote-smarthome","z":"69e2d5c8.b334dc","g":"a7dd80f9d2d8f91b","name":"","account":"c341166.e0c82e8","config":{"option":"get","value":"entities"},"outputs":1,"x":486,"y":503,"wires":[["bbb134ad08e33b8c"]]},{"id":"2f9dbc6a6456df09","type":"alexa-remote-smarthome","z":"69e2d5c8.b334dc","g":"a7dd80f9d2d8f91b","name":"","account":"c341166.e0c82e8","config":{"option":"get","value":"groups"},"outputs":1,"x":486,"y":539,"wires":[["bbb134ad08e33b8c"]]},{"id":"3d34159007f4b5ac","type":"mqtt in","z":"69e2d5c8.b334dc","g":"3f0fa02f154cbeb4","name":"","topic":"layzspa/reboot_time","qos":"2","datatype":"auto","broker":"e96cb00d.af953","nl":false,"rap":false,"inputs":0,"x":141,"y":1066.9999961853027,"wires":[["a1eaabd8083b975b"]]},{"id":"a1eaabd8083b975b","type":"function","z":"69e2d5c8.b334dc","g":"3f0fa02f154cbeb4","name":"Parse MQTT","func":"var d = Date.parse(msg.payload);\n//node.warn('date: ' + d);\n\n//String representation of the Date for JSON\n//var strJSON = new Date(d).toJSON();\n//node.warn('JSON String Representation: ' + strJSON);\n\n//ISO Date Format\n//var iso = new Date(d).toISOString();\n//node.warn('ISO: ' + iso);\n\n//Date String\n//var strDate = new Date(d).toDateString();\n//node.warn('Date String: ' + strDate);\n\n//Date String with time\n//var strTstamp = new Date(d).toString();\n//node.warn('Timestamp String: ' + strTstamp);\n\n//UNIX time\nvar unixTime = new Date(d).getTime();\n\n// ************** DEBUG (must come before 'return') **************\nif (global.get('debug') == true) {\n    node.warn('Layzspa MQTT -> InfluxDB - Reboot Time - UNIX Timestamp: ' + unixTime);\n}\n// ****************************************************************\n\n//If your timezone is e.g. +11:00\n//var unixWithTZ = new Date(d).getTime() + (11*60*60*1000);\n//node.warn('UNIX Timestamp (timezone offset): ' + unixWithTZ);\n\nvar tags;\nvar fields;\n\ntags = {\n}\n\nfields = {\n    rebootdate: unixTime\n}\n\nmsg.payload = [\n    fields,\n    tags\n]\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":429,"y":1066.9999961853027,"wires":[["7008bb3b2d299d4e","ea184274244d63b2","ee20aa94089fd0e2"]]},{"id":"7008bb3b2d299d4e","type":"debug","z":"69e2d5c8.b334dc","g":"3f0fa02f154cbeb4","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":777,"y":1066.9999961853027,"wires":[]},{"id":"1829db51c724a407","type":"change","z":"69e2d5c8.b334dc","g":"ad33077998102cae","name":"","rules":[{"t":"set","p":"debug","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":472,"y":120,"wires":[["5feca0a08f9a7e2b"]]},{"id":"88e781c1c7e47aca","type":"inject","z":"69e2d5c8.b334dc","g":"ad33077998102cae","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":130,"y":108,"wires":[["1829db51c724a407"]]},{"id":"d1592b035b4e1cb9","type":"inject","z":"69e2d5c8.b334dc","g":"ad33077998102cae","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"false","payloadType":"bool","x":130,"y":156,"wires":[["1829db51c724a407"]]},{"id":"0311745f4dcce768","type":"comment","z":"69e2d5c8.b334dc","g":"ad33077998102cae","name":"Notes","info":"https://notenoughtech.com/home-automation/nodered-home-automation/nodered-for-beginners-7/\n\nSimilar to 'Global Controller' - have added a global variable to enable/disable debug messages.\nWhen outputting debug messages using node.warn we can check value of this variable to determine whether to parse code or not. \nSee Bin Notifocation for example but we can implement with:\n\nOld: \n    if ( global.debug = true ) {\n        node.warn(\"BINS - 1. Event Name: \" + bin_event_name );\n        node.warn(\"BINS - 1. Offset Reached: \" + bin_event_offset_reached );\n    };\n\n\nBelow should work better:\n    // ************** DEBUG (must come before 'returns') **************\n    if ( global.get('debug') == true ) {\n        node.warn(\"BINS - 1. Event Name: \" + bin_event_name );\n        node.warn(\"BINS - 1. Offset Reached: \" + bin_event_offset_reached );\n        node.warn(\"BINS - 1. Event Started: \" + bin_event_started );\n        node.warn(\"BINS - 1. Start DateTime: \" + bin_event_start_datetime );\n    }\n    // ****************************************************************","x":94,"y":60,"wires":[]},{"id":"5feca0a08f9a7e2b","type":"function","z":"69e2d5c8.b334dc","g":"ad33077998102cae","name":"Output var to debug","func":"node.warn(\"global.debug updated to: \" + global.get('debug') );\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":670,"y":120,"wires":[[]],"info":"Example of getting data from input msg and creating new payload with that data."},{"id":"1c7ff71e0adc97b4","type":"function","z":"69e2d5c8.b334dc","g":"ad33077998102cae","name":"Output var to debug","func":"node.warn(\"global.debug = \" + global.get('debug') );\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":650,"y":72,"wires":[[]],"info":"Example of getting data from input msg and creating new payload with that data."},{"id":"c06d9349f1336eb1","type":"inject","z":"69e2d5c8.b334dc","g":"ad33077998102cae","name":"Check Debug Var","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":408,"y":72,"wires":[["1c7ff71e0adc97b4"]]},{"id":"38d94220e476059b","type":"eztimer","z":"69e2d5c8.b334dc","g":"a7dd80f9d2d8f91b","name":"Refresh","debug":false,"autoname":"08:10","tag":"eztimer","topic":"","suspended":false,"sendEventsOnSuspend":false,"latLongSource":"manual","latLongHaZone":"zone.home","lat":"55.8938","lon":"-3.6232","timerType":"2","startupMessage":false,"ontype":"2","ontimesun":"dawn","ontimetod":"08:10","onpropertytype":"msg","onproperty":"payload","onvaluetype":"num","onvalue":1,"onoffset":0,"onrandomoffset":0,"onsuppressrepeats":false,"offtype":"1","offtimesun":"dusk","offtimetod":"dusk","offduration":"00:01:00","offpropertytype":"msg","offproperty":"payload","offvaluetype":"num","offvalue":0,"offoffset":0,"offrandomoffset":0,"offsuppressrepeats":false,"resend":false,"resendInterval":"1m","mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"sun":true,"x":176,"y":503,"wires":[["9290f6a102e9a1dd","f9a7c77fc84799a5","2f9dbc6a6456df09"]]},{"id":"756625f9a949aba1","type":"eztimer","z":"69e2d5c8.b334dc","g":"a7dd80f9d2d8f91b","name":"Refresh","debug":false,"autoname":"08:05","tag":"eztimer","topic":"","suspended":false,"sendEventsOnSuspend":false,"latLongSource":"manual","latLongHaZone":"zone.home","lat":"55.8938","lon":"-3.6232","timerType":"2","startupMessage":false,"ontype":"2","ontimesun":"dawn","ontimetod":"08:05","onpropertytype":"msg","onproperty":"payload","onvaluetype":"num","onvalue":1,"onoffset":0,"onrandomoffset":0,"onsuppressrepeats":false,"offtype":"1","offtimesun":"dusk","offtimetod":"dusk","offduration":"00:01:00","offpropertytype":"msg","offproperty":"payload","offvaluetype":"num","offvalue":0,"offoffset":0,"offrandomoffset":0,"offsuppressrepeats":false,"resend":false,"resendInterval":"1m","mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"sun":true,"x":279,"y":362,"wires":[["648de0bc.c21ab"]]},{"id":"b44474014d7eb730","type":"eztimer","z":"69e2d5c8.b334dc","g":"a7dd80f9d2d8f91b","name":"Refresh","debug":false,"autoname":"08:00","tag":"eztimer","topic":"","suspended":false,"sendEventsOnSuspend":false,"latLongSource":"manual","latLongHaZone":"zone.home","lat":"55.8938","lon":"-3.6232","timerType":"2","startupMessage":false,"ontype":"2","ontimesun":"dawn","ontimetod":"08:00","onpropertytype":"msg","onproperty":"payload","onvaluetype":"num","onvalue":1,"onoffset":0,"onrandomoffset":0,"onsuppressrepeats":false,"offtype":"1","offtimesun":"dusk","offtimetod":"dusk","offduration":"00:01:00","offpropertytype":"msg","offproperty":"payload","offvaluetype":"num","offvalue":0,"offoffset":0,"offrandomoffset":0,"offsuppressrepeats":false,"resend":false,"resendInterval":"1m","mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"sun":true,"x":279,"y":272.00000190734863,"wires":[["dcbc4afe23f039d0"]]},{"id":"555ebe58.31e22","type":"inject","z":"69e2d5c8.b334dc","d":true,"g":"f929982c.2b26f8","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":921.9999961853027,"y":241.0000057220459,"wires":[["b9457877.233668"]]},{"id":"d775baf6.2e1f88","type":"debug","z":"69e2d5c8.b334dc","d":true,"g":"f929982c.2b26f8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":1281.9999961853027,"y":241.0000057220459,"wires":[]},{"id":"b9457877.233668","type":"switch","z":"69e2d5c8.b334dc","d":true,"g":"f929982c.2b26f8","name":"GC Switch","property":"controller","propertyType":"global","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":1111.9999961853027,"y":241.0000057220459,"wires":[["d775baf6.2e1f88"]]},{"id":"593b894c.ee6258","type":"change","z":"69e2d5c8.b334dc","g":"465d4051.950e8","name":"","rules":[{"t":"set","p":"controller","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1281,"y":125.00000190734863,"wires":[[]]},{"id":"69bda2ee.4d0afc","type":"inject","z":"69e2d5c8.b334dc","g":"465d4051.950e8","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":929,"y":113.00000190734863,"wires":[["593b894c.ee6258"]]},{"id":"a31f5327.8fa26","type":"inject","z":"69e2d5c8.b334dc","g":"465d4051.950e8","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"false","payloadType":"bool","x":929,"y":161.00000190734863,"wires":[["593b894c.ee6258"]]},{"id":"85bc969e.b647b8","type":"comment","z":"69e2d5c8.b334dc","g":"465d4051.950e8","name":"Notes","info":"https://notenoughtech.com/home-automation/nodered-home-automation/nodered-for-beginners-7/\n\nAdd switch to any nodes you want to turn on/off and\nset it to only pass messages if global.controller is\ntrue.\n\nEasy way to switch on/off nodes.","x":893,"y":65.00000190734863,"wires":[]},{"id":"5b31d2fbb29001e9","type":"influxdb out","z":"69e2d5c8.b334dc","d":true,"g":"977b214a85453b89","influxdb":"9d9ad3f4.49ce7","name":"","measurement":"shellyem","precision":"","retentionPolicy":"","database":"","retentionPolicyV18Flux":"","org":"","bucket":"","x":1108,"y":718.9999961853027,"wires":[]},{"id":"83ec43b63eb3a8b6","type":"api-call-service","z":"69e2d5c8.b334dc","g":"e5e5d7a4.fecf88","name":"OpenUV - Update Entity","server":"ebb6b83c7588d734","version":5,"debugenabled":false,"domain":"homeassistant","service":"update_entity","areaId":[],"deviceId":[],"entityId":["sensor.current_uv_index"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1886,"y":192,"wires":[[]]},{"id":"143311e5.74610e","type":"api-call-service","z":"69e2d5c8.b334dc","d":true,"g":"e5e5d7a4.fecf88","name":"[DEPRECIATED SERVICE] OpenUV - Update ALL Data","server":"ebb6b83c7588d734","version":5,"debugenabled":false,"domain":"openuv","service":"update_data","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1986,"y":228,"wires":[[]]},{"id":"0c249ef1692e72bf","type":"function","z":"a28aa095.d828e","d":true,"g":"0d128617d83f618e","name":"Parse Input","func":"// Note the variables defined in flows which call this:\n    // Message\n    // global.get('notification_msg');\n\n    // Notification Service i.e. target device\n    // global.get('alexa_notify_service');\n\n    // (Optional) Notification Volume\n    // global.get('alexa_volume');\n    // (Optional) Volume Entity i.e. Entity ID for target device, for changing volume\n    // global.get('alexa_volume_entity');\n\n// We're going to use flow variables wherever possible to set values for\n// Call Service nodes etc - easier than trying to define and parse msg\n// contents.\n\n// NOTIFICATION VARIABLES\n// Already defined in global variables:\n//      notification_msg\n//      alexa_notify_service \nflow.set('alexa_notify_domain', \"notify\")\n\n// Send 1st output if volume is set\n// Send 2nd output if no volume i.e. just notification_msg\nif (global.get('alexa_volume') != undefined) {\n    // VOLUME SET VARIABLES\n    // Note: Volume Get only requires global var: alexa_volume_entity\n    // Already defined in global variables:\n    //      alexa_volume\n    //      alexa_volume_entity\n    flow.set('alexa_volume_domain', \"media_player\")\n    flow.set('alexa_volume_service', \"volume_set\")\n\n    // Send 1st output\n    return [msg, null]; \n\n} else {\n\n    // Send 2nd output\n    return [null,msg];\n}","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":395,"y":883,"wires":[[],[]]},{"id":"4e0fb3de.b1482c","type":"link in","z":"a28aa095.d828e","g":"042736150ac6c679","name":"Notify - Pushover","links":["d30da918.0f6e98","d9790745.64b708","fae436ad.73be38","b268ca11.161318","e971240a.705a08","a350b714.885898","824ff565.76f938","8c509b27.5bac28","57100253.c5a25c","700faff5.43c67","9bfd5366fa485550","27ae56a638e8e3fa","fc1b976c85c8a03d","dfcde47769d4c1a1","493d404f9de19bfc","5c3c6c427a6ea7bb","1abc6950ac49f7e5","aaecc501185966e0","6cd5e6cf82fb7a86","08066f334d4ab20c","2461ea03aebb8824","f42fd28b932916c1","a3d2e49ea41a6762","ece9fb0d40c2b0bc","3982544b5ec84c8a","80c105534476f45e","c53811a3ec5a9fc4","b05c50d1067590a0"],"x":143,"y":144,"wires":[["fc1b6e67.4aa12"]]},{"id":"fc1b6e67.4aa12","type":"function","z":"a28aa095.d828e","g":"042736150ac6c679","name":"Parse Notification Message","func":"msg.payload=global.get('notification_msg');\nmsg.topic=global.get('notification_title');\nmsg.sound=global.get('notification_sound');\nmsg.priority=global.get('notification_priority');\nmsg.url=global.get('notification_url');\nmsg.url_title=global.get('notification_url_title');\nmsg.image=global.get('notification_imgurl');\nmsg.device=global.get('notification_device');\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":332,"y":144,"wires":[["1889ad23.6e8d53","7211d541.a0a3dc","406cb03c.7944c"]]},{"id":"1889ad23.6e8d53","type":"debug","z":"a28aa095.d828e","g":"042736150ac6c679","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","x":454,"y":96,"wires":[]},{"id":"c2dc8bc2.91af38","type":"inject","z":"a28aa095.d828e","g":"042736150ac6c679","name":"Test Pushover","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":222,"y":204,"wires":[["ff831fc1.56908"]]},{"id":"7211d541.a0a3dc","type":"pushover api","z":"a28aa095.d828e","g":"042736150ac6c679","keys":"26350208.abcdbe","title":"Notify - Pushover","name":"","x":632,"y":108,"wires":[]},{"id":"ff831fc1.56908","type":"function","z":"a28aa095.d828e","g":"042736150ac6c679","name":"Set Notification Content","func":"var message=\"Pushover Test Message\";\nglobal.set('notification_msg',message);\n\nvar title=\"Test Title\";\nglobal.set('notification_title',title);\n\nvar sound=\"bike\";\nglobal.set('notification_sound',sound);\n\nvar priority=1;\nglobal.set('notification_priority',priority);\n\nvar url=\"https://ha.mc-guinness.co.uk/dev-service\";\nglobal.set('notification_url',url);\n\nvar url_title=\"Home Assistant - Call Service\";\nglobal.set('notification_url_title',url_title);\n\nvar imgurl=\"https://notenoughtech.com/wp-content/uploads/2018/06/custom-one-640x211.jpg\";\nglobal.set('notification_imgurl',imgurl);\n\nvar device=\"OnePlus8T\";\nglobal.set('notification_device',device);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":430,"y":204,"wires":[["d30da918.0f6e98"]]},{"id":"d30da918.0f6e98","type":"link out","z":"a28aa095.d828e","g":"042736150ac6c679","name":"Test - Pushover","links":["4e0fb3de.b1482c"],"x":587,"y":204,"wires":[]},{"id":"406cb03c.7944c","type":"change","z":"a28aa095.d828e","g":"042736150ac6c679","name":"Delete Vars","rules":[{"t":"delete","p":"notification_msg","pt":"global"},{"t":"delete","p":"notification_title","pt":"global"},{"t":"delete","p":"notification_sound","pt":"global"},{"t":"delete","p":"notification_priority","pt":"global"},{"t":"delete","p":"notification_url","pt":"global"},{"t":"delete","p":"notification_url_title","pt":"global"},{"t":"delete","p":"notification_imgurl","pt":"global"},{"t":"delete","p":"notification_device","pt":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":774,"y":144,"wires":[[]]},{"id":"940c86c.1c95078","type":"api-call-service","z":"a28aa095.d828e","g":"57ed8c098b8cac3f","name":"Notify - Persistent","server":"ebb6b83c7588d734","version":5,"debugenabled":false,"domain":"persistent_notification","service":"create","areaId":[],"deviceId":[],"entityId":[],"data":"{\"message\":\"{{payload}}\",\"title\":\"{{title}}\",\"notification_id\":\"{{notification_id}}\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1466,"y":144,"wires":[["7dc62.83a0739e8"]]},{"id":"7dc62.83a0739e8","type":"change","z":"a28aa095.d828e","g":"57ed8c098b8cac3f","name":"Delete Vars","rules":[{"t":"delete","p":"notification_msg","pt":"global"},{"t":"delete","p":"notification_title","pt":"global"},{"t":"delete","p":"notification_id","pt":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":1662,"y":144,"wires":[[]]},{"id":"d612569.2504ca8","type":"function","z":"a28aa095.d828e","g":"57ed8c098b8cac3f","name":"Parse Notification Message","func":"msg.payload=global.get('notification_msg');\nmsg.title=global.get('notification_title');\nmsg.notification_id=global.get('notification_id');\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1220,"y":144,"wires":[["5c700ee6.8cc56","940c86c.1c95078"]]},{"id":"23e5a679.ec2f2a","type":"link in","z":"a28aa095.d828e","g":"57ed8c098b8cac3f","name":"Notify - Persistent","links":["74e514ad.404f4c"],"x":1031,"y":144,"wires":[["d612569.2504ca8"]]},{"id":"5c700ee6.8cc56","type":"debug","z":"a28aa095.d828e","g":"57ed8c098b8cac3f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","x":1342,"y":96,"wires":[]},{"id":"7b94c2cc.15bf7c","type":"inject","z":"a28aa095.d828e","g":"57ed8c098b8cac3f","name":"Test Persistent","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1108,"y":204,"wires":[["592b5d1a.cdd014"]]},{"id":"592b5d1a.cdd014","type":"function","z":"a28aa095.d828e","g":"57ed8c098b8cac3f","name":"Set Notification Content","func":"var message=\"Persistent Test Message\";\nglobal.set('notification_msg',message);\n\nvar title=\"Test Node Red\";\nglobal.set('notification_title',title);\n\nvar notification_id=\"test_node_red\";\nglobal.set('notification_id',notification_id);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1318,"y":204,"wires":[["74e514ad.404f4c"]]},{"id":"74e514ad.404f4c","type":"link out","z":"a28aa095.d828e","g":"57ed8c098b8cac3f","name":"Test - Persistent","links":["23e5a679.ec2f2a"],"x":1463,"y":204,"wires":[]},{"id":"a8c64f4e.d5342","type":"pushbullet","z":"a28aa095.d828e","g":"ef7d6ad04984274b","config":"2d9e1c07.fe99b4","pushtype":"note","title":"","chan":"","name":"","x":642,"y":300,"wires":[]},{"id":"b4a7eb88.ff5078","type":"function","z":"a28aa095.d828e","g":"ef7d6ad04984274b","name":"Parse Notification Message","func":"msg.payload=global.get('notification_msg');\nmsg.topic=global.get('notification_title');\nreturn msg;","outputs":1,"noerr":0,"x":332,"y":336,"wires":[["a871bdf8.4acfe","4bec32a9.b41a9c","a8c64f4e.d5342"]]},{"id":"a871bdf8.4acfe","type":"debug","z":"a28aa095.d828e","g":"ef7d6ad04984274b","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","x":454,"y":288,"wires":[]},{"id":"600d3cfa.56bc44","type":"inject","z":"a28aa095.d828e","g":"ef7d6ad04984274b","name":"Test Pushbullet","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":232,"y":396,"wires":[["830f32ff.3fea4"]]},{"id":"830f32ff.3fea4","type":"function","z":"a28aa095.d828e","g":"ef7d6ad04984274b","name":"Set Notification Content","func":"var message=\"Pushbullet Test Message\";\nglobal.set('notification_msg',message);\n\nvar title=\"Test Pushbullet Title\";\nglobal.set('notification_title',title);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":430,"y":396,"wires":[["1c9f7475.aee34c"]]},{"id":"4bec32a9.b41a9c","type":"change","z":"a28aa095.d828e","g":"ef7d6ad04984274b","name":"Delete Vars","rules":[{"t":"delete","p":"notification_msg","pt":"global"},{"t":"delete","p":"notification_title","pt":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":774,"y":336,"wires":[[]]},{"id":"4c8aefb.3f4371","type":"link in","z":"a28aa095.d828e","g":"ef7d6ad04984274b","name":"Notify - Pushbullet","links":["1c9f7475.aee34c"],"x":143,"y":336,"wires":[["b4a7eb88.ff5078"]]},{"id":"1c9f7475.aee34c","type":"link out","z":"a28aa095.d828e","g":"ef7d6ad04984274b","name":"Test - Pushbullet","links":["4c8aefb.3f4371"],"x":587,"y":396,"wires":[]},{"id":"15809d0c.8af793","type":"change","z":"a28aa095.d828e","g":"2233ae63732529db","name":"Delete Vars","rules":[{"t":"delete","p":"notification_msg","pt":"global"},{"t":"delete","p":"notification_slackchannel","pt":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":774,"y":528,"wires":[[]]},{"id":"22e2aab5.889326","type":"function","z":"a28aa095.d828e","g":"2233ae63732529db","name":"Parse Notification Message","func":"var message = global.get('notification_msg');\nvar slackchannel = global.get('notification_slackchannel');\n\n\nmsg.topic = \"chat.postMessage\";\nmsg.payload = {\n    channel: slackchannel,\n    text: message,\n    username: \"Node Red\",  // Or use \"Node Red\" consistently\n    icon_emoji: \":computer:\" //:warning: :rotating_light:\n    //as_user: false,\n    //attachments: [],\n}\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":356,"y":528,"wires":[["a3539d65.622ed","b1b7d8e768a32a83"]]},{"id":"3333fe09.707012","type":"link in","z":"a28aa095.d828e","g":"2233ae63732529db","name":"Notify - Slack","links":["929d1a8.07eb8e8"],"x":167,"y":528,"wires":[["22e2aab5.889326"]]},{"id":"a3539d65.622ed","type":"debug","z":"a28aa095.d828e","g":"2233ae63732529db","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","x":478,"y":480,"wires":[]},{"id":"c9d856b3.a72328","type":"inject","z":"a28aa095.d828e","g":"2233ae63732529db","name":"Test Slack","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":224,"y":588,"wires":[["137960f4.d1c33f"]]},{"id":"137960f4.d1c33f","type":"function","z":"a28aa095.d828e","g":"2233ae63732529db","name":"Set Notification Content","func":"var message = \"Slack Test Message\";\nglobal.set('notification_msg', message);\n\nvar slackchannel = \"#alert\";\nglobal.set('notification_slackchannel', slackchannel);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":454,"y":588,"wires":[["929d1a8.07eb8e8"]]},{"id":"929d1a8.07eb8e8","type":"link out","z":"a28aa095.d828e","g":"2233ae63732529db","name":"Test - Slack","links":["3333fe09.707012"],"x":599,"y":588,"wires":[]},{"id":"82de70d4.0a2de","type":"api-call-service","z":"a28aa095.d828e","g":"b157c3bc1035f126","name":"Notify - HTML5","server":"ebb6b83c7588d734","version":5,"debugenabled":false,"domain":"notify","service":"html5_desktop","areaId":[],"deviceId":[],"entityId":[],"data":"{\"message\":\"{{payload}}\",\"title\":\"{{title}}\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1456,"y":336,"wires":[["a2367f6a.6cf3c"]]},{"id":"a2367f6a.6cf3c","type":"change","z":"a28aa095.d828e","g":"b157c3bc1035f126","name":"Delete Vars","rules":[{"t":"delete","p":"notification_msg","pt":"global"},{"t":"delete","p":"notification_title","pt":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":1662,"y":336,"wires":[[]]},{"id":"27e3a46.29cd05c","type":"function","z":"a28aa095.d828e","g":"b157c3bc1035f126","name":"Parse Notification Message","func":"msg.payload=global.get('notification_msg');\nmsg.title=global.get('notification_title');\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1220,"y":336,"wires":[["ff2acc95.c2ed9","82de70d4.0a2de"]]},{"id":"b7b5a030.43b4a","type":"link in","z":"a28aa095.d828e","g":"b157c3bc1035f126","name":"Notify - HTML5","links":["aa1c18c6.f389a8"],"x":1031,"y":336,"wires":[["27e3a46.29cd05c"]]},{"id":"ff2acc95.c2ed9","type":"debug","z":"a28aa095.d828e","g":"b157c3bc1035f126","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","x":1342,"y":288,"wires":[]},{"id":"27b69adf.2bed86","type":"inject","z":"a28aa095.d828e","g":"b157c3bc1035f126","name":"Test HTML5","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1098,"y":396,"wires":[["eee4346d.013888"]]},{"id":"eee4346d.013888","type":"function","z":"a28aa095.d828e","g":"b157c3bc1035f126","name":"Set Notification Content","func":"var message=\"HTML5 Test Message\";\nglobal.set('notification_msg',message);\n\nvar title=\"Test Node Red\";\nglobal.set('notification_title',title);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1318,"y":396,"wires":[["aa1c18c6.f389a8"]]},{"id":"aa1c18c6.f389a8","type":"link out","z":"a28aa095.d828e","g":"b157c3bc1035f126","name":"Test - HTML5","links":["b7b5a030.43b4a"],"x":1463,"y":396,"wires":[]},{"id":"e8eb2c56.b4e45","type":"api-call-service","z":"a28aa095.d828e","g":"053db0065adad6ce","name":"Notify - TV","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"notify","service":"living_room_tv_wired","areaId":[],"deviceId":[],"entityId":[],"data":"{\"message\":\"{{payload}}\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"payload","output_location_type":"none","x":1446,"y":528,"wires":[["411c1a67.f9eea4"]]},{"id":"411c1a67.f9eea4","type":"change","z":"a28aa095.d828e","g":"053db0065adad6ce","name":"Delete Vars","rules":[{"t":"delete","p":"notification_msg","pt":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":1662,"y":528,"wires":[[]]},{"id":"786cb5a3.bf423c","type":"function","z":"a28aa095.d828e","g":"053db0065adad6ce","name":"Parse Notification Message","func":"msg.payload=global.get('notification_msg');\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1220,"y":528,"wires":[["652dff14.97f94","e8eb2c56.b4e45"]]},{"id":"94bfaf5c.0978c","type":"link in","z":"a28aa095.d828e","g":"053db0065adad6ce","name":"Notify - TV","links":["8b4afc42.0e06f","af8dd88d.f0c3a8","3f50a1b2.7948fe","93080b75c3be85fb","4d88332deb83abcb"],"x":1031,"y":528,"wires":[["786cb5a3.bf423c"]]},{"id":"652dff14.97f94","type":"debug","z":"a28aa095.d828e","g":"053db0065adad6ce","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","x":1342,"y":480,"wires":[]},{"id":"8438feeb.d173e","type":"inject","z":"a28aa095.d828e","g":"053db0065adad6ce","name":"Test TV","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1078,"y":588,"wires":[["2fbeff9e.275e9"]]},{"id":"2fbeff9e.275e9","type":"function","z":"a28aa095.d828e","g":"053db0065adad6ce","name":"Set Notification Content","func":"var message=\"TV Test Message\";\nglobal.set('notification_msg',message);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1318,"y":588,"wires":[["8b4afc42.0e06f"]]},{"id":"8b4afc42.0e06f","type":"link out","z":"a28aa095.d828e","g":"053db0065adad6ce","name":"Test - TV","links":["94bfaf5c.0978c"],"x":1463,"y":588,"wires":[]},{"id":"55102448b3bba3a6","type":"http in","z":"a28aa095.d828e","g":"04d47dd5ca75ed46","name":"Webhook - Grafana Alert","url":"/webhook-grafana-alert","method":"post","upload":false,"swaggerDoc":"","x":242,"y":1488,"wires":[["125859ceaa09c6e9","1a6c23a189218b26","d4c6e8477a9f2a7d","3e22a6fb82eef673","26730536764a662c"]]},{"id":"125859ceaa09c6e9","type":"http response","z":"a28aa095.d828e","g":"04d47dd5ca75ed46","name":"Websocket Response","statusCode":"200","headers":{},"x":268,"y":1536,"wires":[]},{"id":"d4c6e8477a9f2a7d","type":"switch","z":"a28aa095.d828e","d":true,"g":"04d47dd5ca75ed46","name":"Parse Payload","property":"payload.state","propertyType":"msg","rules":[{"t":"eq","v":"docker-ram","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":592,"y":1524,"wires":[["2729d63a33d3b0c7","3e22a6fb82eef673","26730536764a662c"]]},{"id":"1a6c23a189218b26","type":"debug","z":"a28aa095.d828e","g":"04d47dd5ca75ed46","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":458,"y":1596,"wires":[]},{"id":"2729d63a33d3b0c7","type":"debug","z":"a28aa095.d828e","g":"04d47dd5ca75ed46","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":626,"y":1416,"wires":[]},{"id":"26730536764a662c","type":"wled2","z":"a28aa095.d828e","d":true,"g":"04d47dd5ca75ed46","address":"192.168.30.20","brightness":128,"delay":0,"color1":"#de7300","color2":"#ffffff","color3":"#ffffff","effect":"28","effectIntensity":128,"effectSpeed":128,"name":"Server Lights - Flash Red","palette":"2","preset":"2","state":"on","x":922,"y":1440,"wires":[["13474dc36e93314b"]]},{"id":"cdc4a2259d61f597","type":"inject","z":"a28aa095.d828e","g":"04d47dd5ca75ed46","name":"Test - Docker Container RAM Alert","props":[{"p":"payload.state","v":"docker-ram","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":320,"y":1404,"wires":[["d4c6e8477a9f2a7d"]]},{"id":"13474dc36e93314b","type":"debug","z":"a28aa095.d828e","g":"04d47dd5ca75ed46","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1154,"y":1416,"wires":[]},{"id":"be2ba35fb010bbc5","type":"comment","z":"a28aa095.d828e","g":"04d47dd5ca75ed46","name":"Example message from Grafana","info":"\n\n# OK Message\n\n{\n    \"_msgid\": \"187b4eba555f5905\",\n    \"payload\":\n    {\n        \"title\": \"[OK] Per Cont Mem Use > 10G [5 min avg] (Prometheus)\",\n        \"ruleId\": 26,\n        \"ruleName\": \"Per Cont Mem Use > 10G [5 min avg] (Prometheus)\",\n        \"state\": \"ok\",\n        \"evalMatches\":\n        [],\n        \"orgId\": 1,\n        \"dashboardId\": 2,\n        \"panelId\": 17,\n        \"tags\":\n        {},\n        \"ruleUrl\": \"http://localhost:3000/d/KSZhdSEmk/docker-containers?tab=alert&viewPanel=17&orgId=1\"\n    },\n    \"req\":\n    {\n        \"_readableState\":\n        {\n            \"objectMode\": false,\n            \"highWaterMark\": 16384,\n            \"buffer\":\n            {\n                \"head\": null,\n                \"tail\": null,\n                \"length\": 0\n            },\n            \"length\": 0,\n            \"pipes\":\n            [],\n            \"flowing\": true,\n            \"ended\": true,\n            \"endEmitted\": true,\n            \"reading\": false,\n            \"sync\": false,\n            \"needReadable\": false,\n            \"emittedReadable\": false,\n            \"readableListening\": false,\n            \"resumeScheduled\": false,\n            \"errorEmitted\": false,\n            \"emitClose\": true,\n            \"autoDestroy\": false,\n            \"destroyed\": false,\n            \"errored\": null,\n            \"closed\": false,\n            \"closeEmitted\": false,\n            \"defaultEncoding\": \"utf8\",\n            \"awaitDrainWriters\": null,\n            \"multiAwaitDrain\": false,\n            \"readingMore\": false,\n            \"dataEmitted\": true,\n            \"decoder\": null,\n            \"encoding\": null\n        },\n        \"_events\":\n        {},\n        \"_eventsCount\": 1,\n        \"socket\": \"[internal]\",\n        \"httpVersionMajor\": 1,\n        \"httpVersionMinor\": 1,\n        \"httpVersion\": \"1.1\",\n        \"complete\": true,\n        \"headers\":\n        {\n            \"host\": \"node-red.mc-guinness.co.uk\",\n            \"user-agent\": \"Grafana\",\n            \"content-length\": \"331\",\n            \"accept-encoding\": \"gzip\",\n            \"content-type\": \"application/json\",\n            \"x-forwarded-for\": \"192.168.91.1\",\n            \"x-forwarded-host\": \"node-red.mc-guinness.co.uk\",\n            \"x-forwarded-port\": \"443\",\n            \"x-forwarded-proto\": \"https\",\n            \"x-forwarded-server\": \"f7d83c03fdd1\",\n            \"x-real-ip\": \"192.168.91.1\"\n        },\n        \"rawHeaders\":\n        [\n            \"Host\",\n            \"node-red.mc-guinness.co.uk\",\n            \"User-Agent\",\n            \"Grafana\",\n            \"Content-Length\",\n            \"331\",\n            \"Accept-Encoding\",\n            \"gzip\",\n            \"Content-Type\",\n            \"application/json\",\n            \"X-Forwarded-For\",\n            \"192.168.91.1\",\n            \"X-Forwarded-Host\",\n            \"node-red.mc-guinness.co.uk\",\n            \"X-Forwarded-Port\",\n            \"443\",\n            \"X-Forwarded-Proto\",\n            \"https\",\n            \"X-Forwarded-Server\",\n            \"f7d83c03fdd1\",\n            \"X-Real-Ip\",\n            \"192.168.91.1\"\n        ],\n        \"trailers\":\n        {},\n        \"rawTrailers\":\n        [],\n        \"aborted\": false,\n        \"upgrade\": false,\n        \"url\": \"/webhook-grafana-alert\",\n        \"method\": \"POST\",\n        \"statusCode\": null,\n        \"statusMessage\": null,\n        \"client\": \"[internal]\",\n        \"_consuming\": true,\n        \"_dumped\": false,\n        \"baseUrl\": \"\",\n        \"originalUrl\": \"/webhook-grafana-alert\",\n        \"_parsedUrl\":\n        {\n            \"protocol\": null,\n            \"slashes\": null,\n            \"auth\": null,\n            \"host\": null,\n            \"port\": null,\n            \"hostname\": null,\n            \"hash\": null,\n            \"search\": null,\n            \"query\": null,\n            \"pathname\": \"/webhook-grafana-alert\",\n            \"path\": \"/webhook-grafana-alert\",\n            \"href\": \"/webhook-grafana-alert\",\n            \"_raw\": \"/webhook-grafana-alert\"\n        },\n        \"params\":\n        {},\n        \"query\":\n        {},\n        \"res\": \"[internal]\",\n        \"body\":\n        {\n            \"title\": \"[OK] Per Cont Mem Use > 10G [5 min avg] (Prometheus)\",\n            \"ruleId\": 26,\n            \"ruleName\": \"Per Cont Mem Use > 10G [5 min avg] (Prometheus)\",\n            \"state\": \"ok\",\n            \"evalMatches\":\n            [],\n            \"orgId\": 1,\n            \"dashboardId\": 2,\n            \"panelId\": 17,\n            \"tags\":\n            {},\n            \"ruleUrl\": \"http://localhost:3000/d/KSZhdSEmk/docker-containers?tab=alert&viewPanel=17&orgId=1\"\n        },\n        \"_body\": true,\n        \"route\":\n        {\n            \"path\": \"/webhook-grafana-alert\",\n            \"stack\":\n            [\n                {\n                    \"name\": \"cookieParser\",\n                    \"keys\":\n                    [],\n                    \"regexp\":\n                    {\n                        \"__enc__\": true,\n                        \"type\": \"regexp\",\n                        \"data\": \"/^\\\\/?$/i\"\n                    },\n                    \"method\": \"post\"\n                },\n                {\n                    \"name\": \"httpMiddleware\",\n                    \"keys\":\n                    [],\n                    \"regexp\":\n                    {\n                        \"__enc__\": true,\n                        \"type\": \"regexp\",\n                        \"data\": \"/^\\\\/?$/i\"\n                    },\n                    \"method\": \"post\"\n                },\n                {\n                    \"name\": \"corsHandler\",\n                    \"keys\":\n                    [],\n                    \"regexp\":\n                    {\n                        \"__enc__\": true,\n                        \"type\": \"regexp\",\n                        \"data\": \"/^\\\\/?$/i\"\n                    },\n                    \"method\": \"post\"\n                },\n                {\n                    \"name\": \"metricsHandler\",\n                    \"keys\":\n                    [],\n                    \"regexp\":\n                    {\n                        \"__enc__\": true,\n                        \"type\": \"regexp\",\n                        \"data\": \"/^\\\\/?$/i\"\n                    },\n                    \"method\": \"post\"\n                },\n                {\n                    \"name\": \"jsonParser\",\n                    \"keys\":\n                    [],\n                    \"regexp\":\n                    {\n                        \"__enc__\": true,\n                        \"type\": \"regexp\",\n                        \"data\": \"/^\\\\/?$/i\"\n                    },\n                    \"method\": \"post\"\n                },\n                {\n                    \"name\": \"urlencodedParser\",\n                    \"keys\":\n                    [],\n                    \"regexp\":\n                    {\n                        \"__enc__\": true,\n                        \"type\": \"regexp\",\n                        \"data\": \"/^\\\\/?$/i\"\n                    },\n                    \"method\": \"post\"\n                },\n                {\n                    \"name\": \"multipartParser\",\n                    \"keys\":\n                    [],\n                    \"regexp\":\n                    {\n                        \"__enc__\": true,\n                        \"type\": \"regexp\",\n                        \"data\": \"/^\\\\/?$/i\"\n                    },\n                    \"method\": \"post\"\n                },\n                {\n                    \"name\": \"rawBodyParser\",\n                    \"keys\":\n                    [],\n                    \"regexp\":\n                    {\n                        \"__enc__\": true,\n                        \"type\": \"regexp\",\n                        \"data\": \"/^\\\\/?$/i\"\n                    },\n                    \"method\": \"post\"\n                },\n                {\n                    \"name\": \"<anonymous>\",\n                    \"keys\":\n                    [],\n                    \"regexp\":\n                    {\n                        \"__enc__\": true,\n                        \"type\": \"regexp\",\n                        \"data\": \"/^\\\\/?$/i\"\n                    },\n                    \"method\": \"post\"\n                },\n                {\n                    \"name\": \"<anonymous>\",\n                    \"keys\":\n                    [],\n                    \"regexp\":\n                    {\n                        \"__enc__\": true,\n                        \"type\": \"regexp\",\n                        \"data\": \"/^\\\\/?$/i\"\n                    },\n                    \"method\": \"post\"\n                }\n            ],\n            \"methods\":\n            {\n                \"post\": true\n            }\n        },\n        \"cookies\":\n        {},\n        \"signedCookies\":\n        {}\n    },\n    \"res\":\n    {}\n}","x":800,"y":1596,"wires":[]},{"id":"18967f36.2d9bd1","type":"server-state-changed","z":"a28aa095.d828e","g":"82fdf5de.96f998","name":"Front Door Motion","server":"ebb6b83c7588d734","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.front_door_motion","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":282,"y":1140,"wires":[["2d6df248.71cfde"],[]]},{"id":"99b10cb.902e4f","type":"inject","z":"a28aa095.d828e","g":"82fdf5de.96f998","name":"Test","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":202,"y":1190,"wires":[["2d6df248.71cfde"]]},{"id":"7c46fe2d.5ed01","type":"server-state-changed","z":"a28aa095.d828e","g":"82fdf5de.96f998","name":"Front Door Ring","server":"ebb6b83c7588d734","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.front_door_ding","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":262,"y":1240,"wires":[["66994a05.9c2e14"],[]]},{"id":"9a8e4ac9.573f78","type":"inject","z":"a28aa095.d828e","g":"82fdf5de.96f998","name":"Test","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":202,"y":1290,"wires":[["66994a05.9c2e14"]]},{"id":"2d6df248.71cfde","type":"function","z":"a28aa095.d828e","g":"82fdf5de.96f998","name":"Set Notification Message","func":"var message=\"Bleep Bloop - Movement at the front door.\";\nglobal.set('notification_msg',message);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":562,"y":1140,"wires":[["e3404b60.a64198"]]},{"id":"e3404b60.a64198","type":"link out","z":"a28aa095.d828e","d":true,"g":"82fdf5de.96f998","name":"Front Door Motion","mode":"link","links":["4524a21d2bb88f0f","7b43ab144b55aa86","8e76bef055b3bd8c"],"x":718,"y":1139,"wires":[]},{"id":"66994a05.9c2e14","type":"function","z":"a28aa095.d828e","g":"82fdf5de.96f998","name":"Set Notification Message","func":"var message=\"Ding Dong - Doorbell ringing.\";\nglobal.set('notification_msg',message);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":562,"y":1240,"wires":[["af8dd88d.f0c3a8"]]},{"id":"af8dd88d.f0c3a8","type":"link out","z":"a28aa095.d828e","d":true,"g":"82fdf5de.96f998","name":"Front Door Ring","mode":"link","links":["8b3c03bf.d143f","94bfaf5c.0978c","c5daa35.4dd9a6"],"x":718,"y":1240,"wires":[]},{"id":"3e22a6fb82eef673","type":"change","z":"a28aa095.d828e","g":"04d47dd5ca75ed46","name":"Set WLED device & preset","rules":[{"t":"set","p":"topic","pt":"msg","to":"wled/server/api","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"PL=2","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":936,"y":1488,"wires":[["2713a023b8c8d47c","13474dc36e93314b"]]},{"id":"2713a023b8c8d47c","type":"mqtt out","z":"a28aa095.d828e","g":"04d47dd5ca75ed46","name":"","topic":"","qos":"2","retain":"true","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"e96cb00d.af953","x":1138,"y":1488,"wires":[]},{"id":"5fb56e70079c92d8","type":"slack-rtm-in","z":"a28aa095.d828e","d":true,"g":"e5643e5e5290ee60","client":"4a2333f3b1c1ed2b","name":"Slack Monitor","events":"","x":226,"y":672,"wires":[["58123ee08d25cfee"]]},{"id":"d753c9702bf34c4d","type":"debug","z":"a28aa095.d828e","g":"e5643e5e5290ee60","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","x":538,"y":672,"wires":[]},{"id":"58123ee08d25cfee","type":"function","z":"a28aa095.d828e","d":true,"g":"e5643e5e5290ee60","name":"Filter Input","func":"// // https://medium.com/segmentx/writing-a-simple-slack-bot-using-node-red-fast-6bb131af4ea1\n// \n// // Filter the input received (input is in the form of events which are listened\n// // to by our bot) so that we only receive the message another user has sent to\n// // us either in our DM or a channel to which our bot is added.\n// \n// // ignore anything but messages\n// if (msg.payload.type != \"message\") {\n//     return null;\n// }\n// // ignore deleted messages\n// if (msg.payload.subtype == \"message_deleted\") {\n//     return null;\n// }\n// // ignore me_message\n// if (msg.payload.subtype == \"me_message\") {\n//     return null;\n// }\n// // ignore bot_message\n// if (msg.payload.subtype == \"bot_message\") {\n//     return null;\n// }\n// msg.user = {\n//     id: msg.payload.user,\n//     name: msg.payload.userObject.name\n// }\n// msg.text = msg.payload.text\n// msg.channel = msg.payload.channel\n// return msg;\n\n\n// Only view bot messages - i.e. confirm that what we have sent has arrived in slack\n\n// ignore anything but messages\nif (msg.payload.type != \"message\") {\n    return null;\n}\n// ignore all but bot messages\nif (msg.payload.subtype != \"bot_message\") {\n    return null;\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":386,"y":672,"wires":[["d753c9702bf34c4d"]]},{"id":"b1b7d8e768a32a83","type":"slack-web-out","z":"a28aa095.d828e","g":"2233ae63732529db","client":"4a2333f3b1c1ed2b","name":"Notify - Slack","x":594,"y":528,"wires":[["15809d0c.8af793"]]},{"id":"fadd5dc415e2cae2","type":"api-call-service","z":"a28aa095.d828e","g":"0d128617d83f618e","name":"Notify - Alexa TTS","server":"ebb6b83c7588d734","version":5,"debugenabled":false,"domain":"{{flow.alexa_notify_domain}}","service":"{{global.alexa_notify_service}}","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1122,"y":900,"wires":[["405ffb1980f139a1"]]},{"id":"09c999560841044b","type":"change","z":"a28aa095.d828e","g":"0d128617d83f618e","name":"Delete Vars","rules":[{"t":"delete","p":"notification_msg","pt":"global"},{"t":"delete","p":"alexa_notify_service","pt":"global"},{"t":"delete","p":"alexa_volume","pt":"global"},{"t":"delete","p":"alexa_volume_entity","pt":"global"},{"t":"delete","p":"alexa_volume_domain","pt":"flow"},{"t":"delete","p":"alexa_volume_service","pt":"flow"},{"t":"delete","p":"alexa_notify_domain","pt":"flow"},{"t":"delete","p":"alexa_volume_before","pt":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":1754,"y":900,"wires":[[]]},{"id":"7b43ab144b55aa86","type":"link in","z":"a28aa095.d828e","g":"0d128617d83f618e","name":"Notify - Alexa TTS","links":["1ea0d2d7ac9e8eb6","27368ddbc7128c62","e3404b60.a64198"],"x":141,"y":900,"wires":[["5b2e505106cf3b28"]]},{"id":"3ac311dba53ad4df","type":"inject","z":"a28aa095.d828e","g":"0d128617d83f618e","name":"Test Alexa TTS - Volume","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":266,"y":984,"wires":[["6e24879643db0a56"]]},{"id":"6e24879643db0a56","type":"function","z":"a28aa095.d828e","g":"0d128617d83f618e","name":"Set Notification Content","func":"// Define message\nglobal.set('notification_msg', \"Alexa Test Message\");\n\n// Define target alexa - search for specific service names by looking in Cal\n// Service node under 'service' list after selecting 'notify' for Domain.\n// Or look in HA -> Developer -> Services\nglobal.set('alexa_notify_service', \"alexa_media_kitchen\");\n\n// v1 Echo devices can't have vol changed\nglobal.set('alexa_volume', \"0.6\");\n// Only need to set entity ID if vol change being requested\nglobal.set('alexa_volume_entity', \"media_player.kitchen\");\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":530,"y":984,"wires":[["27368ddbc7128c62"]]},{"id":"27368ddbc7128c62","type":"link out","z":"a28aa095.d828e","g":"0d128617d83f618e","name":"Test - HTML5","links":["7b43ab144b55aa86"],"x":711,"y":984,"wires":[]},{"id":"433fcb33c1a756bb","type":"api-call-service","z":"a28aa095.d828e","g":"0d128617d83f618e","name":"Change Vol","server":"ebb6b83c7588d734","version":5,"debugenabled":false,"domain":"{{flow.alexa_volume_domain}}","service":"{{flow.alexa_volume_service}}","areaId":[],"deviceId":[],"entityId":["{{global.alexa_volume_entity}}"],"data":"{\"volume_level\": {{global.alexa_volume}} }","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":994,"y":804,"wires":[["0743bf7674938db4"]]},{"id":"c20fb349462e4a9b","type":"api-current-state","z":"a28aa095.d828e","g":"0d128617d83f618e","name":"Get Current Vol","server":"ebb6b83c7588d734","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{global.alexa_volume_entity}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"entitydata_before","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":616,"y":804,"wires":[["7b166708acd5a635"]]},{"id":"ce535e13533769a9","type":"inject","z":"a28aa095.d828e","g":"0d128617d83f618e","name":"Clear Variables","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1576,"y":960,"wires":[["09c999560841044b"]]},{"id":"4ef77e0bd7f47552","type":"inject","z":"a28aa095.d828e","g":"0d128617d83f618e","name":"Test Alexa TTS - No Volume","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":276,"y":1032,"wires":[["60d85e3440e07857"]]},{"id":"1ea0d2d7ac9e8eb6","type":"link out","z":"a28aa095.d828e","g":"0d128617d83f618e","name":"Test - Alexa TTS","mode":"link","links":["7b43ab144b55aa86"],"x":711,"y":1032,"wires":[]},{"id":"405ffb1980f139a1","type":"switch","z":"a28aa095.d828e","g":"0d128617d83f618e","name":"Vol Reset?","property":"alexa_volume","propertyType":"global","rules":[{"t":"nempty"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1330,"y":900,"wires":[["935459cbef2ff4a9"],["09c999560841044b"]]},{"id":"60d85e3440e07857","type":"function","z":"a28aa095.d828e","g":"0d128617d83f618e","name":"Set Notification Content","func":"// Define message\nglobal.set('notification_msg', \"Alexa Test Message\");\n\n// Define target alexa - search for specific service names by looking in Cal\n// Service node under 'service' list after selecting 'notify' for Domain.\n// Or look in HA -> Developer -> Services\nglobal.set('alexa_notify_service', \"alexa_media_study\");\n\n// v1 Echo devices can't have vol changed\n//global.set('alexa_volume', \"0.6\");\n// Only need to set entity ID if vol change being requested\n//global.set('alexa_volume_entity', \"media_player.kitchen\");\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":534,"y":1032,"wires":[["1ea0d2d7ac9e8eb6"]]},{"id":"0625f2374df68dda","type":"switch","z":"a28aa095.d828e","g":"0d128617d83f618e","name":"Vol Change Requested?","property":"alexa_volume","propertyType":"global","rules":[{"t":"nempty"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":514,"y":900,"wires":[["081e7374c1ee871f"],["0743bf7674938db4"]]},{"id":"081e7374c1ee871f","type":"change","z":"a28aa095.d828e","g":"0d128617d83f618e","name":"Set Flow Vars - Volume","rules":[{"t":"set","p":"alexa_volume_domain","pt":"flow","to":"media_player","tot":"str"},{"t":"set","p":"alexa_volume_service","pt":"flow","to":"volume_set","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":406,"y":804,"wires":[["c20fb349462e4a9b"]]},{"id":"5b2e505106cf3b28","type":"change","z":"a28aa095.d828e","g":"0d128617d83f618e","name":"Set Flow Vars - Notify","rules":[{"t":"set","p":"alexa_notify_domain","pt":"flow","to":"notify","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":280,"y":900,"wires":[["0625f2374df68dda"]]},{"id":"0743bf7674938db4","type":"function","z":"a28aa095.d828e","g":"0d128617d83f618e","name":"Prep Notify Service Call","func":"// Have to set payload in function since Call Service is not\n// properly accepting template input for data:\n// i.e. {\"message\": {{global.notification_msg}}, \"data\": { \"type\": \"tts\" } }\n// Works in Set Volume node so not sure why it wouldn't in Notify node\n\n\nvar msg = {\n    payload: {\n        \"domain\": flow.get('alexa_notify_domain'),\n        \"service\": global.get('alexa_notify_service'),\n        \"data\": {\n            \"message\": global.get('notification_msg'),\n            \"data\": {\n                \"type\": \"tts\"\n            }\n        }\n    }\n}\n\n// Return message\nreturn msg;\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":898,"y":900,"wires":[["fadd5dc415e2cae2"]]},{"id":"935459cbef2ff4a9","type":"change","z":"a28aa095.d828e","g":"0d128617d83f618e","name":"Delete Notify Payload","rules":[{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1448,"y":804,"wires":[["7f6d4d73dd7e0d84"]]},{"id":"7b166708acd5a635","type":"change","z":"a28aa095.d828e","g":"0d128617d83f618e","name":"Save 'Before' Vol","rules":[{"t":"set","p":"alexa_volume_before","pt":"flow","to":"entitydata_before.attributes.volume_level","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":810,"y":804,"wires":[["433fcb33c1a756bb"]]},{"id":"7f6d4d73dd7e0d84","type":"api-call-service","z":"a28aa095.d828e","g":"0d128617d83f618e","name":"Reset Vol","server":"ebb6b83c7588d734","version":5,"debugenabled":false,"domain":"{{flow.alexa_volume_domain}}","service":"{{flow.alexa_volume_service}}","areaId":[],"deviceId":[],"entityId":["{{global.alexa_volume_entity}}"],"data":"{\"volume_level\": {{flow.alexa_volume_before}} }","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1644,"y":804,"wires":[["09c999560841044b"]]},{"id":"fa214ee.90f1cb","type":"api-call-service","z":"bb37110c.14f0d","g":"dea433c.4083fd","name":"Log in HA Logbook","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"logbook","service":"log","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1074,"y":144,"wires":[[]]},{"id":"785fd6f4.b6a028","type":"function","z":"bb37110c.14f0d","g":"dea433c.4083fd","name":"Get data from msg and create new payload","func":"msg.payload = {\n    data: {\n        \"name\":\"Node Red Test Log\",\n        \"message\":\"Brightness is \" + msg.data.attributes.brightness,\n        \"entity_id\":msg.data.entity_id\n    }\n};\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":746,"y":132,"wires":[["fa214ee.90f1cb"]],"info":"Example of getting data from input msg and creating new payload with that data."},{"id":"32f9348a.d6a1ac","type":"inject","z":"bb37110c.14f0d","g":"dea433c.4083fd","name":"TRIGGER","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":144,"y":108,"wires":[["16a4a4b8.ee228b"]]},{"id":"16a4a4b8.ee228b","type":"api-current-state","z":"bb37110c.14f0d","g":"dea433c.4083fd","name":"Get entity state - Office Light","server":"3b49c004.6176a","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.z2m_ikea_rgb_study","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":396,"y":120,"wires":[["785fd6f4.b6a028"]]},{"id":"a1fea83f.847648","type":"function","z":"bb37110c.14f0d","g":"ee1609dc.862078","name":"output to debug ","func":"node.warn(\"your_payload=\"+msg.payload);\nnode.warn(\"your_topic=\"+msg.topic);\n\n// Or use parseFloat(var) or parseInt(var,10)\nnode.warn(\"some maths: \"+ (+msg.data.numberone + +msg.data.numbertwo));\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":320,"y":480,"wires":[["5e308fde.5b242"]]},{"id":"5e308fde.5b242","type":"debug","z":"bb37110c.14f0d","g":"ee1609dc.862078","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":526,"y":480,"wires":[]},{"id":"5e1c9d44.476e04","type":"inject","z":"bb37110c.14f0d","g":"ee1609dc.862078","name":"Trigger","props":[{"p":"payload"},{"p":"topic","vt":"str"},{"p":"msg.data.numberone","v":"100","vt":"num"},{"p":"msg.data.numbertwo","v":"50","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"something awesome","payload":"","payloadType":"date","x":134,"y":480,"wires":[["a1fea83f.847648"]]},{"id":"78f7c893.628148","type":"function","z":"bb37110c.14f0d","g":"f4e4b003.22427","name":"unset vars","func":"global.unset(\"jenna_towards_dist_edge\");\nglobal.unset(\"jenna_towards_dist_new\");\nglobal.unset(\"ryan_towards_dist_edge\");\nglobal.unset(\"ryan_towards_dist_new\");\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":310,"y":600,"wires":[["63bc915.4bb357"]]},{"id":"63bc915.4bb357","type":"debug","z":"bb37110c.14f0d","g":"f4e4b003.22427","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":526,"y":600,"wires":[]},{"id":"30dbb49c.fe393c","type":"inject","z":"bb37110c.14f0d","g":"f4e4b003.22427","name":"Trigger","props":[{"p":"payload"},{"p":"topic","vt":"str"},{"p":"msg.data.numberone","v":"100","vt":"num"},{"p":"msg.data.numbertwo","v":"50","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"something awesome","payload":"","payloadType":"date","x":134,"y":600,"wires":[["78f7c893.628148"]]},{"id":"3786141a.65c15c","type":"comment","z":"bb37110c.14f0d","name":"Javascript notes / examples","info":"===================================================\nIF/Else/ElseIf\n===================================================\nif (x > 50) {\n  /* do something */\n} else if (x > 5) {\n  /* do something */\n} else {\n  /* do something */\n}\n\n\n\n===================================================\n= / == / ===\n===================================================\n\n - Equal to (=) is an assignment operator, which sets the variable on the left of the = to the value of the expression that is on its right. \n - Double equals (==) is a comparison operator, which transforms the operands having the same type before comparison.\n - === (Triple equals) is a strict equality comparison operator in JavaScript, which returns false for the values which are not of a similar type. This operator performs type casting for equality. If we compare 2 with \"2\" using ===, then it will return a false value.\n \n\n\n===================================================\nDates & Times\n - https://stevesnoderedguide.com/working-with-time\n - https://www.digitalocean.com/community/tutorials/understanding-date-and-time-in-javascript\n - https://flaviocopes.com/javascript-dates/\n===================================================\nUniversal Time (UTC) and Greenwich Mean Time (GMT) are the same thing, and time is store in the Date object in UTC.\n\nCreate new date variables:\n    var d=new Date();    // var set to date/time now\n    var date = new Date('September 22, 2018 13:22:13')    //using string\n    var d=new Date(timestamp);    //using unix timestamp\n    \nInterval between dates:\n    var difference =end_time-start_time;\n    if(time1<=time2) {}\n\nAdjust dates\n    var date=new Date();    // var set to date/time now\n    date.setHours(newValue);    // Change hour value of date\n\n    Add 1 hr to current time - doesn't work for crossing midnight:\n        var date=new Date();\n        var hour =date.getHours();\n        hour=hour+1;\n        date.setHours(hour);\n    \n    Add 1 hr to current time - works fine for crossing midnight:\n        var date=new Date();\n        var timestamp =date.getTime();\n        timestamp=timestamp+(3600*1000); //1hour in milliseconds\n\nFormat date/time for display:\n    var d=new Date();\n    var day=d.getDate()  //day as a number 0 -31\n    var weekday=d.getDay()  //-weekday as a number  0-6\n    var month=d.getMonth() // month as a number 0-11\n    var year=d.getFullYear() //year as a four digit number (yyyy)\n    var hours=d.getHours() //the hour (0-23)\n    var minutes=d.getMinutes() //-the minute (0-59)\n    var seconds=d.getSeconds() //-the seconds (0-59)\n    \n    var months={1:\"January\",2:\"February\",3:\"March\",4:\"April\",5:\"May\",6:\"June\",7:\"July\",8:\"August\",9:\"September\",10:\"October\",11:\"November\",12:\"December\"};\n    var month=d.getMonth();\n    var month_name=months[month];\n\n    Format times for display:\n    var d=new Date();\n    var day=d.getDate();\n    var month=d.getMonth();\n    var year=d.getFullYear();\n    if(day<=9)\n    day=\"0\"+day;\n    if(month<=9)\n    month=\"0\"+month;\n    var date_out= day+\"/\"+month+\"/\"+year;\n\n\n    Convert unix timestamp to HH:MM\n    var date1 = new Date('September 22, 2018 13:22:13')\n    var date2 = new Date();\n    date_diff = bin_now_datetime - bin_notify_off_datetime;    // outputs in unix timestamp miliseconds\n    var h = new Date(date_dif).getHours();\n    var m = new Date(date_dif).getMinutes();\n    h = (h<10) ? '0' + h : h;\n    m = (m<10) ? '0' + m : m;\n    var output = h + ':' + m;\n    \nChange timezones:\n    new Date('September 26, 2018 19:20:00 PDT')\n    new Date('September 26, 2020 19:20:00 -0700')","x":166,"y":36,"wires":[]},{"id":"945d2e80.0b55d","type":"api-current-state","z":"bb37110c.14f0d","g":"43943956.9495f8","name":"","server":"3b49c004.6176a","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"calendar.bin_collection","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":450,"y":828,"wires":[["e8542aa8.744cc8","683271ed.2d7e7","762ccc14.d5c124"]]},{"id":"e8542aa8.744cc8","type":"debug","z":"bb37110c.14f0d","g":"43943956.9495f8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":770,"y":792,"wires":[]},{"id":"762ccc14.d5c124","type":"debug","z":"bb37110c.14f0d","g":"43943956.9495f8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"data","targetType":"msg","statusVal":"","statusType":"auto","x":780,"y":864,"wires":[]},{"id":"683271ed.2d7e7","type":"debug","z":"bb37110c.14f0d","g":"43943956.9495f8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":790,"y":828,"wires":[]},{"id":"814a293f.27ed78","type":"inject","z":"bb37110c.14f0d","g":"43943956.9495f8","name":"Get current state","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":164,"y":828,"wires":[["945d2e80.0b55d"]]},{"id":"2d270b9b.6423f4","type":"trigger-state","z":"bb37110c.14f0d","g":"96cbb686.cf8058","name":"LIDL LEDs - Trigger State","server":"3b49c004.6176a","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"light.z2m_lidl_led_strip01","entityidfiltertype":"exact","debugenabled":false,"constraints":[],"inputs":1,"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","enableInput":true,"x":338,"y":996,"wires":[["c02dc4c0.9f9c58","8d257a6e.060f98"],[]]},{"id":"8d257a6e.060f98","type":"debug","z":"bb37110c.14f0d","g":"96cbb686.cf8058","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"data","targetType":"msg","statusVal":"","statusType":"auto","x":624,"y":1008,"wires":[]},{"id":"c02dc4c0.9f9c58","type":"debug","z":"bb37110c.14f0d","g":"96cbb686.cf8058","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":634,"y":972,"wires":[]},{"id":"f014197a.48eea8","type":"inject","z":"bb37110c.14f0d","g":"96cbb686.cf8058","name":"on","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":134,"y":996,"wires":[["2d270b9b.6423f4"]]},{"id":"2fa709ec.cdc006","type":"trigger-state","z":"bb37110c.14f0d","d":true,"g":"1a1c464.2e622ba","name":"Server Lights - Trigger State","server":"3b49c004.6176a","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"light.wled_server_lights","entityidfiltertype":"exact","debugenabled":false,"constraints":[],"inputs":1,"outputs":2,"customoutputs":[],"outputinitially":true,"state_type":"str","enableInput":true,"x":348,"y":1200,"wires":[["a33552a1.ea7fa","dc54f8f9.94aef8","13ee9bb4.000184"],[]]},{"id":"dc54f8f9.94aef8","type":"debug","z":"bb37110c.14f0d","g":"1a1c464.2e622ba","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"data","targetType":"msg","statusVal":"","statusType":"auto","x":696,"y":1152,"wires":[]},{"id":"a33552a1.ea7fa","type":"debug","z":"bb37110c.14f0d","g":"1a1c464.2e622ba","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":706,"y":1116,"wires":[]},{"id":"6952542c.fe317c","type":"inject","z":"bb37110c.14f0d","g":"1a1c464.2e622ba","name":"on","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":134,"y":1200,"wires":[["2fa709ec.cdc006"]]},{"id":"13ee9bb4.000184","type":"function","z":"bb37110c.14f0d","g":"1a1c464.2e622ba","name":"Set msg.payload to equal changed attributes - see notes","func":"//if (msg.payload === \"off\") {\n//    msg.payload = {\n//        \"domain\":\"light\",\n//        \"service\":\"turn_off\"\n//    }\n//    return msg;\n//} else {\n    msg.payload = {\n        \"data\": {\n            \"transition\":\"1\",\n            \"rgb_color\":msg.data.event.new_state.attributes.rgb_color,\n            \"brightness\":msg.data.event.new_state.attributes.brightness\n        }\n    };\n    return msg;\n//}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":750,"y":1212,"wires":[["e0606935.d8d778","116b3bc6.b9f634","e404ba2a.3b1bf8"]],"info":"Set up a Poll State node with debug reading msg.data and make changes you want in HA.\nPoll State of entity to see details of entity settings\nCopy json paths and values from debug and copy into this function as the msg.payload.\n\nOr do the same with a Trigger State node which will show the old and new values when you update the entity in HA."},{"id":"e0606935.d8d778","type":"debug","z":"bb37110c.14f0d","g":"1a1c464.2e622ba","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1114,"y":1164,"wires":[]},{"id":"116b3bc6.b9f634","type":"api-call-service","z":"bb37110c.14f0d","g":"1a1c464.2e622ba","name":"Control LIDL LEDs","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.z2m_lidl_led_strip01"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1134,"y":1212,"wires":[[]]},{"id":"e404ba2a.3b1bf8","type":"api-call-service","z":"bb37110c.14f0d","g":"1a1c464.2e622ba","name":"Control study RGB bulb","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.z2m_ikea_rgb_study"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1154,"y":1284,"wires":[[]]},{"id":"b18ed48a.10d0f8","type":"api-call-service","z":"bb37110c.14f0d","g":"1a1c464.2e622ba","name":"Control study RGB bulb","server":"3b49c004.6176a","version":5,"debugenabled":true,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.z2m_ikea_rgb_study"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1142,"y":1404,"wires":[[]]},{"id":"b261f3d0.250d1","type":"inject","z":"bb37110c.14f0d","g":"1a1c464.2e622ba","name":"on","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":422,"y":1392,"wires":[["e48da7ce.e074f8"]]},{"id":"e48da7ce.e074f8","type":"function","z":"bb37110c.14f0d","g":"1a1c464.2e622ba","name":"Set msg.payload to equal changed attributes - see notes","func":"// set up logic to output \n//   msg.payload = {\"service\":\"turn_off\"}\n// if the initial light is turned off (based on msg.payload=off \n// or data.event.new_state.state=off)\n    \nmsg.payload = {\n    //\"domain\":\"light\",\n    //\"service\":\"turn_off\"\n    //\"service\":\"turn_on\"\n    \"data\": {\n        \"transition\":\"1\",\n        \"rgb_color\":msg.data.event.new_state.attributes.rgb_color,\n        \"brightness\":msg.data.event.new_state.attributes.brightness\n    }\n};\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":750,"y":1392,"wires":[["b18ed48a.10d0f8"]],"info":"Set up a Poll State node with debug reading msg.data and make changes you want in HA.\nPoll State of entity to see details of entity settings\nCopy json paths and values from debug and copy into this function as the msg.payload.\n\nOr do the same with a Trigger State node which will show the old and new values when you update the entity in HA."},{"id":"d52557ddbd05b423","type":"switch","z":"bb37110c.14f0d","g":"7fe1d3a64de8b851","name":"Turn On/Off?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":2018,"y":732,"wires":[["788e168e362257f0"],["12a5b2f9aed671ff"]]},{"id":"788e168e362257f0","type":"function","z":"bb37110c.14f0d","g":"7fe1d3a64de8b851","name":"Set msg.payload - ON","func":"msg.payload = {\"state\":\"on\"};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2252,"y":684,"wires":[["82cf946f25a738c9","6ddb24ea79b0efbe"]]},{"id":"12a5b2f9aed671ff","type":"function","z":"bb37110c.14f0d","g":"7fe1d3a64de8b851","name":"Set msg.payload - OFF","func":"msg.payload = {\"state\":\"off\"};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2262,"y":768,"wires":[["82cf946f25a738c9","6ddb24ea79b0efbe"]]},{"id":"82cf946f25a738c9","type":"zigbee2mqtt-out","z":"bb37110c.14f0d","g":"7fe1d3a64de8b851","name":"Z2M Lidl Socket 1 - Kitchen Fairy Lights","server":"f0cc4845.3e9e28","friendly_name":"z2m_lidl_socket01_kitchen_Fairy_lights","device_id":"0xec1bbdfffeb07bed","command":"state","commandType":"z2m_cmd","payload":"payload","payloadType":"msg","x":2624,"y":720,"wires":[]},{"id":"1dfa5d28219104ee","type":"inject","z":"bb37110c.14f0d","g":"7fe1d3a64de8b851","name":"On","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":1770,"y":648,"wires":[["d52557ddbd05b423"]]},{"id":"b530e2de711bfe80","type":"inject","z":"bb37110c.14f0d","g":"7fe1d3a64de8b851","name":"Off","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"off","payloadType":"str","x":1770,"y":684,"wires":[["d52557ddbd05b423"]]},{"id":"6ddb24ea79b0efbe","type":"debug","z":"bb37110c.14f0d","g":"7fe1d3a64de8b851","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":2490,"y":648,"wires":[]},{"id":"3073187f76502d9b","type":"api-call-service","z":"bb37110c.14f0d","g":"7fe1d3a64de8b851","name":"Lidl Outlet 01 - Kitchen Fairy Lights - Toggle","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"light","service":"toggle","areaId":[],"deviceId":[],"entityId":["switch.z2m_lidl_socket01_kitchen_Fairy_lights"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":2630,"y":768,"wires":[[]]},{"id":"44d3ce14fab2b7e9","type":"switch","z":"bb37110c.14f0d","g":"34092f65e4683e6f","name":"","property":"payload.occupancy","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"false","repair":false,"outputs":2,"x":2210,"y":1032,"wires":[["9912903e3dec1c7b","c4dd8cd29495d7a6","04f8c83bb6ce844d"],["77dcdb23e6d2e2c5","145ac0cc0669a240"]]},{"id":"f0e4738a2a8ed025","type":"zigbee2mqtt-in","z":"bb37110c.14f0d","d":true,"g":"34092f65e4683e6f","name":"Sonoff Motion - Kids Toilet","server":"f0cc4845.3e9e28","friendly_name":"z2m_son_motion01_kids_toilet","device_id":"0x00124b0022683b4b","state":"0","outputAtStartup":true,"x":1838,"y":1032,"wires":[["6bf582985491bfca","44d3ce14fab2b7e9"]]},{"id":"e0394a039efbaa99","type":"mqtt out","z":"bb37110c.14f0d","g":"34092f65e4683e6f","name":"","topic":"","qos":"2","retain":"true","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"e96cb00d.af953","x":3278,"y":1020,"wires":[]},{"id":"f9810ab8fc3143ca","type":"debug","z":"bb37110c.14f0d","g":"34092f65e4683e6f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3182,"y":1056,"wires":[]},{"id":"905a337b8d7b6f6f","type":"debug","z":"bb37110c.14f0d","g":"34092f65e4683e6f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3038,"y":924,"wires":[]},{"id":"9912903e3dec1c7b","type":"debug","z":"bb37110c.14f0d","g":"34092f65e4683e6f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2270,"y":984,"wires":[]},{"id":"6bf582985491bfca","type":"debug","z":"bb37110c.14f0d","g":"34092f65e4683e6f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2006,"y":1092,"wires":[]},{"id":"77dcdb23e6d2e2c5","type":"debug","z":"bb37110c.14f0d","g":"34092f65e4683e6f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2270,"y":1080,"wires":[]},{"id":"145ac0cc0669a240","type":"trigger","z":"bb37110c.14f0d","g":"34092f65e4683e6f","name":"","op1":"","op2":"off","op1type":"nul","op2type":"str","duration":"30","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2542,"y":1104,"wires":[["b672dca90505c4d0","3530f9499b2d2e4d"]]},{"id":"683dedd612679e93","type":"debug","z":"bb37110c.14f0d","g":"34092f65e4683e6f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2570,"y":1008,"wires":[]},{"id":"a7cc6bc5947f137f","type":"change","z":"bb37110c.14f0d","g":"34092f65e4683e6f","name":"Set msg.topic = MQTT topic","rules":[{"t":"set","p":"topic","pt":"msg","to":"shellies/shelly1pm-kids-toilet/relay/0/command","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":3084,"y":1020,"wires":[["f9810ab8fc3143ca","e0394a039efbaa99"]]},{"id":"f79f7cc0d38b9058","type":"change","z":"bb37110c.14f0d","g":"34092f65e4683e6f","name":"Set msg.payload=on","rules":[{"t":"set","p":"payload","pt":"msg","to":"on","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2828,"y":960,"wires":[["905a337b8d7b6f6f","a7cc6bc5947f137f"]]},{"id":"b672dca90505c4d0","type":"change","z":"bb37110c.14f0d","g":"34092f65e4683e6f","name":"Set msg.payload=off","rules":[{"t":"set","p":"payload","pt":"msg","to":"off","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2764,"y":1104,"wires":[["a7cc6bc5947f137f","bfb9f509ff84ae91"]]},{"id":"c4dd8cd29495d7a6","type":"change","z":"bb37110c.14f0d","g":"34092f65e4683e6f","name":"Set payload - cancel off timer","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":2544,"y":972,"wires":[["145ac0cc0669a240","683dedd612679e93"]]},{"id":"577949bc373783eb","type":"inject","z":"bb37110c.14f0d","g":"34092f65e4683e6f","name":"Occupancy = false","props":[{"p":"payload.occupancy","v":"false","vt":"bool"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":2058,"y":960,"wires":[["44d3ce14fab2b7e9"]]},{"id":"1c4e6bcbad62b805","type":"inject","z":"bb37110c.14f0d","g":"34092f65e4683e6f","name":"Occupancy = true","props":[{"p":"payload.occupancy","v":"true","vt":"bool"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":2058,"y":924,"wires":[["44d3ce14fab2b7e9"]]},{"id":"3530f9499b2d2e4d","type":"debug","z":"bb37110c.14f0d","g":"34092f65e4683e6f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2618,"y":1068,"wires":[]},{"id":"bfb9f509ff84ae91","type":"debug","z":"bb37110c.14f0d","g":"34092f65e4683e6f","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2882,"y":1140,"wires":[]},{"id":"04f8c83bb6ce844d","type":"time-range-switch","z":"bb37110c.14f0d","g":"34092f65e4683e6f","name":"Night time?","lat":"55.8938","lon":"-3.6232","startTime":"sunsetStart","endTime":"sunriseEnd","startOffset":"-20","endOffset":"20","x":2506,"y":924,"wires":[["f79f7cc0d38b9058"],[]]},{"id":"669290fcba6bd46e","type":"inject","z":"bb37110c.14f0d","g":"34092f65e4683e6f","name":"off","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"off","payloadType":"str","x":2486,"y":1140,"wires":[["b672dca90505c4d0"]]},{"id":"f090d87c0c01264e","type":"inject","z":"bb37110c.14f0d","g":"34092f65e4683e6f","name":"On","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":2666,"y":900,"wires":[["f79f7cc0d38b9058"]]},{"id":"d3e39c98909bedf6","type":"mqtt in","z":"bb37110c.14f0d","g":"34092f65e4683e6f","name":"Z2M - Sonoff Motion Sensor","topic":"zigbee2mqtt/z2m_son_motion01_kids_toilet","qos":"2","datatype":"auto","broker":"e96cb00d.af953","nl":false,"rap":true,"rh":0,"inputs":0,"x":1828,"y":996,"wires":[[]],"info":"Check MQTT Messages in MQTT Explorer.\nMotion sensor publishes:\n\n{\n  \"battery\": 100,\n  \"battery_low\": false,\n  \"linkquality\": 87,\n  \"occupancy\": false,\n  \"tamper\": false,\n  \"voltage\": 3100\n}"},{"id":"2122f69.fdedd0a","type":"mqtt in","z":"bb37110c.14f0d","d":true,"g":"a40e9a3cd9abb572","name":"","topic":"sensors/#","qos":"2","datatype":"auto-detect","broker":"e96cb00d.af953","nl":false,"rap":false,"inputs":0,"x":168,"y":1656,"wires":[["bbed4e22.4412b"]]},{"id":"bbed4e22.4412b","type":"function","z":"bb37110c.14f0d","d":true,"g":"a40e9a3cd9abb572","name":"MQTT to InfluxDB","func":"var tokens = msg.topic.split(\"/\");\nvar dest = tokens[tokens.length-1];\nmsg.url =\"http://localhost:8086/write?db=greenhouse\";\nmsg.payload = tokens[2] + \",device=\" + tokens[1] + \" value=\" + msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":387,"y":1658,"wires":[["92e875bf.6d1788","7804637a.87fb9c"]]},{"id":"92e875bf.6d1788","type":"http request","z":"bb37110c.14f0d","d":true,"g":"a40e9a3cd9abb572","name":"","method":"POST","ret":"txt","url":"http://localhost:8086/write?db=greenhouse","x":610,"y":1657,"wires":[["989defec.67621"]]},{"id":"989defec.67621","type":"debug","z":"bb37110c.14f0d","d":true,"g":"a40e9a3cd9abb572","name":"","active":true,"console":"false","complete":"true","x":804,"y":1656,"wires":[]},{"id":"7804637a.87fb9c","type":"debug","z":"bb37110c.14f0d","d":true,"g":"a40e9a3cd9abb572","name":"","active":true,"console":"false","complete":"false","x":594,"y":1797,"wires":[]},{"id":"b9c1043b88fac24d","type":"comment","z":"bb37110c.14f0d","d":true,"g":"a40e9a3cd9abb572","name":"MQTT to InfluxDB via http request (https://flows.nodered.org/flow/5c96cc92d3171b6434bf)","info":"","x":406,"y":1596,"wires":[]},{"id":"1bb27551.b13a6b","type":"influxdb out","z":"bb37110c.14f0d","d":true,"g":"b47174e3.35aef8","influxdb":"","name":"","measurement":"measure1","precision":"s","retentionPolicy":"one_week","database":"database","precisionV18FluxV20":"ms","retentionPolicyV18Flux":"","org":"organisation","bucket":"bucket","x":1032,"y":2112,"wires":[]},{"id":"7273324f.7f53ac","type":"inject","z":"bb37110c.14f0d","g":"b47174e3.35aef8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"},{"p":"measurement","v":"measure1","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"[{\"field1\":100,\"value\":101},{\"tagname1\":\"tag1val\"}]","payloadType":"json","x":750,"y":2100,"wires":[["1bb27551.b13a6b"]]},{"id":"a000bc32.2dc19","type":"function","z":"bb37110c.14f0d","g":"b47174e3.35aef8","name":"Validate Input","func":"/**\n * Validate input suitable for the influxdb-out node.\n * We will ALWAYS use the \"array containing two objects\" payload\n * OR the singe Object payload (if no tags being used).\n * See the Description tab for more details.\n */\n\n// check measurement field is set - if not exit with error\nif ( ! msg.measurement ) {\n    node.error('msg.measurement is missing')\n    return\n}\n\nlet fields,tags\n\n// if payload is an object, assume that it contains fieldName:fieldValue pairs\nif ( msg.payload!== null && msg.payload.constructor.name === 'Object' ) {\n    fields = msg.payload\n} else if ( msg.payload!== null && msg.payload.constructor.name === 'Array' ) {\n    node.error('msg.payload cannot be an array. It must be an object containing fieldName:fieldValue pairs or a single value (which would be written to the `value` field name).')\n    return\n} else {\n    // Otherwise, we always use 'value' as the default field name\n    fields = {'value': msg.payload}\n}\n\nconst lstFields = Object.keys(fields)\n\n// check to make sure that there is a value field name - if not, continue but with a warning\nif ( ! lstFields.includes('value') ) {\n    // Lets us turn off the warning if we know what we are doing :-)\n    if ( msg.noValueField !== true )\n        node.warn('Default field name \"vaue\" not present, was that deliberate? Set msg.noValueField=true or use the `value` field name to avoid this msg')\n}\n\n// check to make sure that all field values are numeric - if not, exit with a warning\nlet allNumeric = true\nlstFields.forEach( key => {\n    // I use On/Off for simple switch values in MQTT but these are not useful\n    // in InfluxDB, so translate them to ON=1 and OFF=0 (ignoring case).\n    try {\n        if ( fields[key].toLowerCase() === 'on' ) fields[key] = 1\n        if ( fields[key].toLowerCase() === 'off' ) fields[key] = 0\n    } catch (e) {}\n\n    // then check to make sure the field is actually a number\n    if ( parseFloat(fields[key]) !== fields[key] ) {\n        node.error(`Field msg.payload.${key} is not numeric. Only use numbers for field values, text should go in tags.`)\n        allNumeric = false\n        return\n    }\n})\nif ( allNumeric === false ) {\n    return\n}\n\n// check to make sure that if msg.tags is present, it is an object - if not, exit with a warning\nif ( msg.tags ) {\n    if ( !(msg.tags!== null && msg.tags.constructor.name === 'Object') ) {\n        node.error('msg.tags is not an object - it must contain tagName:tagValue pairs')\n        return\n    }\n    tags = msg.tags\n}\n\n// Format the output to go to the InfluxDB out node\nif ( msg.tags ) {\n    msg.payload = [\n        fields,\n        tags,\n    ]\n} else {\n    msg.payload = fields\n}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":592,"y":2180,"wires":[["1bb27551.b13a6b","2dbcfbbd.b61f44","afc875d9a4cbfc88"]],"info":"This function validates msg input to ensure that it is suitable for the influxdb-out node.\n\nUse the following input msg schema:\n\n* `msg.payload`: **MUST** be an object containing fieldName:fieldValue pairs; OR a single value that will be written to the `value` field which is the default field name for InfluxDB.\n* `msg.measurement`: **MUST** be a valid measurement name for the database being written to.\n* `msg.tags`: Is _OPTIONAL_. If present, it **MUST** be an object containing tagName:tagValue pairs.\n\nWe will ALWAYS use the \"array containing two objects\" payload\nOR the singe Object payload (if no tags being used).\n\n## Tests\n* _SUCCESS_: \n  `msg={\"payload\":{\"fieldName1\":10,\"value\":15},\"tags\":{\"tagName1\":\"tagname1Value\"},\"measure\":\"myMeasure1\"}`\n* _SUCCESS_ (payload converted to `{\"value\":16}`): \n  `msg={\"payload\":16,\"tags\":{\"tagName1\":\"tagname1Value\"},\"measure\":\"myMeasure2\"}`\n* _SUCCESS_ (no tags): \n  `msg={\"payload\":16,\"measure\":\"myMeasure2\"}`\n* _SUCCESS_ (but warning issued, no value field): \n  `msg={\"payload\":{\"fieldName2\":17},\"tags\":{\"tagName1\":\"tagname1Value\"},\"measure\":\"myMeasure3\"}`\n* _SUCCESS_ (value \"On\" converted to 1): \n  `msg={\"payload\":\"On\",\"measure\":\"myMeasure4\"}`\n* _???_ (missing tags for a measure with tags): \n  `msg={\"payload\":\"On\",\"measure\":\"myMeasure1\"}`\n* _FAIL_: No `msg.measure`\n* _FAIL_: `msg.payload` is an array\n* _FAIL_: 1 or more fields have non-numeric values\n* _FAIL_: msg.tags exists but is not an object\n\n## Expected output formats\n```\nmsg.payload = [\n    objFields,\n    objTags\n]\n```\nOR (if no tags)\n```\nmsg.payload = {\n    \"fieldName1\":123,\n    \"fieldName2\":23,\n    \"value\":3,\n}\n```"},{"id":"2dbcfbbd.b61f44","type":"debug","z":"bb37110c.14f0d","g":"b47174e3.35aef8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":907,"y":2200,"wires":[],"l":false},{"id":"4c6ac117.8bbe6","type":"inject","z":"bb37110c.14f0d","g":"b47174e3.35aef8","name":"SUCCESS/Valid Input","props":[{"p":"topic","vt":"str"},{"p":"payload"},{"p":"measurement","v":"measure1","vt":"str"},{"p":"tags","v":"{\"tagname1\":\"tagname1Value\"}","vt":"json"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"SUCCESS/Valid Input","payload":"{\"field1\":10,\"value\":15}","payloadType":"json","x":212,"y":2004,"wires":[["a000bc32.2dc19"]]},{"id":"d16b6be1.138148","type":"inject","z":"bb37110c.14f0d","g":"b47174e3.35aef8","name":"FAIL/msg.measurement missing","props":[{"p":"payload"},{"p":"topic","vt":"str"},{"p":"tags","v":"{\"tagname1\":\"tagname1Value\"}","vt":"json"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"FAIL/msg.measurement missing","payload":"{\"field1\":10,\"value\":15}","payloadType":"json","x":242,"y":2280,"wires":[["a000bc32.2dc19"]]},{"id":"a13fc0ed.df4e","type":"inject","z":"bb37110c.14f0d","g":"b47174e3.35aef8","name":"SUCCESS/single value payload","props":[{"p":"topic","vt":"str"},{"p":"payload"},{"p":"measurement","v":"measure1","vt":"str"},{"p":"tags","v":"{\"tagname1\":\"tagname1Value\"}","vt":"json"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"SUCCESS/single value payload","payload":"16","payloadType":"num","x":242,"y":2044,"wires":[["a000bc32.2dc19"]]},{"id":"dc063c13.07848","type":"inject","z":"bb37110c.14f0d","g":"b47174e3.35aef8","name":"SUCCESS/no tags","props":[{"p":"topic","vt":"str"},{"p":"payload"},{"p":"measurement","v":"measure1","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"SUCCESS/no tags","payload":"16","payloadType":"num","x":202,"y":2084,"wires":[["a000bc32.2dc19"]]},{"id":"e0d6c61d.faee48","type":"inject","z":"bb37110c.14f0d","g":"b47174e3.35aef8","name":"SUCCESS/no value field/warning","props":[{"p":"topic","vt":"str"},{"p":"payload"},{"p":"measurement","v":"measure1","vt":"str"},{"p":"tags","v":"{\"tagname1\":\"tagname1Value\"}","vt":"json"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"SUCCESS/but warning issued, no value field","payload":"{\"fieldname2\":17}","payloadType":"json","x":242,"y":2124,"wires":[["a000bc32.2dc19"]]},{"id":"91c03b02.b2c198","type":"inject","z":"bb37110c.14f0d","g":"b47174e3.35aef8","name":"SUCCESS/no value field/no warning","props":[{"p":"topic","vt":"str"},{"p":"payload"},{"p":"measurement","v":"measure1","vt":"str"},{"p":"tags","v":"{\"tagname1\":\"tagname1Value\"}","vt":"json"},{"p":"noValueField","v":"true","vt":"bool"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"SUCCESS/no value field, no warning","payload":"{\"fieldname2\":17}","payloadType":"json","x":252,"y":2164,"wires":[["a000bc32.2dc19"]]},{"id":"312b8552.1db4ea","type":"inject","z":"bb37110c.14f0d","g":"b47174e3.35aef8","name":"SUCCESS/value \"On\" converted to 1","props":[{"p":"topic","vt":"str"},{"p":"payload"},{"p":"measurement","v":"measure1","vt":"str"},{"p":"tags","v":"{\"tagname1\":\"tagname1Value\"}","vt":"json"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"SUCCESS/On converted to 1","payload":"On","payloadType":"str","x":252,"y":2204,"wires":[["a000bc32.2dc19"]]},{"id":"b7c7c8cb.4003d8","type":"inject","z":"bb37110c.14f0d","g":"b47174e3.35aef8","name":"SUCCESS/value \"Off\" converted to 1","props":[{"p":"topic","vt":"str"},{"p":"payload"},{"p":"measurement","v":"measure1","vt":"str"},{"p":"tags","v":"{\"tagname1\":\"tagname1Value\"}","vt":"json"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"SUCCESS/Off converted to 1","payload":"{\"fieldname3\":\"Off\",\"value\":\"ON\"}","payloadType":"json","x":252,"y":2244,"wires":[["a000bc32.2dc19"]]},{"id":"79bbe9aa.3a2408","type":"inject","z":"bb37110c.14f0d","g":"b47174e3.35aef8","name":"FAIL/payload is an array","props":[{"p":"topic","vt":"str"},{"p":"payload"},{"p":"measurement","v":"measure1","vt":"str"},{"p":"tags","v":"{\"tagname1\":\"tagname1Value\"}","vt":"json"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"FAIL/payload is an array","payload":"[10,15]","payloadType":"json","x":222,"y":2320,"wires":[["a000bc32.2dc19"]]},{"id":"4025e7d.27e6c18","type":"inject","z":"bb37110c.14f0d","g":"b47174e3.35aef8","name":"FAIL/Field with non-numeric value","props":[{"p":"topic","vt":"str"},{"p":"payload"},{"p":"measurement","v":"measure1","vt":"str"},{"p":"tags","v":"{\"tagname1\":\"tagname1Value\"}","vt":"json"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"FAIL/Field with non-numeric value","payload":"{\"field1\":\"hello\",\"value\":true}","payloadType":"json","x":252,"y":2360,"wires":[["a000bc32.2dc19"]]},{"id":"913cf8ef.65c9f8","type":"inject","z":"bb37110c.14f0d","g":"b47174e3.35aef8","name":"FAIL/tags exists but not object","props":[{"p":"topic","vt":"str"},{"p":"payload"},{"p":"measurement","v":"measure1","vt":"str"},{"p":"tags","v":"{\"tagname1\":\"tagname1Value\"}","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"FAIL/msg.tags exists but is not an object","payload":"{\"field1\":10,\"value\":15}","payloadType":"json","x":232,"y":2400,"wires":[["a000bc32.2dc19"]]},{"id":"54b3c063.c132b","type":"comment","z":"bb37110c.14f0d","g":"b47174e3.35aef8","name":"Test validation function for influxdb-out (https://flows.nodered.org/flow/f9e7c9ef60e262da95e4c4e5f3ccc46a)","info":"","x":882,"y":2020,"wires":[]},{"id":"c6c65dc9c75e8add","type":"link in","z":"bb37110c.14f0d","g":"b47174e3.35aef8","name":"InfluxDB Validation In","links":["ea184274244d63b2"],"x":295,"y":1956,"wires":[["a000bc32.2dc19"]]},{"id":"afc875d9a4cbfc88","type":"link out","z":"bb37110c.14f0d","g":"b47174e3.35aef8","name":"InfluxDB Validation Out","mode":"link","links":[],"x":901,"y":2160,"wires":[]},{"id":"8b0c9a233e07c3f9","type":"debug","z":"bb37110c.14f0d","g":"8f5e9a1ac7fea624","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":542,"y":264,"wires":[]},{"id":"d192ba6337c30edf","type":"function","z":"bb37110c.14f0d","d":true,"g":"8f5e9a1ac7fea624","name":"Parse MQTT","func":"\n//var rebootTime = msg.payload\n//var dArr = rebootTime.split('T')\n//var dDate = ${dArr[0]}.split('-')\n//var dTime = ${ dArr[1]}.split(':')\n\n//var d = Date.parse(`${dDate[0]}-${dArr[1]}-${dArr[2]}`);\n\nvar d = Date.parse(msg.payload);\nconsole.log('date: ', d);\n\n//String representation of the Date for JSON\nvar strJSON = new Date(d).toJSON();\nnode.warn('JSON String Representation: ' + strJSON);\n\n//ISO Date Format\nvar iso = new Date(d).toISOString();\nnode.warn('ISO: ' + iso);\n\n//Date String\nvar strDate = new Date(d).toDateString();\nnode.warn('Date String: ' + strDate);\n\n//Date String with time\nvar strTstamp = new Date(d).toString();\nnode.warn('Timestamp String: ' + strTstamp);\n\n//UNIX time\nvar unixTime = new Date(d).getTime();\nnode.warn('UNIX Timestamp: ' + unixTime);\n\n//If your timezone is e.g. +11:00\nvar unixWithTZ = new Date(d).getTime() + (11*60*60*1000);\nnode.warn('UNIX Timestamp (timezone offset): ' + unixWithTZ);\n\nvar tags;\nvar fields;\n\ntags = {\n}\n\nfields = {\n    rebootdate: unixTime\n}\n\nmsg.payload = [\n    fields,\n    tags\n]\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":362,"y":300,"wires":[["8b0c9a233e07c3f9","fd4fb3b74dbb99fc"]]},{"id":"78cce74fc7f14f3b","type":"mqtt in","z":"bb37110c.14f0d","d":true,"g":"8f5e9a1ac7fea624","name":"","topic":"layzspa/reboot_time","qos":"2","datatype":"auto","broker":"e96cb00d.af953","nl":false,"rap":false,"inputs":0,"x":154,"y":300,"wires":[["d192ba6337c30edf"]]},{"id":"fd4fb3b74dbb99fc","type":"mqtt out","z":"bb37110c.14f0d","d":true,"g":"8f5e9a1ac7fea624","name":"","topic":"test","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"e96cb00d.af953","x":554,"y":312,"wires":[]},{"id":"143ccab7a3e2586f","type":"change","z":"bb37110c.14f0d","g":"d51ce67aabf87caf","name":"Set msg.topic = MQTT topic","rules":[{"t":"set","p":"topic","pt":"msg","to":"shellies/shelly1pm-98CDAC1EE194/relay/0/command","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"on","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1980,"y":72,"wires":[["b5b0a0302397af24"]]},{"id":"b5b0a0302397af24","type":"mqtt out","z":"bb37110c.14f0d","g":"d51ce67aabf87caf","name":"","topic":"","qos":"2","retain":"true","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"e96cb00d.af953","x":2210,"y":72,"wires":[]},{"id":"ff7c1cb2287aa6e0","type":"inject","z":"bb37110c.14f0d","g":"d51ce67aabf87caf","name":"off","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"off","payloadType":"str","x":1742,"y":108,"wires":[["2fa2451014771f3c"]]},{"id":"c53fdd3c3a819565","type":"inject","z":"bb37110c.14f0d","g":"d51ce67aabf87caf","name":"on","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":1730,"y":72,"wires":[["143ccab7a3e2586f"]]},{"id":"2fa2451014771f3c","type":"change","z":"bb37110c.14f0d","g":"d51ce67aabf87caf","name":"Set msg.topic = MQTT topic","rules":[{"t":"set","p":"topic","pt":"msg","to":"shellies/shelly1pm-98CDAC1EE194/relay/0/command","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"off","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1968,"y":120,"wires":[["b5b0a0302397af24"]]},{"id":"f1fee44499d16b28","type":"change","z":"bb37110c.14f0d","d":true,"g":"e69ed4f88f9bd9cf","name":"Set MQTT topic - wled/device","rules":[{"t":"set","p":"topic","pt":"msg","to":"wled/garden-wall","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2256,"y":264,"wires":[["e0fe8b257c8c6de8"]]},{"id":"0adeff675e297f47","type":"inject","z":"bb37110c.14f0d","d":true,"g":"e69ed4f88f9bd9cf","name":"Payload: on","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":1994,"y":216,"wires":[["f1fee44499d16b28"]]},{"id":"f72c8223b38bbcef","type":"inject","z":"bb37110c.14f0d","d":true,"g":"e69ed4f88f9bd9cf","name":"Payload: off","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"off","payloadType":"str","x":1994,"y":252,"wires":[["f1fee44499d16b28"]]},{"id":"0a785249f52405a4","type":"inject","z":"bb37110c.14f0d","d":true,"g":"e69ed4f88f9bd9cf","name":"Payload: brightness 80 [0-255]","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"80","payloadType":"str","x":1948,"y":288,"wires":[["f1fee44499d16b28"]]},{"id":"fc9319335968c634","type":"inject","z":"bb37110c.14f0d","d":true,"g":"e69ed4f88f9bd9cf","name":"Payload: API (omit 'url/win&' prefix) e.g. PRESET 1","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"PL=1","payloadType":"str","x":1882,"y":456,"wires":[["c45d3a89e5b2da2c"]]},{"id":"d0969fe3036edd6d","type":"inject","z":"bb37110c.14f0d","d":true,"g":"e69ed4f88f9bd9cf","name":"Payload: colour Red [#hex]","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"#FF8000","payloadType":"str","x":1966,"y":372,"wires":[["1f32153e47da949a"]]},{"id":"1f32153e47da949a","type":"change","z":"bb37110c.14f0d","d":true,"g":"e69ed4f88f9bd9cf","name":"Set MQTT topic - wled/device/col","rules":[{"t":"set","p":"topic","pt":"msg","to":"wled/garden-wall/col","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2284,"y":384,"wires":[["e0fe8b257c8c6de8"]]},{"id":"e0fe8b257c8c6de8","type":"mqtt out","z":"bb37110c.14f0d","d":true,"g":"e69ed4f88f9bd9cf","name":"","topic":"","qos":"2","retain":"true","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"e96cb00d.af953","x":2558,"y":360,"wires":[]},{"id":"c45d3a89e5b2da2c","type":"change","z":"bb37110c.14f0d","d":true,"g":"e69ed4f88f9bd9cf","name":"Set MQTT topic - wled/device/api","rules":[{"t":"set","p":"topic","pt":"msg","to":"wled/garden-wall/api","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2288,"y":492,"wires":[["e0fe8b257c8c6de8"]]},{"id":"2ca476d4bc3dc4d2","type":"inject","z":"bb37110c.14f0d","d":true,"g":"e69ed4f88f9bd9cf","name":"Payload: brightness 255 [0-255]","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"255","payloadType":"str","x":1938,"y":324,"wires":[["f1fee44499d16b28"]]},{"id":"34cbaf9a3153eb9f","type":"inject","z":"bb37110c.14f0d","d":true,"g":"e69ed4f88f9bd9cf","name":"Payload: colour Green [#hex]","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"#00FF00","payloadType":"str","x":1956,"y":408,"wires":[["1f32153e47da949a"]]},{"id":"d8f4dd9e912d6eef","type":"inject","z":"bb37110c.14f0d","d":true,"g":"e69ed4f88f9bd9cf","name":"Payload: API (omit 'url/win&' prefix) e.g. PRESET 99","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"PL=99","payloadType":"str","x":1886,"y":492,"wires":[["c45d3a89e5b2da2c"]]},{"id":"29f01cca6e432730","type":"inject","z":"bb37110c.14f0d","d":true,"g":"e69ed4f88f9bd9cf","name":"Payload: API (omit 'url/win&' prefix) e.g. PRESET 4","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"PL=4","payloadType":"str","x":1886,"y":528,"wires":[["c45d3a89e5b2da2c"]]},{"id":"12114ed528e1847e","type":"change","z":"bb37110c.14f0d","g":"ba082cc01afd5f50","name":"Reset","rules":[{"t":"set","p":"reset","pt":"msg","to":"foo","tot":"str"},{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2090,"y":1440,"wires":[["cd66d59c1636d4fa"]]},{"id":"349f5c4194990a3b","type":"inject","z":"bb37110c.14f0d","g":"ba082cc01afd5f50","name":"Reset","repeat":"","crontab":"","once":true,"onceDelay":"0.5","topic":"","payload":"","payloadType":"date","x":1910,"y":1400,"wires":[["12114ed528e1847e"]]},{"id":"f8f672e092a17176","type":"debug","z":"bb37110c.14f0d","g":"ba082cc01afd5f50","name":"Four presses","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":2660,"y":1540,"wires":[]},{"id":"1e842243be69de48","type":"inject","z":"bb37110c.14f0d","g":"ba082cc01afd5f50","name":"Start","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1753.3333129882812,"y":1371.111083984375,"wires":[["cd66d59c1636d4fa","3b100bb37a84f674"]]},{"id":"cd66d59c1636d4fa","type":"counter","z":"bb37110c.14f0d","g":"ba082cc01afd5f50","name":"","init":"0","step":"1","lower":null,"upper":null,"mode":"increment","outputs":"1","x":2100,"y":1370,"wires":[["f16ca4b72c5eae3f"]]},{"id":"c73a1b23a0975708","type":"switch","z":"bb37110c.14f0d","g":"ba082cc01afd5f50","name":"count presses","property":"count","propertyType":"flow","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"},{"t":"eq","v":"3","vt":"num"},{"t":"eq","v":"4","vt":"num"}],"checkall":"true","repair":false,"outputs":4,"x":2270,"y":1480,"wires":[["3b214cb98fe9182f"],["96ca5a776c1fbc39"],["3cbe36b427e58da7"],["8068093871829a43"]],"info":"Just expand the flow.count to how ever many\npresses you want/need."},{"id":"3b100bb37a84f674","type":"trigger","z":"bb37110c.14f0d","g":"ba082cc01afd5f50","name":"","op1":"","op2":"0","op1type":"nul","op2type":"str","duration":"1","extend":true,"units":"s","reset":"","bytopic":"all","outputs":1,"x":1920,"y":1480,"wires":[["626229cff769d867","c73a1b23a0975708"]]},{"id":"f16ca4b72c5eae3f","type":"change","z":"bb37110c.14f0d","g":"ba082cc01afd5f50","name":"Flow set","rules":[{"t":"set","p":"count","pt":"flow","to":"count","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2250,"y":1370,"wires":[["35e366ac16d461d0"]]},{"id":"c7c2944da56b671a","type":"debug","z":"bb37110c.14f0d","g":"ba082cc01afd5f50","name":"Tripple press","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":2660,"y":1500,"wires":[]},{"id":"c6f894ef5eabe53c","type":"debug","z":"bb37110c.14f0d","g":"ba082cc01afd5f50","name":"Double press","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":2660,"y":1460,"wires":[]},{"id":"7d6ae9fa7069cc02","type":"debug","z":"bb37110c.14f0d","g":"ba082cc01afd5f50","name":"Single Press","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":2660,"y":1420,"wires":[]},{"id":"3b214cb98fe9182f","type":"change","z":"bb37110c.14f0d","g":"ba082cc01afd5f50","name":"Single Press","rules":[{"t":"set","p":"payload","pt":"msg","to":"Single Press","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2480,"y":1420,"wires":[["7d6ae9fa7069cc02"]]},{"id":"96ca5a776c1fbc39","type":"change","z":"bb37110c.14f0d","g":"ba082cc01afd5f50","name":"Double Press","rules":[{"t":"set","p":"payload","pt":"msg","to":"Double Press","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2490,"y":1460,"wires":[["c6f894ef5eabe53c"]]},{"id":"3cbe36b427e58da7","type":"change","z":"bb37110c.14f0d","g":"ba082cc01afd5f50","name":"Tripple Press","rules":[{"t":"set","p":"payload","pt":"msg","to":"Tripple Press","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2480,"y":1500,"wires":[["c7c2944da56b671a"]]},{"id":"8068093871829a43","type":"change","z":"bb37110c.14f0d","g":"ba082cc01afd5f50","name":"Four Press","rules":[{"t":"set","p":"payload","pt":"msg","to":"Four Press","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2480,"y":1540,"wires":[["f8f672e092a17176"]]},{"id":"90974a00337390fd","type":"comment","z":"bb37110c.14f0d","g":"ba082cc01afd5f50","name":"DELAY - Readme","info":"The DELAY time has to be a bit longer than how\nlong it takes you to press the button the\nmaximum number of times.\nRead information in the SWITCH node too!","x":2300,"y":1290,"wires":[]},{"id":"61b599bafcd0f9e1","type":"comment","z":"bb37110c.14f0d","g":"ba082cc01afd5f50","name":"Input","info":"","x":1910,"y":1330,"wires":[]},{"id":"5c2a35839a60986c","type":"comment","z":"bb37110c.14f0d","g":"ba082cc01afd5f50","name":"Outputs","info":"Debug nodes are here now, but just connect\nthem to what ever you want.\nThe messages sent are in the nodes just before\nthe debug nodes.\n","x":2640,"y":1380,"wires":[]},{"id":"35e366ac16d461d0","type":"debug","z":"bb37110c.14f0d","g":"ba082cc01afd5f50","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"count","targetType":"msg","x":2480,"y":1370,"wires":[]},{"id":"626229cff769d867","type":"delay","z":"bb37110c.14f0d","g":"ba082cc01afd5f50","name":"Delay","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1910,"y":1440,"wires":[["12114ed528e1847e"]]},{"id":"902dafbb.5356e","type":"server-state-changed","z":"f40271d9.9f445","g":"c69b5eb8.ce519","name":"Ikea Button","server":"3b49c004.6176a","version":4,"entityidfilter":"sensor.ikea_5button_action","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":298,"y":204,"wires":[["616b6458.f9cdec"]]},{"id":"616b6458.f9cdec","type":"switch","z":"f40271d9.9f445","g":"c69b5eb8.ce519","name":"Find button","property":"payload","propertyType":"msg","rules":[{"t":"nempty"},{"t":"eq","v":"toggle","vt":"str"},{"t":"eq","v":"brightness_up_click","vt":"str"},{"t":"eq","v":"brightness_down_click","vt":"str"},{"t":"eq","v":"arrow_left_click","vt":"str"},{"t":"eq","v":"arrow_right_click","vt":"str"}],"checkall":"true","repair":false,"outputs":6,"x":468,"y":204,"wires":[["dd2e8fc0.2b15f"],["a7f4c343.47cc2"],["ac8bb60.2a3fe48"],["351eac6a.9aa984"],[],[]]},{"id":"5c41d75a.b28628","type":"comment","z":"f40271d9.9f445","g":"c69b5eb8.ce519","name":"Ikea 5-button cycle colours","info":"Try making the ikea buttons cycle through \neffetcts or colours!\n\nPink payload\n{\"state\": \"ON\", \"color\": {\"r\": 255, \"g\": 0, \"b\": 255}}\nsent to: home/leds_crush_5v_ha/state/in","x":158,"y":84,"wires":[]},{"id":"dd2e8fc0.2b15f","type":"debug","z":"f40271d9.9f445","g":"c69b5eb8.ce519","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":712,"y":113,"wires":[]},{"id":"9fc4912.1ca5c7","type":"debug","z":"f40271d9.9f445","g":"c69b5eb8.ce519","name":"","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"data.attributes.brightness","targetType":"msg","x":1298,"y":114,"wires":[]},{"id":"fdc87852.37e158","type":"debug","z":"f40271d9.9f445","g":"c69b5eb8.ce519","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"data.attributes.brightness","targetType":"msg","x":978,"y":114,"wires":[]},{"id":"fb4b581f.02db98","type":"debug","z":"f40271d9.9f445","g":"c69b5eb8.ce519","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":1548,"y":114,"wires":[]},{"id":"a7f4c343.47cc2","type":"api-call-service","z":"f40271d9.9f445","g":"c69b5eb8.ce519","name":"LEDs Toggle","server":"3b49c004.6176a","version":5,"domain":"light","service":"toggle","areaId":[],"deviceId":[],"entityId":["light.leds_crush_5v"],"data":"","mergeContext":"","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","output_location":"payload","output_location_type":"msg","x":1418,"y":164,"wires":[[]]},{"id":"3facd4c6.e716fc","type":"change","z":"f40271d9.9f445","g":"c69b5eb8.ce519","name":"Brightness: +50","rules":[{"t":"set","p":"data.attributes.brightness","pt":"msg","to":"msg.data.attributes.brightness + 50","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":968,"y":204,"wires":[["28faa962.1cead6","9fc4912.1ca5c7"]]},{"id":"28faa962.1cead6","type":"function","z":"f40271d9.9f445","g":"c69b5eb8.ce519","name":"Amend Payload","func":"msg.payload = { data: {\"brightness\":msg.data.attributes.brightness } };\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1178,"y":214,"wires":[["db8df199.db814","fb4b581f.02db98"]]},{"id":"db8df199.db814","type":"api-call-service","z":"f40271d9.9f445","g":"c69b5eb8.ce519","name":"LEDs On w/ Payload","server":"3b49c004.6176a","version":5,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.leds_crush_5v"],"data":"","mergeContext":"","outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1408,"y":214,"wires":[[]]},{"id":"4cc4b780.1a6758","type":"change","z":"f40271d9.9f445","g":"c69b5eb8.ce519","name":"Brightness: -50","rules":[{"t":"set","p":"data.attributes.brightness","pt":"msg","to":"msg.data.attributes.brightness - 50","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":968,"y":244,"wires":[["ae639e72.a6c2a","9fc4912.1ca5c7"]]},{"id":"ae639e72.a6c2a","type":"function","z":"f40271d9.9f445","g":"c69b5eb8.ce519","name":"Amend Payload","func":"msg.payload = { data: {\"brightness\":msg.data.attributes.brightness } };\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1178,"y":254,"wires":[["b31f3d4.22254c","fb4b581f.02db98"]]},{"id":"b31f3d4.22254c","type":"api-call-service","z":"f40271d9.9f445","g":"c69b5eb8.ce519","name":"LEDs On w/ Payload","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.leds_crush_5v"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1408,"y":254,"wires":[[]]},{"id":"ac8bb60.2a3fe48","type":"api-current-state","z":"f40271d9.9f445","g":"c69b5eb8.ce519","name":"Get LED Current State","server":"3b49c004.6176a","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.leds_crush_5v","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":728,"y":204,"wires":[["3facd4c6.e716fc","fdc87852.37e158"]]},{"id":"351eac6a.9aa984","type":"api-current-state","z":"f40271d9.9f445","g":"c69b5eb8.ce519","name":"Get LED Current State","server":"3b49c004.6176a","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.leds_crush_5v","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":728,"y":244,"wires":[["4cc4b780.1a6758","fdc87852.37e158"]]},{"id":"b75f2446.f93748","type":"function","z":"f40271d9.9f445","g":"ef273204.3ab62","name":"change rgb","func":"var i = flow.get(\"i\");\nvar red   = Math.round(Math.sin(0.3*i + 0) * 127 + 128);\nvar green = Math.round(Math.sin(0.3*i + 2) * 127 + 128);\nvar blue  = Math.round(Math.sin(0.3*i + 4) * 127 + 128);\n\ni++;\nif (i>=32) {\n    i = 0;\n}\n\nflow.set(\"i\", i);\n\nmsg.payload = {};\nmsg.payload.data = {};\nmsg.payload.data.rgb_color = [red, green, blue];\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":466,"y":444,"wires":[["e8033bd1.be11e8","fdde52aa.aa13d","c1febef9.9aef3"]]},{"id":"b78f1543.dbd748","type":"inject","z":"f40271d9.9f445","g":"ef273204.3ab62","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":136,"y":444,"wires":[["408ec43e.c4fbdc"]]},{"id":"e8033bd1.be11e8","type":"debug","z":"f40271d9.9f445","g":"ef273204.3ab62","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","x":866,"y":434,"wires":[]},{"id":"408ec43e.c4fbdc","type":"function","z":"f40271d9.9f445","g":"ef273204.3ab62","name":"set var","func":"flow.set(\"i\", 0);\n\nreturn msg;","outputs":1,"noerr":0,"x":286,"y":444,"wires":[["b75f2446.f93748"]]},{"id":"fdde52aa.aa13d","type":"delay","z":"f40271d9.9f445","g":"ef273204.3ab62","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":456,"y":524,"wires":[["b75f2446.f93748"]]},{"id":"c1febef9.9aef3","type":"api-call-service","z":"f40271d9.9f445","g":"ef273204.3ab62","name":"turn on light","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.leds_crush_5v"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","output_location":"payload","output_location_type":"msg","x":866,"y":504,"wires":[[]]},{"id":"617576bb.499418","type":"comment","z":"f40271d9.9f445","g":"ef273204.3ab62","name":"Rainbow RGB - https://www.reddit.com/r/homeassistant/comments/8itku9/node_red_color_cycle/","info":"","x":366,"y":364,"wires":[]},{"id":"11194364.149dad","type":"comment","z":"f40271d9.9f445","g":"ef273204.3ab62","name":"https://pastebin.com/nKAticnC","info":"","x":156,"y":404,"wires":[]},{"id":"192e30d3.70bf0f","type":"server-state-changed","z":"f40271d9.9f445","g":"823a10f9.ffad9","name":"","server":"3b49c004.6176a","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"camera.front_door2","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":260,"y":756,"wires":[["cbd04e58.bd0ca"]]},{"id":"1166936d.670dad","type":"api-call-service","z":"f40271d9.9f445","g":"823a10f9.ffad9","name":"","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"downloader","service":"download_file","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","output_location":"payload","output_location_type":"msg","x":1051,"y":940,"wires":[["823e6dfe.64fdd"]]},{"id":"6dab5ecc.5a474","type":"change","z":"f40271d9.9f445","g":"823a10f9.ffad9","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\t   \"data\":{\t       \"url\": data.new_state.attributes.video_url,\t       \"subdir\": topic,\t       \"filename\": $join([new.groups[0], \"_\", new.groups[1], \".mp4\"])\t   }\t}","tot":"jsonata"},{"t":"delete","p":"topic","pt":"msg"},{"t":"delete","p":"data","pt":"msg"},{"t":"delete","p":"new","pt":"msg"},{"t":"delete","p":"old","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":783,"y":944,"wires":[["1166936d.670dad"]]},{"id":"823e6dfe.64fdd","type":"debug","z":"f40271d9.9f445","g":"823a10f9.ffad9","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1168.5,"y":862,"wires":[]},{"id":"66911912.a22a78","type":"server-state-changed","z":"f40271d9.9f445","g":"823a10f9.ffad9","name":"","server":"3b49c004.6176a","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"camera.backyard","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":258.5,"y":871,"wires":[["cbd04e58.bd0ca"]]},{"id":"e89ece18.7af2a","type":"change","z":"f40271d9.9f445","g":"823a10f9.ffad9","name":"","rules":[{"t":"set","p":"old","pt":"msg","to":"$match(data.old_state.attributes.video_url, /\\/(\\d+)\\/(\\d+)\\.mp4\\?/)","tot":"jsonata"},{"t":"set","p":"new","pt":"msg","to":"$match(data.new_state.attributes.video_url, /\\/(\\d+)\\/(\\d+)\\.mp4\\?/)","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":821.5,"y":1120,"wires":[["3f0cd162.c775ce"]]},{"id":"3f0cd162.c775ce","type":"switch","z":"f40271d9.9f445","g":"823a10f9.ffad9","name":"","property":"(old.groups[0] = new.groups[0]) and (old.groups[1] = new.groups[1])","propertyType":"jsonata","rules":[{"t":"false"}],"checkall":"true","repair":false,"outputs":1,"x":675,"y":878,"wires":[["6dab5ecc.5a474","fa67885b.f19238"]]},{"id":"fa67885b.f19238","type":"debug","z":"f40271d9.9f445","g":"823a10f9.ffad9","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":880.5,"y":859,"wires":[]},{"id":"1df3dbb2.13cc24","type":"switch","z":"f40271d9.9f445","g":"823a10f9.ffad9","name":"new video url is a string","property":"data.new_state.attributes.video_url","propertyType":"msg","rules":[{"t":"istype","v":"string","vt":"string"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":469,"y":1064,"wires":[["e89ece18.7af2a"],["6521af21.167ea"]]},{"id":"cbd04e58.bd0ca","type":"switch","z":"f40271d9.9f445","g":"823a10f9.ffad9","name":"old video url is a string","property":"data.old_state.attributes.video_url","propertyType":"msg","rules":[{"t":"istype","v":"string","vt":"string"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":454.5,"y":941,"wires":[["1df3dbb2.13cc24"],["3ecc4bd2.a09de4"]]},{"id":"3ecc4bd2.a09de4","type":"change","z":"f40271d9.9f445","g":"823a10f9.ffad9","name":"set old url to a string","rules":[{"t":"set","p":"data.old_state.attributes.video_url","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":251,"y":1010,"wires":[["1df3dbb2.13cc24"]]},{"id":"6521af21.167ea","type":"change","z":"f40271d9.9f445","g":"823a10f9.ffad9","name":"set new url to a string","rules":[{"t":"set","p":"data.new_state.attributes.video_url","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":403.5,"y":1126,"wires":[["e89ece18.7af2a"]]},{"id":"7e0d5e4c.43214","type":"comment","z":"f40271d9.9f445","g":"823a10f9.ffad9","name":"Ring Video Download - Front Door","info":"","x":188,"y":684,"wires":[]},{"id":"9ca0923c.afdc3","type":"ha-entity","z":"f40271d9.9f445","g":"b49d9abe.78dd88","name":"Create HA entity - NodeRed test","server":"3b49c004.6176a","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"NodeRed_test"},{"property":"device_class","value":""},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"payload","stateType":"msg","attributes":[{"property":"CustomAttrib","value":"off","valueType":"str"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":314,"y":1308,"wires":[[]]},{"id":"7afac9b8.7f4ef8","type":"inject","z":"f40271d9.9f445","g":"b49d9abe.78dd88","name":"Test - on","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"on","payload":"on","payloadType":"str","x":184,"y":1440,"wires":[["9ca0923c.afdc3"]]},{"id":"60c1850d.d699dc","type":"comment","z":"f40271d9.9f445","g":"b49d9abe.78dd88","name":"Test create entity in HA","info":"","x":152,"y":1236,"wires":[]},{"id":"974e2f1e.260ae","type":"server-state-changed","z":"f40271d9.9f445","g":"77f04818.c0bfd8","name":"Input Select - Power HTPC","server":"3b49c004.6176a","version":4,"entityidfilter":"input_select.power_htpc","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":2470,"y":1572,"wires":[["a8e6683e.b4d398"]]},{"id":"a8e6683e.b4d398","type":"switch","z":"f40271d9.9f445","g":"77f04818.c0bfd8","name":"Switch Input","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"None","vt":"str"},{"t":"eq","v":"Wake On LAN","vt":"str"},{"t":"eq","v":"Suspend","vt":"str"},{"t":"eq","v":"Poweroff","vt":"str"},{"t":"eq","v":"Force Poweroff","vt":"str"},{"t":"eq","v":"Reboot","vt":"str"},{"t":"eq","v":"Test","vt":"str"}],"checkall":"true","repair":false,"outputs":7,"x":2742,"y":1572,"wires":[[],["2f4c60bc.1822d"],["aadc4356.f295"],["e0508bc8.1063f8"],["92bf65b0.d45148"],["a974932e.10235"],["81455679.ead5a8"]]},{"id":"a974932e.10235","type":"api-call-service","z":"f40271d9.9f445","g":"77f04818.c0bfd8","name":"Shell Cmd","server":"3b49c004.6176a","version":5,"domain":"shell_command","service":"sol_htpc_reboot","areaId":[],"deviceId":[],"entityId":[],"data":"","mergeContext":"","outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":3318,"y":1488,"wires":[["ec738885.095f38"]]},{"id":"aadc4356.f295","type":"api-call-service","z":"f40271d9.9f445","g":"77f04818.c0bfd8","name":"Shell Cmd","server":"3b49c004.6176a","version":5,"domain":"shell_command","service":"sol_htpc_suspend","areaId":[],"deviceId":[],"entityId":[],"data":"","mergeContext":"","outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":3318,"y":1368,"wires":[["4a76ad4.1e5da54"]]},{"id":"e0508bc8.1063f8","type":"api-call-service","z":"f40271d9.9f445","g":"77f04818.c0bfd8","name":"Shell Cmd","server":"3b49c004.6176a","version":5,"domain":"shell_command","service":"sol_htpc_poweroff","areaId":[],"deviceId":[],"entityId":[],"data":"","mergeContext":"","outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":3318,"y":1408,"wires":[["4a76ad4.1e5da54"]]},{"id":"92bf65b0.d45148","type":"api-call-service","z":"f40271d9.9f445","g":"77f04818.c0bfd8","name":"Shell Cmd","server":"3b49c004.6176a","version":5,"domain":"shell_command","service":"sol_htpc_forcepoweroff","areaId":[],"deviceId":[],"entityId":[],"data":"","mergeContext":"","outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":3318,"y":1448,"wires":[["4a76ad4.1e5da54"]]},{"id":"2f4c60bc.1822d","type":"api-call-service","z":"f40271d9.9f445","g":"77f04818.c0bfd8","name":"Shell Cmd","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"shell_command","service":"wol_htpc","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":3318,"y":1328,"wires":[["4c1219ab.b27538"]]},{"id":"81455679.ead5a8","type":"api-call-service","z":"f40271d9.9f445","g":"77f04818.c0bfd8","name":"Shell Cmd","server":"3b49c004.6176a","version":5,"domain":"shell_command","service":"sol_htpc_test","areaId":[],"deviceId":[],"entityId":[],"data":"","mergeContext":"","outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":3318,"y":1528,"wires":[["a225493b.f2a218"]]},{"id":"ec738885.095f38","type":"api-call-service","z":"f40271d9.9f445","g":"77f04818.c0bfd8","name":"Set Input Select to None","server":"3b49c004.6176a","version":5,"domain":"input_select","service":"select_option","areaId":[],"deviceId":[],"entityId":["input_select.power_htpc"],"data":"{\"option\":\"None\"}","mergeContext":"","outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":4278,"y":1478,"wires":[[]]},{"id":"4a76ad4.1e5da54","type":"delay","z":"f40271d9.9f445","g":"77f04818.c0bfd8","name":"","pauseType":"delay","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":3648,"y":1368,"wires":[["3b485fa7.fe4ad"]]},{"id":"3b485fa7.fe4ad","type":"api-current-state","z":"f40271d9.9f445","g":"77f04818.c0bfd8","name":"Is HTPC Off?","server":"3b49c004.6176a","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.htpc","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":3648,"y":1428,"wires":[["4a76ad4.1e5da54"],["7221388.48f2ec8"]]},{"id":"a225493b.f2a218","type":"api-call-service","z":"f40271d9.9f445","g":"77f04818.c0bfd8","name":"HTPC/TV Outlet Off","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.z2m_ikea_outlet02_htpc_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":4028,"y":1425,"wires":[["ec738885.095f38"]]},{"id":"4c1219ab.b27538","type":"api-call-service","z":"f40271d9.9f445","g":"77f04818.c0bfd8","name":"HTPC/TV Outlet On","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.z2m_ikea_outlet02_htpc_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":3938,"y":1328,"wires":[["ec738885.095f38"]]},{"id":"7221388.48f2ec8","type":"delay","z":"f40271d9.9f445","g":"77f04818.c0bfd8","name":"","pauseType":"delay","timeout":"25","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":3842,"y":1425,"wires":[["a225493b.f2a218"]]},{"id":"ceb71e82.4b99","type":"inject","z":"f40271d9.9f445","g":"77f04818.c0bfd8","name":"Test - off","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"off","payload":"","payloadType":"str","x":2444,"y":1320,"wires":[["3e3f49e6.be7eb6"]]},{"id":"1c7c17ac.b68088","type":"inject","z":"f40271d9.9f445","g":"77f04818.c0bfd8","name":"Test - on","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"on","payload":"","payloadType":"str","x":2444,"y":1284,"wires":[["3e3f49e6.be7eb6"]]},{"id":"c0976624.f77568","type":"mqtt in","z":"f40271d9.9f445","g":"77f04818.c0bfd8","name":"Hall Light Sensor","topic":"/myhome/state/Lumin_Hall","qos":"2","datatype":"auto","broker":"e96cb00d.af953","inputs":0,"x":2438,"y":1392,"wires":[["1ff67987.1ad616"]]},{"id":"1ff67987.1ad616","type":"json","z":"f40271d9.9f445","g":"77f04818.c0bfd8","name":"","property":"payload","action":"","pretty":false,"x":2602,"y":1392,"wires":[["e4991a78.0c3ba8","546a1e51.5c3f9"]]},{"id":"e4991a78.0c3ba8","type":"switch","z":"f40271d9.9f445","g":"77f04818.c0bfd8","name":"Parse Switch Message","property":"payload.action","propertyType":"msg","rules":[{"t":"eq","v":"brightness_up_click","vt":"str"},{"t":"eq","v":"brightness_down_click","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":2772,"y":1392,"wires":[["2f4c60bc.1822d"],["92bf65b0.d45148"]]},{"id":"98ab6ec7.f036","type":"comment","z":"f40271d9.9f445","g":"77f04818.c0bfd8","name":"MQTT directly instead of HA input (read more inside)","info":"Using zigbee2mqtt's MQTT messages directly \nhere to work with Ikea buttons instead of\nHA's switch input.\n\nNote the 5-button unit has many more possible \nstates since holding and releasing buttons also\ncause MQTT updates including duration of hold.\n\nJust a proof of concept to work out how to do it.\n\nOnly downside is that HA won't know current switch \nstate since bypassing HA in the loop but don't\nreally need it in this case.\n\nNeed to parse MQTT payload with json node\nbefore being able to get values.\n\nAnd we can't use toggle button to toggle on/off\nunless we want to save the state of the TV somewhere\nor pull the state from somewhere as part of flow.\nCould be possible by pinging TV maybe or tracking\nlast MQTT message value from plug constantly and\nsaving in variable.\nBut easier just to use the brightness buttons to\ndo on/off.","x":2646,"y":1428,"wires":[]},{"id":"546a1e51.5c3f9","type":"debug","z":"f40271d9.9f445","g":"77f04818.c0bfd8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":2744,"y":1296,"wires":[]},{"id":"3e3f49e6.be7eb6","type":"alexa-local","z":"f40271d9.9f445","g":"77f04818.c0bfd8","devicename":"Television","inputtrigger":false,"x":2552,"y":1140,"wires":[["5e2b6469.9de28c"]]},{"id":"5e2b6469.9de28c","type":"switch","z":"f40271d9.9f445","g":"77f04818.c0bfd8","name":"Turn On/Off?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":2766,"y":1152,"wires":[["2f4c60bc.1822d"],["92bf65b0.d45148"]]},{"id":"941743d1.b3b39","type":"file in","z":"f40271d9.9f445","g":"60eeedcc.b3b4e4","name":"Read Encrypted credentials","filename":"credentials.txt","format":"utf8","chunk":false,"sendError":false,"x":408,"y":1884,"wires":[["8816ed07.da549"]]},{"id":"1d68bd2d.bf84b3","type":"http response","z":"f40271d9.9f445","g":"60eeedcc.b3b4e4","name":"GET reponse","statusCode":"","headers":{},"x":1138,"y":1884,"wires":[]},{"id":"31066f71.c2a3f","type":"http in","z":"f40271d9.9f445","g":"60eeedcc.b3b4e4","name":"","url":"/credentials","method":"get","upload":false,"swaggerDoc":"","x":168,"y":1884,"wires":[["941743d1.b3b39"]]},{"id":"8816ed07.da549","type":"decrypt","z":"f40271d9.9f445","g":"60eeedcc.b3b4e4","name":"","algorithm":"AES","key":"pass","x":648,"y":1864,"wires":[["17211ba5.ffd3c4"]]},{"id":"17211ba5.ffd3c4","type":"json","z":"f40271d9.9f445","g":"60eeedcc.b3b4e4","name":"Format Response","property":"payload","action":"","pretty":false,"x":958,"y":1884,"wires":[["1d68bd2d.bf84b3"]]},{"id":"d4e20de3.5929c","type":"comment","z":"f40271d9.9f445","g":"60eeedcc.b3b4e4","name":"Setup http endpoint to send get request to to retrieve creds [more in details[","info":"Send get request from node red with user/pass to get creds","x":344,"y":1836,"wires":[]},{"id":"1f11cde2.b12a52","type":"comment","z":"f40271d9.9f445","g":"75f35ac5.b3d044","name":"Save encrypted data & retrieve later [link in details]","info":"Guide\nhttps://notenoughtech.com/featured/serving-credentials-with-nodered/\n\nGuide to retrieving and parsing creds with Tasker\nhttps://notenoughtech.com/tasker/tasker-credentials/","x":286,"y":1572,"wires":[]},{"id":"ce9833c6.1f571","type":"file","z":"f40271d9.9f445","g":"75f35ac5.b3d044","name":"save to credentials.txt","filename":"[{\"id\":\"4e6c8f73.8b8b5\",\"type\":\"tab\",\"label\":\"Credentials\",\"disabled\":false,\"info\":\"How to serve credentials with NodeRED\\n\\nRequires: https://github.com/baumblatt/node-red-contrib-crypto-js\\n\\nMore details on:[https://notenoughtech.com/home-automation/nodered-home-automation/serving-credentials-with-nodered/](https://notenoughtech.com/home-automation/nodered-home-automation/serving-credentials-with-nodered/)\"},{\"id\":\"e6cf7226.223fc\",\"type\":\"file in\",\"z\":\"4e6c8f73.8b8b5\",\"name\":\"Read Encrypted credentials\",\"filename\":\"credentials.txt\",\"format\":\"utf8\",\"chunk\":false,\"sendError\":false,\"x\":380,\"y\":220,\"wires\":[[\"86d72815.423228\"]]},{\"id\":\"d0beb1e1.d08cd\",\"type\":\"http response\",\"z\":\"4e6c8f73.8b8b5\",\"name\":\"GET reponse\",\"statusCode\":\"\",\"headers\":{},\"x\":1110,\"y\":220,\"wires\":[]},{\"id\":\"d1e9e77.d16ed18\",\"type\":\"http in\",\"z\":\"4e6c8f73.8b8b5\",\"name\":\"\",\"url\":\"/credentials\",\"method\":\"get\",\"upload\":false,\"swaggerDoc\":\"\",\"x\":140,\"y\":220,\"wires\":[[\"e6cf7226.223fc\"]]},{\"id\":\"a4d160f3.3d72\",\"type\":\"file\",\"z\":\"4e6c8f73.8b8b5\",\"name\":\"save to credentials.txt\",\"filename\":\"credentials.txt\",\"appendNewline\":true,\"createDir\":false,\"overwriteFile\":\"true\",\"x\":1020,\"y\":100,\"wires\":[[]]},{\"id\":\"5d9ef3e9.45144c\",\"type\":\"template\",\"z\":\"4e6c8f73.8b8b5\",\"name\":\"Write JSON\",\"field\":\"payload\",\"fieldType\":\"msg\",\"format\":\"json\",\"syntax\":\"mustache\",\"template\":\" {\\n\\\"NodeRED_IP\\\": \\\"192.168.1.183:1880\\\",\\n\\\"DNS\\\": \\\"DNS1.ddns.net\\\",\\n\\\"MQTT_user\\\": \\\"MQTTuser\\\",\\n\\\"MQTT_pass\\\": \\\"MQTTpass\\\",\\n\\\"HTTP_user\\\": \\\"HTTPuser\\\",\\n\\\"HTTP_pass\\\": \\\"HTTPpass\\\"\\n}\",\"output\":\"str\",\"x\":310,\"y\":100,\"wires\":[[\"ce4f89a2.8bdda8\"]]},{\"id\":\"42fc6378.241d4c\",\"type\":\"inject\",\"z\":\"4e6c8f73.8b8b5\",\"name\":\"\",\"topic\":\"\",\"payload\":\"\",\"payloadType\":\"date\",\"repeat\":\"\",\"crontab\":\"\",\"once\":false,\"onceDelay\":0.1,\"x\":140,\"y\":100,\"wires\":[[\"5d9ef3e9.45144c\"]]},{\"id\":\"ce4f89a2.8bdda8\",\"type\":\"encrypt\",\"z\":\"4e6c8f73.8b8b5\",\"name\":\"\",\"algorithm\":\"AES\",\"key\":\"pass\",\"x\":620,\"y\":120,\"wires\":[[\"a4d160f3.3d72\"]]},{\"id\":\"86d72815.423228\",\"type\":\"decrypt\",\"z\":\"4e6c8f73.8b8b5\",\"name\":\"\",\"algorithm\":\"AES\",\"key\":\"pass\",\"x\":620,\"y\":200,\"wires\":[[\"53090437.cffacc\"]]},{\"id\":\"53090437.cffacc\",\"type\":\"json\",\"z\":\"4e6c8f73.8b8b5\",\"name\":\"Format Response\",\"property\":\"payload\",\"action\":\"\",\"pretty\":false,\"x\":930,\"y\":220,\"wires\":[[\"d0beb1e1.d08cd\"]]},{\"id\":\"5836551c.77f12c\",\"type\":\"comment\",\"z\":\"4e6c8f73.8b8b5\",\"name\":\"Remove this flow when done\",\"info\":\"\",\"x\":200,\"y\":60,\"wires\":[]},{\"id\":\"b57a657c.d4e948\",\"type\":\"comment\",\"z\":\"4e6c8f73.8b8b5\",\"name\":\"Passphrase and Encryption type must match\",\"info\":\"\",\"x\":670,\"y\":160,\"wires\":[]}]","appendNewline":true,"createDir":false,"overwriteFile":"true","x":1048,"y":1656,"wires":[[]]},{"id":"19aed5cd.483e2a","type":"template","z":"f40271d9.9f445","g":"75f35ac5.b3d044","name":"Write JSON","field":"payload","fieldType":"msg","format":"json","syntax":"mustache","template":" {\n\"NodeRED_IP\": \"192.168.1.183:1880\",\n\"DNS\": \"DNS1.ddns.net\",\n\"MQTT_user\": \"MQTTuser\",\n\"MQTT_pass\": \"MQTTpass\",\n\"HTTP_user\": \"HTTPuser\",\n\"HTTP_pass\": \"HTTPpass\"\n}","output":"str","x":338,"y":1656,"wires":[["4dbcee24.c4911"]]},{"id":"461b3323.15622c","type":"inject","z":"f40271d9.9f445","g":"75f35ac5.b3d044","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":168,"y":1656,"wires":[["19aed5cd.483e2a"]]},{"id":"4dbcee24.c4911","type":"encrypt","z":"f40271d9.9f445","g":"75f35ac5.b3d044","name":"","algorithm":"AES","key":"pass","x":648,"y":1676,"wires":[["ce9833c6.1f571"]]},{"id":"ef23dae0.39a3d8","type":"comment","z":"f40271d9.9f445","g":"75f35ac5.b3d044","name":"Save credentiials - remove this flow when done - save password","info":"","x":338,"y":1616,"wires":[]},{"id":"ca56c064.dea37","type":"comment","z":"f40271d9.9f445","g":"75f35ac5.b3d044","name":"Passphrase and Encryption type must match","info":"","x":698,"y":1716,"wires":[]},{"id":"e99934000c0c41bb","type":"comment","z":"f40271d9.9f445","g":"5c70dc07dc72a49e","name":"Notes","info":"https://diyfuturism.com/index.php/2017/12/14/basic-node-red-flows-for-automating-lighting-with-home-assistant/\n\nIkea detector times out after 3 min so off timer \nadds on to this.","x":122,"y":3192,"wires":[]},{"id":"3be070a749d0b51a","type":"server-state-changed","z":"f40271d9.9f445","d":true,"g":"5c70dc07dc72a49e","name":"Ikea Motion Sensor","server":"3b49c004.6176a","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":"frontdoor_motion_enabled"},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.z2m_ikea_motiondetector02_frontdoor_occupancy","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":258,"y":3324,"wires":[["fd3fd8cd074c3d58"]]},{"id":"1edba7b17b904a23","type":"switch","z":"f40271d9.9f445","g":"5c70dc07dc72a49e","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":290,"y":3468,"wires":[["c27291b2272111ca","4bbbdfa406b1d12d"],["fe83d7a444f90529"]]},{"id":"4bbbdfa406b1d12d","type":"stoptimer","z":"f40271d9.9f445","g":"5c70dc07dc72a49e","duration":"60","units":"Second","payloadtype":"num","payloadval":"0","name":"60s (+ built in 3 min from Ikea detector)","x":1098,"y":3492,"wires":[["fe83d7a444f90529"],[]]},{"id":"cd39a597a948bb22","type":"api-call-service","z":"f40271d9.9f445","g":"5c70dc07dc72a49e","name":"Lights On","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.tasmo_shelly1pm_frontdoor","switch.tasmo_shelly1_garage_outside"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1476,"y":3384,"wires":[["37a9d8ea29095758"]]},{"id":"c27291b2272111ca","type":"api-current-state","z":"f40271d9.9f445","g":"5c70dc07dc72a49e","name":"Lights Already on?","server":"3b49c004.6176a","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.tasmo_shelly1pm_frontdoor","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1110,"y":3379,"wires":[[],["cd39a597a948bb22"]]},{"id":"fd3fd8cd074c3d58","type":"api-current-state","z":"f40271d9.9f445","g":"5c70dc07dc72a49e","name":"Motion Enabled?","server":"3b49c004.6176a","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.frontdoor_motion_enabled","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":642,"y":3360,"wires":[["c27291b2272111ca","4bbbdfa406b1d12d"],[]]},{"id":"a102d6c623031608","type":"mqtt in","z":"f40271d9.9f445","g":"5c70dc07dc72a49e","name":"Ikea 5-button Switch","topic":"zigbee2mqtt/z2m_ikea_5button02_htpc","qos":"2","datatype":"auto","broker":"e96cb00d.af953","inputs":0,"x":162,"y":3672,"wires":[["ea82b1a3858d83a1"]]},{"id":"ea82b1a3858d83a1","type":"json","z":"f40271d9.9f445","g":"5c70dc07dc72a49e","name":"","property":"payload","action":"","pretty":false,"x":326,"y":3672,"wires":[["76a6988493785b3f"]]},{"id":"76a6988493785b3f","type":"switch","z":"f40271d9.9f445","g":"5c70dc07dc72a49e","name":"Parse Switch Message","property":"payload.action","propertyType":"msg","rules":[{"t":"eq","v":"toggle","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":496,"y":3672,"wires":[["f15b7dad8a8c5fa6"]]},{"id":"f15b7dad8a8c5fa6","type":"api-current-state","z":"f40271d9.9f445","g":"5c70dc07dc72a49e","name":"Already on?","server":"3b49c004.6176a","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.z2m_ikea_bulb_wh02_frontdoor_light","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":682,"y":3672,"wires":[["fe83d7a444f90529"],["cd39a597a948bb22","4bbbdfa406b1d12d"]]},{"id":"d15d21931475e43d","type":"alexa-local","z":"f40271d9.9f445","g":"5c70dc07dc72a49e","devicename":"Front Door Lights","inputtrigger":true,"x":138,"y":3468,"wires":[["1edba7b17b904a23"]]},{"id":"fe83d7a444f90529","type":"api-call-service","z":"f40271d9.9f445","g":"5c70dc07dc72a49e","name":"Lights Off","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.tasmo_shelly1pm_frontdoor","switch.tasmo_shelly1_garage_outside"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1524,"y":3528,"wires":[["1cc819eed691763c"]]},{"id":"c902166650df4ccf","type":"inject","z":"f40271d9.9f445","g":"5c70dc07dc72a49e","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":290,"y":3252,"wires":[["fd3fd8cd074c3d58"]]},{"id":"7d0d3ad0550cb041","type":"inject","z":"f40271d9.9f445","g":"5c70dc07dc72a49e","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"off","payloadType":"str","x":290,"y":3288,"wires":[["fd3fd8cd074c3d58"]]},{"id":"a4699014c7ab3dbc","type":"eztimer","z":"f40271d9.9f445","g":"bf8bcd9739c85cfd","name":"","debug":false,"autoname":"sunsetStart - dawn","tag":"eztimer","suspended":false,"sendEventsOnSuspend":false,"lat":"55.9024","lon":"-3.6431","timerType":"1","startupMessage":true,"ontype":"1","ontimesun":"sunsetStart","ontimetod":"23:00","onpropertytype":"msg","onproperty":"payload","onvaluetype":"str","onvalue":"on","onoffset":"0","onrandomoffset":false,"onsuppressrepeats":false,"offtype":"1","offtimesun":"dawn","offtimetod":"22:30","offduration":"00:01:00","offpropertytype":"msg","offproperty":"payload","offvaluetype":"str","offvalue":"off","offoffset":"","offrandomoffset":false,"offsuppressrepeats":false,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"sun":true,"x":1146,"y":3228,"wires":[["1f113446a6c34572"]]},{"id":"1f113446a6c34572","type":"switch","z":"f40271d9.9f445","g":"bf8bcd9739c85cfd","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1406,"y":3228,"wires":[["256d645783461bb2"],["6673a9050f5a2fed"]]},{"id":"6673a9050f5a2fed","type":"api-call-service","z":"f40271d9.9f445","g":"bf8bcd9739c85cfd","name":"Motion Detection Disabled","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.frontdoor_motion_enabled"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1740,"y":3252,"wires":[[]]},{"id":"256d645783461bb2","type":"api-call-service","z":"f40271d9.9f445","g":"bf8bcd9739c85cfd","name":"Motion Detection Enabled","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.frontdoor_motion_enabled"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1730,"y":3204,"wires":[[]]},{"id":"bc138989cb749a2d","type":"inject","z":"f40271d9.9f445","g":"5c70dc07dc72a49e","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"off","payloadType":"str","x":1346,"y":3600,"wires":[["fe83d7a444f90529"]]},{"id":"37a9d8ea29095758","type":"api-call-service","z":"f40271d9.9f445","g":"5c70dc07dc72a49e","name":"Turn On Input Bool to Show Timer Is Running","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.frontdoor_motion_timer_running"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1814,"y":3384,"wires":[[]]},{"id":"1cc819eed691763c","type":"api-call-service","z":"f40271d9.9f445","g":"5c70dc07dc72a49e","name":"Turn Off Input Bool to Show Timer Is Stopped","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.frontdoor_motion_timer_running"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1814,"y":3528,"wires":[[]]},{"id":"5d4b48193c497d5f","type":"inject","z":"f40271d9.9f445","g":"5c70dc07dc72a49e","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":1334,"y":3324,"wires":[["cd39a597a948bb22"]]},{"id":"91a1aa41680d0b57","type":"server-state-changed","z":"f40271d9.9f445","d":true,"g":"5c70dc07dc72a49e","name":"Ring Doorbell Motion Detected","server":"3b49c004.6176a","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.front_door_motion","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":214,"y":3372,"wires":[["fd3fd8cd074c3d58"],[]]},{"id":"dc747341bb477bc3","type":"ha-wait-until","z":"f40271d9.9f445","g":"2b554b192bf0e233","name":"Wait Until Motion Gone - Ring","server":"3b49c004.6176a","version":1,"outputs":1,"entityId":"binary_sensor.front_door_motion","entityIdFilterType":"exact","property":"state","comparator":"is","value":"off","valueType":"str","timeout":0,"timeoutType":"num","timeoutUnits":"seconds","checkCurrentState":true,"blockInputOverrides":true,"entityLocation":"","entityLocationType":"none","x":1034,"y":2220,"wires":[["6b7571224162e746","bcd1ad16736e133e"]]},{"id":"611c90b19fbcfa88","type":"api-current-state","z":"f40271d9.9f445","g":"2b554b192bf0e233","name":"Is Motion Detection Enabled?","server":"3b49c004.6176a","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.outside_garage_motion_enabled","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":628,"y":2160,"wires":[["355ba9b5343f8a69","679a4802021f9629"],["e5e688ccb2821ffd","b72fd9e16e470fdc"]]},{"id":"6b7571224162e746","type":"api-call-service","z":"f40271d9.9f445","g":"2b554b192bf0e233","name":"Mark Timer Running","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.outside_garage_motion_timer_running"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1436,"y":2172,"wires":[[]]},{"id":"bcd1ad16736e133e","type":"trigger","z":"f40271d9.9f445","g":"2b554b192bf0e233","name":"","op1":"","op2":"off","op1type":"nul","op2type":"str","duration":"2","extend":false,"units":"min","reset":"","bytopic":"all","outputs":1,"x":1406,"y":2292,"wires":[["3baf21b855479785","f06ac9763c070697","277e154275a1f490"]]},{"id":"3baf21b855479785","type":"api-call-service","z":"f40271d9.9f445","g":"2b554b192bf0e233","name":"Mark Timer Stopped","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.outside_garage_motion_timer_running"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1772,"y":2304,"wires":[[]]},{"id":"075ce852631e8a27","type":"api-current-state","z":"f40271d9.9f445","g":"2b554b192bf0e233","name":"Is Timer Running?","server":"3b49c004.6176a","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.outside_garage_motion_timer_running","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":598,"y":2436,"wires":[["f34bc0f6c456b453"],[]]},{"id":"f34bc0f6c456b453","type":"change","z":"f40271d9.9f445","g":"2b554b192bf0e233","name":"Set Reset Payload","rules":[{"t":"set","p":"reset","pt":"msg","to":"reset","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":898,"y":2436,"wires":[["bcd1ad16736e133e","2d5b9c047d01dc2b"]]},{"id":"7e0afc14ef855b27","type":"inject","z":"f40271d9.9f445","g":"2b554b192bf0e233","name":"Test - reset","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"off","payload":"off","payloadType":"str","x":628,"y":2496,"wires":[["f34bc0f6c456b453"]]},{"id":"9f7d0e250afa4e58","type":"inject","z":"f40271d9.9f445","g":"2b554b192bf0e233","name":"Test - start timer","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"off","payload":"off","payloadType":"str","x":1068,"y":2316,"wires":[["bcd1ad16736e133e"]]},{"id":"2d5b9c047d01dc2b","type":"api-call-service","z":"f40271d9.9f445","g":"2b554b192bf0e233","name":"Mark Timer Stopped","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.outside_garage_motion_timer_running"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1496,"y":2412,"wires":[[]]},{"id":"355ba9b5343f8a69","type":"api-call-service","z":"f40271d9.9f445","g":"2b554b192bf0e233","name":"Garage Door Lights On","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.shelly1_garage_outside"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1014,"y":2088,"wires":[[]]},{"id":"e5e688ccb2821ffd","type":"api-call-service","z":"f40271d9.9f445","g":"2b554b192bf0e233","name":"Front Door Lights On","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.z2m_ikea_bulb_wh02_frontdoor_light","light.z2m_ikea_bulb_wh03_frontdoor_light"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1004,"y":2136,"wires":[[]]},{"id":"679a4802021f9629","type":"ha-wait-until","z":"f40271d9.9f445","g":"2b554b192bf0e233","name":"Wait Until Motion Gone - Ikea","server":"3b49c004.6176a","version":1,"outputs":1,"entityId":"binary_sensor.z2m_ikea_motiondetector02_frontdoor_occupancy","entityIdFilterType":"exact","property":"state","comparator":"is","value":"off","valueType":"str","timeout":0,"timeoutType":"num","timeoutUnits":"seconds","checkCurrentState":true,"blockInputOverrides":true,"entityLocation":"","entityLocationType":"none","x":1024,"y":2268,"wires":[["bcd1ad16736e133e","6b7571224162e746"]]},{"id":"f06ac9763c070697","type":"api-call-service","z":"f40271d9.9f445","g":"2b554b192bf0e233","name":"Garage Door Lights Off","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.shelly1_garage_outside"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1782,"y":2208,"wires":[[]]},{"id":"277e154275a1f490","type":"api-call-service","z":"f40271d9.9f445","g":"2b554b192bf0e233","name":"Front Door Lights Off","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.z2m_ikea_bulb_wh02_frontdoor_light","light.z2m_ikea_bulb_wh03_frontdoor_light"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1772,"y":2256,"wires":[[]]},{"id":"994bf86fdc860127","type":"inject","z":"f40271d9.9f445","g":"2b554b192bf0e233","name":"Test - off","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"off","payload":"off","payloadType":"str","x":244,"y":2424,"wires":[["611c90b19fbcfa88"]]},{"id":"7248ee8e2aa0f56e","type":"inject","z":"f40271d9.9f445","g":"2b554b192bf0e233","name":"Test - on","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"on","payload":"on","payloadType":"str","x":232,"y":2076,"wires":[["611c90b19fbcfa88"]]},{"id":"b72fd9e16e470fdc","type":"api-call-service","z":"f40271d9.9f445","g":"2b554b192bf0e233","name":"Front Door Lights Off","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.z2m_ikea_bulb_wh02_frontdoor_light","light.z2m_ikea_bulb_wh03_frontdoor_light"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":776,"y":2292,"wires":[[]]},{"id":"27f2fde9499830f6","type":"server-state-changed","z":"f40271d9.9f445","g":"2b554b192bf0e233","name":"Ring Doorbell Motion Detected","server":"3b49c004.6176a","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.front_door_motion","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":230,"y":2196,"wires":[["611c90b19fbcfa88"],["075ce852631e8a27"]]},{"id":"2be1d4cbb89c1740","type":"server-state-changed","z":"f40271d9.9f445","g":"2b554b192bf0e233","name":"Ikea Motion Sensor","server":"3b49c004.6176a","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.z2m_ikea_motiondetector02_frontdoor_occupancy","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":274,"y":2148,"wires":[["611c90b19fbcfa88"],["075ce852631e8a27"]]},{"id":"b087fe3a25410931","type":"comment","z":"f40271d9.9f445","g":"2b554b192bf0e233","name":"Front Door Lights - Initial config for motion sensing","info":"","x":254,"y":2016,"wires":[]},{"id":"3410498393024ace","type":"server-state-changed","z":"f40271d9.9f445","g":"34db8f418e4e34f2","name":"Ring Doorbell Motion Detected","server":"3b49c004.6176a","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.front_door_motion","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":194,"y":2724,"wires":[["63392435c8073047","2866e5eedf142503","344df1ee6fc5c23e"],["ec8c8ab5f8b6addc","671f103f49433a42"]]},{"id":"61a8f98898f9f4ee","type":"api-call-service","z":"f40271d9.9f445","g":"34db8f418e4e34f2","name":"Turn Off Input Bool to Show Timer Is Stopped","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.frontdoor_motion_timer_running"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1470,"y":2820,"wires":[[]]},{"id":"c49c1eb13f49df82","type":"api-call-service","z":"f40271d9.9f445","g":"34db8f418e4e34f2","name":"Lights Off","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.tasmo_shelly1pm_frontdoor","switch.tasmo_shelly1_garage_outside"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"payload","output_location_type":"none","x":1180,"y":2820,"wires":[["61a8f98898f9f4ee","372a022f818d1443"]]},{"id":"63392435c8073047","type":"api-current-state","z":"f40271d9.9f445","g":"34db8f418e4e34f2","name":"Motion Enabled?","server":"3b49c004.6176a","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.frontdoor_motion_enabled","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":586,"y":2688,"wires":[["1e3facf64a475f6f","b4265a5c7f2934c7"],[]]},{"id":"b4265a5c7f2934c7","type":"api-call-service","z":"f40271d9.9f445","g":"34db8f418e4e34f2","name":"Lights On","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.tasmo_shelly1pm_frontdoor","switch.tasmo_shelly1_garage_outside"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"payload","output_location_type":"none","x":1180,"y":2676,"wires":[["1b013332450326bb","0664409110572893"]]},{"id":"1b013332450326bb","type":"api-call-service","z":"f40271d9.9f445","g":"34db8f418e4e34f2","name":"Turn On Input Bool to Show Timer Is Running","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.frontdoor_motion_timer_running"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1518,"y":2664,"wires":[[]]},{"id":"1e3facf64a475f6f","type":"debug","z":"f40271d9.9f445","g":"34db8f418e4e34f2","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":697.6666870117188,"y":2622,"wires":[]},{"id":"90dd352a2fc9cbad","type":"debug","z":"f40271d9.9f445","g":"34db8f418e4e34f2","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":846,"y":2736,"wires":[]},{"id":"0664409110572893","type":"debug","z":"f40271d9.9f445","g":"34db8f418e4e34f2","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1290,"y":2592,"wires":[]},{"id":"372a022f818d1443","type":"debug","z":"f40271d9.9f445","g":"34db8f418e4e34f2","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1338,"y":2892,"wires":[]},{"id":"36143433f9fd5402","type":"debug","z":"f40271d9.9f445","g":"34db8f418e4e34f2","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":918,"y":2856,"wires":[]},{"id":"2866e5eedf142503","type":"debug","z":"f40271d9.9f445","g":"34db8f418e4e34f2","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":426,"y":2640,"wires":[]},{"id":"ec8c8ab5f8b6addc","type":"trigger","z":"f40271d9.9f445","g":"34db8f418e4e34f2","name":"","op1":"","op2":"off","op1type":"nul","op2type":"str","duration":"30","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":710,"y":2820,"wires":[["36143433f9fd5402","c49c1eb13f49df82"]]},{"id":"671f103f49433a42","type":"debug","z":"f40271d9.9f445","g":"34db8f418e4e34f2","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":366,"y":2844,"wires":[]},{"id":"344df1ee6fc5c23e","type":"change","z":"f40271d9.9f445","g":"34db8f418e4e34f2","name":"Set payload - cancel off timer","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":628,"y":2748,"wires":[["ec8c8ab5f8b6addc","90dd352a2fc9cbad"]]},{"id":"bbc611e1.23115","type":"server-state-changed","z":"f40271d9.9f445","g":"8bbc612a.3c21c","name":"Input Select - Power TV","server":"3b49c004.6176a","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_select.power_tv","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":2464,"y":2136,"wires":[["5fb129db.76d978"]]},{"id":"5fb129db.76d978","type":"switch","z":"f40271d9.9f445","g":"8bbc612a.3c21c","name":"Switch Input","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"None","vt":"str"},{"t":"eq","v":"Wake","vt":"str"},{"t":"eq","v":"Suspend","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":2746,"y":2136,"wires":[[],["dd650f83.a82488","266bf7.901eb40a"],["aca9e3a0.700d9"]]},{"id":"e493c396.e7279","type":"api-call-service","z":"f40271d9.9f445","g":"8bbc612a.3c21c","name":"Set Input Select to None","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"input_select","service":"select_option","areaId":[],"deviceId":[],"entityId":["input_select.power_tv"],"data":"{\"option\":\"None\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":4358,"y":2040,"wires":[[]]},{"id":"300b869a.fab05a","type":"inject","z":"f40271d9.9f445","g":"8bbc612a.3c21c","name":"Test - off","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"off","payload":"","payloadType":"str","x":2448,"y":1884,"wires":[["b678cc41.7acec"]]},{"id":"ac7cd25f.35d0d","type":"inject","z":"f40271d9.9f445","g":"8bbc612a.3c21c","name":"Test - on","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"on","payload":"","payloadType":"str","x":2448,"y":1848,"wires":[["b678cc41.7acec"]]},{"id":"6fc80cfd.e66a34","type":"mqtt in","z":"f40271d9.9f445","g":"8bbc612a.3c21c","name":"Ikea 5-button Switch","topic":"zigbee2mqtt/z2m_ikea_5button02_htpc","qos":"2","datatype":"auto","broker":"e96cb00d.af953","inputs":0,"x":2442,"y":1956,"wires":[["4870478.23603b8"]]},{"id":"4870478.23603b8","type":"json","z":"f40271d9.9f445","g":"8bbc612a.3c21c","name":"","property":"payload","action":"","pretty":false,"x":2606,"y":1956,"wires":[["72a742a3.629cdc","d59ca95.2a21a58"]]},{"id":"72a742a3.629cdc","type":"switch","z":"f40271d9.9f445","g":"8bbc612a.3c21c","name":"Parse Switch Message","property":"payload.action","propertyType":"msg","rules":[{"t":"eq","v":"brightness_up_click","vt":"str"},{"t":"eq","v":"brightness_down_click","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":2812,"y":1956,"wires":[["dd650f83.a82488","266bf7.901eb40a"],["aca9e3a0.700d9"]]},{"id":"52026761.249d98","type":"comment","z":"f40271d9.9f445","g":"8bbc612a.3c21c","name":"MQTT directly instead of HA input (read more inside)","info":"Using zigbee2mqtt's MQTT messages directly \nhere to work with Ikea buttons instead of\nHA's switch input.\n\nNote the 5-button unit has many more possible \nstates since holding and releasing buttons also\ncause MQTT updates including duration of hold.\n\nJust a proof of concept to work out how to do it.\n\nOnly downside is that HA won't know current switch \nstate since bypassing HA in the loop but don't\nreally need it in this case.\n\nNeed to parse MQTT payload with json node\nbefore being able to get values.\n\nAnd we can't use toggle button to toggle on/off\nunless we want to save the state of the TV somewhere\nor pull the state from somewhere as part of flow.\nCould be possible by pinging TV maybe or tracking\nlast MQTT message value from plug constantly and\nsaving in variable.\nBut easier just to use the brightness buttons to\ndo on/off.","x":2650,"y":1992,"wires":[]},{"id":"d59ca95.2a21a58","type":"debug","z":"f40271d9.9f445","g":"8bbc612a.3c21c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":2748,"y":1860,"wires":[]},{"id":"b678cc41.7acec","type":"alexa-local","z":"f40271d9.9f445","g":"8bbc612a.3c21c","devicename":"Television","inputtrigger":false,"x":2556,"y":1704,"wires":[["ff252afc.a107b8"]]},{"id":"ff252afc.a107b8","type":"switch","z":"f40271d9.9f445","g":"8bbc612a.3c21c","name":"Turn On/Off?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":2770,"y":1716,"wires":[["dd650f83.a82488","266bf7.901eb40a"],["aca9e3a0.700d9"]]},{"id":"129c2a9b.035335","type":"api-call-service","z":"f40271d9.9f445","g":"8bbc612a.3c21c","name":"Turn on TV","server":"3b49c004.6176a","version":5,"debugenabled":true,"domain":"media_player","service":"turn_on","areaId":[],"deviceId":[],"entityId":["media_player.living_room_tv_wired"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":3322,"y":1860,"wires":[[]]},{"id":"aca9e3a0.700d9","type":"api-call-service","z":"f40271d9.9f445","g":"8bbc612a.3c21c","name":"Turn off TV","server":"3b49c004.6176a","version":5,"debugenabled":true,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":["media_player.living_room_tv_wired"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":3332.5078125,"y":1908.0234375,"wires":[["e493c396.e7279"]]},{"id":"266bf7.901eb40a","type":"delay","z":"f40271d9.9f445","g":"8bbc612a.3c21c","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":3312,"y":1764,"wires":[["35255c12.bc86d4"]]},{"id":"35255c12.bc86d4","type":"api-call-service","z":"f40271d9.9f445","g":"8bbc612a.3c21c","name":"TV Source: Disney+","server":"3b49c004.6176a","version":5,"debugenabled":true,"domain":"media_player","service":"select_source","areaId":[],"deviceId":[],"entityId":["media_player.living_room_tv_wired"],"data":"{\"source\":\"Disney+\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":3604,"y":1764,"wires":[["e493c396.e7279"]]},{"id":"dd650f83.a82488","type":"wake on lan","z":"f40271d9.9f445","g":"8bbc612a.3c21c","mac":"58:FD:B1:6B:F1:29","host":"192.168.30.254","udpport":9,"name":"WOL - TV","x":3312,"y":1728,"wires":[]},{"id":"d8d9a83c.16b388","type":"server-state-changed","z":"f40271d9.9f445","g":"7b10225a.94ce1c","name":"Input Select - Power Desktop","server":"3b49c004.6176a","version":4,"entityidfilter":"input_select.power_desktop","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":1872,"y":192,"wires":[["37a09293.8b015e"]]},{"id":"37a09293.8b015e","type":"switch","z":"f40271d9.9f445","g":"7b10225a.94ce1c","name":"Switch Input","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"None","vt":"str"},{"t":"eq","v":"Wake On LAN","vt":"str"},{"t":"eq","v":"Suspend","vt":"str"},{"t":"eq","v":"Poweroff","vt":"str"},{"t":"eq","v":"Force Poweroff","vt":"str"},{"t":"eq","v":"Reboot","vt":"str"},{"t":"eq","v":"Test","vt":"str"}],"checkall":"true","repair":false,"outputs":7,"x":2112,"y":192,"wires":[[],["c0e51d6.e8bffe"],["2f3252dc.aa29be"],["4729263b.8304c8"],["a1dd6393.ea697"],["757e4f34.9886"],["5fd401e4.aef69"]]},{"id":"757e4f34.9886","type":"api-call-service","z":"f40271d9.9f445","g":"7b10225a.94ce1c","name":"Shell Cmd","server":"3b49c004.6176a","version":5,"domain":"shell_command","service":"sol_desktop_reboot","areaId":[],"deviceId":[],"entityId":[],"data":"","mergeContext":"","outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":2312,"y":252,"wires":[["fd73c95d.55ed58"]]},{"id":"2f3252dc.aa29be","type":"api-call-service","z":"f40271d9.9f445","g":"7b10225a.94ce1c","name":"Shell Cmd","server":"3b49c004.6176a","version":5,"domain":"shell_command","service":"sol_desktop_suspend","areaId":[],"deviceId":[],"entityId":[],"data":"","mergeContext":"","outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":2312,"y":132,"wires":[["fd73c95d.55ed58"]]},{"id":"4729263b.8304c8","type":"api-call-service","z":"f40271d9.9f445","g":"7b10225a.94ce1c","name":"Shell Cmd","server":"3b49c004.6176a","version":5,"domain":"shell_command","service":"sol_desktop_poweroff","areaId":[],"deviceId":[],"entityId":[],"data":"","mergeContext":"","outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":2312,"y":172,"wires":[["fd73c95d.55ed58"]]},{"id":"a1dd6393.ea697","type":"api-call-service","z":"f40271d9.9f445","g":"7b10225a.94ce1c","name":"Shell Cmd","server":"3b49c004.6176a","version":5,"domain":"shell_command","service":"sol_desktop_forcepoweroff","areaId":[],"deviceId":[],"entityId":[],"data":"","mergeContext":"","outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":2312,"y":212,"wires":[["fd73c95d.55ed58"]]},{"id":"c0e51d6.e8bffe","type":"api-call-service","z":"f40271d9.9f445","g":"7b10225a.94ce1c","name":"Shell Cmd","server":"3b49c004.6176a","version":5,"domain":"shell_command","service":"wol_desktop","areaId":[],"deviceId":[],"entityId":[],"data":"","mergeContext":"","outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":2312,"y":92,"wires":[["fd73c95d.55ed58"]]},{"id":"5fd401e4.aef69","type":"api-call-service","z":"f40271d9.9f445","g":"7b10225a.94ce1c","name":"Shell Cmd","server":"3b49c004.6176a","version":5,"domain":"shell_command","service":"sol_desktop_test","areaId":[],"deviceId":[],"entityId":[],"data":"","mergeContext":"","outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":2312,"y":292,"wires":[["fd73c95d.55ed58"]]},{"id":"fd73c95d.55ed58","type":"api-call-service","z":"f40271d9.9f445","g":"7b10225a.94ce1c","name":"Set Input Select to None","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"input_select","service":"select_option","areaId":[],"deviceId":[],"entityId":["input_select.power_desktop"],"data":"{\"option\":\"None\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":2682,"y":292,"wires":[[]]},{"id":"b44967e4.0904f8","type":"alexa-local","z":"f40271d9.9f445","g":"1b818000.2352e","devicename":"TV Netflix","inputtrigger":false,"x":2448,"y":2436,"wires":[["28afee4.de3bf12"]]},{"id":"99ee333d.2be1e","type":"api-call-service","z":"f40271d9.9f445","g":"1b818000.2352e","name":"TV Source: Netflix","server":"3b49c004.6176a","version":5,"debugenabled":true,"domain":"media_player","service":"select_source","areaId":[],"deviceId":[],"entityId":["media_player.living_room_tv_wired"],"data":"{\"source\":\"Netflix\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":3006,"y":2424,"wires":[[]]},{"id":"c38141dc.8886a","type":"delay","z":"f40271d9.9f445","g":"1b818000.2352e","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":2770,"y":2448,"wires":[["99ee333d.2be1e"]]},{"id":"b0fbe5d5.787878","type":"wake on lan","z":"f40271d9.9f445","g":"1b818000.2352e","mac":"58:FD:B1:6B:F1:29","host":"192.168.30.254","udpport":9,"name":"WOL - TV","x":2770,"y":2484,"wires":[]},{"id":"28afee4.de3bf12","type":"api-current-state","z":"f40271d9.9f445","g":"1b818000.2352e","name":"Is TV on?","server":"3b49c004.6176a","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"media_player.living_room_tv_wired","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2602,"y":2436,"wires":[["99ee333d.2be1e"],["b0fbe5d5.787878","c38141dc.8886a"]]},{"id":"a266a84.e529c58","type":"alexa-local","z":"f40271d9.9f445","g":"c7f4a247.24ddf","devicename":"TV Chromecast","inputtrigger":false,"x":2468,"y":2604,"wires":[["e15fa29a.ad4eb"]]},{"id":"88f8392.5a486c8","type":"api-call-service","z":"f40271d9.9f445","g":"c7f4a247.24ddf","name":"TV Source: Chromecast","server":"3b49c004.6176a","version":5,"debugenabled":true,"domain":"media_player","service":"select_source","areaId":[],"deviceId":[],"entityId":["media_player.living_room_tv_wired"],"data":"{\"source\":\"Chromecast\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":2988,"y":2592,"wires":[[]]},{"id":"6034cac5.da1034","type":"delay","z":"f40271d9.9f445","g":"c7f4a247.24ddf","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":2770,"y":2616,"wires":[["88f8392.5a486c8"]]},{"id":"cc2c6949.61fc48","type":"wake on lan","z":"f40271d9.9f445","g":"c7f4a247.24ddf","mac":"58:FD:B1:6B:F1:29","host":"192.168.30.254","udpport":9,"name":"WOL - TV","x":2770,"y":2652,"wires":[]},{"id":"e15fa29a.ad4eb","type":"api-current-state","z":"f40271d9.9f445","g":"c7f4a247.24ddf","name":"Is TV on?","server":"3b49c004.6176a","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"media_player.living_room_tv_wired","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2628,"y":2604,"wires":[["88f8392.5a486c8"],["cc2c6949.61fc48","6034cac5.da1034"]]},{"id":"ba5ebc76.336b2","type":"alexa-local","z":"f40271d9.9f445","g":"ff03c6b0.3ed978","devicename":"TV Disney","inputtrigger":false,"x":2458,"y":2280,"wires":[["d70275e0.529ca8"]]},{"id":"3c40958a.bbfd1a","type":"api-call-service","z":"f40271d9.9f445","g":"ff03c6b0.3ed978","name":"TV Source: Disney+","server":"3b49c004.6176a","version":5,"debugenabled":true,"domain":"media_player","service":"select_source","areaId":[],"deviceId":[],"entityId":["media_player.living_room_tv_wired"],"data":"{\"source\":\"Disney+\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":3004,"y":2268,"wires":[[]]},{"id":"cf497f93.bed4d","type":"delay","z":"f40271d9.9f445","g":"ff03c6b0.3ed978","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":2770,"y":2292,"wires":[["3c40958a.bbfd1a"]]},{"id":"36667e2c.40ded2","type":"wake on lan","z":"f40271d9.9f445","g":"ff03c6b0.3ed978","mac":"58:FD:B1:6B:F1:29","host":"192.168.30.254","udpport":9,"numpackets":"","interval":"","name":"WOL - TV","x":2770,"y":2328,"wires":[]},{"id":"d70275e0.529ca8","type":"api-current-state","z":"f40271d9.9f445","g":"ff03c6b0.3ed978","name":"Is TV on?","server":"3b49c004.6176a","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"media_player.living_room_tv_wired","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2616,"y":2280,"wires":[["3c40958a.bbfd1a"],["36667e2c.40ded2","cf497f93.bed4d"]]},{"id":"4e4cb88a.7f7ce8","type":"alexa-local","z":"f40271d9.9f445","g":"5c3424b6.5bab8c","devicename":"TV Amazon","inputtrigger":false,"x":2458,"y":2760,"wires":[["594fbd1a.935334"]]},{"id":"ce3aedc9.d0e64","type":"api-call-service","z":"f40271d9.9f445","g":"5c3424b6.5bab8c","name":"TV Source: Prime Video","server":"3b49c004.6176a","version":5,"debugenabled":true,"domain":"media_player","service":"select_source","areaId":[],"deviceId":[],"entityId":["media_player.living_room_tv_wired"],"data":"{\"source\":\"Amazon Prime Video\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":2983,"y":2754,"wires":[[]]},{"id":"c79d6e90.0f5a1","type":"delay","z":"f40271d9.9f445","g":"5c3424b6.5bab8c","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":2765,"y":2772,"wires":[["ce3aedc9.d0e64"]]},{"id":"1224e837.f4ba38","type":"wake on lan","z":"f40271d9.9f445","g":"5c3424b6.5bab8c","mac":"58:FD:B1:6B:F1:29","host":"192.168.30.254","udpport":9,"name":"WOL - TV","x":2765,"y":2808,"wires":[]},{"id":"594fbd1a.935334","type":"api-current-state","z":"f40271d9.9f445","g":"5c3424b6.5bab8c","name":"Is TV on?","server":"3b49c004.6176a","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"media_player.living_room_tv_wired","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2609,"y":2760,"wires":[["ce3aedc9.d0e64"],["1224e837.f4ba38","c79d6e90.0f5a1"]]},{"id":"2082c0.94345d4","type":"comment","z":"fd8eb98d.2d1be8","name":"https://github.com/thehookup/Node-RED-Examples","info":"","x":190,"y":40,"wires":[]},{"id":"e8f5fb58.f89118","type":"switch","z":"fd8eb98d.2d1be8","g":"a6353282da12ad38","name":"On/Off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"ON","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":382,"y":168,"wires":[["848e82ca.5f03"]]},{"id":"d2310a40.7d51d8","type":"rbe","z":"fd8eb98d.2d1be8","g":"a6353282da12ad38","name":"RBE","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":302,"y":288,"wires":[["e8f5fb58.f89118"]]},{"id":"d001c70.7ce0238","type":"mqtt out","z":"fd8eb98d.2d1be8","g":"a6353282da12ad38","name":"Send to Wake Alarm","topic":"SunriseMCU/wakeAlarm","qos":"0","retain":"false","broker":"e96cb00d.af953","x":832,"y":168,"wires":[]},{"id":"ed7f2664.af4078","type":"change","z":"fd8eb98d.2d1be8","g":"a6353282da12ad38","name":"Set to 300","rules":[{"t":"set","p":"payload","pt":"msg","to":"300","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":692,"y":288,"wires":[["d001c70.7ce0238"]]},{"id":"848e82ca.5f03","type":"api-current-state","z":"fd8eb98d.2d1be8","g":"a6353282da12ad38","name":"School Day HA","server":"3b49c004.6176a","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"calendar.reminders_gmail_com","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":492,"y":288,"wires":[["66e64a1e.c8ce84"]]},{"id":"66e64a1e.c8ce84","type":"switch","z":"fd8eb98d.2d1be8","g":"a6353282da12ad38","name":"","property":"data.attributes.message","propertyType":"msg","rules":[{"t":"eq","v":"School","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":602,"y":168,"wires":[["ed7f2664.af4078"]]},{"id":"fa18c462.2bd5c8","type":"delay","z":"fd8eb98d.2d1be8","g":"a6353282da12ad38","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":452,"y":358,"wires":[["7d6eb648.93e3f8"]]},{"id":"a37ef7e9.708aa8","type":"rbe","z":"fd8eb98d.2d1be8","g":"a6353282da12ad38","name":"RBE","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":362,"y":418,"wires":[["fa18c462.2bd5c8"]]},{"id":"7d6eb648.93e3f8","type":"switch","z":"fd8eb98d.2d1be8","g":"a6353282da12ad38","name":"On/Off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"ON","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":542,"y":418,"wires":[["ec9bb865.2a91e8"]]},{"id":"ec9bb865.2a91e8","type":"api-current-state","z":"fd8eb98d.2d1be8","g":"a6353282da12ad38","name":"School Day HA","server":"3b49c004.6176a","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"calendar.reminders_gmail_com","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":652,"y":358,"wires":[["344e354c.42990a"]]},{"id":"344e354c.42990a","type":"switch","z":"fd8eb98d.2d1be8","g":"a6353282da12ad38","name":"","property":"data.attributes.message","propertyType":"msg","rules":[{"t":"eq","v":"School","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":742,"y":418,"wires":[["a2aa50f5.5cb92"]]},{"id":"a2aa50f5.5cb92","type":"trigger","z":"fd8eb98d.2d1be8","g":"a6353282da12ad38","name":"Yellow","op1":"FF40000000","op2":"next","op1type":"str","op2type":"str","duration":"10","extend":false,"units":"min","reset":"","bytopic":"all","outputs":1,"x":922,"y":358,"wires":[["40f9dfac.fae8b"]]},{"id":"40f9dfac.fae8b","type":"switch","z":"fd8eb98d.2d1be8","g":"a6353282da12ad38","name":"next","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"next","vt":"str"},{"t":"eq","v":"next","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1062,"y":358,"wires":[["ca8115bb.5fd158"],["72935d22.0eb324"]]},{"id":"72935d22.0eb324","type":"trigger","z":"fd8eb98d.2d1be8","g":"a6353282da12ad38","name":"green","op1":"00FF000000","op2":"next","op1type":"str","op2type":"str","duration":"10","extend":false,"units":"min","reset":"","bytopic":"all","outputs":1,"x":922,"y":418,"wires":[["bceacb1d.43b6a8"]]},{"id":"bceacb1d.43b6a8","type":"switch","z":"fd8eb98d.2d1be8","g":"a6353282da12ad38","name":"next","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"next","vt":"str"},{"t":"eq","v":"next","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1062,"y":418,"wires":[["ca8115bb.5fd158"],["fc9b9065.c827"]]},{"id":"fc9b9065.c827","type":"trigger","z":"fd8eb98d.2d1be8","g":"a6353282da12ad38","name":"pink","op1":"1000030000","op2":"next","op1type":"str","op2type":"str","duration":"10","extend":false,"units":"min","reset":"","bytopic":"all","outputs":1,"x":922,"y":478,"wires":[["eb8fa758.1228a8"]]},{"id":"eb8fa758.1228a8","type":"switch","z":"fd8eb98d.2d1be8","g":"a6353282da12ad38","name":"next","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"next","vt":"str"},{"t":"eq","v":"next","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1062,"y":478,"wires":[["ca8115bb.5fd158"],[]]},{"id":"ca8115bb.5fd158","type":"mqtt out","z":"fd8eb98d.2d1be8","g":"a6353282da12ad38","name":"","topic":"cmnd/Tuya_Bulb_2/COLOR","qos":"","retain":"","broker":"e96cb00d.af953","x":1312,"y":418,"wires":[]},{"id":"af85b53f.0bb108","type":"rbe","z":"fd8eb98d.2d1be8","g":"a6353282da12ad38","name":"RBE","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":362,"y":598,"wires":[["d296030e.c2e88"]]},{"id":"d296030e.c2e88","type":"switch","z":"fd8eb98d.2d1be8","g":"a6353282da12ad38","name":"On/Off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"ON","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":542,"y":598,"wires":[["b3ec4f9e.4ba1d"]]},{"id":"b3ec4f9e.4ba1d","type":"api-current-state","z":"fd8eb98d.2d1be8","g":"a6353282da12ad38","name":"Nonschool Day HA","server":"3b49c004.6176a","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"calendar.reminders_gmail_com","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":662,"y":538,"wires":[["e5c90d09.8119"]]},{"id":"e5c90d09.8119","type":"switch","z":"fd8eb98d.2d1be8","g":"a6353282da12ad38","name":"","property":"data.attributes.message","propertyType":"msg","rules":[{"t":"eq","v":"Nonschool","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":742,"y":598,"wires":[["bf5e51d3.37128"]]},{"id":"bf5e51d3.37128","type":"trigger","z":"fd8eb98d.2d1be8","g":"a6353282da12ad38","name":"Yellow","op1":"FF40000000","op2":"next","op1type":"str","op2type":"str","duration":"45","extend":false,"units":"min","reset":"","bytopic":"all","outputs":1,"x":922,"y":538,"wires":[["d48c9d1c.634ca"]]},{"id":"d48c9d1c.634ca","type":"switch","z":"fd8eb98d.2d1be8","g":"a6353282da12ad38","name":"next","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"next","vt":"str"},{"t":"eq","v":"next","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1062,"y":538,"wires":[["78a67328.e9e72c"],["7aebad9.f0d8d54"]]},{"id":"7aebad9.f0d8d54","type":"trigger","z":"fd8eb98d.2d1be8","g":"a6353282da12ad38","name":"green","op1":"00FF000000","op2":"next","op1type":"str","op2type":"str","duration":"30","extend":false,"units":"min","reset":"","bytopic":"all","outputs":1,"x":922,"y":598,"wires":[["60002366.e4da3c"]]},{"id":"60002366.e4da3c","type":"switch","z":"fd8eb98d.2d1be8","g":"a6353282da12ad38","name":"next","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"next","vt":"str"},{"t":"eq","v":"next","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1062,"y":598,"wires":[["78a67328.e9e72c"],["28031ca0.336ab4"]]},{"id":"28031ca0.336ab4","type":"trigger","z":"fd8eb98d.2d1be8","g":"a6353282da12ad38","name":"pink","op1":"1000030000","op2":"next","op1type":"str","op2type":"str","duration":"10","extend":false,"units":"min","reset":"","bytopic":"all","outputs":1,"x":922,"y":658,"wires":[["c4945f19.69f57"]]},{"id":"c4945f19.69f57","type":"switch","z":"fd8eb98d.2d1be8","g":"a6353282da12ad38","name":"next","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"next","vt":"str"},{"t":"eq","v":"next","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1062,"y":658,"wires":[["78a67328.e9e72c"],[]]},{"id":"78a67328.e9e72c","type":"mqtt out","z":"fd8eb98d.2d1be8","g":"a6353282da12ad38","name":"","topic":"cmnd/Tuya_Bulb_2/COLOR","qos":"","retain":"","broker":"e96cb00d.af953","x":1312,"y":598,"wires":[]},{"id":"593c4c6e.8f1e74","type":"comment","z":"fd8eb98d.2d1be8","g":"a6353282da12ad38","name":"https://github.com/thehookup/Node-RED-Examples/blob/master/Calendar_Flow.json","info":"","x":322,"y":128,"wires":[]},{"id":"1ae3495c.b8fec7","type":"light-scheduler","z":"fd8eb98d.2d1be8","g":"a6353282da12ad38","settings":"39451665.94000a","events":"[{\"start\":{\"dow\":1,\"mod\":405},\"end\":{\"dow\":1,\"mod\":420}},{\"start\":{\"dow\":2,\"mod\":405},\"end\":{\"dow\":2,\"mod\":420}},{\"start\":{\"dow\":3,\"mod\":405},\"end\":{\"dow\":3,\"mod\":420}},{\"start\":{\"dow\":4,\"mod\":405},\"end\":{\"dow\":4,\"mod\":420}},{\"start\":{\"dow\":5,\"mod\":405},\"end\":{\"dow\":5,\"mod\":420}}]","topic":"","name":"Sunrise","onPayload":"ON","onPayloadType":"str","offPayload":"OFF","offPayloadType":"str","onlyWhenDark":false,"scheduleRndMax":"","sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange","x":212,"y":168,"wires":[["d2310a40.7d51d8"]]},{"id":"adec1c9f.5b5ea","type":"light-scheduler","z":"fd8eb98d.2d1be8","g":"a6353282da12ad38","settings":"39451665.94000a","events":"[{\"start\":{\"dow\":1,\"mod\":360},\"end\":{\"dow\":1,\"mod\":375}},{\"start\":{\"dow\":2,\"mod\":360},\"end\":{\"dow\":2,\"mod\":375}},{\"start\":{\"dow\":3,\"mod\":360},\"end\":{\"dow\":3,\"mod\":375}},{\"start\":{\"dow\":4,\"mod\":360},\"end\":{\"dow\":4,\"mod\":375}},{\"start\":{\"dow\":5,\"mod\":360},\"end\":{\"dow\":5,\"mod\":375}}]","topic":"","name":"Scarlett School Day","onPayload":"ON","onPayloadType":"str","offPayload":"OFF","offPayloadType":"str","onlyWhenDark":false,"scheduleRndMax":"","sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange","x":242,"y":358,"wires":[["a37ef7e9.708aa8"]]},{"id":"fa5923b6.b4aab","type":"light-scheduler","z":"fd8eb98d.2d1be8","g":"a6353282da12ad38","settings":"39451665.94000a","events":"[{\"start\":{\"dow\":1,\"mod\":405},\"end\":{\"dow\":1,\"mod\":420}},{\"start\":{\"dow\":2,\"mod\":405},\"end\":{\"dow\":2,\"mod\":420}},{\"start\":{\"dow\":3,\"mod\":405},\"end\":{\"dow\":3,\"mod\":420}},{\"start\":{\"dow\":4,\"mod\":405},\"end\":{\"dow\":4,\"mod\":420}},{\"start\":{\"dow\":5,\"mod\":405},\"end\":{\"dow\":5,\"mod\":420}},{\"start\":{\"dow\":6,\"mod\":405},\"end\":{\"dow\":6,\"mod\":420}},{\"start\":{\"dow\":0,\"mod\":405},\"end\":{\"dow\":0,\"mod\":420}}]","topic":"","name":"Scarlett Nonschool Day","onPayload":"ON","onPayloadType":"str","offPayload":"OFF","offPayloadType":"str","onlyWhenDark":false,"scheduleRndMax":"","sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange","x":262,"y":538,"wires":[["af85b53f.0bb108"]]},{"id":"bfa58b17.97f8b8","type":"function","z":"fd8eb98d.2d1be8","g":"bd80095bdaede51d","name":"ON","func":"if (msg.payload == \"ON\"){\nreturn msg;}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2398,"y":1080,"wires":[["e2a06f85.f16fb"]]},{"id":"9feffc83.114ad","type":"function","z":"fd8eb98d.2d1be8","g":"bd80095bdaede51d","name":"OFF","func":"if (msg.payload == \"OFF\"){\nreturn msg;}","outputs":1,"noerr":0,"x":2400,"y":1177,"wires":[["f5861311.9df7"]]},{"id":"e2a06f85.f16fb","type":"api-call-service","z":"fd8eb98d.2d1be8","g":"bd80095bdaede51d","name":"Buffet On","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.buffet_light"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","output_location":"payload","output_location_type":"msg","x":2608,"y":1080,"wires":[[]]},{"id":"f5861311.9df7","type":"api-call-service","z":"fd8eb98d.2d1be8","g":"bd80095bdaede51d","name":"Buffet Off","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.buffet_light"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","output_location":"payload","output_location_type":"msg","x":2609.8333282470703,"y":1177.5555572509766,"wires":[[]]},{"id":"b5264d44.4b4ea","type":"light-scheduler","z":"fd8eb98d.2d1be8","g":"bd80095bdaede51d","settings":"39451665.94000a","events":"[{\"start\":{\"dow\":1,\"mod\":1020},\"end\":{\"dow\":1,\"mod\":1380}},{\"start\":{\"dow\":2,\"mod\":1020},\"end\":{\"dow\":2,\"mod\":1380}},{\"start\":{\"dow\":3,\"mod\":1020},\"end\":{\"dow\":3,\"mod\":1380}},{\"start\":{\"dow\":4,\"mod\":1020},\"end\":{\"dow\":4,\"mod\":1380}},{\"start\":{\"dow\":5,\"mod\":1020},\"end\":{\"dow\":5,\"mod\":1380}},{\"start\":{\"dow\":6,\"mod\":1020},\"end\":{\"dow\":6,\"mod\":1380}},{\"start\":{\"dow\":0,\"mod\":1020},\"end\":{\"dow\":0,\"mod\":1380}}]","topic":"Buffet","name":"Buffet Light","onPayload":"ON","onPayloadType":"str","offPayload":"OFF","offPayloadType":"str","onlyWhenDark":false,"scheduleRndMax":"","sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange.startup","x":2218,"y":1120,"wires":[["bfa58b17.97f8b8","9feffc83.114ad"]]},{"id":"e7e9b94e.aba508","type":"light-scheduler","z":"fd8eb98d.2d1be8","g":"bd80095bdaede51d","settings":"39451665.94000a","events":"[{\"start\":{\"dow\":1,\"mod\":360},\"end\":{\"dow\":2,\"mod\":0}},{\"start\":{\"dow\":2,\"mod\":360},\"end\":{\"dow\":3,\"mod\":0}},{\"start\":{\"dow\":3,\"mod\":360},\"end\":{\"dow\":4,\"mod\":0}},{\"start\":{\"dow\":4,\"mod\":360},\"end\":{\"dow\":5,\"mod\":0}},{\"start\":{\"dow\":5,\"mod\":360},\"end\":{\"dow\":6,\"mod\":0}},{\"start\":{\"dow\":6,\"mod\":360},\"end\":{\"dow\":0,\"mod\":0}},{\"start\":{\"dow\":0,\"mod\":360},\"end\":{\"dow\":1,\"mod\":0}}]","topic":"Cabinet Lights","name":"Cabinet Lights","onPayload":"ON","onPayloadType":"str","offPayload":"OFF","offPayloadType":"str","onlyWhenDark":false,"scheduleRndMax":"","sunElevationThreshold":6,"sunShowElevationInStatus":false,"outputfreq":"output.statechange.startup","x":2228,"y":920,"wires":[["70b70245.81071c","f27fe6ca.4facf8"]]},{"id":"70b70245.81071c","type":"function","z":"fd8eb98d.2d1be8","g":"bd80095bdaede51d","name":"ON","func":"if (msg.payload == \"ON\"){\nreturn msg;}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2398,"y":860,"wires":[["7b0265f4.1a7ddc"]]},{"id":"f27fe6ca.4facf8","type":"function","z":"fd8eb98d.2d1be8","g":"bd80095bdaede51d","name":"OFF","func":"if (msg.payload == \"OFF\"){\nreturn msg;}","outputs":1,"noerr":0,"x":2401,"y":965,"wires":[["f6ebb0d.178a65"]]},{"id":"7b0265f4.1a7ddc","type":"api-call-service","z":"fd8eb98d.2d1be8","g":"bd80095bdaede51d","name":"Cabinet Lights On","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.cabinet_lights"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","output_location":"payload","output_location_type":"msg","x":2632.0000076293945,"y":859.2222032546997,"wires":[[]]},{"id":"f6ebb0d.178a65","type":"api-call-service","z":"fd8eb98d.2d1be8","g":"bd80095bdaede51d","name":"Cabinet Lights Off","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.cabinet_lights"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","output_location":"payload","output_location_type":"msg","x":2631.8333435058594,"y":965.4446439743042,"wires":[[]]},{"id":"bae93d9d.50c96","type":"api-call-service","z":"fd8eb98d.2d1be8","g":"bd80095bdaede51d","name":"Exterior Notifications On","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.notify_exterior"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","output_location":"payload","output_location_type":"msg","x":2078,"y":540,"wires":[[]]},{"id":"3c2d0114.198dce","type":"server-state-changed","z":"fd8eb98d.2d1be8","g":"bd80095bdaede51d","name":"Away","server":"3b49c004.6176a","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.home_occupied","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":1598,"y":820,"wires":[[],["f23de0eb.cc9b5","36314410.29a4cc","d969523a.f1c05","15a3c38b.52289c","9f91fce.3903a","dd6f2982.8e88a8","b31f20f7.f43e3"]]},{"id":"170da324.7cabdd","type":"api-call-service","z":"fd8eb98d.2d1be8","g":"bd80095bdaede51d","name":"Garage Entry Off","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.garage_entry_light"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","output_location":"payload","output_location_type":"msg","x":2058,"y":340,"wires":[[]]},{"id":"b78b2b39.9fae08","type":"api-call-service","z":"fd8eb98d.2d1be8","g":"bd80095bdaede51d","name":"Uplights Off","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.uplights"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","output_location":"payload","output_location_type":"msg","x":2038,"y":380,"wires":[[]]},{"id":"8e00e05d.7e6f7","type":"api-call-service","z":"fd8eb98d.2d1be8","g":"bd80095bdaede51d","name":"Ben Light Off","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.ben_light"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","output_location":"payload","output_location_type":"msg","x":2038,"y":420,"wires":[[]]},{"id":"e1f28fb1.10bdd","type":"api-call-service","z":"fd8eb98d.2d1be8","g":"bd80095bdaede51d","name":"Other Ben Light Off","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.other_ben_light"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","output_location":"payload","output_location_type":"msg","x":2058,"y":460,"wires":[[]]},{"id":"1aa6e2eb.8ece9d","type":"api-call-service","z":"fd8eb98d.2d1be8","g":"bd80095bdaede51d","name":"Kitchen Lights Off","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.kitchen_lights"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","output_location":"payload","output_location_type":"msg","x":2058,"y":500,"wires":[[]]},{"id":"ba1d3e2.dfe44c","type":"server-state-changed","z":"fd8eb98d.2d1be8","g":"bd80095bdaede51d","name":"Home","server":"3b49c004.6176a","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.home_occupied","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":1598,"y":1140,"wires":[[],["444198ab.4900a8","c3a35718.c2d408","57a65068.d046f","b0f3a9a9.3ad688","463bfd43.96b204","143e65c6.d8564a","7d99605f.bc0a5"]]},{"id":"444198ab.4900a8","type":"api-call-service","z":"fd8eb98d.2d1be8","g":"bd80095bdaede51d","name":"Exterior Notifications Off","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.notify_exterior"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","output_location":"payload","output_location_type":"msg","x":1918,"y":1440,"wires":[[]]},{"id":"c3a35718.c2d408","type":"change","z":"fd8eb98d.2d1be8","g":"bd80095bdaede51d","name":"auto","rules":[{"t":"set","p":"payload","pt":"msg","to":"auto","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1858,"y":1120,"wires":[["b5264d44.4b4ea","e7e9b94e.aba508"]]},{"id":"f23de0eb.cc9b5","type":"change","z":"fd8eb98d.2d1be8","g":"bd80095bdaede51d","name":"off","rules":[{"t":"set","p":"payload","pt":"msg","to":"off","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1858,"y":1040,"wires":[["b5264d44.4b4ea","e7e9b94e.aba508"]]},{"id":"36314410.29a4cc","type":"delay","z":"fd8eb98d.2d1be8","g":"bd80095bdaede51d","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":1788,"y":480,"wires":[["170da324.7cabdd","b78b2b39.9fae08","8e00e05d.7e6f7","e1f28fb1.10bdd","1aa6e2eb.8ece9d","bae93d9d.50c96"]]},{"id":"d969523a.f1c05","type":"api-current-state","z":"fd8eb98d.2d1be8","g":"bd80095bdaede51d","name":"Garage Entry State","server":"3b49c004.6176a","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.garage_entry_light","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1858,"y":660,"wires":[["d2f65779.39dbd8"]]},{"id":"9f91fce.3903a","type":"api-current-state","z":"fd8eb98d.2d1be8","g":"bd80095bdaede51d","name":"Ben Light State","server":"3b49c004.6176a","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.ben_light","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1848,"y":740,"wires":[["260ed891.51b3e8"]]},{"id":"15a3c38b.52289c","type":"api-current-state","z":"fd8eb98d.2d1be8","g":"bd80095bdaede51d","name":"Uplights State","server":"3b49c004.6176a","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.uplights","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1848,"y":700,"wires":[["bcc359ba.977a88"]]},{"id":"dd6f2982.8e88a8","type":"api-current-state","z":"fd8eb98d.2d1be8","g":"bd80095bdaede51d","name":"Other Ben Light","server":"3b49c004.6176a","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.other_ben_light","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1848,"y":780,"wires":[["5095b995.6055e8"]]},{"id":"b31f20f7.f43e3","type":"api-current-state","z":"fd8eb98d.2d1be8","g":"bd80095bdaede51d","name":"Kitchen Light State","server":"3b49c004.6176a","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.kitchen_lights","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1858,"y":820,"wires":[["33202e8c.43c972"]]},{"id":"d2f65779.39dbd8","type":"change","z":"fd8eb98d.2d1be8","g":"bd80095bdaede51d","name":"Garage Flow","rules":[{"t":"set","p":"garageEntry","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2098,"y":660,"wires":[[]]},{"id":"bcc359ba.977a88","type":"change","z":"fd8eb98d.2d1be8","g":"bd80095bdaede51d","name":"Uplights Flow","rules":[{"t":"set","p":"uplights","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2108,"y":700,"wires":[[]]},{"id":"260ed891.51b3e8","type":"change","z":"fd8eb98d.2d1be8","g":"bd80095bdaede51d","name":"Ben Light Flow","rules":[{"t":"set","p":"benLight","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2108,"y":740,"wires":[[]]},{"id":"5095b995.6055e8","type":"change","z":"fd8eb98d.2d1be8","g":"bd80095bdaede51d","name":"Other Ben Light Flow","rules":[{"t":"set","p":"otherBenLight","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2128,"y":780,"wires":[[]]},{"id":"33202e8c.43c972","type":"change","z":"fd8eb98d.2d1be8","g":"bd80095bdaede51d","name":"Kitchen Light Flow","rules":[{"t":"set","p":"kichenLight","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2118,"y":820,"wires":[[]]},{"id":"57a65068.d046f","type":"switch","z":"fd8eb98d.2d1be8","g":"bd80095bdaede51d","name":"Garage Flow","property":"garageEntry","propertyType":"flow","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1878,"y":1220,"wires":[["c0f7d352.e0cc3"]]},{"id":"b0f3a9a9.3ad688","type":"switch","z":"fd8eb98d.2d1be8","g":"bd80095bdaede51d","name":"Uplights Flow","property":"uplights","propertyType":"flow","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1888,"y":1260,"wires":[["faedc68f.0b6838"]]},{"id":"463bfd43.96b204","type":"switch","z":"fd8eb98d.2d1be8","g":"bd80095bdaede51d","name":"Ben Light Flow","property":"benLight","propertyType":"flow","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1888,"y":1300,"wires":[["665b02b9.1bb99c"]]},{"id":"143e65c6.d8564a","type":"switch","z":"fd8eb98d.2d1be8","g":"bd80095bdaede51d","name":"Other Ben Light Flow","property":"otherBenLight","propertyType":"flow","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1908,"y":1340,"wires":[["8ec59625.577308"]]},{"id":"7d99605f.bc0a5","type":"switch","z":"fd8eb98d.2d1be8","g":"bd80095bdaede51d","name":"Kitchen Light Flow","property":"kitchenLight","propertyType":"flow","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1898,"y":1380,"wires":[["e5b1b81a.790018"]]},{"id":"c0f7d352.e0cc3","type":"api-call-service","z":"fd8eb98d.2d1be8","g":"bd80095bdaede51d","name":"Garage Entry On","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.garage_entry_light"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","output_location":"payload","output_location_type":"msg","x":2198,"y":1220,"wires":[[]]},{"id":"faedc68f.0b6838","type":"api-call-service","z":"fd8eb98d.2d1be8","g":"bd80095bdaede51d","name":"Uplights On","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.uplights"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","output_location":"payload","output_location_type":"msg","x":2178,"y":1260,"wires":[[]]},{"id":"665b02b9.1bb99c","type":"api-call-service","z":"fd8eb98d.2d1be8","g":"bd80095bdaede51d","name":"Ben Light On","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.ben_light"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","output_location":"payload","output_location_type":"msg","x":2178,"y":1300,"wires":[[]]},{"id":"8ec59625.577308","type":"api-call-service","z":"fd8eb98d.2d1be8","g":"bd80095bdaede51d","name":"Other Ben Light On","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.other_ben_light"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","output_location":"payload","output_location_type":"msg","x":2198,"y":1340,"wires":[[]]},{"id":"e5b1b81a.790018","type":"api-call-service","z":"fd8eb98d.2d1be8","g":"bd80095bdaede51d","name":"Kitchen Lights On","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.kitchen_lights"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","output_location":"payload","output_location_type":"msg","x":2198,"y":1380,"wires":[[]]},{"id":"d2bf4773.c3fa48","type":"comment","z":"fd8eb98d.2d1be8","g":"bd80095bdaede51d","name":"https://github.com/thehookup/Node-RED-Examples/blob/master/Example%20Flow%203.txt","info":"","x":1828,"y":290,"wires":[]},{"id":"58e8440c.272f7c","type":"server-state-changed","z":"fd8eb98d.2d1be8","g":"af2130d08e75cb82","name":"Bathroom Motion","server":"3b49c004.6176a","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.bathroom_motion","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":164,"y":876,"wires":[[],["4cee5be1.01f1e4"]]},{"id":"4cee5be1.01f1e4","type":"time-range-switch","z":"fd8eb98d.2d1be8","g":"af2130d08e75cb82","name":"After 6AM","lat":"55.8938","lon":"-3.6232","startTime":"06:00","endTime":"23:59","startOffset":"","endOffset":"","x":347.333309173584,"y":875.9999780654907,"wires":[["ca265bbc.767628","2f94da4a.cb6d16"],[]]},{"id":"ca265bbc.767628","type":"api-current-state","z":"fd8eb98d.2d1be8","g":"af2130d08e75cb82","name":"Light Off?","server":"3b49c004.6176a","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.bathroom_light","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":517.3334007263184,"y":837.3333940505981,"wires":[[],["dc1df4b5.cf5178"]]},{"id":"dc1df4b5.cf5178","type":"api-call-service","z":"fd8eb98d.2d1be8","g":"af2130d08e75cb82","name":"ON","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.bathroom_light"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","output_location":"payload","output_location_type":"msg","x":978.9999504089355,"y":838.999979019165,"wires":[[]]},{"id":"d774ab82.c6aa98","type":"api-render-template","z":"fd8eb98d.2d1be8","g":"af2130d08e75cb82","name":"Still in Bathroom?","server":"3b49c004.6176a","version":0,"template":"{{ states.variable.last_motion.state != 'Bathroom Motion' }}","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":687.3333396911621,"y":896.0000238418579,"wires":[["3bedb586.df82aa"]]},{"id":"2f94da4a.cb6d16","type":"stoptimer","z":"fd8eb98d.2d1be8","g":"af2130d08e75cb82","duration":"12","units":"Minute","payloadtype":"num","payloadval":"0","name":"12min","x":504.0000190734863,"y":902.6667079925537,"wires":[["d774ab82.c6aa98"],[]]},{"id":"3bedb586.df82aa","type":"switch","z":"fd8eb98d.2d1be8","g":"af2130d08e75cb82","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"True","vt":"str"}],"checkall":"true","outputs":1,"x":852.3333015441895,"y":896.000002861023,"wires":[["636194ee.ce808c"]]},{"id":"636194ee.ce808c","type":"api-call-service","z":"fd8eb98d.2d1be8","g":"af2130d08e75cb82","name":"OFF","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["group.bathroom"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","output_location":"payload","output_location_type":"msg","x":981.5001754760742,"y":896.0000314712524,"wires":[[]]},{"id":"c11a7b33.6bd188","type":"server-state-changed","z":"fd8eb98d.2d1be8","g":"af2130d08e75cb82","name":"Bathroom Switch Flipped On","server":"3b49c004.6176a","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.bathroom_light","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":297.33336639404297,"y":951.0001130104065,"wires":[[],["2f94da4a.cb6d16"]]},{"id":"ae167d1b.c294","type":"comment","z":"fd8eb98d.2d1be8","g":"af2130d08e75cb82","name":"https://diyfuturism.com/index.php/2017/12/14/basic-node-red-flows-for-automating-lighting-with-home-assistant/","info":"","x":404,"y":756,"wires":[]},{"id":"5a9a2770.35a978","type":"comment","z":"fd8eb98d.2d1be8","g":"9d154ea7684d09f5","name":"Backup Spotify Playlists - https://www.reddit.com/r/homeassistant/comments/asw1ld/nodered_backup_spotify_playlists/","info":"","x":436,"y":1056,"wires":[]},{"id":"debd8305.ed3d2","type":"inject","z":"fd8eb98d.2d1be8","g":"9d154ea7684d09f5","name":"username","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"yourusernamehere","payloadType":"str","x":252,"y":1140,"wires":[["505e1331.1e03bc"]]},{"id":"278e155e.840a2a","type":"debug","z":"fd8eb98d.2d1be8","g":"9d154ea7684d09f5","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":938,"y":1116,"wires":[]},{"id":"7c996b0b.d86a14","type":"inject","z":"fd8eb98d.2d1be8","g":"9d154ea7684d09f5","name":"inject a playlist ID directly","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"playlistidhere","payloadType":"str","x":254,"y":1356,"wires":[["3ba94139.9f55ae"]]},{"id":"b74d83d8.fe52b","type":"file","z":"fd8eb98d.2d1be8","g":"9d154ea7684d09f5","name":"save file","filename":"","appendNewline":true,"createDir":false,"overwriteFile":"true","x":900,"y":1440,"wires":[["e897ab47.2a0808"]]},{"id":"1e3fe9ac.b88986","type":"json","z":"fd8eb98d.2d1be8","g":"9d154ea7684d09f5","name":"","property":"payload","action":"str","pretty":false,"x":710,"y":1440,"wires":[["b74d83d8.fe52b"]]},{"id":"3ba94139.9f55ae","type":"function","z":"fd8eb98d.2d1be8","g":"9d154ea7684d09f5","name":"set msg.params","func":"msg.params = [\n    msg.payload, /* Artist ID */\n    { limit: 100, offset: 0 } /* Options */\n];\nreturn msg;","outputs":1,"noerr":0,"x":512,"y":1332,"wires":[["8b986614.0a2be8","b9fb8421.597a48"]]},{"id":"8b986614.0a2be8","type":"debug","z":"fd8eb98d.2d1be8","g":"9d154ea7684d09f5","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":674,"y":1308,"wires":[]},{"id":"d2936ac5.719838","type":"debug","z":"fd8eb98d.2d1be8","g":"9d154ea7684d09f5","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":890,"y":1332,"wires":[]},{"id":"c6de633f.e3a85","type":"function","z":"fd8eb98d.2d1be8","g":"9d154ea7684d09f5","name":"get track IDs","func":"msg.total = msg.payload.total;\nt = msg.payload.items.map(ele=> ele[\"track\"]);\ni = t.map(ele=> ele[\"id\"]);\nmsg.payload = i;\nreturn msg;","outputs":1,"noerr":0,"x":334,"y":1428,"wires":[["db831cf.48534e","46a6f0cf.61402"]]},{"id":"2c4d2270.d3f60e","type":"function","z":"fd8eb98d.2d1be8","g":"9d154ea7684d09f5","name":"get playlists","func":"msg.payload = msg.payload.items;\nreturn msg;","outputs":1,"noerr":0,"x":790,"y":1140,"wires":[["278e155e.840a2a","5e74c7c0.e6f428"]]},{"id":"db831cf.48534e","type":"function","z":"fd8eb98d.2d1be8","g":"9d154ea7684d09f5","name":"set msg.filename","func":"msg.filename = \"/data/spotify/playlist_\" + msg.params[0] + \"_\" + msg.params[1].offset + \"\\.json\";\nreturn msg;","outputs":1,"noerr":0,"x":534,"y":1428,"wires":[["1e3fe9ac.b88986"]]},{"id":"46a6f0cf.61402","type":"debug","z":"fd8eb98d.2d1be8","g":"9d154ea7684d09f5","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":314,"y":1476,"wires":[]},{"id":"e897ab47.2a0808","type":"function","z":"fd8eb98d.2d1be8","g":"9d154ea7684d09f5","name":"set msg.remaining","func":"r = msg.total - msg.params[1].offset;\nmsg.remaining = r;\nreturn msg;","outputs":1,"noerr":0,"x":522,"y":1500,"wires":[["500ef57.5ec700c","26617863.a0f118"]]},{"id":"500ef57.5ec700c","type":"switch","z":"fd8eb98d.2d1be8","g":"9d154ea7684d09f5","name":"remaining >=100","property":"remaining","propertyType":"msg","rules":[{"t":"gte","v":"100","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":738,"y":1500,"wires":[["12023600.180c0a"]]},{"id":"12023600.180c0a","type":"function","z":"fd8eb98d.2d1be8","g":"9d154ea7684d09f5","name":"set new msg.params","func":"os = msg.params[1].offset + 100;\nmsg.params = [\n    msg.params[0], /* Artist ID */\n    { limit: 100, offset: os } /* Options */\n];\nreturn msg;","outputs":1,"noerr":0,"x":952,"y":1500,"wires":[["ee083fb4.e8c7e","b9fb8421.597a48"]]},{"id":"26617863.a0f118","type":"debug","z":"fd8eb98d.2d1be8","g":"9d154ea7684d09f5","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":626,"y":1548,"wires":[]},{"id":"ee083fb4.e8c7e","type":"debug","z":"fd8eb98d.2d1be8","g":"9d154ea7684d09f5","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":938,"y":1548,"wires":[]},{"id":"505e1331.1e03bc","type":"function","z":"fd8eb98d.2d1be8","g":"9d154ea7684d09f5","name":"set msg.username","func":"msg.username = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":426,"y":1140,"wires":[["57e61ee7.8e587"]]},{"id":"5e74c7c0.e6f428","type":"split","z":"fd8eb98d.2d1be8","g":"9d154ea7684d09f5","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":218,"y":1212,"wires":[["99e6b32f.fedb"]]},{"id":"99e6b32f.fedb","type":"switch","z":"fd8eb98d.2d1be8","g":"9d154ea7684d09f5","name":"playlist owner =  username","property":"payload.owner.id","propertyType":"msg","rules":[{"t":"eq","v":"username","vt":"msg"}],"checkall":"true","repair":false,"outputs":1,"x":408,"y":1212,"wires":[["51fa5a3a.a12f64","27720aed.470486","338695e8.f57f3a"]]},{"id":"338695e8.f57f3a","type":"change","z":"fd8eb98d.2d1be8","g":"9d154ea7684d09f5","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":296,"y":1308,"wires":[["7e857daa.4b9724","3ba94139.9f55ae"]]},{"id":"7e857daa.4b9724","type":"debug","z":"fd8eb98d.2d1be8","g":"9d154ea7684d09f5","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":482,"y":1284,"wires":[]},{"id":"51fa5a3a.a12f64","type":"debug","z":"fd8eb98d.2d1be8","g":"9d154ea7684d09f5","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":338,"y":1260,"wires":[]},{"id":"b082ef40.4b3b1","type":"file","z":"fd8eb98d.2d1be8","g":"9d154ea7684d09f5","name":"save file","filename":"","appendNewline":true,"createDir":false,"overwriteFile":"true","x":972,"y":1212,"wires":[[]]},{"id":"e1c7f601.9c9f28","type":"json","z":"fd8eb98d.2d1be8","g":"9d154ea7684d09f5","name":"","property":"payload","action":"str","pretty":false,"x":842,"y":1212,"wires":[["b082ef40.4b3b1"]]},{"id":"27720aed.470486","type":"function","z":"fd8eb98d.2d1be8","g":"9d154ea7684d09f5","name":"set msg.filename","func":"msg.filename = \"/data/spotify/playlist_\" + msg.payload.id + \"_data\\.json\";\nreturn msg;","outputs":1,"noerr":0,"x":666,"y":1212,"wires":[["e1c7f601.9c9f28"]]},{"id":"57e61ee7.8e587","type":"spotify","z":"fd8eb98d.2d1be8","g":"9d154ea7684d09f5","name":"","auth":"188079bd.534b86","api":"getUserPlaylists","x":608,"y":1140,"wires":[["2c4d2270.d3f60e"]]},{"id":"b9fb8421.597a48","type":"spotify","z":"fd8eb98d.2d1be8","g":"9d154ea7684d09f5","name":"","auth":"188079bd.534b86","api":"getPlaylistTracks","x":714,"y":1356,"wires":[["d2936ac5.719838","c6de633f.e3a85"]]},{"id":"da21213a.d1c418","type":"mqtt in","z":"fd8eb98d.2d1be8","g":"92e3c25dcc813d7b","name":"Send Alarm","topic":"Alarms","qos":"0","datatype":"auto","broker":"e96cb00d.af953","inputs":0,"x":214,"y":1968,"wires":[["c1e6aaab.f19138","9701b7d3.99416"]]},{"id":"2b0eb06f.d7e8d8","type":"mqtt out","z":"fd8eb98d.2d1be8","g":"92e3c25dcc813d7b","name":"Hall Light Dimmer ","topic":"/myhome/command/Light_Hall/state","qos":"0","retain":"true","broker":"e96cb00d.af953","x":1209.0000915527344,"y":2018.6833190917969,"wires":[]},{"id":"c1e6aaab.f19138","type":"switch","z":"fd8eb98d.2d1be8","g":"92e3c25dcc813d7b","name":"Movement detected?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"OPEN","vt":"str"}],"checkall":"false","outputs":1,"x":473.00006103515625,"y":1946.2333374023438,"wires":[["a7f3a3f2.b51f38"]]},{"id":"9701b7d3.99416","type":"trigger","z":"fd8eb98d.2d1be8","g":"92e3c25dcc813d7b","name":"Switch off delay","op1":"5","op2":"0","op1type":"nul","op2type":"val","duration":"8","extend":false,"units":"s","reset":"OPEN","outputs":1,"x":595.0000610351562,"y":2116.2333068847656,"wires":[["2b0eb06f.d7e8d8"]]},{"id":"e7886307.9cdb98","type":"mqtt in","z":"fd8eb98d.2d1be8","g":"92e3c25dcc813d7b","name":"Hall Light Dimmer ","topic":"/myhome/command/Light_Hall/state","qos":"0","datatype":"auto","broker":"e96cb00d.af953","inputs":0,"x":203.66668701171875,"y":1749.3832702636719,"wires":[["ba0ba53c.012d6"]]},{"id":"1e9a8082.fb1d8f","type":"inject","z":"fd8eb98d.2d1be8","g":"92e3c25dcc813d7b","name":"Reduce Brightness at 21:00","repeat":"","crontab":"00 21 * * *","once":false,"topic":"Night Brightness","payload":"1","payloadType":"str","x":258.00006103515625,"y":1871.6999816894531,"wires":[["9455415e.123a28"]]},{"id":"160d3974.89f507","type":"inject","z":"fd8eb98d.2d1be8","g":"92e3c25dcc813d7b","name":"Normal Brightness at 6:00","repeat":"","crontab":"00 6 * * *","once":false,"topic":"Night Brightness","payload":"50","payloadType":"num","x":248.66668701171875,"y":1830.3833312988281,"wires":[["9455415e.123a28"]]},{"id":"ba0ba53c.012d6","type":"switch","z":"fd8eb98d.2d1be8","g":"92e3c25dcc813d7b","name":"Light Threshold Selector","property":"payload","propertyType":"msg","rules":[{"t":"lt","v":"20","vt":"num"},{"t":"else"}],"checkall":"false","outputs":2,"x":557.6666564941406,"y":1749.3833312988281,"wires":[["6c4b46e6.b31dd8"],["6af8fd01.69823c"]]},{"id":"6c4b46e6.b31dd8","type":"change","z":"fd8eb98d.2d1be8","g":"92e3c25dcc813d7b","name":"Enable Light","rules":[{"t":"set","p":"Light_enabled","pt":"flow","to":"Yes","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":862.3333435058594,"y":1712.6666564941406,"wires":[[]]},{"id":"6af8fd01.69823c","type":"change","z":"fd8eb98d.2d1be8","g":"92e3c25dcc813d7b","name":"Disable Light","rules":[{"t":"set","p":"Light_enabled","pt":"flow","to":"No","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":864.9999694824219,"y":1781.1833190917969,"wires":[[]]},{"id":"9455415e.123a28","type":"change","z":"fd8eb98d.2d1be8","g":"92e3c25dcc813d7b","name":"Light Brightness Adjustment","rules":[{"t":"set","p":"Light_brightness","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":606.6667175292969,"y":1847.3833312988281,"wires":[[]]},{"id":"a7f3a3f2.b51f38","type":"switch","z":"fd8eb98d.2d1be8","g":"92e3c25dcc813d7b","name":"Light Enabled?","property":"Light_enabled","propertyType":"flow","rules":[{"t":"eq","v":"Yes","vt":"str"}],"checkall":"true","outputs":1,"x":703.6668395996094,"y":1945.3833312988281,"wires":[["c474bc9b.e9ff88"]]},{"id":"c474bc9b.e9ff88","type":"change","z":"fd8eb98d.2d1be8","g":"92e3c25dcc813d7b","name":"Light Brightness Adjustment","rules":[{"t":"set","p":"payload","pt":"msg","to":"Light_brightness","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":944.1667175292969,"y":1945.0166320800781,"wires":[["2b0eb06f.d7e8d8"]]},{"id":"5a2b58f6.273f18","type":"comment","z":"fd8eb98d.2d1be8","g":"92e3c25dcc813d7b","name":"Motion Detection - https://flows.nodered.org/flow/9834a2f7aeb397f065912c70b467497a","info":"","x":340,"y":1644,"wires":[]},{"id":"3b49b0a2.cd82e","type":"api-call-service","z":"fd8eb98d.2d1be8","g":"2cd9006f.99be1","name":"Node Red Presence not_home","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"device_tracker","service":"see","areaId":[],"deviceId":[],"entityId":[],"data":"{\"dev_id\":\"you_nodered\",\"location_name\":\"not_home\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","output_location":"payload","output_location_type":"msg","x":2050,"y":180,"wires":[[]]},{"id":"3244224c.76ee5e","type":"api-call-service","z":"fd8eb98d.2d1be8","g":"2cd9006f.99be1","name":"Node Red Presence home","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"device_tracker","service":"see","areaId":[],"deviceId":[],"entityId":[],"data":"{\"dev_id\":\"you_nodered\",\"location_name\":\"home\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","output_location":"payload","output_location_type":"msg","x":2039.999885559082,"y":109.33336353302002,"wires":[[]]},{"id":"e41335da.593438","type":"comment","z":"fd8eb98d.2d1be8","g":"2cd9006f.99be1","name":"Create Device Tracker","info":"","x":2043.0000457763672,"y":70.0000319480896,"wires":[]},{"id":"d3abc00c.25cd5","type":"comment","z":"fd8eb98d.2d1be8","g":"2cd9006f.99be1","name":"Home or Not?","info":"","x":1613.535743713379,"y":148.36904764175415,"wires":[]},{"id":"9819475f.ab3978","type":"function","z":"fd8eb98d.2d1be8","g":"2cd9006f.99be1","name":"GPS","func":"newmsg = {};\nnewmsg.payload = { data: {'gps': [msg.payload.lat,msg.payload.lon] } };\nreturn newmsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1840.833698272705,"y":110.2380690574646,"wires":[["3244224c.76ee5e"]]},{"id":"e1737555.a23c78","type":"function","z":"fd8eb98d.2d1be8","g":"2cd9006f.99be1","name":"GPS","func":"newmsg = {};\nnewmsg.payload = { data: {'gps': [msg.payload.lat,msg.payload.lon] } };\nreturn newmsg;","outputs":1,"noerr":0,"x":1840.0001640319824,"y":179.90478086471558,"wires":[["3b49b0a2.cd82e"]]},{"id":"d0a9ff53.b739a","type":"geofence","z":"fd8eb98d.2d1be8","g":"2cd9006f.99be1","name":"Inside Home Zone","mode":"polyline","inside":"true","rad":0,"points":[{"latitude":51.600818724533056,"longitude":0.10941535234451294},{"latitude":51.60465706809492,"longitude":0.10647565126419067},{"latitude":51.605256779967696,"longitude":0.11199027299880983},{"latitude":51.60319107239184,"longitude":0.11514455080032349}],"centre":{},"floor":"","ceiling":"","worldmap":false,"outputs":1,"x":1607.8154678344727,"y":98.53567552566528,"wires":[["9819475f.ab3978"]]},{"id":"5283fcc7.605834","type":"geofence","z":"fd8eb98d.2d1be8","g":"2cd9006f.99be1","name":"Outside Home Zone","mode":"circle","inside":"false","rad":0,"points":[],"centre":{"latitude":0,"longitude":0},"outputs":1,"x":1617.1904487609863,"y":194.78566598892212,"wires":[["e1737555.a23c78"]]},{"id":"2faf619ab6a2e6c2","type":"comment","z":"fd8eb98d.2d1be8","name":"https://github.com/586837r/node-red-contrib-alexa-remote2/blob/master//examples.md","info":"","x":324,"y":2268,"wires":[]},{"id":"fea522aeb174b991","type":"comment","z":"fd8eb98d.2d1be8","g":"d28ddbe75d1348c4","name":"1. Alexa Speak Dashboard","info":"https://github.com/586837r/node-red-contrib-alexa-remote2/blob/master//examples.md#1-alexa-speak-dashboard","x":170,"y":2400,"wires":[]},{"id":"155c6658a1281d09","type":"ui_text_input","z":"fd8eb98d.2d1be8","g":"d28ddbe75d1348c4","name":"","label":"","group":"326ce2f.8d02d1e","order":3,"width":0,"height":0,"passthru":true,"mode":"text","delay":"1","topic":"","x":134,"y":2580,"wires":[["a2118161000d8a0b"]]},{"id":"a2118161000d8a0b","type":"change","z":"fd8eb98d.2d1be8","g":"d28ddbe75d1348c4","name":"","rules":[{"t":"set","p":"textToSpeak","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":354,"y":2580,"wires":[[]]},{"id":"655976d3c6722809","type":"ui_button","z":"fd8eb98d.2d1be8","g":"d28ddbe75d1348c4","name":"","group":"326ce2f.8d02d1e","order":4,"width":0,"height":0,"passthru":false,"label":"Speak","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":124,"y":2620,"wires":[["6cdd6c043d922af5"]]},{"id":"8a16ac91db3cc434","type":"change","z":"fd8eb98d.2d1be8","g":"d28ddbe75d1348c4","name":"","rules":[{"t":"set","p":"device","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":488,"y":2520,"wires":[[]]},{"id":"95df1fbc65f3e087","type":"change","z":"fd8eb98d.2d1be8","g":"d28ddbe75d1348c4","name":"","rules":[{"t":"set","p":"options","pt":"msg","to":"payload.accountName[]","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":154,"y":2520,"wires":[["aade279657681c80"]]},{"id":"aade279657681c80","type":"ui_dropdown","z":"fd8eb98d.2d1be8","g":"d28ddbe75d1348c4","name":"","label":"Device","tooltip":"","place":"","group":"326ce2f.8d02d1e","order":1,"width":"5","height":"1","passthru":true,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"","x":304,"y":2520,"wires":[["8a16ac91db3cc434"]]},{"id":"d6ba15f5238880f5","type":"ui_button","z":"fd8eb98d.2d1be8","g":"d28ddbe75d1348c4","name":"","group":"326ce2f.8d02d1e","order":2,"width":"1","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"refresh","payload":"","payloadType":"str","topic":"","x":124,"y":2460,"wires":[["72301d6fb6cbf986"]]},{"id":"6cdd6c043d922af5","type":"alexa-remote-routine","z":"fd8eb98d.2d1be8","g":"d28ddbe75d1348c4","name":"","account":"c341166.e0c82e8","routineNode":{"type":"speak","payload":{"type":"regular","text":{"type":"flow","value":"textToSpeak"},"devices":{"type":"flow","value":"device"}}},"x":334,"y":2620,"wires":[[]]},{"id":"72301d6fb6cbf986","type":"alexa-remote-echo","z":"fd8eb98d.2d1be8","g":"d28ddbe75d1348c4","name":"","account":"c341166.e0c82e8","config":{"option":"get","value":{"what":"device","device":{"type":"str","value":"ALEXA_ALL_DSN"}}},"x":284,"y":2460,"wires":[["95df1fbc65f3e087"]]},{"id":"6575407dc937af47","type":"inject","z":"fd8eb98d.2d1be8","g":"e390622a7b33dfa9","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"str","x":134,"y":2772,"wires":[["42eae770827e1fc7"]]},{"id":"42eae770827e1fc7","type":"template","z":"fd8eb98d.2d1be8","g":"e390622a7b33dfa9","name":"Good Morning","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<speak>    \n<s><voice name=\"Celine\">Bonjour!</voice></s>\n<s><voice name=\"Hans\">Guten Morgen!</voice></s>\n<s><voice name=\"Amy\">Good Morning!</voice></s>\n<s><voice name=\"Giorgio\">Buongiorno!</voice></s>\n<s><voice name=\"Enrique\">¡Buenos días!</voice></s>\n</speak>","output":"str","x":284,"y":2772,"wires":[["98124c956d933661"]]},{"id":"ede481fd32b8d00b","type":"template","z":"fd8eb98d.2d1be8","g":"e390622a7b33dfa9","name":"Effects","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<speak>\n<prosody volume=\"x-loud\">This is louder.</prosody>\n<prosody volume=\"x-soft\">This is quieter.</prosody>\n<prosody rate=\"50%\">This is slow.</prosody>\n<prosody rate=\"150%\">This is fast.</prosody>\n<prosody pitch=\"-33.3%\">This is deep.</prosody>\n<prosody pitch=\"+50%\">This is high.</prosody>\n<amazon:effect name=\"whispered\">This is whispering.</amazon:effect>\n</speak>","output":"str","x":254,"y":2812,"wires":[["98124c956d933661"]]},{"id":"bab9bbb2506751a3","type":"inject","z":"fd8eb98d.2d1be8","g":"e390622a7b33dfa9","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"str","x":134,"y":2812,"wires":[["ede481fd32b8d00b"]]},{"id":"98124c956d933661","type":"alexa-remote-routine","z":"fd8eb98d.2d1be8","g":"e390622a7b33dfa9","name":"","account":"c341166.e0c82e8","routineNode":{"type":"speak","payload":{"type":"ssml","text":{"type":"msg","value":"payload"},"devices":[]}},"x":484,"y":2812,"wires":[[]]},{"id":"4a9ebcbeaa3ce8c9","type":"template","z":"fd8eb98d.2d1be8","g":"e390622a7b33dfa9","name":"Time and Date","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<speak>\n    Time 08:30.\n    Duration <say-as interpret-as=\"time\">12'3\"</say-as>.\n    Date <say-as interpret-as=\"date\" format=\"dmy\">28/02/2020</say-as>.\n</speak>","output":"str","x":284,"y":2852,"wires":[["98124c956d933661"]]},{"id":"5bdf51e40b9dc0a7","type":"inject","z":"fd8eb98d.2d1be8","g":"e390622a7b33dfa9","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"str","x":134,"y":2852,"wires":[["4a9ebcbeaa3ce8c9"]]},{"id":"459a5d18265a3d0b","type":"comment","z":"fd8eb98d.2d1be8","g":"e390622a7b33dfa9","name":"2. Alexa SSML","info":"https://github.com/586837r/node-red-contrib-alexa-remote2/blob/master//examples.md#2-alexa-ssml","x":140,"y":2724,"wires":[]},{"id":"53fe522fcea3c103","type":"ui_dropdown","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","name":"","label":"Provider","tooltip":"","place":" ","group":"7bea4aa8.d8cdb4","order":5,"width":"5","height":"1","passthru":true,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"","x":1032,"y":2736,"wires":[["b3a9cdd210d8dab7"]]},{"id":"b3a9cdd210d8dab7","type":"change","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","name":"","rules":[{"t":"set","p":"provider","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1052,"y":2776,"wires":[[]]},{"id":"9c44a8d556779e26","type":"ui_button","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","name":"","group":"7bea4aa8.d8cdb4","order":9,"width":"0","height":"0","passthru":false,"label":"Play","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":822,"y":2876,"wires":[["d86bb171b60cd242"]]},{"id":"9f65d7c85c08bf12","type":"ui_text_input","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","name":"","label":"Query","tooltip":"","group":"7bea4aa8.d8cdb4","order":8,"width":"0","height":"0","passthru":true,"mode":"text","delay":300,"topic":"","x":822,"y":2836,"wires":[["be857272ca630221"]]},{"id":"be857272ca630221","type":"change","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","name":"","rules":[{"t":"set","p":"query","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":992,"y":2836,"wires":[[]]},{"id":"a43d27559fae9e69","type":"change","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","name":"","rules":[{"t":"set","p":"device","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1052,"y":2576,"wires":[[]]},{"id":"523a5f97627c8abc","type":"ui_button","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","name":"Pause","group":"39eba160.64cc2e","order":1,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-pause","payload":"","payloadType":"str","topic":"","x":822,"y":2936,"wires":[["bdf2f18c6a60652b"]]},{"id":"70bf5808df69b882","type":"ui_button","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","name":"Resume","group":"39eba160.64cc2e","order":2,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-play","payload":"","payloadType":"str","topic":"","x":832,"y":2976,"wires":[["f2c94157587e74b5"]]},{"id":"7aa7b352424451a3","type":"ui_slider","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","name":"Volume Slider","label":"","tooltip":"","group":"39eba160.64cc2e","order":6,"width":"4","height":"1","passthru":true,"outs":"end","topic":"","min":0,"max":"100","step":1,"x":992,"y":3116,"wires":[["d31c227f05f8f2a1"]]},{"id":"73e5d460a6d6c7e2","type":"change","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","name":"","rules":[{"t":"set","p":"options","pt":"msg","to":"payload.accountName[]","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":1052,"y":2496,"wires":[["77255f9479dc65a7"]]},{"id":"77255f9479dc65a7","type":"ui_dropdown","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","name":"","label":"Device","tooltip":"","place":" ","group":"7bea4aa8.d8cdb4","order":2,"width":"5","height":"1","passthru":true,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"","x":1022,"y":2536,"wires":[["a43d27559fae9e69"]]},{"id":"6cde3511b53fa390","type":"change","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","name":"","rules":[{"t":"set","p":"options","pt":"msg","to":"payload.id[]","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":1052,"y":2656,"wires":[["3fbbc51a9add2174"]]},{"id":"3fbbc51a9add2174","type":"function","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","name":"pretty label","func":"let prettify = s => {\n\ts = s.replace('_', ' ');\n\ts = s.toLowerCase();\n\ts = s.split(' ').map(w => w[0].toUpperCase() + w.slice(1)).join(' ');\n\treturn s;\n};\n\nmsg.options = msg.options.map(o => {\n    let obj = {};\n    obj[prettify(o)] = o;\n    return obj;\n});\n\nreturn msg;","outputs":1,"noerr":0,"x":1042,"y":2696,"wires":[["53fe522fcea3c103"]]},{"id":"e422e53e30242a6d","type":"ui_template","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","group":"39eba160.64cc2e","name":"Repeat","order":7,"width":"2","height":"1","format":"<div style=\"margin:auto;\">Repeat</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":832,"y":3176,"wires":[[]]},{"id":"68dc553e982ba5bb","type":"ui_button","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","name":"Repeat On","group":"39eba160.64cc2e","order":8,"width":"2","height":"1","passthru":false,"label":"On","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":982,"y":3176,"wires":[["c323b1f65be96888"]]},{"id":"8dda48a733bc4ee8","type":"ui_button","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","name":"Repeat Off","group":"39eba160.64cc2e","order":9,"width":"2","height":"1","passthru":false,"label":"Off","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":982,"y":3216,"wires":[["933c3a5156572c04"]]},{"id":"61b08add5486844b","type":"ui_template","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","group":"39eba160.64cc2e","name":"Shuffle","order":10,"width":"2","height":"1","format":"<div style=\"margin:auto;\">Shuffle</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":822,"y":3256,"wires":[[]]},{"id":"fbb346ce9ceb9117","type":"ui_button","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","name":"Shuffle On","group":"39eba160.64cc2e","order":11,"width":"2","height":"1","passthru":false,"label":"On","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":982,"y":3256,"wires":[["bf141dfde5dfa227"]]},{"id":"67dd49662e855941","type":"ui_button","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","name":"Shuffle Off","group":"39eba160.64cc2e","order":12,"width":"2","height":"1","passthru":false,"label":"Off","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":982,"y":3296,"wires":[["b581a305a147b265"]]},{"id":"414ada4e37794083","type":"ui_button","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","name":"Refresh Device","group":"7bea4aa8.d8cdb4","order":3,"width":"1","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"refresh","payload":"","payloadType":"str","topic":"","x":872,"y":2456,"wires":[["f8a221db109b7c06"]]},{"id":"3c8e71a92dbb8a01","type":"ui_button","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","name":"Refresh Provider","group":"7bea4aa8.d8cdb4","order":6,"width":"1","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"refresh","payload":"","payloadType":"str","topic":"","x":862,"y":2616,"wires":[["11ce3382c2e40c82"]]},{"id":"c77849b29f043e50","type":"alexa-remote-event","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","name":"","account":"c341166.e0c82e8","event":"ws-audio-player-state-change","x":902,"y":3396,"wires":[["b8c11f34c6442db9"]]},{"id":"e5827b37b4eff671","type":"ui_template","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","group":"c67b7b1.78a7c88","name":"Image","order":2,"width":"6","height":"7","format":"<a href=\"{{msg.payload}}\">\n    <img src=\"{{msg.payload}}\" alt=\"oh no\" width=\"310\">\n</a>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":1322,"y":3436,"wires":[[]]},{"id":"bb82b8d0bd7119fa","type":"ui_template","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","group":"c67b7b1.78a7c88","name":"Title","order":1,"width":"6","height":"1","format":"<div ng-bind-html=\"msg.payload\" style=\"margin:auto; margin-top:0;\">\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":1322,"y":3396,"wires":[[]]},{"id":"c8c013a07e3768a8","type":"ui_slider","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","name":"","label":"","tooltip":"","group":"c67b7b1.78a7c88","order":3,"width":0,"height":0,"passthru":false,"outs":"end","topic":"","min":0,"max":"100","step":"1","x":1322,"y":3476,"wires":[[]]},{"id":"9c1c1a699cedbff1","type":"function","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","name":"progress","func":"let interval = context.get('interval');\nif(interval) clearInterval(interval);\ncontext.set('interval', undefined);\n\nif(!msg.payload.progress) return;\n\nconst updateTime = Date.now();\nconst updateProgress = msg.payload.progress.mediaProgress;\nconst mediaLength = msg.payload.progress.mediaLength;\nconst fraction = updateProgress / mediaLength;\nnode.send({ payload: fraction * 100 });\n\nif(msg.payload.state !== 'PLAYING') return;\n\ncontext.set('interval', setInterval(() => {\n    const elapsed = Date.now() - updateTime;\n    const progress = updateProgress + elapsed / 1000;\n    const fraction = progress / mediaLength;\n    node.send({ payload: fraction * 100 });\n}, 1000));\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1192,"y":3476,"wires":[["c8c013a07e3768a8"]]},{"id":"dffe94610b879a3f","type":"change","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","name":"infoText","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.infoText.title","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1192,"y":3396,"wires":[["bb82b8d0bd7119fa"]]},{"id":"93ac56ec1733c63a","type":"change","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","name":"mainArt","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.mainArt.url","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1192,"y":3436,"wires":[["e5827b37b4eff671"]]},{"id":"f8a221db109b7c06","type":"alexa-remote-echo","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","name":"","account":"c341166.e0c82e8","config":{"option":"get","value":{"what":"device","device":{"type":"str","value":"ALEXA_ALL_DSN"}}},"x":1062,"y":2456,"wires":[["73e5d460a6d6c7e2"]]},{"id":"11ce3382c2e40c82","type":"alexa-remote-other","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","name":"","account":"c341166.e0c82e8","config":{"option":"get","value":{"what":"musicProviders"}},"x":1072,"y":2616,"wires":[["6cde3511b53fa390"]]},{"id":"bdf2f18c6a60652b","type":"alexa-remote-echo","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","name":"","account":"c341166.e0c82e8","config":{"option":"command","value":{"device":{"type":"flow","value":"device"},"what":"pause"}},"x":982,"y":2936,"wires":[[]]},{"id":"f2c94157587e74b5","type":"alexa-remote-echo","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","name":"","account":"c341166.e0c82e8","config":{"option":"command","value":{"device":{"type":"flow","value":"device"},"what":"play"}},"x":972,"y":2976,"wires":[[]]},{"id":"d86bb171b60cd242","type":"alexa-remote-routine","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","name":"","account":"c341166.e0c82e8","routineNode":{"type":"music","payload":{"device":{"type":"flow","value":""},"provider":{"type":"str","value":"AMAZON_MUSIC"},"search":{"type":"flow","value":"query"},"duration":{"type":"num","value":""}}},"x":992,"y":2876,"wires":[[]]},{"id":"d31c227f05f8f2a1","type":"alexa-remote-echo","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","name":"","account":"c341166.e0c82e8","config":{"option":"command","value":{"device":{"type":"flow","value":"device"},"what":"volume","value":{"type":"msg","value":"payload"}}},"x":1162,"y":3116,"wires":[[]]},{"id":"c323b1f65be96888","type":"alexa-remote-echo","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","name":"","account":"c341166.e0c82e8","config":{"option":"command","value":{"device":{"type":"flow","value":"device"},"what":"repeat","value":{"type":"bool","value":"true"}}},"x":1162,"y":3176,"wires":[[]]},{"id":"933c3a5156572c04","type":"alexa-remote-echo","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","name":"","account":"c341166.e0c82e8","config":{"option":"command","value":{"device":{"type":"flow","value":"device"},"what":"repeat","value":{"type":"bool","value":"true"}}},"x":1162,"y":3216,"wires":[[]]},{"id":"bf141dfde5dfa227","type":"alexa-remote-echo","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","name":"","account":"c341166.e0c82e8","config":{"option":"command","value":{"device":{"type":"flow","value":"device"},"what":"shuffle","value":{"type":"bool","value":"true"}}},"x":1152,"y":3256,"wires":[[]]},{"id":"b581a305a147b265","type":"alexa-remote-echo","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","name":"","account":"c341166.e0c82e8","config":{"option":"command","value":{"device":{"type":"flow","value":"device"},"what":"shuffle","value":{"type":"bool","value":"false"}}},"x":1152,"y":3296,"wires":[[]]},{"id":"b8c11f34c6442db9","type":"alexa-remote-echo","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","name":"","account":"c341166.e0c82e8","config":{"option":"get","value":{"what":"playerInfo","device":{"type":"flow","value":"device"}}},"x":992,"y":3436,"wires":[["dffe94610b879a3f","93ac56ec1733c63a","9c1c1a699cedbff1"]]},{"id":"e34014dda8a286c3","type":"ui_button","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","name":"Previous","group":"39eba160.64cc2e","order":3,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-arrow-left","payload":"","payloadType":"str","topic":"","x":832,"y":3016,"wires":[["927f2b972eab7268"]]},{"id":"133b1eef8d13bcbc","type":"ui_button","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","name":"Next","group":"39eba160.64cc2e","order":4,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-arrow-right","payload":"","payloadType":"str","topic":"","x":822,"y":3056,"wires":[["b4816fa70d9b4c21"]]},{"id":"927f2b972eab7268","type":"alexa-remote-echo","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","name":"","account":"c341166.e0c82e8","config":{"option":"command","value":{"device":{"type":"flow","value":"device"},"what":"previous"}},"x":992,"y":3016,"wires":[[]]},{"id":"b4816fa70d9b4c21","type":"alexa-remote-echo","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","name":"","account":"c341166.e0c82e8","config":{"option":"command","value":{"device":{"type":"flow","value":"device"},"what":"next"}},"x":982,"y":3056,"wires":[[]]},{"id":"efedf9a26975dc8b","type":"ui_template","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","group":"39eba160.64cc2e","name":"Volume","order":5,"width":"2","height":"1","format":"<div style=\"margin:auto;\">Volume</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":832,"y":3116,"wires":[[]]},{"id":"9c74d7334bfa6b69","type":"comment","z":"fd8eb98d.2d1be8","g":"5db4b4ef341421cc","name":"3. Alexa Music Dashboard","info":"https://github.com/586837r/node-red-contrib-alexa-remote2/blob/master//examples.md#3-alexa-music-dashboard","x":902,"y":2412,"wires":[]},{"id":"28b3f4fa009ab066","type":"alexa-remote-init","z":"fd8eb98d.2d1be8","d":true,"g":"d80402f2c42e743c","name":"","account":"c341166.e0c82e8","option":"refresh","x":944,"y":2304,"wires":[["b8835f773956d0a3"]]},{"id":"805aa0937ac1201a","type":"inject","z":"fd8eb98d.2d1be8","d":true,"g":"d80402f2c42e743c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":756,"y":2304,"wires":[["28b3f4fa009ab066"]]},{"id":"b8835f773956d0a3","type":"debug","z":"fd8eb98d.2d1be8","d":true,"g":"d80402f2c42e743c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1142,"y":2304,"wires":[]},{"id":"7d1c2ce39f559d38","type":"comment","z":"fd8eb98d.2d1be8","g":"e89100b0ca32d393","name":"4. Alexa Lists Dashboard","info":"https://github.com/586837r/node-red-contrib-alexa-remote2/blob/master//examples.md#4-alexa-lists-dashboard","x":1596,"y":2400,"wires":[]},{"id":"176b69cbfc870ff0","type":"inject","z":"fd8eb98d.2d1be8","g":"e89100b0ca32d393","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"str","x":1538,"y":2856,"wires":[["ca8fa8714eb9d771"]]},{"id":"ca8fa8714eb9d771","type":"alexa-remote-list","z":"fd8eb98d.2d1be8","g":"e89100b0ca32d393","name":"Todo","account":"c341166.e0c82e8","config":{"option":"getListItems","value":{"list":{"type":"str","value":"YW16bjEuYWNjb3VudC5BRzMzWUhRT0lHQzJGUzdHWDZIWTVXVEszSUxRLVNIT1BQSU5HX0lURU0="}}},"x":1658,"y":2856,"wires":[["58de072ce869a71d"]]},{"id":"2ae11b10917886b7","type":"alexa-remote-list","z":"fd8eb98d.2d1be8","g":"e89100b0ca32d393","name":"","account":"c341166.e0c82e8","config":{"option":"removeItem","value":{"list":{"type":"str","value":"YW16bjEuYWNjb3VudC5BRzMzWUhRT0lHQzJGUzdHWDZIWTVXVEszSUxRLVNIT1BQSU5HX0lURU0="},"item":{"type":"msg","value":"payload.id"}}},"x":2338,"y":2956,"wires":[[]]},{"id":"f921d40c410b194c","type":"ui_template","z":"fd8eb98d.2d1be8","g":"e89100b0ca32d393","group":"2315beea.977712","name":"","order":2,"width":6,"height":12,"format":"<!-- ITEMS -->\n<div layout\n    ng-repeat=\"item in msg.payload track by $index\" \n    style=\"height: 48px; overflow: hidden;\">\n    \n    <!-- COMPLETED -->\n    <div style=\"\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        height: 100%;\n        width: 48px;\n        \">\n        <md-button \n            ng-click=\"\n                item.completed = !item.completed; \n                send({payload: item, action: 'edit'})\n            \"\n            style=\"\n            background: transparent;\n            border-radius: 50%;\n            \">\n            <style scoped>\n                ng-md-icon[icon=\"check_box\"] path {\n                    fill: lightgray !important;\n                }\n                ng-md-icon[icon=\"check_box_outline_blank\"] path {\n                    fill: gray !important;\n                }\n            </style>\n            <ng-md-icon \n                icon=\"{{item.completed ? 'check_box' : 'check_box_outline_blank'}}\"\n                size=\"24\"\n                style=\"\n                    outline: none !important;\n                    border: 0 !important;\n                \">\n            </ng-md-icon>\n        </md-button>\n    </div>\n    \n    <!-- LABEL -->\n    <div layout\n        style=\"{{item.disabled \n            ? 'padding: 0 12px; flex: 1; align-items: center;' \n            : 'padding: 0 12px; flex: 1; align-items: center; color: gray;'\n        }}\">\n        <p>{{item.value}}</p>\n    </div>\n    \n    <!-- DELETE -->\n    <div style=\"\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        height: 100%;\n        width: 48px;\n        \">\n        <md-button \n            ng-click=\"\n                send({payload: item, action: 'delete'})\n            \" \n            style=\"\n            background: transparent;\n            border-radius: 50%;\n            \">\n            <style scoped>\n                ng-md-icon[icon=\"delete\"] path {\n                    fill: lightgray !important;\n                }\n            </style>\n            <ng-md-icon \n                icon=\"delete\"\n                size=\"24\"\n                style=\"\n                    outline: none !important;\n                    border: 0 !important;\n                \">\n            </ng-md-icon>\n        </md-button>\n    </div>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":1968,"y":2896,"wires":[["76f8cde2bd729d39"]]},{"id":"925aae9f79bcc3d3","type":"alexa-remote-list","z":"fd8eb98d.2d1be8","g":"e89100b0ca32d393","name":"","account":"c341166.e0c82e8","config":{"option":"editItem","value":{"list":{"type":"str","value":"YW16bjEuYWNjb3VudC5BRzMzWUhRT0lHQzJGUzdHWDZIWTVXVEszSUxRLVNIT1BQSU5HX0lURU0="},"item":{"type":"msg","value":"payload.id"},"text":{"type":"msg","value":"payload.value"},"completed":{"type":"msg","value":"payload.completed"},"version":{"type":"msg","value":"payload.version"}}},"x":2328,"y":2896,"wires":[["dd7a3d34c007b5b0"]]},{"id":"76f8cde2bd729d39","type":"switch","z":"fd8eb98d.2d1be8","g":"e89100b0ca32d393","name":"","property":"action","propertyType":"msg","rules":[{"t":"eq","v":"edit","vt":"str"},{"t":"eq","v":"delete","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":2178,"y":2896,"wires":[["925aae9f79bcc3d3"],["2ae11b10917886b7","f2e78d4a29db08a3"]]},{"id":"f923befcb592876f","type":"change","z":"fd8eb98d.2d1be8","g":"e89100b0ca32d393","name":"","rules":[{"t":"set","p":"todo","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1938,"y":2856,"wires":[["f75e718fd36f1b54"]]},{"id":"f75e718fd36f1b54","type":"change","z":"fd8eb98d.2d1be8","g":"e89100b0ca32d393","name":"get flow.todo","rules":[{"t":"set","p":"payload","pt":"msg","to":"todo","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":1818,"y":2896,"wires":[["f921d40c410b194c"]]},{"id":"f2e78d4a29db08a3","type":"function","z":"fd8eb98d.2d1be8","g":"e89100b0ca32d393","name":"remove","func":"let list = flow.get('todo');\nlist = list.filter(o => o.id != msg.payload.id);\nflow.set('todo', list);\nreturn msg;","outputs":1,"noerr":0,"x":2488,"y":2956,"wires":[["f75e718fd36f1b54"]]},{"id":"dd7a3d34c007b5b0","type":"function","z":"fd8eb98d.2d1be8","g":"e89100b0ca32d393","name":"update","func":"let list = flow.get('todo');\nlist = list.filter(o => o.id != msg.payload.id);\nlist.push(msg.payload);\nflow.set('todo', list);\nreturn msg;","outputs":1,"noerr":0,"x":2478,"y":2896,"wires":[["66390779189a5a80"]]},{"id":"66390779189a5a80","type":"function","z":"fd8eb98d.2d1be8","g":"e89100b0ca32d393","name":"sort","func":"let list = flow.get('todo');\nlist = list.sort((a, b) => b.createdDateTime - a.createdDateTime)\nflow.set('todo', list);\nreturn msg;","outputs":1,"noerr":0,"x":2618,"y":2896,"wires":[["f75e718fd36f1b54"]]},{"id":"c51ead7d1e04ba36","type":"ui_button","z":"fd8eb98d.2d1be8","g":"e89100b0ca32d393","name":"Refresh","group":"2315beea.977712","order":5,"width":6,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"refresh","payload":"","payloadType":"str","topic":"","x":1548,"y":2816,"wires":[["ca8fa8714eb9d771"]]},{"id":"58de072ce869a71d","type":"function","z":"fd8eb98d.2d1be8","g":"e89100b0ca32d393","name":"sort","func":"msg.payload = msg.payload.sort((a, b) => b.createdDateTime - a.createdDateTime)\nreturn msg;","outputs":1,"noerr":0,"x":1798,"y":2856,"wires":[["f923befcb592876f"]]},{"id":"054879f441f415e9","type":"alexa-remote-list","z":"fd8eb98d.2d1be8","g":"e89100b0ca32d393","name":"Shopping","account":"c341166.e0c82e8","config":{"option":"getListItems","value":{"list":{"type":"str","value":"YW16bjEuYWNjb3VudC5BRzMzWUhRT0lHQzJGUzdHWDZIWTVXVEszSUxRLVNIT1BQSU5HX0lURU0="}}},"x":1668,"y":2596,"wires":[["df65c111a0e17814"]]},{"id":"a8288f09613c4826","type":"inject","z":"fd8eb98d.2d1be8","g":"e89100b0ca32d393","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"str","x":1538,"y":2596,"wires":[["054879f441f415e9"]]},{"id":"6ba33188bfa52ccb","type":"ui_button","z":"fd8eb98d.2d1be8","g":"e89100b0ca32d393","name":"Refresh","group":"1654aec2.080031","order":5,"width":6,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"refresh","payload":"","payloadType":"str","topic":"","x":1548,"y":2556,"wires":[["054879f441f415e9"]]},{"id":"df65c111a0e17814","type":"function","z":"fd8eb98d.2d1be8","g":"e89100b0ca32d393","name":"sort","func":"msg.payload = msg.payload.sort((a, b) => b.createdDateTime - a.createdDateTime)\nreturn msg;","outputs":1,"noerr":0,"x":1818,"y":2596,"wires":[["f290b8c5cedc2f19"]]},{"id":"f290b8c5cedc2f19","type":"change","z":"fd8eb98d.2d1be8","g":"e89100b0ca32d393","name":"","rules":[{"t":"set","p":"shopping","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1978,"y":2596,"wires":[["bc2fefc36ce230ce"]]},{"id":"bc2fefc36ce230ce","type":"change","z":"fd8eb98d.2d1be8","g":"e89100b0ca32d393","name":"get flow.shopping","rules":[{"t":"set","p":"payload","pt":"msg","to":"shopping","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":1858,"y":2636,"wires":[["6f89af4ba201ffed"]]},{"id":"6f89af4ba201ffed","type":"ui_template","z":"fd8eb98d.2d1be8","g":"e89100b0ca32d393","group":"1654aec2.080031","name":"","order":2,"width":6,"height":12,"format":"<!-- ITEMS -->\n<div layout\n    ng-repeat=\"item in msg.payload track by $index\" \n    style=\"height: 48px; overflow: hidden;\">\n    \n    <!-- COMPLETED -->\n    <div style=\"\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        height: 100%;\n        width: 48px;\n        \">\n        <md-button \n            ng-click=\"\n                item.completed = !item.completed; \n                send({payload: item, action: 'edit'})\n            \"\n            style=\"\n            background: transparent;\n            border-radius: 50%;\n            \">\n            <style scoped>\n                ng-md-icon[icon=\"check_box\"] path {\n                    fill: lightgray !important;\n                }\n                ng-md-icon[icon=\"check_box_outline_blank\"] path {\n                    fill: gray !important;\n                }\n            </style>\n            <ng-md-icon \n                icon=\"{{item.completed ? 'check_box' : 'check_box_outline_blank'}}\"\n                size=\"24\"\n                style=\"\n                    outline: none !important;\n                    border: 0 !important;\n                \">\n            </ng-md-icon>\n        </md-button>\n    </div>\n    \n    <!-- LABEL -->\n    <div layout\n        style=\"{{item.disabled \n            ? 'padding: 0 12px; flex: 1; align-items: center;' \n            : 'padding: 0 12px; flex: 1; align-items: center; color: gray;'\n        }}\">\n        <p>{{item.value}}</p>\n    </div>\n    \n    <!-- DELETE -->\n    <div style=\"\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        height: 100%;\n        width: 48px;\n        \">\n        <md-button \n            ng-click=\"\n                send({payload: item, action: 'delete'})\n            \" \n            style=\"\n            background: transparent;\n            border-radius: 50%;\n            \">\n            <style scoped>\n                ng-md-icon[icon=\"delete\"] path {\n                    fill: lightgray !important;\n                }\n            </style>\n            <ng-md-icon \n                icon=\"delete\"\n                size=\"24\"\n                style=\"\n                    outline: none !important;\n                    border: 0 !important;\n                \">\n            </ng-md-icon>\n        </md-button>\n    </div>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":2028,"y":2636,"wires":[["aa46650ab1986f45"]]},{"id":"2fa77eb67df6f720","type":"function","z":"fd8eb98d.2d1be8","g":"e89100b0ca32d393","name":"sort","func":"let list = flow.get('shopping');\nlist = list.sort((a, b) => b.createdDateTime - a.createdDateTime)\nflow.set('shopping', list);\nreturn msg;","outputs":1,"noerr":0,"x":2618,"y":2636,"wires":[["bc2fefc36ce230ce"]]},{"id":"74667db224675f7a","type":"function","z":"fd8eb98d.2d1be8","g":"e89100b0ca32d393","name":"remove","func":"let list = flow.get('shopping');\nlist = list.filter(o => o.id != msg.payload.id);\nflow.set('shopping', list);\nreturn msg;","outputs":1,"noerr":0,"x":2488,"y":2696,"wires":[["bc2fefc36ce230ce"]]},{"id":"aa46650ab1986f45","type":"switch","z":"fd8eb98d.2d1be8","g":"e89100b0ca32d393","name":"","property":"action","propertyType":"msg","rules":[{"t":"eq","v":"edit","vt":"str"},{"t":"eq","v":"delete","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":2178,"y":2636,"wires":[["bf17cbf411db32e5"],["b829b1c96cad353d","74667db224675f7a"]]},{"id":"aa3e2d2aff99a652","type":"function","z":"fd8eb98d.2d1be8","g":"e89100b0ca32d393","name":"update","func":"let list = flow.get('shopping');\nlist = list.filter(o => o.id != msg.payload.id);\nlist.push(msg.payload);\nflow.set('shopping', list);\nreturn msg;","outputs":1,"noerr":0,"x":2478,"y":2636,"wires":[["2fa77eb67df6f720"]]},{"id":"bf17cbf411db32e5","type":"alexa-remote-list","z":"fd8eb98d.2d1be8","g":"e89100b0ca32d393","name":"","account":"c341166.e0c82e8","config":{"option":"editItem","value":{"list":{"type":"str","value":"YW16bjEuYWNjb3VudC5BRzMzWUhRT0lHQzJGUzdHWDZIWTVXVEszSUxRLVNIT1BQSU5HX0lURU0="},"item":{"type":"msg","value":"payload.id"},"text":{"type":"msg","value":"payload.value"},"completed":{"type":"msg","value":"payload.completed"},"version":{"type":"msg","value":"payload.version"}}},"x":2328,"y":2636,"wires":[["aa3e2d2aff99a652"]]},{"id":"b829b1c96cad353d","type":"alexa-remote-list","z":"fd8eb98d.2d1be8","g":"e89100b0ca32d393","name":"","account":"c341166.e0c82e8","config":{"option":"removeItem","value":{"list":{"type":"str","value":"YW16bjEuYWNjb3VudC5BRzMzWUhRT0lHQzJGUzdHWDZIWTVXVEszSUxRLVNIT1BQSU5HX0lURU0="},"item":{"type":"msg","value":"payload.id"}}},"x":2338,"y":2696,"wires":[[]]},{"id":"42c8b7c6a8223e54","type":"ui_text_input","z":"fd8eb98d.2d1be8","g":"e89100b0ca32d393","name":"Item","label":"Add new item","tooltip":"Add new item","group":"2315beea.977712","order":3,"width":5,"height":1,"passthru":true,"mode":"text","delay":300,"topic":"","x":1538,"y":2736,"wires":[["02a35c6f59cfe44e"]]},{"id":"ec08a8d64477a083","type":"ui_button","z":"fd8eb98d.2d1be8","g":"e89100b0ca32d393","name":"Add","group":"2315beea.977712","order":4,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"add","payload":"","payloadType":"str","topic":"","x":1538,"y":2776,"wires":[["753ba34acb84a239"]]},{"id":"02a35c6f59cfe44e","type":"change","z":"fd8eb98d.2d1be8","g":"e89100b0ca32d393","name":"","rules":[{"t":"set","p":"todoItem","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1698,"y":2736,"wires":[[]]},{"id":"753ba34acb84a239","type":"alexa-remote-list","z":"fd8eb98d.2d1be8","g":"e89100b0ca32d393","name":"","account":"c341166.e0c82e8","config":{"option":"addItem","value":{"list":{"type":"str","value":"YW16bjEuYWNjb3VudC5BRzMzWUhRT0lHQzJGUzdHWDZIWTVXVEszSUxRLVNIT1BQSU5HX0lURU0="},"text":{"type":"flow","value":"todoItem"}}},"x":1668,"y":2776,"wires":[["fc25e5d994aae5e6"]]},{"id":"fc25e5d994aae5e6","type":"function","z":"fd8eb98d.2d1be8","g":"e89100b0ca32d393","name":"add","func":"let list = flow.get('todo');\nlist.unshift(msg.payload);\nflow.set('todo', list);\nreturn msg;","outputs":1,"noerr":0,"x":1798,"y":2776,"wires":[["f75e718fd36f1b54"]]},{"id":"e6f437c0f59e2ade","type":"ui_text_input","z":"fd8eb98d.2d1be8","g":"e89100b0ca32d393","name":"Item","label":"Add new item","tooltip":"Add new item","group":"1654aec2.080031","order":3,"width":5,"height":1,"passthru":true,"mode":"text","delay":300,"topic":"","x":1538,"y":2476,"wires":[["040cfa3ffe916a96"]]},{"id":"599f19f329e3d324","type":"ui_button","z":"fd8eb98d.2d1be8","g":"e89100b0ca32d393","name":"Add","group":"1654aec2.080031","order":4,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"add","payload":"","payloadType":"str","topic":"","x":1538,"y":2516,"wires":[["18cf6e3c83b314df"]]},{"id":"040cfa3ffe916a96","type":"change","z":"fd8eb98d.2d1be8","g":"e89100b0ca32d393","name":"","rules":[{"t":"set","p":"shoppingItem","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1708,"y":2476,"wires":[[]]},{"id":"18cf6e3c83b314df","type":"alexa-remote-list","z":"fd8eb98d.2d1be8","g":"e89100b0ca32d393","name":"","account":"c341166.e0c82e8","config":{"option":"addItem","value":{"list":{"type":"str","value":"YW16bjEuYWNjb3VudC5BRzMzWUhRT0lHQzJGUzdHWDZIWTVXVEszSUxRLVNIT1BQSU5HX0lURU0="},"text":{"type":"flow","value":"shoppingItem"}}},"x":1668,"y":2516,"wires":[["1dfa085f478c6012"]]},{"id":"1dfa085f478c6012","type":"function","z":"fd8eb98d.2d1be8","g":"e89100b0ca32d393","name":"add","func":"let list = flow.get('shopping');\nlist.unshift(msg.payload);\nflow.set('shopping', list);\nreturn msg;","outputs":1,"noerr":0,"x":1798,"y":2516,"wires":[["bc2fefc36ce230ce"]]},{"id":"286527ca4217ca2d","type":"comment","z":"fd8eb98d.2d1be8","g":"877d07a80bb00420","name":"5. Alexa Timers Dashboard","info":"https://github.com/586837r/node-red-contrib-alexa-remote2/blob/master//examples.md#5-alexa-timers-dashboard","x":178,"y":2964,"wires":[]},{"id":"8146db0875fc0a2e","type":"alexa-remote-event","z":"fd8eb98d.2d1be8","g":"877d07a80bb00420","name":"","account":"c341166.e0c82e8","event":"ws-notification-change","x":218,"y":3060,"wires":[["fdd249e33ff6ff7d"]]},{"id":"fdd249e33ff6ff7d","type":"alexa-remote-other","z":"fd8eb98d.2d1be8","g":"877d07a80bb00420","name":"","account":"c341166.e0c82e8","config":{"option":"get","value":{"what":"notifications"}},"x":438,"y":3060,"wires":[["67c3fc7b2683cdda"]]},{"id":"1e698adf2350851d","type":"function","z":"fd8eb98d.2d1be8","g":"877d07a80bb00420","name":"map timers","func":"const timers = msg.payload.map(x => ({\n   name: x.timerLabel || 'Unnamed',\n   remaining: x.remainingTime,\n   paused: x.status !== 'ON',\n}));\n\nmsg.payload = { \n    timers: timers, \n    time: Date.now() \n};\n\nreturn msg;","outputs":1,"noerr":0,"x":468,"y":3120,"wires":[["f5be3762662b34e1"]]},{"id":"67c3fc7b2683cdda","type":"function","z":"fd8eb98d.2d1be8","g":"877d07a80bb00420","name":"filter active timers","func":"msg.payload = msg.payload.filter(x => \n    x.type === 'Timer' && x.status !== 'OFF'\n);\nreturn msg;","outputs":1,"noerr":0,"x":288,"y":3120,"wires":[["1e698adf2350851d"]]},{"id":"f5be3762662b34e1","type":"ui_template","z":"fd8eb98d.2d1be8","g":"877d07a80bb00420","group":"765c4d0d.672094","name":"","order":1,"width":"0","height":"0","format":"<div id=\"alexa-timers-container\">\n    \n</div>\n<script>\n    (function(scope) {\n        function durationToPieces(dur = 0) {\n        \tconst u = dur % 1000, uRem = Math.floor(dur / 1000);\n        \tconst s = uRem % 60, sRem = Math.floor(uRem / 60);\n        \tconst m = sRem % 60, mRem = Math.floor(sRem / 60);\n        \tconst h = mRem % 24, hRem = Math.floor(mRem / 24);\n        \tconst d = hRem;\n        \treturn [d, h, m, s, u];\n        }\n        \n        function formatDuration(dur) {\n            const [d, h, m, s, u] = durationToPieces(dur);\n            let string = `${m ? String(s).padStart(2, '0') : s}`;\n            if(m) string = `${h ? String(m).padStart(2, '0') : m}:${string}`;\n            if(h) string = `${h}:${string}`;\n            if(d) string = `${d} days ${string}`;\n            return string;\n        }\n\n        scope.$watch('msg.payload', function(data) {\n            const container = $('#alexa-timers-container');\n            container.parent().css({ height: 'auto', width: 'auto', padding: '0', 'overflow-y': 'visible'});\n            container.empty();\n            \n            if(!data) return;\n            console.log(data);\n            const { timers, time } = data;\n            \n            const interval = container.data('interval');\n            if(interval) clearInterval(interval);\n            \n            for (const timer of timers) {\n                // copied from ui_text\n                const row = $('<md-card ui-card-size=\"6x1\" layout=\"row\" layout-align=\"space-between center\" class=\"nr-dashboard-text ng-scope _md layout-row layout-align-space-between-center visible\" style=\"left: 0px; top: 0px; width: 318px; height: 48px;\">');\n                row.css({ margin: '0' });\n                row.data(timer);\n                const label = $(`<p class=\"label\">${timer.name}</p>`);\n                const value = $(`<p class=\"value\">${formatDuration(timer.remaining).toString()}</p>`);\n                const icon = $(`<i class=\"fa fa-${timer.paused ? 'pause' : 'play'}\" style=\"margin-left: 8px;\"></i>`);\n                row.append(label, value.append(icon))\n                container.append(row);\n            }\n            \n            container.data('interval', setInterval(() => {\n                const rows = container.children().each(function(){\n                    const row = $(this);\n                    const timer = row.data();\n                    if(!timer.paused) {\n                        const elapsed = Date.now() - time;\n                        const remaining = Math.max(timer.remaining - elapsed, 0);\n                        //console.log({now: Date.now(), time: time, rem: data.remaining});\n                        const string = formatDuration(remaining);\n                        row.children().eq(1).text(string).append(`<i class=\"fa fa-${timer.paused ? 'pause' : 'play'}\" style=\"margin-left: 8px;\"></i>`);\n                    }\n                });\n                //console.log(rows);  \n            }, 1000));\n        });\n    })(scope);\n</script>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":618,"y":3120,"wires":[[]]},{"id":"7ef9f9aabcbe416c","type":"inject","z":"fd8eb98d.2d1be8","g":"877d07a80bb00420","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":258,"y":3020,"wires":[["fdd249e33ff6ff7d"]]},{"id":"c74a887cbce25994","type":"mqtt in","z":"fd8eb98d.2d1be8","g":"1bcdbf064cc50c63","name":"","topic":"layzspa/message","qos":"2","datatype":"json","broker":"e96cb00d.af953","nl":false,"rap":false,"inputs":0,"x":136,"y":4044,"wires":[["9a14adbf6c0fb90b","05fbd93efdcf1405","50818d85d97258a6","f5188fd31329cf9c","b8615fca969a0e24","bcb2c1565b7116c8","842662cc35a8f537","06227f6df2cb3d11"]]},{"id":"257e15b8aa8f0694","type":"mqtt out","z":"fd8eb98d.2d1be8","g":"1bcdbf064cc50c63","name":"","topic":"layzspa/command","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"e96cb00d.af953","x":1346,"y":4304,"wires":[]},{"id":"3f3ac26936421037","type":"inject","z":"fd8eb98d.2d1be8","g":"1bcdbf064cc50c63","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"CMD\":3,\"VALUE\":false,\"XTIME\":1618758528,\"INTERVAL\":0}","payloadType":"str","x":766,"y":4144,"wires":[["257e15b8aa8f0694"]]},{"id":"b64acaf378a26911","type":"mqtt out","z":"fd8eb98d.2d1be8","g":"1bcdbf064cc50c63","name":"","topic":"layzspa/command","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"e96cb00d.af953","x":1346,"y":3744,"wires":[]},{"id":"68a3324baf5dfdc7","type":"join","z":"fd8eb98d.2d1be8","g":"1bcdbf064cc50c63","name":"","mode":"custom","build":"object","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":true,"timeout":"","count":"1","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"num","reduceFixup":"","x":706,"y":3744,"wires":[["11b834ca1e4ca397"]]},{"id":"9a14adbf6c0fb90b","type":"function","z":"fd8eb98d.2d1be8","g":"1bcdbf064cc50c63","name":"add topic \"heat\"","func":"var mymsg = msg.payload.RED || msg.payload.GRN;\nmsg.payload = mymsg;\nmsg.topic = \"heat\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":476,"y":3804,"wires":[["68a3324baf5dfdc7"]]},{"id":"48be9d6d2e362443","type":"function","z":"fd8eb98d.2d1be8","g":"1bcdbf064cc50c63","name":"add topic \"amps\"","func":"var mymsg = msg.payload;\nmsg.payload = mymsg;\nmsg.topic = \"amps\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":486,"y":3764,"wires":[["68a3324baf5dfdc7"]]},{"id":"11b834ca1e4ca397","type":"function","z":"fd8eb98d.2d1be8","g":"1bcdbf064cc50c63","name":"Turn on or off heat","func":"var local = context.get(\"heat\");\nvar turnon = '{\"CMD\":3,\"VALUE\":true,\"XTIME\":0,\"INTERVAL\":0}';\nvar turnoff = '{\"CMD\":3,\"VALUE\":false,\"XTIME\":0,\"INTERVAL\":0}';\n\nif(msg.payload.amps > 16 && msg.payload.heat) {\n    context.set(\"restoreheat\", 1);\n    return {payload: turnoff};\n}\nif(msg.payload.amps < 7) {\n    if(context.get(\"restoreheat\")){\n        context.set(\"restoreheat\", 0);\n        return {payload: turnon};\n    }\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":886,"y":3744,"wires":[["b64acaf378a26911"]]},{"id":"be3e8b2b625dd7b2","type":"inject","z":"fd8eb98d.2d1be8","g":"1bcdbf064cc50c63","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"17","payloadType":"num","x":176,"y":3844,"wires":[["48be9d6d2e362443"]]},{"id":"7177afaaebbe664c","type":"inject","z":"fd8eb98d.2d1be8","g":"1bcdbf064cc50c63","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"5","payloadType":"num","x":175,"y":3884,"wires":[["48be9d6d2e362443"]]},{"id":"0733da4a1697fc48","type":"server-state-changed","z":"fd8eb98d.2d1be8","g":"1bcdbf064cc50c63","name":"","server":"ebb6b83c7588d734","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.l1_current","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":206,"y":3764,"wires":[["48be9d6d2e362443"]]},{"id":"5413f759e85bc8c6","type":"api-call-service","z":"fd8eb98d.2d1be8","g":"1bcdbf064cc50c63","name":"Notify Thomas","server":"ebb6b83c7588d734","version":5,"debugenabled":false,"domain":"notify","service":"mobile_app_thomas_landahls_mobil","areaId":[],"deviceId":[],"entityId":[],"data":"{\"title\":\"SPA command\",\"message\":\"{{payload}}\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"output_location":"payload","output_location_type":"msg","x":1336,"y":4044,"wires":[[]]},{"id":"ad4e34943c76c624","type":"inject","z":"fd8eb98d.2d1be8","g":"1bcdbf064cc50c63","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"blablablabla","payloadType":"str","x":446,"y":4084,"wires":[["5413f759e85bc8c6"]]},{"id":"05fbd93efdcf1405","type":"function","z":"fd8eb98d.2d1be8","g":"1bcdbf064cc50c63","name":"target reached","func":"if(msg.payload.TGT == msg.payload.TMP && context.get(\"reportnext\")) {\n    context.set(\"reportnext\", 0);\n    return {payload: {data: { title: \"SPA temperature\", message:\"Target temperature is reached\"}}};\n}\nif(Math.abs(msg.payload.TMP - msg.payload.TGT)>1 && context.get(\"reportnext\")==0) {\n    context.set(\"reportnext\", 1);\n    return {payload: {data: { title: \"SPA temperature\", message:\"Temperature is deviating from target\"}}};\n}","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is started.\ncontext.set(\"reportnext\", 0);","finalize":"","libs":[],"x":436,"y":4044,"wires":[["5413f759e85bc8c6"]]},{"id":"1b12a89ae06c9739","type":"influxdb out","z":"fd8eb98d.2d1be8","g":"1bcdbf064cc50c63","influxdb":"27519cf66f268968","name":"influx/pooldb","measurement":"pooldata","precision":"","retentionPolicy":"","database":"","retentionPolicyV18Flux":"","org":"","bucket":"","x":1326,"y":3964,"wires":[]},{"id":"50818d85d97258a6","type":"function","z":"fd8eb98d.2d1be8","g":"1bcdbf064cc50c63","name":"","func":"var tags;\nvar fields;\n\ntags = {\n}\n\nfields = {\n    content: msg.payload[\"CONTENT\"],\n    temp: msg.payload[\"TMP\"],\n    target: msg.payload[\"TGT\"],\n    locked: msg.payload[\"LCK\"],\n    air: msg.payload[\"AIR\"],\n    celsius: msg.payload[\"UNT\"],\n    heating: msg.payload[\"RED\"],\n    heater: msg.payload[\"GRN\"] || msg.payload[\"RED\"],\n    filter: msg.payload[\"FLT\"],\n    power: msg.payload[\"PWR\"],\n    ch1: msg.payload[\"CH1\"],\n    ch2: msg.payload[\"CH2\"],\n    ch3: msg.payload[\"CH3\"]\n}\n\nmsg.payload = [\n    fields,\n    tags\n]\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":416,"y":3964,"wires":[["1b12a89ae06c9739"]]},{"id":"f5188fd31329cf9c","type":"ha-entity","z":"fd8eb98d.2d1be8","g":"1bcdbf064cc50c63","name":"Spa temperature","server":"ebb6b83c7588d734","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"spa_temperature"},{"property":"device_class","value":"temperature"},{"property":"icon","value":"hass:thermometer"},{"property":"unit_of_measurement","value":"°C"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"payload.TMP","stateType":"msg","attributes":[{"property":"Heater","value":"payload.GRN","valueType":"msg"},{"property":"Heating","value":"payload.RED","valueType":"msg"},{"property":"Target","value":"payload.TGT","valueType":"msg"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":386,"y":4184,"wires":[[]]},{"id":"b8615fca969a0e24","type":"ha-entity","z":"fd8eb98d.2d1be8","g":"1bcdbf064cc50c63","name":"Spa target temperature","server":"ebb6b83c7588d734","version":2,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"spa_target_temperature"},{"property":"device_class","value":"temperature"},{"property":"icon","value":"hass:thermometer"},{"property":"unit_of_measurement","value":"°C"},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"payload.TGT","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":406,"y":4244,"wires":[["f02f71a2f7611f83"]]},{"id":"bcb2c1565b7116c8","type":"ha-entity","z":"fd8eb98d.2d1be8","g":"1bcdbf064cc50c63","name":"Spa filter pump","server":"ebb6b83c7588d734","version":2,"debugenabled":false,"outputs":1,"entityType":"binary_sensor","config":[{"property":"name","value":"spa_pump"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:pump"},{"property":"unit_of_measurement","value":""},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"payload.FLT","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":376,"y":4304,"wires":[["047fd5dac570516f"]]},{"id":"842662cc35a8f537","type":"ha-entity","z":"fd8eb98d.2d1be8","g":"1bcdbf064cc50c63","name":"Spa air bubbles","server":"ebb6b83c7588d734","version":2,"debugenabled":false,"outputs":1,"entityType":"binary_sensor","config":[{"property":"name","value":"spa_airbubbles"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:chart-bubble"},{"property":"unit_of_measurement","value":""},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"payload.AIR","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":376,"y":4364,"wires":[["64c842d42d17b2b2"]]},{"id":"06227f6df2cb3d11","type":"ha-entity","z":"fd8eb98d.2d1be8","g":"1bcdbf064cc50c63","name":"Spa heater","server":"ebb6b83c7588d734","version":2,"debugenabled":false,"outputs":1,"entityType":"binary_sensor","config":[{"property":"name","value":"spa_heater"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:radiator"},{"property":"unit_of_measurement","value":""},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"msg.payload.RED or msg.payload.GRN","stateType":"jsonata","attributes":[{"property":"Heating","value":"payload.RED","valueType":"msg"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":366,"y":4424,"wires":[["b30a3aaaa72a81d1"]]},{"id":"055e6ac4244b27f4","type":"ha-entity","z":"fd8eb98d.2d1be8","g":"1bcdbf064cc50c63","name":"Spa air bubbles","server":"ebb6b83c7588d734","version":2,"debugenabled":false,"outputs":2,"entityType":"switch","config":[{"property":"name","value":"spa_airbubbles_switch"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:chart-bubble"},{"property":"unit_of_measurement","value":""},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"payload.AIR","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":696,"y":4364,"wires":[["257e15b8aa8f0694"],["257e15b8aa8f0694"]]},{"id":"64c842d42d17b2b2","type":"function","z":"fd8eb98d.2d1be8","g":"1bcdbf064cc50c63","name":"","func":"var mymsg;\nmymsg = {};\nmymsg.enable = false;\nif(msg.payload.AIR) mymsg.enable = true;\nreturn mymsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":536,"y":4364,"wires":[["055e6ac4244b27f4"]]},{"id":"0b239510c9afba83","type":"ha-entity","z":"fd8eb98d.2d1be8","g":"1bcdbf064cc50c63","name":"Spa heater","server":"ebb6b83c7588d734","version":2,"debugenabled":false,"outputs":2,"entityType":"switch","config":[{"property":"name","value":"spa_heater_switch"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:radiator"},{"property":"unit_of_measurement","value":""},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"payload.AIR","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":686,"y":4424,"wires":[["257e15b8aa8f0694"],["257e15b8aa8f0694"]]},{"id":"b30a3aaaa72a81d1","type":"function","z":"fd8eb98d.2d1be8","g":"1bcdbf064cc50c63","name":"","func":"var mymsg;\nmymsg = {};\nmymsg.enable = false;\nif(msg.payload.RED || msg.payload.GRN) mymsg.enable = true;\nreturn mymsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":536,"y":4424,"wires":[["0b239510c9afba83"]]},{"id":"cd393755680fb808","type":"ha-entity","z":"fd8eb98d.2d1be8","g":"1bcdbf064cc50c63","name":"Spa filter pump","server":"ebb6b83c7588d734","version":2,"debugenabled":false,"outputs":2,"entityType":"switch","config":[{"property":"name","value":"spa_filter_pump"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:pump"},{"property":"unit_of_measurement","value":""},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"payload.AIR","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":696,"y":4304,"wires":[["257e15b8aa8f0694"],["257e15b8aa8f0694"]]},{"id":"047fd5dac570516f","type":"function","z":"fd8eb98d.2d1be8","g":"1bcdbf064cc50c63","name":"","func":"var mymsg;\nmymsg = {};\nmymsg.enable = false;\nif(msg.payload.FLT) mymsg.enable = true;\nreturn mymsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":536,"y":4304,"wires":[["cd393755680fb808"]]},{"id":"1cbf17c57f2cd4db","type":"server-state-changed","z":"fd8eb98d.2d1be8","g":"1bcdbf064cc50c63","name":"spa target temp slider","server":"ebb6b83c7588d734","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_number.spa_target_temp","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":796,"y":4244,"wires":[["257e15b8aa8f0694"]]},{"id":"d41034103013a3fa","type":"api-call-service","z":"fd8eb98d.2d1be8","g":"1bcdbf064cc50c63","name":"set slider","server":"ebb6b83c7588d734","version":5,"debugenabled":false,"domain":"input_number","service":"set_value","areaId":[],"deviceId":[],"entityId":["input_number.spa_target_temp"],"data":"{\"value\":$number($entities(\"sensor.spa_target_temperature\").state)}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"output_location":"payload","output_location_type":"msg","x":616,"y":4244,"wires":[[]]},{"id":"8fb7ee16f23564d2","type":"comment","z":"fd8eb98d.2d1be8","g":"1bcdbf064cc50c63","name":"Adds sensors/switches to HA.","info":"","x":176,"y":4144,"wires":[]},{"id":"d07c7bea7f0284d2","type":"comment","z":"fd8eb98d.2d1be8","g":"1bcdbf064cc50c63","name":"Send push to iPhone when target reached","info":"","x":696,"y":4024,"wires":[]},{"id":"16e326d89394363d","type":"comment","z":"fd8eb98d.2d1be8","g":"1bcdbf064cc50c63","name":"Store data in database for display in grafana","info":"","x":706,"y":3924,"wires":[]},{"id":"ef66a65d5a6910e6","type":"comment","z":"fd8eb98d.2d1be8","g":"1bcdbf064cc50c63","name":"I have a Shelly 3EM to monitor house amperage. If too high it turns off the heater in the pool.","info":"","x":396,"y":3684,"wires":[]},{"id":"f02f71a2f7611f83","type":"delay","z":"fd8eb98d.2d1be8","g":"1bcdbf064cc50c63","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"10","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":606,"y":4204,"wires":[["d41034103013a3fa"]]},{"id":"123545dd506fb882","type":"zigbee2mqtt-in","z":"fd8eb98d.2d1be8","g":"4771de1fd4eaa53a","name":"","server":"f0cc4845.3e9e28","friendly_name":"z2m_lidl_socket02 (HG06337)","device_id":"0x842e14fffecd07d2","state":"0","outputAtStartup":true,"filterChanges":true,"enableMultiple":false,"x":1668,"y":2004,"wires":[["1faf0be4d4395a25"]]},{"id":"4834aa1faa625685","type":"zigbee2mqtt-bridge","z":"fd8eb98d.2d1be8","g":"4771de1fd4eaa53a","name":"","server":"f0cc4845.3e9e28","topic":null,"x":1648,"y":1604,"wires":[[]]},{"id":"b38b944ffd4e9a66","type":"zigbee2mqtt-out","z":"fd8eb98d.2d1be8","g":"4771de1fd4eaa53a","name":"","server":"f0cc4845.3e9e28","friendly_name":"z2m_ikea_gu10_movierm_left (LED1537R6/LED1739R5)","device_id":"0xd0cf5efffe019f01","command":"position","commandType":"z2m_cmd","payload":"payload","payloadType":"msg","optionsValue":"","optionsType":"nothing","x":2238,"y":1904,"wires":[]},{"id":"33e8ef8026f7ecc1","type":"inject","z":"fd8eb98d.2d1be8","g":"4771de1fd4eaa53a","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"10","payloadType":"num","x":1918,"y":1904,"wires":[["b38b944ffd4e9a66"]]},{"id":"62a13be50b93dcc9","type":"inject","z":"fd8eb98d.2d1be8","g":"4771de1fd4eaa53a","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"20","payloadType":"num","x":1918,"y":1944,"wires":[["b38b944ffd4e9a66"]]},{"id":"1faf0be4d4395a25","type":"debug","z":"fd8eb98d.2d1be8","g":"4771de1fd4eaa53a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"payload","statusType":"auto","x":1818,"y":2004,"wires":[]},{"id":"89edc10dcce1d277","type":"inject","z":"fd8eb98d.2d1be8","g":"4771de1fd4eaa53a","name":"test","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"test","payload":"","payloadType":"date","x":1618,"y":1804,"wires":[["7fdcec472ec527db"]]},{"id":"7fdcec472ec527db","type":"zigbee2mqtt-get","z":"fd8eb98d.2d1be8","g":"4771de1fd4eaa53a","name":"","server":"f0cc4845.3e9e28","friendly_name":"","device_id":[],"state":"0","enableMultiple":false,"x":1888,"y":1824,"wires":[["8b9d391ced3e6d4c"]]},{"id":"8b9d391ced3e6d4c","type":"debug","z":"fd8eb98d.2d1be8","g":"4771de1fd4eaa53a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2098,"y":1824,"wires":[]},{"id":"01f67f868cbc9d5b","type":"inject","z":"fd8eb98d.2d1be8","g":"4771de1fd4eaa53a","name":"Outlet 1","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"Outlet 1","payload":"","payloadType":"date","x":1618,"y":1844,"wires":[["7fdcec472ec527db"]]},{"id":"f79972418404f0bb","type":"inject","z":"fd8eb98d.2d1be8","g":"4771de1fd4eaa53a","name":"zigbee2mqtt_Outlet1","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"zigbee2mqtt_Outlet1","payload":"","payloadType":"date","x":1668,"y":1884,"wires":[["7fdcec472ec527db"]]},{"id":"6cd3c363497388dc","type":"inject","z":"fd8eb98d.2d1be8","g":"4771de1fd4eaa53a","name":"zigbee2mqtt/Outlet 1","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"zigbee2mqtt/Outlet 1","payload":"","payloadType":"date","x":1668,"y":1764,"wires":[["7fdcec472ec527db"]]},{"id":"3cb917c78bc66b0e","type":"inject","z":"fd8eb98d.2d1be8","g":"4771de1fd4eaa53a","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"no device","payload":"","payloadType":"date","x":1678,"y":1664,"wires":[["7fdcec472ec527db"]]},{"id":"ec5ca0f9299d0ba5","type":"change","z":"fd8eb98d.2d1be8","g":"7c6d6520815fe5fd","name":"Reset","rules":[{"t":"set","p":"reset","pt":"msg","to":"foo","tot":"str"},{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":466,"y":4680,"wires":[["4056cf4bd6e0f153"]]},{"id":"4b9d4766deaa90e7","type":"inject","z":"fd8eb98d.2d1be8","g":"7c6d6520815fe5fd","name":"Reset","repeat":"","crontab":"","once":true,"onceDelay":"0.5","topic":"","payload":"","payloadType":"date","x":286,"y":4640,"wires":[["ec5ca0f9299d0ba5"]]},{"id":"a1dd54da5cb86417","type":"debug","z":"fd8eb98d.2d1be8","g":"7c6d6520815fe5fd","name":"Four presses","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1036,"y":4780,"wires":[]},{"id":"21d7c27d3e454a69","type":"inject","z":"fd8eb98d.2d1be8","g":"7c6d6520815fe5fd","name":"Start","props":[{"p":"payload","v":"","vt":"date"},{"p":"topic","v":"","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":129.33331298828125,"y":4611.111083984375,"wires":[["4056cf4bd6e0f153","681ffad7ab1fbc7d"]]},{"id":"4056cf4bd6e0f153","type":"counter","z":"fd8eb98d.2d1be8","g":"7c6d6520815fe5fd","name":"","init":"0","step":"1","lower":"","upper":"","mode":"increment","outputs":"1","x":476,"y":4610,"wires":[["38724f1aef3b9b83"]]},{"id":"2508e55698064afd","type":"switch","z":"fd8eb98d.2d1be8","g":"7c6d6520815fe5fd","name":"count presses","property":"count","propertyType":"flow","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"},{"t":"eq","v":"3","vt":"num"},{"t":"eq","v":"4","vt":"num"}],"checkall":"true","repair":false,"outputs":4,"x":646,"y":4720,"wires":[["07145a946b2a1994"],["dac8816bab69bd44"],["c12bec7769a66f00"],["ad847aafca93bda3"]],"info":"Just expand the flow.count to how ever many\npresses you want/need."},{"id":"681ffad7ab1fbc7d","type":"trigger","z":"fd8eb98d.2d1be8","g":"7c6d6520815fe5fd","name":"","op1":"","op2":"0","op1type":"nul","op2type":"str","duration":"1","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":296,"y":4720,"wires":[["a42f0202f06137b0","2508e55698064afd"]]},{"id":"38724f1aef3b9b83","type":"change","z":"fd8eb98d.2d1be8","g":"7c6d6520815fe5fd","name":"Flow set","rules":[{"t":"set","p":"count","pt":"flow","to":"count","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":626,"y":4610,"wires":[["c048210107bf7d16"]]},{"id":"8877f6f908515cc7","type":"debug","z":"fd8eb98d.2d1be8","g":"7c6d6520815fe5fd","name":"Tripple press","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1036,"y":4740,"wires":[]},{"id":"b6f2f9b68a395ca8","type":"debug","z":"fd8eb98d.2d1be8","g":"7c6d6520815fe5fd","name":"Double press","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1036,"y":4700,"wires":[]},{"id":"14f2cce6d52c23c2","type":"debug","z":"fd8eb98d.2d1be8","g":"7c6d6520815fe5fd","name":"Single Press","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1036,"y":4660,"wires":[]},{"id":"07145a946b2a1994","type":"change","z":"fd8eb98d.2d1be8","g":"7c6d6520815fe5fd","name":"Single Press","rules":[{"t":"set","p":"payload","pt":"msg","to":"Single Press","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":856,"y":4660,"wires":[["14f2cce6d52c23c2"]]},{"id":"dac8816bab69bd44","type":"change","z":"fd8eb98d.2d1be8","g":"7c6d6520815fe5fd","name":"Double Press","rules":[{"t":"set","p":"payload","pt":"msg","to":"Double Press","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":866,"y":4700,"wires":[["b6f2f9b68a395ca8"]]},{"id":"c12bec7769a66f00","type":"change","z":"fd8eb98d.2d1be8","g":"7c6d6520815fe5fd","name":"Tripple Press","rules":[{"t":"set","p":"payload","pt":"msg","to":"Tripple Press","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":856,"y":4740,"wires":[["8877f6f908515cc7"]]},{"id":"ad847aafca93bda3","type":"change","z":"fd8eb98d.2d1be8","g":"7c6d6520815fe5fd","name":"Four Press","rules":[{"t":"set","p":"payload","pt":"msg","to":"Four Press","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":856,"y":4780,"wires":[["a1dd54da5cb86417"]]},{"id":"9dbbc7aabdb0fd3f","type":"comment","z":"fd8eb98d.2d1be8","g":"7c6d6520815fe5fd","name":"DELAY - Readme","info":"The DELAY time has to be a bit longer than how\nlong it takes you to press the button the\nmaximum number of times.\nRead information in the SWITCH node too!","x":676,"y":4530,"wires":[]},{"id":"a4696f9962b7f1fd","type":"comment","z":"fd8eb98d.2d1be8","g":"7c6d6520815fe5fd","name":"Input","info":"","x":286,"y":4570,"wires":[]},{"id":"88ddde581b8fdac0","type":"comment","z":"fd8eb98d.2d1be8","g":"7c6d6520815fe5fd","name":"Outputs","info":"Debug nodes are here now, but just connect\nthem to what ever you want.\nThe messages sent are in the nodes just before\nthe debug nodes.\n","x":1016,"y":4620,"wires":[]},{"id":"c048210107bf7d16","type":"debug","z":"fd8eb98d.2d1be8","g":"7c6d6520815fe5fd","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"count","targetType":"msg","statusVal":"","statusType":"auto","x":856,"y":4610,"wires":[]},{"id":"a42f0202f06137b0","type":"delay","z":"fd8eb98d.2d1be8","g":"7c6d6520815fe5fd","name":"Delay","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":286,"y":4680,"wires":[["ec5ca0f9299d0ba5"]]},{"id":"ab569b41f6984ad9","type":"switch","z":"fd8eb98d.2d1be8","g":"7fd9490ed740e83c","name":"Parse Switch Message","property":"payload.action","propertyType":"msg","rules":[{"t":"eq","v":"brightness_move_up","vt":"str"},{"t":"eq","v":"brightness_move_down","vt":"str"},{"t":"eq","v":"off","vt":"str"},{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":188,"y":4920,"wires":[[],[],["73221beb60733643"],["73221beb60733643"]]},{"id":"0b01e86466250ec1","type":"zigbee2mqtt-in","z":"fd8eb98d.2d1be8","g":"7fd9490ed740e83c","name":"Z2M Ikea Switch 01 - Office","server":"f0cc4845.3e9e28","friendly_name":"z2m_ikea_switch01_office_lamp (E1743)","device_id":"0x000d6ffffe2a5a91","state":"0","outputAtStartup":true,"filterChanges":true,"enableMultiple":false,"x":184,"y":4848,"wires":[["ab569b41f6984ad9"]]},{"id":"73221beb60733643","type":"timed-counter","z":"fd8eb98d.2d1be8","g":"7fd9490ed740e83c","name":"","timelimit":"750","timeunit":1,"withhold":true,"fixedtimeout":false,"pertopic":false,"x":420,"y":4932,"wires":[["7f68387f5279c711"]]},{"id":"7f68387f5279c711","type":"switch","z":"fd8eb98d.2d1be8","g":"7fd9490ed740e83c","name":"count presses","property":"count","propertyType":"flow","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":624,"y":4932,"wires":[["f6450c9123d5cf36"],["0e639cb36a9dc2d7"]],"info":"Just expand the flow.count to how ever many\npresses you want/need."},{"id":"0e639cb36a9dc2d7","type":"debug","z":"fd8eb98d.2d1be8","g":"7fd9490ed740e83c","name":"Double press","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"count","targetType":"msg","statusVal":"","statusType":"auto","x":822,"y":4956,"wires":[]},{"id":"f6450c9123d5cf36","type":"debug","z":"fd8eb98d.2d1be8","g":"7fd9490ed740e83c","name":"Single press","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"count","targetType":"msg","statusVal":"","statusType":"auto","x":824.666748046875,"y":4908.666656494141,"wires":[]},{"id":"499d8737.9fac58","type":"server-state-changed","z":"2dd3223.7682ade","g":"c4ccf6db.b2bb48","name":"Jenna Present - Person","server":"3b49c004.6176a","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"person.jenna","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"home","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":184,"y":2472,"wires":[["d85d8025.f4acf"],[]]},{"id":"d85d8025.f4acf","type":"api-call-service","z":"2dd3223.7682ade","g":"c4ccf6db.b2bb48","name":"Set Jenna Home (Input Select)","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"input_select","service":"select_option","areaId":[],"deviceId":[],"entityId":["input_select.home_jenna"],"data":"{\"option\":\"Home\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":694,"y":2484,"wires":[["37142a8f.ee4686"]]},{"id":"a3a2501e.78344","type":"server-state-changed","z":"2dd3223.7682ade","g":"559f93a6.3fa2ec","name":"Ryan Present - Person","server":"3b49c004.6176a","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"person.ryan","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"home","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":1156,"y":2532,"wires":[["631246f3.52eb78"],[]]},{"id":"631246f3.52eb78","type":"api-call-service","z":"2dd3223.7682ade","g":"559f93a6.3fa2ec","name":"Set Ryan Home (Input Select)","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"input_select","service":"select_option","areaId":[],"deviceId":[],"entityId":["input_select.home_ryan"],"data":"{\"option\":\"Home\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1666,"y":2508,"wires":[["767c5815.d05d18"]]},{"id":"dc5817e6.b42838","type":"api-call-service","z":"2dd3223.7682ade","g":"7dd9ed68.c15784","name":"Set Home Occupied (Input Select)","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"input_select","service":"select_option","areaId":[],"deviceId":[],"entityId":["input_select.home_occupied"],"data":"{\"option\":\"Yes\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":584,"y":3324,"wires":[[]]},{"id":"9dfd69ac.02ef08","type":"server-state-changed","z":"2dd3223.7682ade","g":"7dd9ed68.c15784","name":"Guest Present - Input Bool On","server":"3b49c004.6176a","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.home_guest","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":184,"y":3424,"wires":[["dc5817e6.b42838"],[]]},{"id":"8e2b49dd.6985e8","type":"inject","z":"2dd3223.7682ade","g":"559f93a6.3fa2ec","name":"Test","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"on","payload":"","payloadType":"str","x":1478,"y":2592,"wires":[["631246f3.52eb78"]]},{"id":"f8eee677.55c428","type":"inject","z":"2dd3223.7682ade","g":"c4ccf6db.b2bb48","name":"Test","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":530,"y":2592,"wires":[["d85d8025.f4acf"]]},{"id":"45e48405.1cc2ac","type":"server-state-changed","z":"2dd3223.7682ade","g":"7dd9ed68.c15784","name":"Jenna Present - Input Select Home","server":"3b49c004.6176a","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_select.home_jenna","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"Home","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":204,"y":3234,"wires":[["dc5817e6.b42838"],[]]},{"id":"7d83906a.3eca7","type":"server-state-changed","z":"2dd3223.7682ade","g":"7dd9ed68.c15784","name":"Ryan Present - Input Select Home","server":"3b49c004.6176a","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_select.home_ryan","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"Home","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":204,"y":3324,"wires":[["dc5817e6.b42838"],[]]},{"id":"2123633e.d3038c","type":"api-call-service","z":"2dd3223.7682ade","g":"98bc40d0.a0fbd","name":"Set Guest Present","server":"3b49c004.6176a","version":5,"domain":"input_boolean","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.home_guest"],"data":"","mergeContext":"","outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":390,"y":2700,"wires":[[]]},{"id":"24324cc.9da04b4","type":"inject","z":"2dd3223.7682ade","g":"98bc40d0.a0fbd","name":"Test","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"on","payload":"","payloadType":"str","x":160,"y":2700,"wires":[["2123633e.d3038c"]]},{"id":"7bfa79fa.2e9ce8","type":"server-state-changed","z":"2dd3223.7682ade","g":"853cd0f6.8beb4","name":"Jenna Away - Person","server":"3b49c004.6176a","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"person.jenna","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"not_home","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":184,"y":2892,"wires":[["439f30a5.bb4ba"],[]]},{"id":"d0fd7422.d287a8","type":"inject","z":"2dd3223.7682ade","g":"853cd0f6.8beb4","name":"Test","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":242,"y":2976,"wires":[["439f30a5.bb4ba"]]},{"id":"d4b52d48.b2a18","type":"server-state-changed","z":"2dd3223.7682ade","g":"2484db99.e027b4","name":"Ryan Away - Bayesian","server":"3b49c004.6176a","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.ryan_home_bayesian","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":904,"y":2856,"wires":[["fd4e3f34.7f7f9"],[]]},{"id":"2dea20f9.1df1","type":"server-state-changed","z":"2dd3223.7682ade","g":"2484db99.e027b4","name":"Ryan Away - Person","server":"3b49c004.6176a","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"person.ryan","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"not_home","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":894,"y":2928,"wires":[["1d8c212b.785cff"],[]]},{"id":"9aad36c8.49e268","type":"inject","z":"2dd3223.7682ade","g":"2484db99.e027b4","name":"Test","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"on","payload":"","payloadType":"str","x":1214,"y":2976,"wires":[["4fe0c9b6.4d07e8"]]},{"id":"717aef8d.09c97","type":"api-current-state","z":"2dd3223.7682ade","g":"5be5b86a.8f1348","name":"If Ryan Select Away","server":"3b49c004.6176a","version":3,"outputs":2,"halt_if":"Away","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_select.home_ryan","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":544,"y":3540,"wires":[["3d67bbae.22c664"],[]]},{"id":"3d67bbae.22c664","type":"api-current-state","z":"2dd3223.7682ade","g":"5be5b86a.8f1348","name":"If Guest Bool Off","server":"3b49c004.6176a","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.home_guest","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":754,"y":3580,"wires":[["d5ba51a1.f4ea9"],[]]},{"id":"6a13784c.b20158","type":"api-current-state","z":"2dd3223.7682ade","g":"5be5b86a.8f1348","name":"If Jenna Select Away","server":"3b49c004.6176a","version":3,"outputs":2,"halt_if":"Away","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_select.home_jenna","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":544,"y":3630,"wires":[["3d67bbae.22c664"],[]]},{"id":"d0b4bab7.c6f218","type":"inject","z":"2dd3223.7682ade","g":"22e8b6e5.47fc5a","name":"Test","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"on","payload":"","payloadType":"str","x":158,"y":3096,"wires":[["3d2b2863.6c8388"]]},{"id":"87e4e48f.1f0758","type":"server-state-changed","z":"2dd3223.7682ade","g":"5be5b86a.8f1348","name":"Guest Present - Input Bool Off","server":"3b49c004.6176a","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.home_guest","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":184,"y":3740,"wires":[["8eed6c10.bdb28"],[]]},{"id":"4b6ab39e.d2250c","type":"server-state-changed","z":"2dd3223.7682ade","g":"5be5b86a.8f1348","name":"Jenna Present - Input Select Away","server":"3b49c004.6176a","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_select.home_jenna","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"Away","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":204,"y":3530,"wires":[["717aef8d.09c97"],[]]},{"id":"188687a8.f8e748","type":"server-state-changed","z":"2dd3223.7682ade","g":"5be5b86a.8f1348","name":"Ryan Present - Input Select Away","server":"3b49c004.6176a","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_select.home_ryan","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"Away","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":194,"y":3640,"wires":[["6a13784c.b20158"],[]]},{"id":"439f30a5.bb4ba","type":"api-call-service","z":"2dd3223.7682ade","g":"853cd0f6.8beb4","name":"Set Jenna Away (Input Select)","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"input_select","service":"select_option","areaId":[],"deviceId":[],"entityId":["input_select.home_jenna"],"data":"{\"option\":\"Away\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":598,"y":2856,"wires":[["d2ec0f57.65fba"]]},{"id":"4fe0c9b6.4d07e8","type":"api-call-service","z":"2dd3223.7682ade","g":"2484db99.e027b4","name":"Set Ryan Away (Input Select)","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"input_select","service":"select_option","areaId":[],"deviceId":[],"entityId":["input_select.home_ryan"],"data":"{\"option\":\"Away\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1504,"y":2886,"wires":[["cfef2056.2bdd7"]]},{"id":"3d2b2863.6c8388","type":"api-call-service","z":"2dd3223.7682ade","g":"22e8b6e5.47fc5a","name":"Set Guest Present (Input Bool)","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.home_guest"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":442,"y":3084,"wires":[[]]},{"id":"8eed6c10.bdb28","type":"api-current-state","z":"2dd3223.7682ade","g":"5be5b86a.8f1348","name":"Set old/new state = Stat (10) -> Away From (800)","server":"3b49c004.6176a","version":3,"outputs":2,"halt_if":"Away","halt_if_type":"str","halt_if_compare":"is","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":524,"y":3730,"wires":[["aa538a45.484018"],[]]},{"id":"aa538a45.484018","type":"api-current-state","z":"2dd3223.7682ade","g":"5be5b86a.8f1348","name":"If Jenna Select Away","server":"3b49c004.6176a","version":3,"outputs":2,"halt_if":"Away","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_select.home_jenna","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":764,"y":3730,"wires":[["d5ba51a1.f4ea9"],[]]},{"id":"d5ba51a1.f4ea9","type":"api-call-service","z":"2dd3223.7682ade","g":"5be5b86a.8f1348","name":"Set Home Empty","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"input_select","service":"select_option","areaId":[],"deviceId":[],"entityId":["input_select.home_occupied"],"data":"{\"option\":\"No\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":984,"y":3650,"wires":[[]]},{"id":"fd4e3f34.7f7f9","type":"api-current-state","z":"2dd3223.7682ade","g":"2484db99.e027b4","name":"If Ryan Person Away","server":"3b49c004.6176a","version":3,"outputs":2,"halt_if":"not_home","halt_if_type":"str","halt_if_compare":"is","entity_id":"person.ryan","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1164,"y":2856,"wires":[["4fe0c9b6.4d07e8"],[]]},{"id":"1d8c212b.785cff","type":"api-current-state","z":"2dd3223.7682ade","g":"2484db99.e027b4","name":"If Ryan Bayes Away","server":"3b49c004.6176a","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.ryan_home_bayesian","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1164,"y":2926,"wires":[["4fe0c9b6.4d07e8"],[]]},{"id":"2fdbc840.3f0e68","type":"server-state-changed","z":"2dd3223.7682ade","g":"559f93a6.3fa2ec","name":"Ryan Present - Bayesian","server":"3b49c004.6176a","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.ryan_home_bayesian","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":1166,"y":2472,"wires":[["631246f3.52eb78"],[]]},{"id":"d9790745.64b708","type":"link out","z":"2dd3223.7682ade","g":"2484db99.e027b4","name":"Front Door Motion","links":["4e0fb3de.b1482c"],"x":1683,"y":2976,"wires":[]},{"id":"cfef2056.2bdd7","type":"function","z":"2dd3223.7682ade","d":true,"g":"2484db99.e027b4","name":"Set Notification Message","func":"message=\"Ryan Left Home\";\nglobal.set('notification_msg',message);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1490,"y":2976,"wires":[["d9790745.64b708","eff188d989797f84"]]},{"id":"873ff1dd.69d22","type":"server-state-changed","z":"2dd3223.7682ade","d":true,"g":"11001d36.026403","name":"State Changed - Device entering DogWalk Zone","server":"3b49c004.6176a","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"device_tracker.life360_ryan","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"DogWalk","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":252,"y":180,"wires":[["292d1e39.cb51c2"],[]]},{"id":"b268ca11.161318","type":"link out","z":"2dd3223.7682ade","d":true,"g":"11001d36.026403","name":"Test - Pushover","links":["4e0fb3de.b1482c"],"x":1025,"y":144,"wires":[]},{"id":"292d1e39.cb51c2","type":"function","z":"2dd3223.7682ade","d":true,"g":"11001d36.026403","name":"Set Notification Content","func":"message=msg.data.state;\nglobal.set('notification_msg',message);\n\nsound=\"bike\";\nglobal.set('notification_sound',sound);\n\ndevice=\"oneplus5t\";\nglobal.set('notification_device',device);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":868,"y":144,"wires":[["b268ca11.161318"]]},{"id":"ed1fd8ec.c762f8","type":"inject","z":"2dd3223.7682ade","d":true,"g":"11001d36.026403","name":"test","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":626,"y":84,"wires":[["292d1e39.cb51c2"]]},{"id":"e971240a.705a08","type":"link out","z":"2dd3223.7682ade","d":true,"g":"ad7a3b73.d4a3c8","name":"Test - Pushover","links":["4e0fb3de.b1482c"],"x":1455,"y":396,"wires":[]},{"id":"7affcc21.05e6f4","type":"function","z":"2dd3223.7682ade","d":true,"g":"ad7a3b73.d4a3c8","name":"Set Notification Content","func":"message=msg.payload;\nglobal.set('notification_msg',message);\n\nsound=\"bike\";\nglobal.set('notification_sound',sound);\n\ndevice=\"oneplus5t\";\nglobal.set('notification_device',device);\n\nreturn msg;","outputs":1,"noerr":6,"initialize":"","finalize":"","libs":[],"x":1226,"y":396,"wires":[["e971240a.705a08","3b21910e.28f8ae"]]},{"id":"d5501c3b.bfbc5","type":"trigger-state","z":"2dd3223.7682ade","d":true,"g":"ad7a3b73.d4a3c8","name":"Trigger State - Device Tracker Zone Entry","server":"3b49c004.6176a","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"device_tracker.life360_ryan","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"DogWalk"}],"inputs":1,"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","enableInput":true,"x":904,"y":372,"wires":[["7affcc21.05e6f4","3e100dad.211a02"],[]]},{"id":"3b21910e.28f8ae","type":"debug","z":"2dd3223.7682ade","d":true,"g":"ad7a3b73.d4a3c8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1378,"y":324,"wires":[]},{"id":"60019bf7.c9df24","type":"trigger-state","z":"2dd3223.7682ade","d":true,"g":"ad7a3b73.d4a3c8","name":"Trigger State - Device Tracker Zone Exit","server":"3b49c004.6176a","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"device_tracker.life360_ryan","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"DogWalk"}],"inputs":1,"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","enableInput":true,"x":904,"y":432,"wires":[["b3378a5d.88d018","7affcc21.05e6f4"],[]]},{"id":"79da2f25.2b641","type":"function","z":"2dd3223.7682ade","d":true,"g":"ad7a3b73.d4a3c8","name":"Set Test Change State - DogWalk >>> Home","func":"msg.payload={\n  \"entity_id\": \"device_tracker.life360_ryan\",\n  \"old_state\": {\n    \"state\": msg.old\n  },\n  \"new_state\": {\n    \"state\": msg.new\n  }\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":470,"y":408,"wires":[["60019bf7.c9df24","d5501c3b.bfbc5"]]},{"id":"78e8e95a.c6bb38","type":"inject","z":"2dd3223.7682ade","d":true,"g":"ad7a3b73.d4a3c8","name":"Set old/new state = DogWalk/home","props":[{"p":"old","v":"DogWalk","vt":"str"},{"p":"new","v":"home","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":236,"y":336,"wires":[["79da2f25.2b641"]]},{"id":"3e100dad.211a02","type":"debug","z":"2dd3223.7682ade","d":true,"g":"ad7a3b73.d4a3c8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1090,"y":276,"wires":[]},{"id":"b3378a5d.88d018","type":"debug","z":"2dd3223.7682ade","d":true,"g":"ad7a3b73.d4a3c8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1114,"y":516,"wires":[]},{"id":"67647720.5cc028","type":"inject","z":"2dd3223.7682ade","d":true,"g":"ad7a3b73.d4a3c8","name":"Set old/new state = DogWalk/home","props":[{"p":"old","v":"home","vt":"str"},{"p":"new","v":"DogWalk","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":236,"y":288,"wires":[["79da2f25.2b641"]]},{"id":"9ca4e6e1.0d56b8","type":"server-state-changed","z":"2dd3223.7682ade","g":"c4ccf6db.b2bb48","name":"Jenna Present - Google Maps","server":"3b49c004.6176a","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"device_tracker.google_maps_107993763956471805595","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"home","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":204,"y":2592,"wires":[["d85d8025.f4acf"],[]]},{"id":"aef5531.f8427b","type":"server-state-changed","z":"2dd3223.7682ade","g":"559f93a6.3fa2ec","name":"Ryan Present - life360","server":"3b49c004.6176a","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"device_tracker.life360_ryan","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"home","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":1156,"y":2592,"wires":[["631246f3.52eb78"],[]]},{"id":"cdef25c3.e22f18","type":"trigger-state","z":"2dd3223.7682ade","d":true,"g":"a6ff36dc.d6c3b8","name":"Trigger State - Proximity Ryan to Home - If Moving Away > 750m","server":"3b49c004.6176a","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"proximity.home_ryan","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":">","comparatorValueDatatype":"num","comparatorValue":"750"},{"targetType":"this_entity","targetValue":"","propertyType":"property","propertyValue":"new_state.attributes.dir_of_travel","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"away_from"}],"inputs":1,"outputs":2,"customoutputs":[],"outputinitially":true,"state_type":"str","enableInput":true,"x":494,"y":1224,"wires":[["75a43e8a.3bfe7","19157fa.1c8638"],[]]},{"id":"75a43e8a.3bfe7","type":"debug","z":"2dd3223.7682ade","d":true,"g":"a6ff36dc.d6c3b8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":662,"y":1200,"wires":[]},{"id":"19157fa.1c8638","type":"function","z":"2dd3223.7682ade","d":true,"g":"a6ff36dc.d6c3b8","name":"Save distance variable (proximity_ryan_home_dist_edge)","func":"// Set ryan_towards_dist variable to distance away\nglobal.set('proximity_ryan_home_dist_edge',msg.payload);\n\n// Setup payload to change state of input bool entity being \n// created by NR\n\nmsg.payload = {\n    \"state\":\"on\",\n    \"data\": {\n        \"distance\":msg.payload\n    }\n};\ndelete msg.data;\n\n\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1050,"y":1224,"wires":[["eb2b35eb.702998","9f7b14e0.fbb328"]],"info":"Set up a Poll State node with debug reading msg.data and make changes you want in HA.\nPoll State of entity to see details of entity settings\nCopy json paths and values from debug and copy into this function as the msg.payload.\n\nOr do the same with a Trigger State node which will show the old and new values when you update the entity in HA."},{"id":"eb2b35eb.702998","type":"debug","z":"2dd3223.7682ade","d":true,"g":"a6ff36dc.d6c3b8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1190,"y":1200,"wires":[]},{"id":"19e97ed1.2ed7c1","type":"inject","z":"2dd3223.7682ade","d":true,"g":"a6ff36dc.d6c3b8","name":"Set old/new state = Stat (10) -> Away From (800)","props":[{"p":"entity","v":"proximity.home_ryan","vt":"str"},{"p":"old_dist","v":"10","vt":"str"},{"p":"old_dir","v":"stationary","vt":"str"},{"p":"new_dist","v":"800","vt":"str"},{"p":"new_dir","v":"away_from","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":288,"y":1092,"wires":[["70e918fb.31eb88"]]},{"id":"70e918fb.31eb88","type":"function","z":"2dd3223.7682ade","d":true,"g":"a6ff36dc.d6c3b8","name":"Test - Change State","func":"msg.payload={\n  \"entity_id\": msg.entity,\n  \"old_state\": {\n        \"state\": msg.old_dist,\n        \"attributes\": {\n          \"dir_of_travel\": msg.old_dir\n        },\n  },\n  \"new_state\": {\n        \"state\": msg.new_dist,\n        \"attributes\": {\n          \"dir_of_travel\": msg.new_dir\n        },\n  }\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":376,"y":1128,"wires":[["cdef25c3.e22f18"]]},{"id":"ae949309.f1b9c","type":"trigger-state","z":"2dd3223.7682ade","d":true,"g":"3b24077d.333d08","name":"Trigger State - Proximity Ryan to Home - If Moving Towards","server":"3b49c004.6176a","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"proximity.home_ryan","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"38co8o2itpf","targetType":"this_entity","targetValue":"","propertyType":"property","propertyValue":"new_state.attributes.dir_of_travel","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"towards"}],"inputs":1,"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","enableInput":true,"x":388,"y":1380,"wires":[["7c989356.d00e1c","a5e26088.a99d5"],[]]},{"id":"2bbcd898.c29a98","type":"api-current-state","z":"2dd3223.7682ade","d":true,"g":"3b24077d.333d08","name":"Check if entity for distance alert enabled","server":"3b49c004.6176a","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.proximity_home_ryan_alert_triggered","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":856,"y":1380,"wires":[["e1c75b3a.6e3f18","a2420d98.df10d"],[]]},{"id":"e1c75b3a.6e3f18","type":"debug","z":"2dd3223.7682ade","d":true,"g":"3b24077d.333d08","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":950,"y":1356,"wires":[]},{"id":"d7c5b68.e321d48","type":"function","z":"2dd3223.7682ade","d":true,"g":"3b24077d.333d08","name":"Test - Change State","func":"msg.payload={\n  \"entity_id\": msg.entity,\n  \"old_state\": {\n        \"state\": msg.old_dist,\n        \"attributes\": {\n          \"dir_of_travel\": msg.old_dir\n        },\n  },\n  \"new_state\": {\n        \"state\": msg.new_dist,\n        \"attributes\": {\n          \"dir_of_travel\": msg.new_dir\n        },\n  }\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":184,"y":1488,"wires":[["ae949309.f1b9c"]]},{"id":"4a61189e.533f68","type":"inject","z":"2dd3223.7682ade","d":true,"g":"3b24077d.333d08","name":"Set old/new state = Away From (1200) -> Towards (900)","props":[{"p":"entity","v":"proximity.home_ryan","vt":"str"},{"p":"old_dist","v":"1200","vt":"str"},{"p":"old_dir","v":"away_from","vt":"str"},{"p":"new_dist","v":"900","vt":"str"},{"p":"new_dir","v":"towards","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":308,"y":1524,"wires":[["d7c5b68.e321d48"]]},{"id":"7c989356.d00e1c","type":"function","z":"2dd3223.7682ade","d":true,"g":"3b24077d.333d08","name":"Save/Update distance variables","func":"// If heading towards home but dist away is further than\n// previous distance then update distance variable.\n\n\nglobal.set('proximity_ryan_home_dist_new', msg.payload);\n\ndistance_new=msg.payload;\ndistance_edge=global.get('proximity_ryan_home_dist_edge');\n\nif ( parseFloat(distance_new) > parseFloat(distance_edge) ) {\n    global.set('proximity_ryan_home_dist_edge', msg.payload);\n} \n\ndelete msg.data;\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":646,"y":1452,"wires":[["2bbcd898.c29a98"]]},{"id":"a2420d98.df10d","type":"function","z":"2dd3223.7682ade","d":true,"g":"3b24077d.333d08","name":"Send Notification and Set Alert Entity to off?","func":"// Send notifications if: \n// 1. Long distances: \n    // Distance_edge has reached more than distance_far\n        // if dist_new has dropped 25% from dist_edge\n// 2. short distances:\n    // if dist_edge < dist_far\n        // if dist_new has dropped 50% from dist_edge\n\ndistance_far=2000;\ndistance_edge=global.get('proximity_ryan_home_dist_edge');\ndistance_new=global.get('proximity_ryan_home_dist_new');\n\nif ( parseFloat(distance_edge) > distance_far ) {\n   if ( ( parseFloat(distance_new) / parseFloat(distance_edge) ) < 0.75 ) {\n       msg.payload = {\n           \"state\":\"off\",\n           \"data\": {\n               \"distance\":distance_new,\n               \"send_msg\":\"yes\"\n               \n           }\n        };\n        return msg;\n   }  \n} else {\n    if ( ( parseFloat(distance_new) / parseFloat(distance_edge) ) < 0.5 ) {\n       msg.payload = {\n           \"state\":\"off\",\n           \"data\": {\n               \"distance\":distance_new,\n               \"send_msg\":\"yes\"\n               \n           }\n           \n       };\n       return msg;\n    }\n}\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1166,"y":1440,"wires":[["4e4ed616.7c7a58","8412cae1.fbb2e8","9f7b14e0.fbb328"]]},{"id":"7a2bf9be.dc4bc8","type":"function","z":"2dd3223.7682ade","d":true,"g":"702e892b.66b7d8","name":"Query Distances","func":"node.warn(\"proximity_ryan_home_dist_edge=\" + global.get('proximity_ryan_home_dist_edge') );\nnode.warn(\"proximity_ryan_home_dist_new=\" + global.get('proximity_ryan_home_dist_new') );\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1962,"y":1632,"wires":[[]]},{"id":"38edcdec.e42c62","type":"inject","z":"2dd3223.7682ade","d":true,"g":"702e892b.66b7d8","name":"Trigger","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1934,"y":1584,"wires":[["7a2bf9be.dc4bc8"]]},{"id":"185f092e.a526d7","type":"inject","z":"2dd3223.7682ade","d":true,"g":"3b24077d.333d08","name":"Set old/new state = Towards (900) -> Towards (1600)","props":[{"p":"entity","v":"proximity.home_ryan","vt":"str"},{"p":"old_dist","v":"900","vt":"str"},{"p":"old_dir","v":"towards","vt":"str"},{"p":"new_dist","v":"1600","vt":"str"},{"p":"new_dir","v":"towards","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":298,"y":1560,"wires":[["d7c5b68.e321d48"]]},{"id":"567baf51.b5e49","type":"inject","z":"2dd3223.7682ade","d":true,"g":"3b24077d.333d08","name":"Set old/new state = Towards (1600) -> Towards (1400)","props":[{"p":"entity","v":"proximity.home_ryan","vt":"str"},{"p":"old_dist","v":"1600","vt":"str"},{"p":"old_dir","v":"towards","vt":"str"},{"p":"new_dist","v":"1400","vt":"str"},{"p":"new_dir","v":"towards","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":308,"y":1596,"wires":[["d7c5b68.e321d48"]]},{"id":"eb8986af.06b048","type":"inject","z":"2dd3223.7682ade","d":true,"g":"3b24077d.333d08","name":"Set old/new state = Towards (1400) -> Towards (790)","props":[{"p":"entity","v":"proximity.home_ryan","vt":"str"},{"p":"old_dist","v":"1400","vt":"str"},{"p":"old_dir","v":"towards","vt":"str"},{"p":"new_dist","v":"790","vt":"str"},{"p":"new_dir","v":"towards","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":298,"y":1632,"wires":[["d7c5b68.e321d48"]]},{"id":"a5e26088.a99d5","type":"debug","z":"2dd3223.7682ade","d":true,"g":"3b24077d.333d08","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":542,"y":1356,"wires":[]},{"id":"4e4ed616.7c7a58","type":"debug","z":"2dd3223.7682ade","d":true,"g":"3b24077d.333d08","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1274,"y":1416,"wires":[]},{"id":"ef53723f.2d4","type":"inject","z":"2dd3223.7682ade","d":true,"g":"3b24077d.333d08","name":"Set old/new state = Away From (800) -> Towards (4000)","props":[{"p":"entity","v":"proximity.home_ryan","vt":"str"},{"p":"old_dist","v":"800","vt":"str"},{"p":"old_dir","v":"away_from","vt":"str"},{"p":"new_dist","v":"4000","vt":"str"},{"p":"new_dir","v":"towards","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":752,"y":1524,"wires":[["d7c5b68.e321d48"]]},{"id":"b302f1ee.82cfe","type":"inject","z":"2dd3223.7682ade","d":true,"g":"3b24077d.333d08","name":"Set old/new state = Towards (4000) -> Towards (3500)","props":[{"p":"entity","v":"proximity.home_ryan","vt":"str"},{"p":"old_dist","v":"4000","vt":"str"},{"p":"old_dir","v":"towards","vt":"str"},{"p":"new_dist","v":"3500","vt":"str"},{"p":"new_dir","v":"towards","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":752,"y":1560,"wires":[["d7c5b68.e321d48"]]},{"id":"4199ca7f.b8f7a4","type":"inject","z":"2dd3223.7682ade","d":true,"g":"3b24077d.333d08","name":"Set old/new state = Towards (3500) -> Towards (1900)","props":[{"p":"entity","v":"proximity.home_ryan","vt":"str"},{"p":"old_dist","v":"3500","vt":"str"},{"p":"old_dir","v":"towards","vt":"str"},{"p":"new_dist","v":"1900","vt":"str"},{"p":"new_dir","v":"towards","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":752,"y":1596,"wires":[["d7c5b68.e321d48"]]},{"id":"8412cae1.fbb2e8","type":"function","z":"2dd3223.7682ade","d":true,"g":"3b24077d.333d08","name":"Set Notification Content","func":"//Only send alert if dist_new proximity > 50m\n// disable false positive alerts!\n\ndistance_new=msg.payload.data.distance;\n\nif ( parseFloat(distance_new) > 50 ) {\n    message=\"Ryan heading home: \" + msg.payload.data.distance + \"m\";\n    global.set('notification_msg',message);\n\n    sound=\"bike\";\n    global.set('notification_sound',sound);\n\n    device=\"OnePlus8T\";\n    global.set('notification_device',device);\n\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1430,"y":1512,"wires":[["824ff565.76f938","37177048.eb812"]]},{"id":"824ff565.76f938","type":"link out","z":"2dd3223.7682ade","d":true,"g":"3b24077d.333d08","name":"Test - Pushover","links":["4e0fb3de.b1482c"],"x":1611,"y":1512,"wires":[]},{"id":"56e2b118.5c627","type":"trigger-state","z":"2dd3223.7682ade","d":true,"g":"a0d4a581.479a88","name":"Trigger State - Proximity Jenna to Home - If Moving Away > 750m","server":"3b49c004.6176a","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"proximity.home_jenna","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"kui5nnw27f","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":">","comparatorValueDatatype":"num","comparatorValue":"750"},{"id":"pmlthllfoli","targetType":"this_entity","targetValue":"","propertyType":"property","propertyValue":"new_state.attributes.dir_of_travel","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"away_from"}],"inputs":1,"outputs":2,"customoutputs":[],"outputinitially":true,"state_type":"str","enableInput":true,"x":504,"y":1884,"wires":[["c9d8c377.ab967","3acbef9f.71dee"],[]]},{"id":"c9d8c377.ab967","type":"debug","z":"2dd3223.7682ade","d":true,"g":"a0d4a581.479a88","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":674,"y":1860,"wires":[]},{"id":"3acbef9f.71dee","type":"function","z":"2dd3223.7682ade","d":true,"g":"a0d4a581.479a88","name":"Save distance variable (proximity_jenna_home_dist_edge)","func":"// Set jenna_towards_dist variable to distance away\nglobal.set('proximity_jenna_home_dist_edge',msg.payload);\n\n// Setup payload to change state of input bool entity being \n// created by NR\n\nmsg.payload = {\n    \"state\":\"on\",\n    \"data\": {\n        \"distance\":msg.payload\n    }\n};\ndelete msg.data;\n\n\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1050,"y":1884,"wires":[["f68edde0.09d6","6ebd088e.3d3838"]],"info":"Set up a Poll State node with debug reading msg.data and make changes you want in HA.\nPoll State of entity to see details of entity settings\nCopy json paths and values from debug and copy into this function as the msg.payload.\n\nOr do the same with a Trigger State node which will show the old and new values when you update the entity in HA."},{"id":"f68edde0.09d6","type":"debug","z":"2dd3223.7682ade","d":true,"g":"a0d4a581.479a88","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1202,"y":1860,"wires":[]},{"id":"9980f0ab.f1c8a","type":"inject","z":"2dd3223.7682ade","d":true,"g":"a0d4a581.479a88","name":"Set old/new state = Stat (10) -> Away From (800)","props":[{"p":"entity","v":"proximity.home_jenna","vt":"str"},{"p":"old_dist","v":"10","vt":"str"},{"p":"old_dir","v":"stationary","vt":"str"},{"p":"new_dist","v":"800","vt":"str"},{"p":"new_dir","v":"away_from","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":288,"y":1776,"wires":[["11d5e8fe.a60e37"]]},{"id":"11d5e8fe.a60e37","type":"function","z":"2dd3223.7682ade","d":true,"g":"a0d4a581.479a88","name":"Test - Change State","func":"msg.payload={\n  \"entity_id\": msg.entity,\n  \"old_state\": {\n        \"state\": msg.old_dist,\n        \"attributes\": {\n          \"dir_of_travel\": msg.old_dir\n        },\n  },\n  \"new_state\": {\n        \"state\": msg.new_dist,\n        \"attributes\": {\n          \"dir_of_travel\": msg.new_dir\n        },\n  }\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":378,"y":1812,"wires":[["56e2b118.5c627"]]},{"id":"49bf6984.8aac88","type":"trigger-state","z":"2dd3223.7682ade","d":true,"g":"33c3333b.c0385c","name":"Trigger State - Proximity Jenna to Home - If Moving Towards","server":"3b49c004.6176a","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"proximity.home_jenna","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"38co8o2itpf","targetType":"this_entity","targetValue":"","propertyType":"property","propertyValue":"new_state.attributes.dir_of_travel","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"towards"}],"inputs":1,"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","enableInput":true,"x":424,"y":2016,"wires":[["1ac7a4df.818feb","a486c944.923128"],[]]},{"id":"b19491d4.4ae48","type":"api-current-state","z":"2dd3223.7682ade","d":true,"g":"33c3333b.c0385c","name":"Check if Jenna marked Far Away","server":"3b49c004.6176a","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.proximity_home_jenna_alert_triggered","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":896,"y":2016,"wires":[["58f90542.4c094c","5308ae38.5e4d"],[]]},{"id":"58f90542.4c094c","type":"debug","z":"2dd3223.7682ade","d":true,"g":"33c3333b.c0385c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":962,"y":1992,"wires":[]},{"id":"279e319e.c0051e","type":"function","z":"2dd3223.7682ade","d":true,"g":"33c3333b.c0385c","name":"Test - Change State","func":"msg.payload={\n  \"entity_id\": msg.entity,\n  \"old_state\": {\n        \"state\": msg.old_dist,\n        \"attributes\": {\n          \"dir_of_travel\": msg.old_dir\n        },\n  },\n  \"new_state\": {\n        \"state\": msg.new_dist,\n        \"attributes\": {\n          \"dir_of_travel\": msg.new_dir\n        },\n  }\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":186,"y":2160,"wires":[["49bf6984.8aac88"]]},{"id":"5217845b.8f06ec","type":"inject","z":"2dd3223.7682ade","d":true,"g":"33c3333b.c0385c","name":"Set old/new state = Away From (1200) -> Towards (900)","props":[{"p":"entity","v":"proximity.home_jenna","vt":"str"},{"p":"old_dist","v":"1200","vt":"str"},{"p":"old_dir","v":"away_from","vt":"str"},{"p":"new_dist","v":"900","vt":"str"},{"p":"new_dir","v":"towards","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":308,"y":2196,"wires":[["279e319e.c0051e"]]},{"id":"1ac7a4df.818feb","type":"function","z":"2dd3223.7682ade","d":true,"g":"33c3333b.c0385c","name":"Save/Update distance variables","func":"// If heading towards home but dist away is further than\n// previous distance then update distance variable.\n\n\nglobal.set('proximity_jenna_home_dist_new', msg.payload);\n\ndistance_new=msg.payload;\ndistance_edge=global.get('proximity_jenna_home_dist_edge');\n\nif ( parseFloat(distance_new) > parseFloat(distance_edge) ) {\n    global.set('proximity_jenna_home_dist_edge', msg.payload);\n} \n\ndelete msg.data;\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":682,"y":2076,"wires":[["b19491d4.4ae48"]]},{"id":"5308ae38.5e4d","type":"function","z":"2dd3223.7682ade","d":true,"g":"33c3333b.c0385c","name":"Send Notification and Set Alert Entity to off?","func":"// Send notifications if: \n// 1. Long distances: \n    // Distance_edge has reached more than distance_far\n        // if dist_new has dropped 33% from dist_edge\n// 2. short distances (if dist_edge < dist_far):\n        // if dist_new has dropped 50% from dist_edge\n\ndistance_far=2000;\ndistance_edge=global.get('proximity_jenna_home_dist_edge');\ndistance_new=global.get('proximity_jenna_home_dist_new');\n\nif ( parseFloat(distance_edge) > distance_far ) {\n   if ( ( parseFloat(distance_new) / parseFloat(distance_edge) ) < 0.33 ) {\n       msg.payload = {\n           \"state\":\"off\",\n           \"data\": {\n               \"distance\":distance_new,\n               \"send_msg\":\"yes\"\n               \n           }\n        };\n        return msg;\n   }  \n} else {\n    if ( ( parseFloat(distance_new) / parseFloat(distance_edge) ) < 0.5 ) {\n       msg.payload = {\n           \"state\":\"off\",\n           \"data\": {\n               \"distance\":distance_new,\n               \"send_msg\":\"yes\"\n               \n           }\n           \n       };\n       return msg;\n    }\n}\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1166,"y":2076,"wires":[["f0254a01.8f5908","8474469f.393ae8","6ebd088e.3d3838"]]},{"id":"62df3c56.bd4554","type":"function","z":"2dd3223.7682ade","d":true,"g":"f05c157.53e64e8","name":"Query Distances","func":"node.warn(\"proximity_jenna_home_dist_edge=\" + global.get('proximity_jenna_home_dist_edge') );\nnode.warn(\"proximity_jenna_home_dist_new=\" + global.get('proximity_jenna_home_dist_new') );\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1962,"y":2304,"wires":[[]]},{"id":"a47182df.6ae35","type":"inject","z":"2dd3223.7682ade","d":true,"g":"f05c157.53e64e8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1968,"y":2268,"wires":[["62df3c56.bd4554"]]},{"id":"2a58e20.f85151e","type":"inject","z":"2dd3223.7682ade","d":true,"g":"33c3333b.c0385c","name":"Set old/new state = Towards (900) -> Towards (1600)","props":[{"p":"entity","v":"proximity.home_jenna","vt":"str"},{"p":"old_dist","v":"900","vt":"str"},{"p":"old_dir","v":"towards","vt":"str"},{"p":"new_dist","v":"1600","vt":"str"},{"p":"new_dir","v":"towards","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":298,"y":2232,"wires":[["279e319e.c0051e"]]},{"id":"5281d5e9.5892ac","type":"inject","z":"2dd3223.7682ade","d":true,"g":"33c3333b.c0385c","name":"Set old/new state = Towards (1600) -> Towards (1400)","props":[{"p":"entity","v":"proximity.home_jenna","vt":"str"},{"p":"old_dist","v":"1600","vt":"str"},{"p":"old_dir","v":"towards","vt":"str"},{"p":"new_dist","v":"1400","vt":"str"},{"p":"new_dir","v":"towards","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":308,"y":2268,"wires":[["279e319e.c0051e"]]},{"id":"541c4409.1c53ac","type":"inject","z":"2dd3223.7682ade","d":true,"g":"33c3333b.c0385c","name":"Set old/new state = Towards (1400) -> Towards (790)","props":[{"p":"entity","v":"proximity.home_jenna","vt":"str"},{"p":"old_dist","v":"1400","vt":"str"},{"p":"old_dir","v":"towards","vt":"str"},{"p":"new_dist","v":"790","vt":"str"},{"p":"new_dir","v":"towards","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":298,"y":2304,"wires":[["279e319e.c0051e"]]},{"id":"a486c944.923128","type":"debug","z":"2dd3223.7682ade","d":true,"g":"33c3333b.c0385c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":566,"y":1992,"wires":[]},{"id":"f0254a01.8f5908","type":"debug","z":"2dd3223.7682ade","d":true,"g":"33c3333b.c0385c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1262,"y":2052,"wires":[]},{"id":"195f2e9c.dfb031","type":"inject","z":"2dd3223.7682ade","d":true,"g":"33c3333b.c0385c","name":"Set old/new state = Away From (800) -> Towards (4000)","props":[{"p":"entity","v":"proximity.home_jenna","vt":"str"},{"p":"old_dist","v":"800","vt":"str"},{"p":"old_dir","v":"away_from","vt":"str"},{"p":"new_dist","v":"4000","vt":"str"},{"p":"new_dir","v":"towards","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":752,"y":2196,"wires":[["279e319e.c0051e"]]},{"id":"661bc51f.5d8eac","type":"inject","z":"2dd3223.7682ade","d":true,"g":"33c3333b.c0385c","name":"Set old/new state = Towards (4000) -> Towards (3500)","props":[{"p":"entity","v":"proximity.home_jenna","vt":"str"},{"p":"old_dist","v":"4000","vt":"str"},{"p":"old_dir","v":"towards","vt":"str"},{"p":"new_dist","v":"3500","vt":"str"},{"p":"new_dir","v":"towards","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":752,"y":2232,"wires":[["279e319e.c0051e"]]},{"id":"ad3131a5.3e9a","type":"inject","z":"2dd3223.7682ade","d":true,"g":"33c3333b.c0385c","name":"Set old/new state = Towards (3500) -> Towards (1900)","props":[{"p":"entity","v":"proximity.home_jenna","vt":"str"},{"p":"old_dist","v":"3500","vt":"str"},{"p":"old_dir","v":"towards","vt":"str"},{"p":"new_dist","v":"1900","vt":"str"},{"p":"new_dir","v":"towards","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":752,"y":2268,"wires":[["279e319e.c0051e"]]},{"id":"8474469f.393ae8","type":"function","z":"2dd3223.7682ade","d":true,"g":"33c3333b.c0385c","name":"Set Notification Content","func":"//Only send alert if dist_new proximity > 50m\n// disable false positive alerts!\n\ndistance_new=msg.payload.data.distance;\n\nif ( parseFloat(distance_new) > 50 ) {\n    \n    message=\"Jenna heading home: \" + msg.payload.data.distance + \"m\";\n    global.set('notification_msg',message);\n\n    sound=\"bike\";\n    global.set('notification_sound',sound);\n\n    device=\"OnePlus8T\";\n    global.set('notification_device',device);\n\n    return msg;\n}\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1370,"y":2160,"wires":[["a350b714.885898","6b94a1f5.beec7"]]},{"id":"a350b714.885898","type":"link out","z":"2dd3223.7682ade","d":true,"g":"33c3333b.c0385c","name":"Test - Pushover","links":["4e0fb3de.b1482c"],"x":1587,"y":2160,"wires":[]},{"id":"6b94a1f5.beec7","type":"debug","z":"2dd3223.7682ade","d":true,"g":"33c3333b.c0385c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1418,"y":2124,"wires":[]},{"id":"37177048.eb812","type":"debug","z":"2dd3223.7682ade","d":true,"g":"3b24077d.333d08","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1478,"y":1488,"wires":[]},{"id":"6ebd088e.3d3838","type":"ha-entity","z":"2dd3223.7682ade","d":true,"g":"2480fcdb.c671b4","name":"Proximity - Home - Jenna - Set Alert On/Off","server":"3b49c004.6176a","version":2,"debugenabled":false,"outputs":1,"entityType":"binary_sensor","config":[{"property":"name","value":"proximity_home_jenna_alert_triggered"},{"property":"device_class","value":""},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"payload","stateType":"msg","attributes":[{"property":"distance","value":"payload.data.distance","valueType":"msg"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":1886,"y":2028,"wires":[[]]},{"id":"9f7b14e0.fbb328","type":"ha-entity","z":"2dd3223.7682ade","d":true,"g":"49e6fe11.422c6","name":"Proximity - Home - Ryan - Set Alert On/Off","server":"3b49c004.6176a","version":2,"debugenabled":false,"outputs":1,"entityType":"binary_sensor","config":[{"property":"name","value":"proximity_home_ryan_alert_triggered"},{"property":"device_class","value":""},{"property":"icon","value":""},{"property":"unit_of_measurement","value":""},{"property":"state_class","value":""},{"property":"last_reset","value":""}],"state":"payload","stateType":"msg","attributes":[{"property":"distance","value":"payload.data.distance","valueType":"msg"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":1876,"y":1356,"wires":[[]]},{"id":"4727ff75.3ac34","type":"server-state-changed","z":"2dd3223.7682ade","d":true,"g":"1519b2a.a34a94d","name":"Proximity Alerting - Manual Trigger - Jenna","server":"3b49c004.6176a","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.proximity_home_jenna_alert_triggered_manual","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":1516,"y":1776,"wires":[["d3827a60.e9d4a8"],["32e431ac.f407ce"]]},{"id":"1606784c.db5768","type":"inject","z":"2dd3223.7682ade","d":true,"g":"e47c7133.0f4cd","name":"Trigger","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":146,"y":612,"wires":[["3993b164.6076fe"]]},{"id":"3993b164.6076fe","type":"api-current-state","z":"2dd3223.7682ade","d":true,"g":"e47c7133.0f4cd","name":"","server":"3b49c004.6176a","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"proximity.home_jenna","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":402,"y":612,"wires":[["720e20b4.e837"]]},{"id":"720e20b4.e837","type":"function","z":"2dd3223.7682ade","d":true,"g":"e47c7133.0f4cd","name":"Output payload to debug","func":"node.warn(\"mgs.payload=\" + msg.payload );\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":758,"y":612,"wires":[[]]},{"id":"d3827a60.e9d4a8","type":"api-current-state","z":"2dd3223.7682ade","d":true,"g":"1519b2a.a34a94d","name":"Get Current Distance","server":"3b49c004.6176a","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"proximity.home_jenna","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1948,"y":1824,"wires":[["b7a01b37.941618"]]},{"id":"b7a01b37.941618","type":"function","z":"2dd3223.7682ade","d":true,"g":"1519b2a.a34a94d","name":"Set msg to Alert On and with Distance","func":"msg.payload = {\n   \"state\":\"on\",\n   \"data\": {\n       \"distance\":msg.payload,\n       }\n    };\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1902,"y":1872,"wires":[["6ebd088e.3d3838"]]},{"id":"32e431ac.f407ce","type":"api-current-state","z":"2dd3223.7682ade","d":true,"g":"1519b2a.a34a94d","name":"Get Current Distance","server":"3b49c004.6176a","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"proximity.home_jenna","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1612,"y":1824,"wires":[["6e348688.fa40d8"]]},{"id":"6e348688.fa40d8","type":"function","z":"2dd3223.7682ade","d":true,"g":"1519b2a.a34a94d","name":"Set msg to Alert Off and with Distance","func":"msg.payload = {\n   \"state\":\"off\",\n   \"data\": {\n       \"distance\":msg.payload,\n       }\n    };\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1566,"y":1872,"wires":[["6ebd088e.3d3838"]]},{"id":"fd23941f.6b40a8","type":"server-state-changed","z":"2dd3223.7682ade","d":true,"g":"ff2b1ceb.289d5","name":"Proximity Alerting - Manual Trigger - Ryan","server":"3b49c004.6176a","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.proximity_home_ryan_alert_triggered_manual","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":1516,"y":1104,"wires":[["a7c5faab.3781e8"],["860b5118.f6225"]]},{"id":"860b5118.f6225","type":"api-current-state","z":"2dd3223.7682ade","d":true,"g":"ff2b1ceb.289d5","name":"Get Current Distance","server":"3b49c004.6176a","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"proximity.home_ryan","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1588,"y":1164,"wires":[["14b35ae0.229175"]]},{"id":"14b35ae0.229175","type":"function","z":"2dd3223.7682ade","d":true,"g":"ff2b1ceb.289d5","name":"Set msg to Alert Off and with Distance","func":"msg.payload = {\n   \"state\":\"off\",\n   \"data\": {\n       \"distance\":msg.payload,\n       }\n    };\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1542,"y":1212,"wires":[["9f7b14e0.fbb328"]]},{"id":"e6197ae9.5c5768","type":"function","z":"2dd3223.7682ade","d":true,"g":"ff2b1ceb.289d5","name":"Set msg to Alert On and with Distance","func":"msg.payload = {\n   \"state\":\"on\",\n   \"data\": {\n       \"distance\":msg.payload,\n       }\n    };\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1902,"y":1212,"wires":[["9f7b14e0.fbb328"]]},{"id":"a7c5faab.3781e8","type":"api-current-state","z":"2dd3223.7682ade","d":true,"g":"ff2b1ceb.289d5","name":"Get Current Distance","server":"3b49c004.6176a","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"proximity.home_ryan","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1948,"y":1164,"wires":[["e6197ae9.5c5768"]]},{"id":"d2ec0f57.65fba","type":"function","z":"2dd3223.7682ade","d":true,"g":"853cd0f6.8beb4","name":"Set Notification Message","func":"message=\"Jenna Left Home\";\nglobal.set('notification_msg',message);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":530,"y":2976,"wires":[["8c509b27.5bac28","17d5e37d15236fc0"]]},{"id":"8c509b27.5bac28","type":"link out","z":"2dd3223.7682ade","g":"853cd0f6.8beb4","name":"Front Door Motion","links":["4e0fb3de.b1482c"],"x":711,"y":2976,"wires":[]},{"id":"767c5815.d05d18","type":"api-call-service","z":"2dd3223.7682ade","g":"559f93a6.3fa2ec","name":"Reset Manual Alerting Switch (Input Bool)","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.proximity_home_ryan_alert_triggered_manual"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1744,"y":2568,"wires":[[]]},{"id":"37142a8f.ee4686","type":"api-call-service","z":"2dd3223.7682ade","g":"c4ccf6db.b2bb48","name":"Reset Manual Alerting Switch (Input Bool)","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.proximity_home_jenna_alert_triggered_manual"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":784,"y":2556,"wires":[[]]},{"id":"17d5e37d15236fc0","type":"debug","z":"2dd3223.7682ade","g":"853cd0f6.8beb4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":674,"y":2928,"wires":[]},{"id":"eff188d989797f84","type":"debug","z":"2dd3223.7682ade","g":"2484db99.e027b4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1694,"y":2928,"wires":[]},{"id":"df65be84.a0f75","type":"server-state-changed","z":"2dd3223.7682ade","d":true,"g":"4a19d79b2d5a2bb4","name":"Rob Home","server":"3b49c004.6176a","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.rob_home","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":1056,"y":768,"wires":[[],["cf52b2d6.e0074"]]},{"id":"7b60f2b6.27cdfc","type":"server-state-changed","z":"2dd3223.7682ade","d":true,"g":"4a19d79b2d5a2bb4","name":"Lindsay Home","server":"3b49c004.6176a","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.lindsay_home","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":1066,"y":828,"wires":[[],["47cc65e8.b532ec"]]},{"id":"cf52b2d6.e0074","type":"api-current-state","z":"2dd3223.7682ade","d":true,"g":"4a19d79b2d5a2bb4","name":"Lindsay Home","server":"3b49c004.6176a","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.lindsay_home","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1296,"y":768,"wires":[[],["44e9e68b.721c38"]]},{"id":"47cc65e8.b532ec","type":"api-current-state","z":"2dd3223.7682ade","d":true,"g":"4a19d79b2d5a2bb4","name":"Rob Home","server":"3b49c004.6176a","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.rob_home","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1286,"y":828,"wires":[[],["44e9e68b.721c38"]]},{"id":"36cdd77d.6fba48","type":"server-state-changed","z":"2dd3223.7682ade","d":true,"g":"4a19d79b2d5a2bb4","name":"Rob Home","server":"3b49c004.6176a","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.rob_home","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":1056,"y":908,"wires":[[],["8776f42f.33d038"]]},{"id":"16ef8ed0.c51a21","type":"server-state-changed","z":"2dd3223.7682ade","d":true,"g":"4a19d79b2d5a2bb4","name":"Lindsay Home","server":"3b49c004.6176a","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.lindsay_home","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":1066,"y":968,"wires":[[],["8776f42f.33d038"]]},{"id":"86c4914e.46ed4","type":"api-call-service","z":"2dd3223.7682ade","d":true,"g":"4a19d79b2d5a2bb4","name":"Away","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.home_occupied"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","output_location":"payload","output_location_type":"msg","x":1686,"y":768,"wires":[[]]},{"id":"8776f42f.33d038","type":"api-call-service","z":"2dd3223.7682ade","d":true,"g":"4a19d79b2d5a2bb4","name":"Home","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.home_occupied"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","output_location":"payload","output_location_type":"msg","x":1266,"y":908,"wires":[[]]},{"id":"44e9e68b.721c38","type":"api-current-state","z":"2dd3223.7682ade","d":true,"g":"4a19d79b2d5a2bb4","name":"House Guests","server":"3b49c004.6176a","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.house_guests","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":1516,"y":768,"wires":[[],["86c4914e.46ed4"]]},{"id":"e13c454d.5226d8","type":"comment","z":"2dd3223.7682ade","d":true,"g":"4a19d79b2d5a2bb4","name":"https://github.com/thehookup/Node-RED-Examples/blob/master/Example%20Flow%201.txt","info":"","x":1118,"y":732,"wires":[]},{"id":"cccad6f7dbd48fd5","type":"api-call-service","z":"2dd3223.7682ade","d":true,"g":"7ae2baec74b843f8","name":"Node Red Presence not_home","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"device_tracker","service":"see","areaId":[],"deviceId":[],"entityId":[],"data":"{\"dev_id\":\"you_nodered\",\"location_name\":\"not_home\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","output_location":"payload","output_location_type":"msg","x":598,"y":864,"wires":[[]]},{"id":"98bd0d0e34bd0557","type":"api-call-service","z":"2dd3223.7682ade","d":true,"g":"7ae2baec74b843f8","name":"Node Red Presence home","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"device_tracker","service":"see","areaId":[],"deviceId":[],"entityId":[],"data":"{\"dev_id\":\"you_nodered\",\"location_name\":\"home\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","output_location":"payload","output_location_type":"msg","x":587.999885559082,"y":793.33336353302,"wires":[[]]},{"id":"4cce4fc10baad6c4","type":"comment","z":"2dd3223.7682ade","d":true,"g":"7ae2baec74b843f8","name":"Create Device Tracker","info":"","x":591.0000457763672,"y":754.0000319480896,"wires":[]},{"id":"a9d531681dfc7d5b","type":"comment","z":"2dd3223.7682ade","d":true,"g":"7ae2baec74b843f8","name":"Home or Not?","info":"","x":161.5357437133789,"y":832.3690476417542,"wires":[]},{"id":"8712669440f61aba","type":"function","z":"2dd3223.7682ade","d":true,"g":"7ae2baec74b843f8","name":"GPS","func":"var newmsg = {};\nnewmsg.payload = { data: {'gps': [msg.payload.lat,msg.payload.lon] } };\nreturn newmsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":388.8336982727051,"y":794.2380690574646,"wires":[["98bd0d0e34bd0557"]]},{"id":"7d4b4bbaeaf9f922","type":"function","z":"2dd3223.7682ade","d":true,"g":"7ae2baec74b843f8","name":"GPS","func":"newmsg = {};\nnewmsg.payload = { data: {'gps': [msg.payload.lat,msg.payload.lon] } };\nreturn newmsg;","outputs":1,"noerr":0,"x":388.0001640319824,"y":863.9047808647156,"wires":[["cccad6f7dbd48fd5"]]},{"id":"a8c30f61e348d651","type":"geofence","z":"2dd3223.7682ade","d":true,"g":"7ae2baec74b843f8","name":"Inside Home Zone","mode":"polyline","inside":"true","rad":0,"points":[{"latitude":51.600818724533056,"longitude":0.10941535234451294},{"latitude":51.60465706809492,"longitude":0.10647565126419067},{"latitude":51.605256779967696,"longitude":0.11199027299880983},{"latitude":51.60319107239184,"longitude":0.11514455080032349}],"centre":{},"floor":"","ceiling":"","worldmap":false,"outputs":1,"x":155.81546783447266,"y":782.5356755256653,"wires":[["8712669440f61aba"]]},{"id":"ba9faf711a5bbcf5","type":"geofence","z":"2dd3223.7682ade","d":true,"g":"7ae2baec74b843f8","name":"Outside Home Zone","mode":"circle","inside":"false","rad":0,"points":[],"centre":{"latitude":0,"longitude":0},"outputs":1,"x":165.19044876098633,"y":878.7856659889221,"wires":[["7d4b4bbaeaf9f922"]]},{"id":"e03d182e.9679c8","type":"comment","z":"c4865e43.cbd68","d":true,"g":"794a9eab.51d4e","name":"Notes","info":"Triggered on by 'misc power' dimmer paired with z2m.\n\nJust an example to grab power from dimmer to potentially implement manual update of light output later.\n\nMQTT node currently disabled.","x":1114,"y":444,"wires":[]},{"id":"c7fef4b1.4e5ad8","type":"mqtt in","z":"c4865e43.cbd68","d":true,"g":"794a9eab.51d4e","name":"MQTT - Ikea Outlet 02 - Clock","topic":"zigbee2mqtt/z2m_ikea_outlet02/set","qos":"","datatype":"auto","broker":"e96cb00d.af953","nl":false,"rap":false,"inputs":0,"x":1206,"y":540,"wires":[["8eb9448d.0af2f8","3ffb2cd.b82f7d4","53cfc109.a6f37"]]},{"id":"8eb9448d.0af2f8","type":"debug","z":"c4865e43.cbd68","d":true,"g":"794a9eab.51d4e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1542,"y":468,"wires":[]},{"id":"3ffb2cd.b82f7d4","type":"json","z":"c4865e43.cbd68","d":true,"g":"794a9eab.51d4e","name":"","property":"payload","action":"","pretty":false,"x":1532,"y":540,"wires":[["42b195c7.57c87c"]]},{"id":"53cfc109.a6f37","type":"json","z":"c4865e43.cbd68","d":true,"g":"794a9eab.51d4e","name":"","property":"payload.brightness","action":"","pretty":false,"x":1532,"y":600,"wires":[["38214c2e.2bf244"]]},{"id":"42b195c7.57c87c","type":"debug","z":"c4865e43.cbd68","d":true,"g":"794a9eab.51d4e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1842,"y":468,"wires":[]},{"id":"38214c2e.2bf244","type":"debug","z":"c4865e43.cbd68","d":true,"g":"794a9eab.51d4e","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1854,"y":564,"wires":[]},{"id":"203d2459.d5854c","type":"comment","z":"c4865e43.cbd68","d":true,"g":"6c184314.2b82bc","name":"Notes","info":"https://diyfuturism.com/index.php/2017/12/14/basic-node-red-flows-for-automating-lighting-with-home-assistant/\n\nIkea detector times out after 3 min so off timer \nadds on to this.","x":194,"y":1260,"wires":[]},{"id":"9416fe93.a0eba","type":"server-state-changed","z":"c4865e43.cbd68","d":true,"g":"6c184314.2b82bc","name":"Ikea Motion Sensor","server":"3b49c004.6176a","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":"frontdoor_motion_enabled"},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.z2m_ikea_motiondetector02_frontdoor_occupancy","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":342,"y":1320,"wires":[["b4692fa1bd78f18a","ff8572f6a26f8e3b","5c9e75faf6d2a740"],["50eed6c8d941261c"]]},{"id":"910d6574.5aa3a8","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"6c184314.2b82bc","name":"Lights On","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.tasmo_shelly1pm_frontdoor","switch.tasmo_shelly1_garage_outside"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1296,"y":1320,"wires":[["cae866e7.da4f08"]]},{"id":"4c94ed2f.d11c14","type":"switch","z":"c4865e43.cbd68","d":true,"g":"b35bcace.f65918","name":"Turn On/Off?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":622,"y":2040,"wires":[["6832094e.7b7a98","c213afb.156205"],["417b3ab2.376d64","9c1f21dd.13ec9"]]},{"id":"71f54b50.da3f04","type":"eztimer","z":"c4865e43.cbd68","d":true,"g":"b35bcace.f65918","name":"","debug":false,"autoname":"sunsetStart - 22:30","tag":"eztimer","suspended":false,"sendEventsOnSuspend":false,"lat":"55.9024","lon":"-3.6431","timerType":"1","startupMessage":true,"ontype":"1","ontimesun":"sunsetStart","ontimetod":"23:00","onpropertytype":"msg","onproperty":"payload","onvaluetype":"str","onvalue":"on","onoffset":"10","onrandomoffset":true,"onsuppressrepeats":false,"offtype":"2","offtimesun":"dusk","offtimetod":"22:30","offduration":"00:01:00","offpropertytype":"msg","offproperty":"payload","offvaluetype":"str","offvalue":"off","offoffset":"10","offrandomoffset":true,"offsuppressrepeats":false,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"sun":true,"x":222,"y":2040,"wires":[["4c94ed2f.d11c14"]]},{"id":"6832094e.7b7a98","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"b35bcace.f65918","name":"Motion Detection Disabled","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.frontdoor_motion_enabled"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1128,"y":2016,"wires":[[]]},{"id":"417b3ab2.376d64","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"b35bcace.f65918","name":"Motion Detection Enabled","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.frontdoor_motion_enabled"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1118,"y":2208,"wires":[[]]},{"id":"cb528f3e.6d389","type":"eztimer","z":"c4865e43.cbd68","d":true,"g":"f37a15a6.4f07a8","name":"","debug":false,"autoname":"sunsetStart - dawn","tag":"eztimer","suspended":false,"sendEventsOnSuspend":false,"lat":"55.9024","lon":"-3.6431","timerType":"1","startupMessage":true,"ontype":"1","ontimesun":"sunsetStart","ontimetod":"23:00","onpropertytype":"msg","onproperty":"payload","onvaluetype":"str","onvalue":"on","onoffset":"0","onrandomoffset":false,"onsuppressrepeats":false,"offtype":"1","offtimesun":"dawn","offtimetod":"22:30","offduration":"00:01:00","offpropertytype":"msg","offproperty":"payload","offvaluetype":"str","offvalue":"off","offoffset":"","offrandomoffset":false,"offsuppressrepeats":false,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"sun":true,"x":246,"y":1560,"wires":[["7e6a90bb.0a40f"]]},{"id":"7e6a90bb.0a40f","type":"switch","z":"c4865e43.cbd68","d":true,"g":"f37a15a6.4f07a8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":506,"y":1560,"wires":[["c253e55d.4e3a18"],["41d7420.a1f89c"]]},{"id":"41d7420.a1f89c","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"f37a15a6.4f07a8","name":"Motion Detection Disabled","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.frontdoor_motion_enabled"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":840,"y":1584,"wires":[[]]},{"id":"c253e55d.4e3a18","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"f37a15a6.4f07a8","name":"Motion Detection Enabled","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.frontdoor_motion_enabled"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":830,"y":1536,"wires":[[]]},{"id":"ae7952.8a6c86b","type":"inject","z":"c4865e43.cbd68","d":true,"g":"b35bcace.f65918","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":434,"y":2112,"wires":[["4c94ed2f.d11c14"]]},{"id":"88ce8b61.4e9018","type":"inject","z":"c4865e43.cbd68","d":true,"g":"b35bcace.f65918","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"off","payloadType":"str","x":446,"y":2160,"wires":[["4c94ed2f.d11c14"]]},{"id":"693cc4a0.ccd77c","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"6c184314.2b82bc","name":"Lights Off","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.tasmo_shelly1pm_frontdoor","switch.tasmo_shelly1_garage_outside"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1296,"y":1440,"wires":[["46fde9eb.a1b7b8"]]},{"id":"c213afb.156205","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"b35bcace.f65918","name":"Lights On","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.tasmo_shelly1pm_frontdoor","switch.tasmo_shelly1_garage_outside"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1068,"y":1968,"wires":[[]]},{"id":"9c1f21dd.13ec9","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"b35bcace.f65918","name":"Lights Off","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.tasmo_shelly1pm_frontdoor","switch.tasmo_shelly1_garage_outside"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1068,"y":2160,"wires":[[]]},{"id":"74dd86a5.fd5fe8","type":"inject","z":"c4865e43.cbd68","d":true,"g":"6c184314.2b82bc","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":1154,"y":1272,"wires":[["910d6574.5aa3a8"]]},{"id":"840dedb9.5e346","type":"inject","z":"c4865e43.cbd68","d":true,"g":"6c184314.2b82bc","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"off","payloadType":"str","x":1154,"y":1392,"wires":[["693cc4a0.ccd77c"]]},{"id":"a0278a38.fa25d8","type":"alexa-local","z":"c4865e43.cbd68","d":true,"g":"fa52424f.aa5cc","devicename":"Movie Lights","inputtrigger":true,"x":194,"y":468,"wires":[["c689a791.8edae8"]]},{"id":"c689a791.8edae8","type":"switch","z":"c4865e43.cbd68","d":true,"g":"fa52424f.aa5cc","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":426,"y":468,"wires":[["92c45425.a28b08"],["f87f5dfa.e01ae"]]},{"id":"92c45425.a28b08","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"fa52424f.aa5cc","name":"Movie Room Light - Group - 30%","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.lights_movieroom"],"data":"brightness_pct: 30","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":828,"y":444,"wires":[[]]},{"id":"f87f5dfa.e01ae","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"fa52424f.aa5cc","name":"Movie Room Light - Group - 100%","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.lights_movieroom"],"data":"brightness_pct: 100","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":852,"y":504,"wires":[[]]},{"id":"ea7e9f40.5fe5b","type":"bigtimer","z":"c4865e43.cbd68","d":true,"g":"1a836572.7c51ab","outtopic":"","outpayload1":"","outpayload2":"","name":"0730 - 0015 (15m random offset)","comment":"","lat":"55.8938","lon":"-3.6232","starttime":"480","endtime":"1425","starttime2":"480","endtime2":"1425","startoff":"15","endoff":"15","startoff2":0,"endoff2":0,"offs":0,"outtext1":"","outtext2":"","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"day6":0,"month6":0,"day7":0,"month7":0,"day8":0,"month8":0,"day9":0,"month9":0,"day10":0,"month10":0,"day11":0,"month11":0,"day12":0,"month12":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"d6":0,"w6":0,"xday1":0,"xmonth1":0,"xday2":0,"xmonth2":0,"xday3":0,"xmonth3":0,"xday4":0,"xmonth4":0,"xday5":0,"xmonth5":0,"xday6":0,"xmonth6":0,"xd1":0,"xw1":0,"xd2":0,"xw2":0,"xd3":0,"xw3":0,"xd4":0,"xw4":0,"xd5":0,"xw5":0,"xd6":0,"xw6":0,"suspend":false,"random":true,"repeat":true,"atstart":true,"odd":false,"even":false,"x":580,"y":3816,"wires":[["760f9aa3.a44374"],[],[]]},{"id":"760f9aa3.a44374","type":"switch","z":"c4865e43.cbd68","d":true,"g":"1a836572.7c51ab","name":"Turn On/Off?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"str"},{"t":"eq","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":870,"y":3804,"wires":[["2bd5999d.98cc86"],["1fa289a6.1799c6"]]},{"id":"904621c2.a8661","type":"bigtimer","z":"c4865e43.cbd68","d":true,"g":"47c6376c.3dc848","outtopic":"","outpayload1":"on","outpayload2":"off","name":"Big Timer","comment":"","lat":"55.8938","lon":"-3.6232","starttime":"5004","endtime":"15","starttime2":0,"endtime2":0,"startoff":"-30","endoff":"10","startoff2":0,"endoff2":0,"offs":0,"outtext1":"","outtext2":"","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"day6":0,"month6":0,"day7":0,"month7":0,"day8":0,"month8":0,"day9":0,"month9":0,"day10":0,"month10":0,"day11":0,"month11":0,"day12":0,"month12":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"d6":0,"w6":0,"xday1":0,"xmonth1":0,"xday2":0,"xmonth2":0,"xday3":0,"xmonth3":0,"xday4":0,"xmonth4":0,"xday5":0,"xmonth5":0,"xday6":0,"xmonth6":0,"xd1":0,"xw1":0,"xd2":0,"xw2":0,"xd3":0,"xw3":0,"xd4":0,"xw4":0,"xd5":0,"xw5":0,"xd6":0,"xw6":0,"suspend":false,"random":true,"repeat":false,"atstart":true,"odd":false,"even":false,"x":624,"y":4236,"wires":[["46ad94ff.6208bc","fdf09a04.548288","37fe30c4.a86fa"],[],[]]},{"id":"46ad94ff.6208bc","type":"switch","z":"c4865e43.cbd68","d":true,"g":"47c6376c.3dc848","name":"Turn On/Off (one-off timer msg)?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":862,"y":4236,"wires":[["c94cc98e.ef21b8"],["a525736b.cdfce"]]},{"id":"77134325.27633c","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"47c6376c.3dc848","name":"Living Room - Big Light - On","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.ikea_living_room_big_lamp"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"payload","output_location_type":"none","x":1548,"y":4152,"wires":[[]]},{"id":"f1fcf507.1aa328","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"47c6376c.3dc848","name":"Living Room - Lamp (socket) - On","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.living_room_small_lamp_socket_08"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1568,"y":4200,"wires":[[]]},{"id":"732bb821.11f368","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"47c6376c.3dc848","name":"Living Room - Big Light - Off","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.ikea_living_room_big_lamp"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"payload","output_location_type":"none","x":1548,"y":4272,"wires":[[]]},{"id":"64d8a2d6.d09ffc","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"47c6376c.3dc848","name":"Living Room - Lamp (socket) - Off","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.living_room_small_lamp_socket_08"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"payload","output_location_type":"none","x":1568,"y":4320,"wires":[[]]},{"id":"33489131.fee59e","type":"mqtt in","z":"c4865e43.cbd68","d":true,"g":"d2f2a56a.61ef08","name":"Ikea 5-button Switch","topic":"zigbee2mqtt/z2m_ikea_5button02_htpc","qos":"2","datatype":"auto","broker":"e96cb00d.af953","nl":false,"rap":false,"inputs":0,"x":222,"y":4776,"wires":[["3b7d49a3.7e36a6"]]},{"id":"3b7d49a3.7e36a6","type":"json","z":"c4865e43.cbd68","d":true,"g":"d2f2a56a.61ef08","name":"","property":"payload","action":"","pretty":false,"x":398,"y":4776,"wires":[["56591abd.833354"]]},{"id":"56591abd.833354","type":"switch","z":"c4865e43.cbd68","d":true,"g":"d2f2a56a.61ef08","name":"Parse Switch Message","property":"payload.action","propertyType":"msg","rules":[{"t":"eq","v":"toggle","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":592,"y":4776,"wires":[["5644946b.3bb84c","c3460df2.41da9","515d2818.4d9078","f15aeda44dc6b330"]]},{"id":"d2497f7f.07ec4","type":"comment","z":"c4865e43.cbd68","d":true,"g":"d2f2a56a.61ef08","name":"MQTT directly instead of HA input (read more inside)","info":"Using zigbee2mqtt's MQTT messages directly \nhere to work with Ikea buttons instead of\nHA's switch input.\n\nNote the 5-button unit has many more possible \nstates since holding and releasing buttons also\ncause MQTT updates including duration of hold.\n\nJust a proof of concept to work out how to do it.\n\nOnly downside is that HA won't know current switch \nstate since bypassing HA in the loop but don't\nreally need it in this case.\n\nNeed to parse MQTT payload with json node\nbefore being able to get values.\n\nAnd we can't use toggle button to toggle on/off\nunless we want to save the state of the TV somewhere\nor pull the state from somewhere as part of flow.\nCould be possible by pinging TV maybe or tracking\nlast MQTT message value from plug constantly and\nsaving in variable.\nBut easier just to use the brightness buttons to\ndo on/off.","x":418,"y":4824,"wires":[]},{"id":"5644946b.3bb84c","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"d2f2a56a.61ef08","name":"Living Room - Big Light - Toggle","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"switch","service":"toggle","areaId":[],"deviceId":[],"entityId":["light.living_room_big_lamp"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1030,"y":4752,"wires":[[]]},{"id":"c3460df2.41da9","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"d2f2a56a.61ef08","name":"Living Room - Lamp (socket) - Toggle","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"switch","service":"toggle","areaId":[],"deviceId":[],"entityId":["switch.living_room_small_lamp_socket_08"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1050,"y":4800,"wires":[[]]},{"id":"a7e79632.469c38","type":"inject","z":"c4865e43.cbd68","d":true,"g":"1a836572.7c51ab","name":"On","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":178,"y":3684,"wires":[["ea7e9f40.5fe5b"]]},{"id":"5c16d110.6ba42","type":"inject","z":"c4865e43.cbd68","d":true,"g":"1a836572.7c51ab","name":"Off","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"off","payloadType":"str","x":178,"y":3720,"wires":[["ea7e9f40.5fe5b"]]},{"id":"fdf09a04.548288","type":"debug","z":"c4865e43.cbd68","d":true,"g":"47c6376c.3dc848","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":782,"y":4188,"wires":[]},{"id":"e4a6ba5a.d04e58","type":"inject","z":"c4865e43.cbd68","d":true,"g":"47c6376c.3dc848","name":"On (Override Timer Until Next On/Off Event)","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":314,"y":4248,"wires":[["904621c2.a8661"]]},{"id":"3bee2e71.c47b42","type":"inject","z":"c4865e43.cbd68","d":true,"g":"47c6376c.3dc848","name":"Off (Override Timer Until Next On/Off Event)","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"off","payloadType":"str","x":314,"y":4308,"wires":[["904621c2.a8661"]]},{"id":"515d2818.4d9078","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"d2f2a56a.61ef08","name":"Lidl Outlet 01 - Kitchen Fairy Lights - Toggle","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"light","service":"toggle","areaId":[],"deviceId":[],"entityId":["switch.z2m_lidl_socket01_kitchen_Fairy_lights"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1070,"y":4860,"wires":[[]]},{"id":"d5c5a376.86c6d","type":"zigbee2mqtt-out","z":"c4865e43.cbd68","d":true,"g":"e98ad2e1.53155","name":"Z2M Lidl Socket 1 - Kitchen Fairy Lights","server":"f0cc4845.3e9e28","friendly_name":"z2m_lidl_socket01_kitchen_Fairy_lights","device_id":"0xec1bbdfffeb07bed","command":"state","commandType":"z2m_cmd","payload":"payload","payloadType":"msg","x":1408,"y":4584,"wires":[]},{"id":"50a077b0.869518","type":"function","z":"c4865e43.cbd68","d":true,"g":"e98ad2e1.53155","name":"Set msg.payload - ON","func":"msg.payload = {\"state\":\"on\"};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1036,"y":4548,"wires":[["d5c5a376.86c6d","667daad0cc858e80","0bc143f9fa9aa024"]]},{"id":"ecaa7a20.989a48","type":"alexa-local","z":"c4865e43.cbd68","d":true,"g":"e98ad2e1.53155","devicename":"Kitchen Fairy Light","inputtrigger":false,"x":534,"y":4596,"wires":[["37fe30c4.a86fa","2cd11fb3.905fa"]]},{"id":"f1e09968.f05ca8","type":"function","z":"c4865e43.cbd68","d":true,"g":"e98ad2e1.53155","name":"Set msg.payload - OFF","func":"msg.payload = {\"state\":\"off\"};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1046,"y":4632,"wires":[["d5c5a376.86c6d","18eb07ce843d50d6"]]},{"id":"37fe30c4.a86fa","type":"switch","z":"c4865e43.cbd68","d":true,"g":"e98ad2e1.53155","name":"Turn On/Off?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":802,"y":4596,"wires":[["50a077b0.869518"],["f1e09968.f05ca8"]]},{"id":"2a9b9e4e.a27fa2","type":"inject","z":"c4865e43.cbd68","d":true,"g":"e98ad2e1.53155","name":"Off","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"off","payloadType":"str","x":554,"y":4548,"wires":[["37fe30c4.a86fa"]]},{"id":"93dd5b0f.0cd4e8","type":"inject","z":"c4865e43.cbd68","d":true,"g":"e98ad2e1.53155","name":"On","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":554,"y":4512,"wires":[["37fe30c4.a86fa"]]},{"id":"2cd11fb3.905fa","type":"debug","z":"c4865e43.cbd68","d":true,"g":"e98ad2e1.53155","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":694,"y":4644,"wires":[]},{"id":"af617516.bf0758","type":"server-state-changed","z":"c4865e43.cbd68","d":true,"g":"1a836572.7c51ab","name":"HA Helper - Christmas Lights","server":"3b49c004.6176a","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.nr_christmas_lights","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":224,"y":3864,"wires":[["ea7e9f40.5fe5b"]]},{"id":"1fa289a6.1799c6","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"1a836572.7c51ab","name":"HA Helper - Christmas Lights - OFF","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.nr_christmas_lights"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"payload","output_location_type":"none","x":1252,"y":3876,"wires":[["5539ed98f71421ba","31be43858f90e72c","9bfb1707481830ee","c040e8288f4899d8"]]},{"id":"2bd5999d.98cc86","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"1a836572.7c51ab","name":"HA Helper - Christmas Lights - ON","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.nr_christmas_lights"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"payload","output_location_type":"none","x":1252,"y":3684,"wires":[["e2ab34d2f441f099","be363b7997d9d19d","058742e618dc313b","924fecaf61d433b9"]]},{"id":"cae866e7.da4f08","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"6c184314.2b82bc","name":"Turn On Input Bool to Show Timer Is Running","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.frontdoor_motion_timer_running"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1562,"y":1320,"wires":[[]]},{"id":"46fde9eb.a1b7b8","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"6c184314.2b82bc","name":"Turn Off Input Bool to Show Timer Is Stopped","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.frontdoor_motion_timer_running"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1562,"y":1440,"wires":[[]]},{"id":"a525736b.cdfce","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"47c6376c.3dc848","name":"HA Helper - Living Room Lights - OFF","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.nr_living_room_lights"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1182,"y":4260,"wires":[["732bb821.11f368","64d8a2d6.d09ffc","b73d5a37.31c9c8","93a1524abb9f1718"]]},{"id":"c94cc98e.ef21b8","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"47c6376c.3dc848","name":"HA Helper - Living Room Lights - ON","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.nr_living_room_lights"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"payload","output_location_type":"none","x":1182,"y":4212,"wires":[["77134325.27633c","f1fcf507.1aa328","c8dbed699fd9668c"]]},{"id":"c53ca04c.8c095","type":"server-state-changed","z":"c4865e43.cbd68","d":true,"g":"47c6376c.3dc848","name":"HA Helper - Living Room Lights","server":"3b49c004.6176a","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.nr_living_room_lights","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":346,"y":4188,"wires":[["904621c2.a8661"]]},{"id":"b73d5a37.31c9c8","type":"alexa-remote-smarthome","z":"c4865e43.cbd68","d":true,"g":"47c6376c.3dc848","name":"Tuya Diffuser - Turn Off","account":"c341166.e0c82e8","config":{"option":"action","value":[{"entity":"6ff88a98-7a2d-4f96-af41-5f9ee4655a8c","action":"turnOff"}]},"outputs":1,"x":1538,"y":4416,"wires":[["9c96163f1e7b9ae4"]]},{"id":"d1490f4f9ae4d65b","type":"http in","z":"c4865e43.cbd68","d":true,"g":"afbfe317f7b9cc3a","name":"Webhook - Movie Room Lights","url":"/webhook-movie-room-lights","method":"post","upload":false,"swaggerDoc":"","x":2150,"y":528,"wires":[["02ebad81ccf36822","4b45a3c23f824eb0","046cb80e239ef061"]]},{"id":"02ebad81ccf36822","type":"http response","z":"c4865e43.cbd68","d":true,"g":"afbfe317f7b9cc3a","name":"Websocket Response","statusCode":"200","headers":{},"x":2180,"y":564,"wires":[]},{"id":"046cb80e239ef061","type":"switch","z":"c4865e43.cbd68","d":true,"g":"afbfe317f7b9cc3a","name":"On/Off","property":"payload.state","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":2430,"y":528,"wires":[["4e6b5ce831ec8466","db0178a8409da0b5"],["92debfc00f93af82"]]},{"id":"4e6b5ce831ec8466","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"afbfe317f7b9cc3a","name":"Movie Room Lights - On - Specified %","server":"3b49c004.6176a","version":5,"debugenabled":true,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.lights_movieroom"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":2722,"y":528,"wires":[[]],"info":"To call independantly...\nlight.z2m_ikea_gu10_movierm_left,light.z2m_ikea_gu10_movierm_right"},{"id":"92debfc00f93af82","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"afbfe317f7b9cc3a","name":"Movie Room Lights - Off","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.lights_movieroom"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":2682.5078125,"y":595.0234375,"wires":[[]],"info":"Or call independantly:\nlight.z2m_ikea_gu10_movierm_left,light.z2m_ikea_gu10_movierm_right"},{"id":"4b45a3c23f824eb0","type":"debug","z":"c4865e43.cbd68","d":true,"g":"afbfe317f7b9cc3a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2346,"y":636,"wires":[]},{"id":"db0178a8409da0b5","type":"debug","z":"c4865e43.cbd68","d":true,"g":"afbfe317f7b9cc3a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2514,"y":456,"wires":[]},{"id":"fbbab013a6523277","type":"alexa-local","z":"c4865e43.cbd68","d":true,"g":"1a836572.7c51ab","devicename":"Christmas Lights","inputtrigger":true,"x":194,"y":3816,"wires":[["ea7e9f40.5fe5b"]]},{"id":"e2ab34d2f441f099","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"1a836572.7c51ab","name":"LIDL Socket 2","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.z2m_lidl_socket02"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"payload","output_location_type":"none","x":1612,"y":3636,"wires":[[]]},{"id":"5539ed98f71421ba","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"1a836572.7c51ab","name":"LIDL Socket 2","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.z2m_lidl_socket02"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"payload","output_location_type":"none","x":1612,"y":3828,"wires":[[]]},{"id":"be363b7997d9d19d","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"1a836572.7c51ab","name":"IKEA Socket 3","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.z2m_ikea_outlet03"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"payload","output_location_type":"none","x":1612,"y":3684,"wires":[[]]},{"id":"058742e618dc313b","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"1a836572.7c51ab","name":"IKEA Socket 4","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.z2m_ikea_outlet04"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"payload","output_location_type":"none","x":1612,"y":3732,"wires":[[]]},{"id":"31be43858f90e72c","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"1a836572.7c51ab","name":"IKEA Socket 3","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.z2m_ikea_outlet03"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"payload","output_location_type":"none","x":1612,"y":3876,"wires":[[]]},{"id":"9bfb1707481830ee","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"1a836572.7c51ab","name":"IKEA Socket 4","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.z2m_ikea_outlet04"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"payload","output_location_type":"none","x":1616,"y":3924,"wires":[[]]},{"id":"e60497eaaeb36ae7","type":"http request","z":"c4865e43.cbd68","d":true,"g":"5aee7e0abc686870","name":"Reboot WLED","method":"GET","ret":"txt","paytoqs":"ignore","url":"http://192.168.30.29/win&RB","tls":"","persist":false,"proxy":"","authType":"","senderr":false,"x":1984,"y":816,"wires":[[]]},{"id":"bbaba42ff654e669","type":"inject","z":"c4865e43.cbd68","d":true,"g":"5aee7e0abc686870","name":"Go!","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":1762,"y":912,"wires":[["e60497eaaeb36ae7"]]},{"id":"ce48406caaf15876","type":"eztimer","z":"c4865e43.cbd68","d":true,"g":"5aee7e0abc686870","name":"Daily @ 8am","debug":false,"autoname":"08:00:00","tag":"eztimer","suspended":false,"sendEventsOnSuspend":false,"lat":"55.8938","lon":"-3.6232","timerType":"2","startupMessage":false,"ontype":"2","ontimesun":"dawn","ontimetod":"08:00:00","onpropertytype":"msg","onproperty":"payload","onvaluetype":"num","onvalue":1,"onoffset":0,"onrandomoffset":0,"onsuppressrepeats":false,"offtype":"1","offtimesun":"dusk","offtimetod":"dusk","offduration":"00:01:00","offpropertytype":"msg","offproperty":"payload","offvaluetype":"num","offvalue":0,"offoffset":0,"offrandomoffset":0,"offsuppressrepeats":false,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"sun":true,"x":1782,"y":804,"wires":[["e60497eaaeb36ae7"]]},{"id":"d6f27916b030116c","type":"switch","z":"c4865e43.cbd68","d":true,"g":"bed9c56215d257da","name":"Turn On/Off (one-off timer msg)?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":930,"y":936,"wires":[["2af25efbddb9f9eb","e385f743115bf735"],["b6b00ea760b65ce8","e3175a15e12561d1"]]},{"id":"e9edaa013335e399","type":"bigtimer","z":"c4865e43.cbd68","d":true,"g":"bed9c56215d257da","outtopic":"","outpayload1":"on","outpayload2":"off","name":"Big Timer","comment":"","lat":"55.8938","lon":"-3.6232","starttime":"5004","endtime":"1365","starttime2":0,"endtime2":0,"startoff":"-30","endoff":"15","startoff2":0,"endoff2":0,"offs":0,"outtext1":"","outtext2":"","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"day6":0,"month6":0,"day7":0,"month7":0,"day8":0,"month8":0,"day9":0,"month9":0,"day10":0,"month10":0,"day11":0,"month11":0,"day12":0,"month12":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"d6":0,"w6":0,"xday1":0,"xmonth1":0,"xday2":0,"xmonth2":0,"xday3":0,"xmonth3":0,"xday4":0,"xmonth4":0,"xday5":0,"xmonth5":0,"xday6":0,"xmonth6":0,"xd1":0,"xw1":0,"xd2":0,"xw2":0,"xd3":0,"xw3":0,"xd4":0,"xw4":0,"xd5":0,"xw5":0,"xd6":0,"xw6":0,"suspend":false,"random":true,"repeat":true,"atstart":true,"odd":false,"even":false,"x":608,"y":924,"wires":[["d6f27916b030116c","1da24356a36a8ab6"],["ba122f35fac90dd2"],[]]},{"id":"1da24356a36a8ab6","type":"debug","z":"c4865e43.cbd68","d":true,"g":"bed9c56215d257da","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":726,"y":852,"wires":[]},{"id":"a04201faece5f481","type":"inject","z":"c4865e43.cbd68","d":true,"g":"bed9c56215d257da","name":"On (Override Timer Until Next On/Off Event)","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":310,"y":816,"wires":[["e9edaa013335e399"]]},{"id":"b1e52ac8ae06f2ec","type":"inject","z":"c4865e43.cbd68","d":true,"g":"bed9c56215d257da","name":"Off (Override Timer Until Next On/Off Event)","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"off","payloadType":"str","x":310,"y":864,"wires":[["e9edaa013335e399"]]},{"id":"dd67e9976846f0f5","type":"server-state-changed","z":"c4865e43.cbd68","d":true,"g":"bed9c56215d257da","name":"HA Helper - Back Garden Lights","server":"3b49c004.6176a","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.nr_back_garden_lights","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":258,"y":1008,"wires":[["e9edaa013335e399"]]},{"id":"038e75798a524ad8","type":"alexa-local","z":"c4865e43.cbd68","d":true,"g":"bed9c56215d257da","devicename":"Back Garden Lights","inputtrigger":true,"x":254,"y":924,"wires":[["e9edaa013335e399"]]},{"id":"2af25efbddb9f9eb","type":"change","z":"c4865e43.cbd68","d":true,"g":"bed9c56215d257da","name":"Back Garden Walll Net - Set MQTT topic","rules":[{"t":"set","p":"topic","pt":"msg","to":"shellies/shelly1pm-garden-wall-net/relay/0/command","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1284,"y":804,"wires":[["d625a64c89b8ba91"]]},{"id":"d625a64c89b8ba91","type":"mqtt out","z":"c4865e43.cbd68","d":true,"g":"bed9c56215d257da","name":"","topic":"","qos":"2","retain":"true","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"e96cb00d.af953","x":1570,"y":804,"wires":[]},{"id":"b6b00ea760b65ce8","type":"change","z":"c4865e43.cbd68","d":true,"g":"bed9c56215d257da","name":"Back Garden Walll Net - Set MQTT topic","rules":[{"t":"set","p":"topic","pt":"msg","to":"shellies/shelly1pm-garden-wall-net/relay/0/command","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1284,"y":1080,"wires":[["bc9f639668057193"]]},{"id":"bc9f639668057193","type":"mqtt out","z":"c4865e43.cbd68","d":true,"g":"bed9c56215d257da","name":"","topic":"","qos":"2","retain":"true","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"e96cb00d.af953","x":1570,"y":1080,"wires":[]},{"id":"4fb51575bac9220b","type":"wled2","z":"c4865e43.cbd68","d":true,"g":"bed9c56215d257da","address":"192.168.30.28","brightness":"220","delay":0,"color1":"#ffffff","color2":"#ffffff","color3":"#ffffff","effect":"102","effectIntensity":128,"effectSpeed":128,"name":"Garden Wall Strip (D1-Pro-02)","palette":"2","preset":"5","state":"on","x":1534,"y":852,"wires":[[]]},{"id":"873d67382981b8c2","type":"wled2","z":"c4865e43.cbd68","d":true,"g":"bed9c56215d257da","address":"192.168.30.28","brightness":128,"delay":0,"color1":"#ffffff","color2":"#ffffff","color3":"#ffffff","effect":"91","effectIntensity":128,"effectSpeed":128,"name":"Garden Wall Strip (D1-Pro-02)","palette":"51","preset":0,"state":"on","x":1482,"y":1032,"wires":[[]]},{"id":"e385f743115bf735","type":"http request","z":"c4865e43.cbd68","d":true,"g":"bed9c56215d257da","name":"Garden Wall Strip - Set Preset","method":"GET","ret":"txt","paytoqs":"ignore","url":"http://192.168.30.28/win&PL=1","tls":"","persist":false,"proxy":"","authType":"","senderr":false,"x":1254,"y":852,"wires":[[]]},{"id":"e3175a15e12561d1","type":"http request","z":"c4865e43.cbd68","d":true,"g":"bed9c56215d257da","name":"Garden Wall Strip - Brightness 0","method":"GET","ret":"txt","paytoqs":"ignore","url":"http://192.168.30.28/win&A=0","tls":"","persist":false,"proxy":"","authType":"","senderr":false,"x":1254,"y":1032,"wires":[[]]},{"id":"3736e13aa588362a","type":"inject","z":"c4865e43.cbd68","d":true,"g":"bed9c56215d257da","name":"off","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"off","payloadType":"str","x":982,"y":1056,"wires":[["e3175a15e12561d1"]]},{"id":"b3aa96289a63acfb","type":"inject","z":"c4865e43.cbd68","d":true,"g":"bed9c56215d257da","name":"on","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":994,"y":792,"wires":[["2af25efbddb9f9eb"]]},{"id":"6820cdde4aca097f","type":"inject","z":"c4865e43.cbd68","d":true,"g":"bed9c56215d257da","name":"on","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":994,"y":828,"wires":[["e385f743115bf735"]]},{"id":"006c397d66b80b67","type":"inject","z":"c4865e43.cbd68","d":true,"g":"bed9c56215d257da","name":"off","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"off","payloadType":"str","x":982,"y":1092,"wires":[["b6b00ea760b65ce8"]]},{"id":"b4692fa1bd78f18a","type":"api-current-state","z":"c4865e43.cbd68","d":true,"g":"6c184314.2b82bc","name":"Motion Enabled?","server":"3b49c004.6176a","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.frontdoor_motion_enabled","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":690,"y":1320,"wires":[["910d6574.5aa3a8","e7324546dca14601"],[]]},{"id":"ff8572f6a26f8e3b","type":"change","z":"c4865e43.cbd68","d":true,"g":"6c184314.2b82bc","name":"Cancel off timer","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":812,"y":1380,"wires":[["705e69ee6042d958","a190b891109ea9f8"]]},{"id":"1a39611804e84306","type":"server-state-changed","z":"c4865e43.cbd68","d":true,"g":"6c184314.2b82bc","name":"Ring Doorbell Motion Detected","server":"3b49c004.6176a","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.front_door_motion","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":298,"y":1368,"wires":[["b4692fa1bd78f18a","ff8572f6a26f8e3b","5c9e75faf6d2a740"],["705e69ee6042d958","50eed6c8d941261c"]]},{"id":"705e69ee6042d958","type":"trigger","z":"c4865e43.cbd68","d":true,"g":"6c184314.2b82bc","name":"Send off after X seconds","op1":"","op2":"off","op1type":"nul","op2type":"str","duration":"30","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1046,"y":1440,"wires":[["693cc4a0.ccd77c","a73ae0ce8062b29c"]]},{"id":"f6f2d0501c58c7cb","type":"switch","z":"c4865e43.cbd68","d":true,"g":"7c5a1277881034f6","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":518,"y":1740,"wires":[["66bef51808022751"],["f39fd6f11284fdbc"]]},{"id":"795d838a6437da93","type":"mqtt in","z":"c4865e43.cbd68","d":true,"g":"7c5a1277881034f6","name":"Ikea 5-button Switch","topic":"zigbee2mqtt/z2m_ikea_5button02_htpc","qos":"2","datatype":"auto","broker":"e96cb00d.af953","inputs":0,"x":234,"y":1812,"wires":[["ec834d127fe7a869"]]},{"id":"ec834d127fe7a869","type":"json","z":"c4865e43.cbd68","d":true,"g":"7c5a1277881034f6","name":"","property":"payload","action":"","pretty":false,"x":302,"y":1860,"wires":[["9b85b7e2609b9d26"]]},{"id":"9b85b7e2609b9d26","type":"switch","z":"c4865e43.cbd68","d":true,"g":"7c5a1277881034f6","name":"Parse Switch Message","property":"payload.action","propertyType":"msg","rules":[{"t":"eq","v":"toggle","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":472,"y":1860,"wires":[["bd8b56206a81119d"]]},{"id":"795dd1991d81f16f","type":"alexa-local","z":"c4865e43.cbd68","d":true,"g":"7c5a1277881034f6","devicename":"Front Door Lights","inputtrigger":true,"x":222,"y":1740,"wires":[["f6f2d0501c58c7cb"]]},{"id":"e14dedaf2d48a062","type":"trigger","z":"c4865e43.cbd68","d":true,"g":"7c5a1277881034f6","name":"Send off after 5 min","op1":"","op2":"off","op1type":"nul","op2type":"str","duration":"5","extend":true,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1002,"y":1764,"wires":[["f39fd6f11284fdbc"]]},{"id":"5c9e75faf6d2a740","type":"debug","z":"c4865e43.cbd68","d":true,"g":"6c184314.2b82bc","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":530,"y":1260,"wires":[]},{"id":"50eed6c8d941261c","type":"debug","z":"c4865e43.cbd68","d":true,"g":"6c184314.2b82bc","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":506,"y":1428,"wires":[]},{"id":"e7324546dca14601","type":"debug","z":"c4865e43.cbd68","d":true,"g":"6c184314.2b82bc","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":854,"y":1248,"wires":[]},{"id":"a190b891109ea9f8","type":"debug","z":"c4865e43.cbd68","d":true,"g":"6c184314.2b82bc","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":998,"y":1356,"wires":[]},{"id":"a73ae0ce8062b29c","type":"debug","z":"c4865e43.cbd68","d":true,"g":"6c184314.2b82bc","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1202,"y":1500,"wires":[]},{"id":"66bef51808022751","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"7c5a1277881034f6","name":"Lights On","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.tasmo_shelly1pm_frontdoor","switch.tasmo_shelly1_garage_outside"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":792,"y":1716,"wires":[["7f5c4d78913bafc5","e14dedaf2d48a062"]]},{"id":"7f5c4d78913bafc5","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"7c5a1277881034f6","name":"Turn On Input Bool to Show Timer Is Running","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.frontdoor_motion_timer_running"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"payload","output_location_type":"none","x":1382,"y":1716,"wires":[[]]},{"id":"f39fd6f11284fdbc","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"7c5a1277881034f6","name":"Lights Off","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.tasmo_shelly1pm_frontdoor","switch.tasmo_shelly1_garage_outside"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1140,"y":1836,"wires":[["799d24f95394e335"]]},{"id":"799d24f95394e335","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"7c5a1277881034f6","name":"Turn Off Input Bool to Show Timer Is Stopped","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.frontdoor_motion_timer_running"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1394,"y":1836,"wires":[[]]},{"id":"bd8b56206a81119d","type":"api-current-state","z":"c4865e43.cbd68","d":true,"g":"7c5a1277881034f6","name":"Lights off?","server":"3b49c004.6176a","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.z2m_ikea_bulb_wh02_frontdoor_light","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":502,"y":1812,"wires":[["66bef51808022751"],["f39fd6f11284fdbc"]]},{"id":"ba122f35fac90dd2","type":"debug","z":"c4865e43.cbd68","d":true,"g":"bed9c56215d257da","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":774,"y":1020,"wires":[]},{"id":"667daad0cc858e80","type":"debug","z":"c4865e43.cbd68","d":true,"g":"e98ad2e1.53155","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1214,"y":4512,"wires":[]},{"id":"c040e8288f4899d8","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"1a836572.7c51ab","name":"IKEA Socket 5","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.z2m_ikea_outlet05"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"payload","output_location_type":"none","x":1616,"y":3972,"wires":[[]]},{"id":"924fecaf61d433b9","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"1a836572.7c51ab","name":"IKEA Socket 5","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.z2m_ikea_outlet05"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"payload","output_location_type":"none","x":1612,"y":3780,"wires":[[]]},{"id":"f15aeda44dc6b330","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"d2f2a56a.61ef08","name":"LIDL Socket 3 - Toggle","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"switch","service":"toggle","areaId":[],"deviceId":[],"entityId":["switch.z2m_lidl_socket03"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"payload","output_location_type":"none","x":1000,"y":4908,"wires":[[]]},{"id":"93a1524abb9f1718","type":"zigbee2mqtt-out","z":"c4865e43.cbd68","d":true,"g":"47c6376c.3dc848","name":"Z2M Lidl Socket 3 - Living Room Fairy Lights","server":"f0cc4845.3e9e28","friendly_name":"z2m_lidl_socket03","device_id":"0x842e14fffedba132","command":"state","commandType":"z2m_cmd","payload":"payload","payloadType":"msg","x":1602,"y":4380,"wires":[]},{"id":"c8dbed699fd9668c","type":"zigbee2mqtt-out","z":"c4865e43.cbd68","d":true,"g":"47c6376c.3dc848","name":"Z2M Lidl Socket 3 - Living Room Fairy Lights","server":"f0cc4845.3e9e28","friendly_name":"","device_id":"0x842e14fffedba132","command":"state","commandType":"z2m_cmd","payload":"payload","payloadType":"msg","x":1606,"y":4104,"wires":[]},{"id":"18eb07ce843d50d6","type":"zigbee2mqtt-out","z":"c4865e43.cbd68","d":true,"g":"e98ad2e1.53155","name":"Z2M Lidl Socket 1 - OFF","server":"f0cc4845.3e9e28","friendly_name":"z2m_lidl_socket01_kitchen_Fairy_lights","device_id":"0xec1bbdfffeb07bed","command":"state","commandType":"z2m_cmd","payload":"off","payloadType":"z2m_payload","x":1378,"y":4620,"wires":[]},{"id":"0bc143f9fa9aa024","type":"zigbee2mqtt-out","z":"c4865e43.cbd68","d":true,"g":"e98ad2e1.53155","name":"Z2M Lidl Socket 1 - ON","server":"f0cc4845.3e9e28","friendly_name":"z2m_lidl_socket01_kitchen_Fairy_lights","device_id":"0xec1bbdfffeb07bed","command":"state","commandType":"z2m_cmd","payload":"on","payloadType":"z2m_payload","x":1382,"y":4548,"wires":[]},{"id":"c3c5c8799cf58c6e","type":"inject","z":"c4865e43.cbd68","d":true,"g":"47c6376c.3dc848","name":"Test - off","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"off","payloadType":"str","x":1200,"y":4416,"wires":[["b73d5a37.31c9c8"]]},{"id":"9c96163f1e7b9ae4","type":"debug","z":"c4865e43.cbd68","d":true,"g":"47c6376c.3dc848","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1726,"y":4452,"wires":[]},{"id":"3391a177.0197de","type":"inject","z":"c4865e43.cbd68","d":true,"g":"7526b80f.838298","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":466,"y":2880,"wires":[["9c59bc53.6d34d"]]},{"id":"9c59bc53.6d34d","type":"switch","z":"c4865e43.cbd68","d":true,"g":"7526b80f.838298","name":"Motion On/Off?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":604,"y":3012,"wires":[["3dae3e30.982312"],[]]},{"id":"df4c2b73.4d4a98","type":"inject","z":"c4865e43.cbd68","d":true,"g":"7526b80f.838298","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"off","payloadType":"str","x":478,"y":2928,"wires":[["9c59bc53.6d34d"]]},{"id":"97b5895.d460b78","type":"server-state-changed","z":"c4865e43.cbd68","d":true,"g":"7526b80f.838298","name":"Motion Sensor","server":"3b49c004.6176a","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.z2m_ikea_motiondetector01_office_occupancy","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":186,"y":3012,"wires":[["da9dd7d4.301718"]]},{"id":"53a2290b.d6c1b8","type":"trigger","z":"c4865e43.cbd68","d":true,"g":"7526b80f.838298","name":"","op1":"","op2":"off","op1type":"nul","op2type":"str","duration":"5","extend":false,"overrideDelay":false,"units":"min","reset":"on","bytopic":"all","topic":"topic","outputs":1,"x":930,"y":3156,"wires":[["1cac89e9.624136"]],"info":"Linking to the 10s timer simply to minimise\ncomplexity of flow. \n\nNo real impact to operation except adds 10s on to this timer before turning off lights."},{"id":"b1e73fd6.cadf2","type":"comment","z":"c4865e43.cbd68","d":true,"g":"7526b80f.838298","name":"Study Motion Sensor Lights","info":"Triggered on by motion sensor. \nOnce 'off' message received then the trigger is \nactivated and the lights will turn off after 15 \nmore seconds unless the motion 'on' message is \nreceived again in this period.\n\nThis can be done without the trigger but the \ntrigger means that there are less false positives\nand any more motion in the trigger delay will \nkeep he lights on.\n\nSuper useful for motion 'sensors' where the \nmotion 'off' message is sent almost immediately \nafter motion stops.\nNot as useful for the binary_sensors which have a\ndelay already built in.","x":248,"y":2856,"wires":[]},{"id":"e71ea60a.d06508","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"7526b80f.838298","name":"Lamp On","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.z2m_ikea_outlet01_office_lamp"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":2096,"y":2976,"wires":[[]]},{"id":"347f62c5.d9214e","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"7526b80f.838298","name":"Lamp Off","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.z2m_ikea_outlet01_office_lamp"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":2096,"y":3432,"wires":[[]]},{"id":"3dae3e30.982312","type":"time-range-switch","z":"c4865e43.cbd68","d":true,"g":"7526b80f.838298","name":"","lat":"55.8938","lon":"-3.6232","startTime":"17:00","endTime":"02:00","startOffset":0,"endOffset":0,"x":846,"y":3012,"wires":[["53a2290b.d6c1b8","1fb2ae80.3de3a2"],[]]},{"id":"41d69579.006b8c","type":"server-state-changed","z":"c4865e43.cbd68","d":true,"g":"7526b80f.838298","name":"Ikea Switch","server":"3b49c004.6176a","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":"NR_Office"},{"property":"icon","value":""}],"entityidfilter":"sensor.z2m_ikea_switch01_office_lamp_click","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":186,"y":3384,"wires":[["2668d323.91574c"]]},{"id":"2668d323.91574c","type":"switch","z":"c4865e43.cbd68","d":true,"g":"7526b80f.838298","name":"Parse Switch Message","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"},{"t":"eq","v":"brightness_up","vt":"str"},{"t":"eq","v":"brightness_down","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":444,"y":3384,"wires":[["1fb2ae80.3de3a2"],["bdc78f54.b8686"],["952d9ea.dc7e46"],["a5142e69.5362b"]]},{"id":"952d9ea.dc7e46","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"7526b80f.838298","name":"Turn On Motion Detection","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.office_lights_motion_enabled"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":682,"y":3492,"wires":[[]]},{"id":"a5142e69.5362b","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"7526b80f.838298","name":"Turn Off Motion Detection","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.office_lights_motion_enabled"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":682,"y":3528,"wires":[[]]},{"id":"1cac89e9.624136","type":"trigger","z":"c4865e43.cbd68","d":true,"g":"7526b80f.838298","name":"","op1":"","op2":"off","op1type":"nul","op2type":"str","duration":"10","extend":false,"overrideDelay":false,"units":"s","reset":"on","bytopic":"all","topic":"topic","outputs":1,"x":1002,"y":3324,"wires":[["9e68c58a.7e9b08"]]},{"id":"da9dd7d4.301718","type":"api-current-state","z":"c4865e43.cbd68","d":true,"g":"7526b80f.838298","name":"Is Motion Enabled?","server":"3b49c004.6176a","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.office_lights_motion_enabled","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":374,"y":3012,"wires":[["9c59bc53.6d34d"],[]]},{"id":"bdc78f54.b8686","type":"api-current-state","z":"c4865e43.cbd68","d":true,"g":"7526b80f.838298","name":"Is Motion Enabled?","server":"3b49c004.6176a","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.office_lights_motion_enabled","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":710,"y":3378,"wires":[["1cac89e9.624136"],["9e68c58a.7e9b08"]],"info":"Gives 10s to exit room before lights go off. Otherwise motion will re-trigger lights on"},{"id":"dd17d442.715458","type":"inject","z":"c4865e43.cbd68","d":true,"g":"7526b80f.838298","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":250,"y":3468,"wires":[["2668d323.91574c"]]},{"id":"2959592d.886226","type":"inject","z":"c4865e43.cbd68","d":true,"g":"7526b80f.838298","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"off","payloadType":"str","x":250,"y":3504,"wires":[["2668d323.91574c"]]},{"id":"ba2356f7.6a1d78","type":"inject","z":"c4865e43.cbd68","d":true,"g":"7526b80f.838298","name":"LEDs On","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":1580,"y":2808,"wires":[["4d6c13a9.8f575c","702910e7.94edc","871b856c.334518"]]},{"id":"e7775cab.463ea","type":"inject","z":"c4865e43.cbd68","d":true,"g":"7526b80f.838298","name":"Lamp On","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":1580,"y":2844,"wires":[["e71ea60a.d06508"]]},{"id":"41240aba.4a5414","type":"wled2","z":"c4865e43.cbd68","d":true,"g":"7526b80f.838298","address":"192.168.30.20","brightness":"255","delay":0,"color1":"#ffffff","color2":"#ffffff","color3":"#ffffff","effect":0,"effectIntensity":128,"effectSpeed":"170","name":"WLED - Server Lights Off","palette":"0","preset":"","state":"off","x":2146,"y":3384,"wires":[[]]},{"id":"702910e7.94edc","type":"wled2","z":"c4865e43.cbd68","d":true,"g":"7526b80f.838298","address":"192.168.30.20","brightness":"255","delay":0,"color1":"#ffffff","color2":"#ffffff","color3":"#ffffff","effect":0,"effectIntensity":128,"effectSpeed":"170","name":"WLED - Server Lights On","palette":"0","preset":0,"state":"on","x":2146,"y":2928,"wires":[[]]},{"id":"3dbfcf2a.a1978","type":"inject","z":"c4865e43.cbd68","d":true,"g":"7526b80f.838298","name":"Clock On","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"off","payloadType":"str","x":1580,"y":2880,"wires":[["121837bf.d62768"]]},{"id":"121837bf.d62768","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"7526b80f.838298","name":"Ikea Socket 02 On (Clock)","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.z2m_ikea_outlet02"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":2156,"y":3024,"wires":[[]]},{"id":"9cf9b325.9beea","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"7526b80f.838298","name":"Ikea Socket 02 Off (Clock)","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.z2m_ikea_outlet02"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":2155,"y":3479,"wires":[[]]},{"id":"4d6c13a9.8f575c","type":"wled2","z":"c4865e43.cbd68","d":true,"g":"7526b80f.838298","address":"192.168.30.24","brightness":"255","delay":0,"color1":"#ffffff","color2":"#ffffff","color3":"#ffffff","effect":0,"effectIntensity":128,"effectSpeed":"170","name":"WLED - D1 Mini #2","palette":"50","preset":"1","state":"on","x":2126,"y":2880,"wires":[[]]},{"id":"a5e5180.ff2b7e8","type":"wled2","z":"c4865e43.cbd68","d":true,"g":"7526b80f.838298","address":"192.168.30.24","brightness":"255","delay":0,"color1":"#ffffff","color2":"#ffffff","color3":"#ffffff","effect":0,"effectIntensity":128,"effectSpeed":"170","name":"WLED - D1 Mini #2","palette":"0","preset":0,"state":"off","x":2126,"y":3336,"wires":[[]]},{"id":"d26823f1.75a3c","type":"server-state-changed","z":"c4865e43.cbd68","d":true,"g":"7526b80f.838298","name":"HA Helper - Office All","server":"3b49c004.6176a","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"device_tracker.wled_wled_2","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":216,"y":3324,"wires":[["2668d323.91574c"]]},{"id":"1fb2ae80.3de3a2","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"7526b80f.838298","name":"HA Helper - Office All - ON","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.nr_office_all"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"payload","output_location_type":"none","x":1352,"y":2952,"wires":[["4d6c13a9.8f575c","702910e7.94edc","e71ea60a.d06508","121837bf.d62768","871b856c.334518"]]},{"id":"9e68c58a.7e9b08","type":"api-call-service","z":"c4865e43.cbd68","d":true,"g":"7526b80f.838298","name":"HA Helper - Office All - OFF","server":"3b49c004.6176a","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.nr_office_all"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1340,"y":3396,"wires":[["a5e5180.ff2b7e8","41240aba.4a5414","347f62c5.d9214e","9cf9b325.9beea","d36f2e32.3d88f","34b1e16d64e3fb38"]]},{"id":"871b856c.334518","type":"wled2","z":"c4865e43.cbd68","d":true,"g":"7526b80f.838298","address":"192.168.30.27","brightness":"255","delay":0,"color1":"#ffffff","color2":"#ffffff","color3":"#ffffff","effect":0,"effectIntensity":128,"effectSpeed":"170","name":"WLED - Study Desk","palette":"50","preset":"1","state":"on","x":2136,"y":2832,"wires":[[]]},{"id":"d36f2e32.3d88f","type":"wled2","z":"c4865e43.cbd68","d":true,"g":"7526b80f.838298","address":"192.168.30.27","brightness":"255","delay":0,"color1":"#ffffff","color2":"#ffffff","color3":"#ffffff","effect":0,"effectIntensity":128,"effectSpeed":"170","name":"WLED - Study Desk","palette":"0","preset":0,"state":"off","x":2136,"y":3288,"wires":[[]]},{"id":"e81e3e09.660fb","type":"inject","z":"c4865e43.cbd68","d":true,"g":"7526b80f.838298","name":"Clock Off","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"off","payloadType":"str","x":1676,"y":3240,"wires":[["9cf9b325.9beea"]]},{"id":"8dba21f0.40ed6","type":"inject","z":"c4865e43.cbd68","d":true,"g":"7526b80f.838298","name":"Lamp Off","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"off","payloadType":"str","x":1676,"y":3204,"wires":[["347f62c5.d9214e"]]},{"id":"92c7e9ef.34c208","type":"inject","z":"c4865e43.cbd68","d":true,"g":"7526b80f.838298","name":"LEDs Off","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"off","payloadType":"str","x":1676,"y":3168,"wires":[["a5e5180.ff2b7e8","41240aba.4a5414","d36f2e32.3d88f"]]},{"id":"34b1e16d64e3fb38","type":"link out","z":"c4865e43.cbd68","d":true,"g":"7526b80f.838298","name":"Bin Notification Off","mode":"link","links":["5251150565dfa639","3a5be8723b07d05d"],"x":1913,"y":3516,"wires":[]},{"id":"b85923459dfd1cac","type":"trigger-state","z":"c4865e43.cbd68","d":true,"g":"b6df7fdabfc8b853","name":"","server":"3b49c004.6176a","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"calendar.bin_collection","entityidfiltertype":"exact","debugenabled":false,"constraints":[],"inputs":1,"outputs":2,"customoutputs":[],"outputinitially":true,"state_type":"str","enableInput":true,"x":488,"y":2508,"wires":[["adc3f532c37ade6e","988a864440d4424a","0e52de1a9a3a9cf7","22b5c945f330261f"],[]]},{"id":"adc3f532c37ade6e","type":"debug","z":"c4865e43.cbd68","d":true,"g":"b6df7fdabfc8b853","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":654,"y":2352,"wires":[]},{"id":"0e52de1a9a3a9cf7","type":"debug","z":"c4865e43.cbd68","d":true,"g":"b6df7fdabfc8b853","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"data","targetType":"msg","statusVal":"","statusType":"auto","x":664,"y":2424,"wires":[]},{"id":"988a864440d4424a","type":"debug","z":"c4865e43.cbd68","d":true,"g":"b6df7fdabfc8b853","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":674,"y":2388,"wires":[]},{"id":"1587417d874e9ed4","type":"inject","z":"c4865e43.cbd68","d":true,"g":"b6df7fdabfc8b853","name":"Test","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":174,"y":2532,"wires":[["b85923459dfd1cac"]]},{"id":"22b5c945f330261f","type":"function","z":"c4865e43.cbd68","d":true,"g":"b6df7fdabfc8b853","name":"Parse calendar msg data","func":"//--------------------------------------------------------------------\n// What we want to do:\n// 1. Get Event details\n// 2. Parse Event Name for bin colour: bin_colour\n//        - save in msg object @ msg.data.colour\n// 3. Do datetime calcs \n//      - calc notification off datetime: bin_notify_off_datetime\n//      - now vs event start \n//          - if event started and passed bin_notify_off_datetime then:\n//              - save bin_notify = false in msg object @ msg.data.notify\n//          - if event started but not passed bin_notify_off_datetime then:\n//              - save bin_notify = true in msg object @ msg.data.notify\n//      - now vs notification off datetime\n//          - if bin_notify_off_datetime passed then:\n//              - save bin_notify = false in msg object @ msg.data.notify\n// 4. Check for offset_reached = true\n//      - if NOT passed bin_notify_off_datetime then:\n//          - save bin_notify = true in msg object @ msg.data.notify\n// 5. Return msg object on Output 1 if bin_notify = true\n//    and  Output 1 if bin_notify = false\n//    Msg object now conatins extra fields:\n//          - bin_colour @ msg.data.colour\n//          - bin_notify @ msg.data.notify\n// 6. Output 1 goes to a switch node to parse bin_colour and turn on lights\n// 7. Output 2 goes to a node to turn off lights.\n//--------------------------------------------------------------------\n\n// Note that global debug variable used to determine  if we output any of the debug text below.\n// Variable can be set at top of 'Useful Example Flows' tab\n\n\n\n// 1. Get Event details\n    var bin_event_name = msg.data.event.new_state.attributes.message;\n    var bin_event_offset_reached = msg.data.event.new_state.attributes.offset_reached;\n    var bin_event_started = msg.payload;\n    var bin_event_start_datetime = new Date( msg.data.event.new_state.attributes.start_time );\n\n    // Set initial variable to track notification status\n    var bin_notify = false\n    // Save this flag in msg data at msg.data.notify\n    msg.data[\"notify\"] = false;  \n\n    // ************** DEBUG (must come before 'returns') **************\n    if ( global.get('debug') == true ) {\n        node.warn(\"BINS - 1. Event Name: \" + bin_event_name );\n        node.warn(\"BINS - 1. Offset Reached: \" + bin_event_offset_reached );\n        node.warn(\"BINS - 1. Event Started: \" + bin_event_started );\n        node.warn(\"BINS - 1. Start DateTime: \" + bin_event_start_datetime );\n    }\n    // ****************************************************************\n\n//--------------------------------------------------------------------\n\n// 2. Parse Event Name for bin colour: bin_colour\n//        - save in msg object @ msg.data.colour\n\n    // Get first 4 characters of event name\n    var bin_event_name_subst = bin_event_name.substring(0, 4);\n    \n    // Check substring for colour match\n    if ( bin_event_name_subst == \"Blue\") {\n        var bin_colour=\"blue\";\n    } else if ( bin_event_name_subst == \"Brow\") {\n        var bin_colour=\"brown\";\n    } else if ( bin_event_name_subst == \"Grey\") {\n        var bin_colour=\"grey\";\n    } else if ( bin_event_name_subst == \"Green\") {\n        var bin_colour=\"green\";\n    } else if ( bin_event_name_subst == \"Test\") {\n        var bin_colour=\"test\";\n    }\n\n    // Add colour to event message details at msg.data.colour\n    msg.data[\"colour\"] = bin_colour;\n\n    // ************** DEBUG (must come before 'returns') **************\n    if ( global.get('debug') == true ) {\n        //node.warn(\"BINS - 2. Event Name Substring: \" + bin_event_name_subst );\n        node.warn(\"BINS - 2. bin_colour: \" + bin_colour );\n        //node.warn(\"BINS - 2. msg.data.colour: \" + msg.data.colour );\n    }\n    // ****************************************************************\n\n//--------------------------------------------------------------------\n\n// 3. Do datetime calcs \n//      - calc notification off datetime: bin_notify_off_datetime\n//      - now vs event start \n//          - if event started and passed bin_notify_off_datetime then:\n//              - save bin_notify = false in msg object @ msg.data.notify\n//          - if event started but NOT passed bin_notify_off_datetime then:\n//              - save bin_notify = true in msg object @ msg.data.notify\n//      - now vs notification off datetime\n//          - if bin_notify_off_datetime passed then:\n//              - save bin_notify = false in msg object @ msg.data.notify\n\n    var bin_now_datetime = new Date();    // var set to date/time now\n\n\n    // Calc notification end datetime = event start + 9 hrs\n    var bin_event_start_timestamp = bin_event_start_datetime.getTime();  //start time in unix epoch\n    var bin_notify_off_timestamp = bin_event_start_timestamp + (3600*3000); // Add 3 hours to get to 9am on bin day\n    var bin_notify_off_datetime = new Date(bin_notify_off_timestamp);\n\n\n    // Check current datetime against bin_event_start_timestamp\n    // If event start passed then check if light should be on i.e. notify if not yet passed\n    // Note: getTime() method returns a number that represents the milliseconds between the Unix epoch and the given date.\n    var bin_event_start_diff_mili = bin_now_datetime.getTime() - bin_notify_off_datetime.getTime();\n    var bin_event_start_diff_h = new Date(bin_event_start_diff_mili).getHours();\n    var bin_event_start_diff_m = new Date(bin_event_start_diff_mili).getMinutes();\n    var bin_event_start_diff_h = Number((bin_event_start_diff_h<10) ? '0' + bin_event_start_diff_h : bin_event_start_diff_h);\n    var bin_event_start_diff_m = Number((bin_event_start_diff_m<10) ? '0' + bin_event_start_diff_m : bin_event_start_diff_m);\n    var bin_event_start_diff_hm = bin_event_start_diff_h + ':' + bin_event_start_diff_m;\n\n    if ( bin_event_start_datetime <= bin_now_datetime ) {\n        //if ( global.get('debug') == true ) {\n        //    node.warn(\"BINS - Event Start Has Passed\");\n        //}\n        \n        // If event start passed then check if light should be on i.e. notify off not yet passed\n        if ( bin_notify_off_datetime <= bin_now_datetime ) {\n            //if ( global.get('debug') == true ) {\n            //    node.warn(\"BINS - Event Start Passed & Notify Off Passed - Turn Off Light!\");\n            //}\n            \n            // Set variable to track that notification should be off\n            bin_notify = false\n\n            // Save this flag in msg data at msg.data.notify\n            msg.data[\"notify\"] = false; \n\n        } else if ( bin_now_datetime < bin_notify_off_datetime ) {\n            //if ( global.get('debug') == true ) {\n            //    node.warn(\"BINS - Event Start Passed & Notify Off NOT Passed - Turn On Light!\");\n            //}\n            \n            // Set variable to track that notification should be on\n            bin_notify = true\n\n            // Save this flag in msg data at msg.data.notify\n            msg.data[\"notify\"] = true; \n        }\n\n    } else {\n        //if ( global.get('debug') == true ) {\n        //    node.warn(\"BINS - Event Starting in (HH:MM): \" + bin_event_start_diff_hm);\n        //}\n        \n    }\n\n\n    // ************** DEBUG (must come before 'returns') **************\n    if ( global.get('debug') == true ) {\n        node.warn(\"BINS - 3a. Current DateTime: \" + bin_now_datetime );\n        node.warn(\"BINS - 3a. Notification Off Date Time: \" + bin_notify_off_datetime );\n        node.warn(\"BINS - 3a. Event Start Difference (HH:MM): \" + bin_event_start_diff_hm );\n        node.warn(\"BINS - 3a. bin_notify: \" + bin_notify );\n        node.warn(\"BINS - 3a. msg.data.notify: \" + msg.data.notify );\n    }\n    // ****************************************************************\n\n\n    // Check current datetime against bin_notify_off_datetime\n    // If notify_off passed then turn off light\n    var bin_notify_off_diff_mili = bin_now_datetime.getTime() - bin_notify_off_datetime.getTime();\n    var bin_notify_off_diff_h = new Date(bin_notify_off_diff_mili).getHours();\n    var bin_notify_off_diff_m = new Date(bin_notify_off_diff_mili).getMinutes();\n    var bin_notify_off_diff_h = Number((bin_notify_off_diff_h<10) ? '0' + bin_notify_off_diff_h : bin_notify_off_diff_h);\n    var bin_notify_off_diff_m = Number((bin_notify_off_diff_m<10) ? '0' + bin_notify_off_diff_m : bin_notify_off_diff_m);\n    var bin_notify_off_diff_hm = bin_notify_off_diff_h + ':' + bin_notify_off_diff_m;\n\n    if ( bin_notify_off_datetime <= bin_now_datetime ) {\n\n        //node.warn(\"BINS - Turn off light!\");\n\n        // Set variable to track that notification should be off\n        bin_notify = false\n\n        // Save this flag in msg data at msg.data.notify\n        msg.data[\"notify\"] = false; \n\n    } else {\n        \n        //node.warn(\"BINS - Turn Off Light In (HH:MM): \" + bin_notify_off_diff_hm);\n\n    }\n\n    // ************** DEBUG (must come before 'returns') **************\n    if ( global.get('debug') == true ) {\n        node.warn(\"BINS - 3b. Notification Off Difference (HH:MM): \" + bin_notify_off_diff_hm );\n        node.warn(\"BINS - 3b. bin_notify: \" + bin_notify );\n        node.warn(\"BINS - 3b. msg.data.notify: \" + msg.data.notify );\n    }\n    // ****************************************************************\n\n//--------------------------------------------------------------------\n\n// 4. Check for offset_reached = true\n//      - if NOT passed bin_notify_off_datetime then:\n//          - save bin_notify = true in msg object @ msg.data.notify\n\nif ( bin_event_offset_reached == true ) {\n    if ( bin_now_datetime < bin_notify_off_datetime ) {\n    \n        // Set variable to track that notification should be on\n        bin_notify = true\n\n        // Save this flag in msg data at msg.data.notify\n        msg.data[\"notify\"] = true;  \n    \n    }\n\n}\n\n    // ************** DEBUG (must come before 'returns') **************\n    if ( global.get('debug') == true ) {\n        node.warn(\"BINS - 4. Offset Reached: \" + bin_event_offset_reached );\n        node.warn(\"BINS - 4. bin_notify: \" + bin_notify );\n        node.warn(\"BINS - 4. msg.data.notify: \" + msg.data.notify );\n    }\n    // ****************************************************************\n\n\n//--------------------------------------------------------------------\n\n// 5. Return msg object on Output 1 if bin_notify = true\n//    and  Output 1 if bin_notify = false\n//    Msg object now conatins extra fields:\n//          - bin_colour @ msg.data.colour\n//          - bin_notify @ msg.data.notify\n\nif ( bin_notify == true ) {\n    return [ msg, null ];\n} else if ( bin_notify == false ) {\n    return [ null, msg ];\n}\n\n\n\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":832,"y":2508,"wires":[["e97ce34e97f69a48","50b63aef416a1c93"],["9a4ba2ef754e4538","0b4009ebc3ec5007","9564e89e2ed6dd0e"]]},{"id":"50b63aef416a1c93","type":"switch","z":"c4865e43.cbd68","d":true,"g":"b6df7fdabfc8b853","name":"Do something based on bin colour (e.g. turn on light)","property":"data.colour","propertyType":"msg","rules":[{"t":"eq","v":"test","vt":"str"},{"t":"eq","v":"blue","vt":"str"},{"t":"eq","v":"brown","vt":"str"},{"t":"eq","v":"grey","vt":"str"},{"t":"eq","v":"green","vt":"str"}],"checkall":"true","repair":false,"outputs":5,"x":1366,"y":2448,"wires":[["6bd7fefe71d72485"],["1d27cfd70038b01d","a64389f70317cec8"],["1d27cfd70038b01d","fc4e70e48bafd945"],["1d27cfd70038b01d","3995a4f25f28f67e"],["f00f6fdbfee29eca"]]},{"id":"6bd7fefe71d72485","type":"debug","z":"c4865e43.cbd68","d":true,"g":"b6df7fdabfc8b853","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1516,"y":2364,"wires":[]},{"id":"1d27cfd70038b01d","type":"function","z":"c4865e43.cbd68","d":true,"g":"b6df7fdabfc8b853","name":"Set Notification Message","func":"message=\"Put Out Bin - \" + msg.data.colour;\nglobal.set('notification_msg',message);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1792,"y":2580,"wires":[["9bfd5366fa485550"]]},{"id":"9bfd5366fa485550","type":"link out","z":"c4865e43.cbd68","d":true,"g":"b6df7fdabfc8b853","name":"Front Door Motion","links":["4e0fb3de.b1482c"],"x":1973,"y":2580,"wires":[]},{"id":"e97ce34e97f69a48","type":"debug","z":"c4865e43.cbd68","d":true,"g":"b6df7fdabfc8b853","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1048,"y":2424,"wires":[]},{"id":"9a4ba2ef754e4538","type":"debug","z":"c4865e43.cbd68","d":true,"g":"b6df7fdabfc8b853","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1036,"y":2592,"wires":[]},{"id":"0b4009ebc3ec5007","type":"function","z":"c4865e43.cbd68","d":true,"g":"b6df7fdabfc8b853","name":"Set Notification Message","func":"message=\"Bin notification off!\";\nglobal.set('notification_msg',message);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1288,"y":2604,"wires":[["27ae56a638e8e3fa"]]},{"id":"27ae56a638e8e3fa","type":"link out","z":"c4865e43.cbd68","d":true,"g":"b6df7fdabfc8b853","name":"Front Door Motion","links":["4e0fb3de.b1482c"],"x":1493,"y":2592,"wires":[]},{"id":"a64389f70317cec8","type":"wled2","z":"c4865e43.cbd68","d":true,"g":"b6df7fdabfc8b853","address":"192.168.30.26","brightness":128,"delay":0,"color1":"#0048ff","color2":"#ffffff","color3":"#ffffff","effect":"28","effectIntensity":128,"effectSpeed":128,"name":"Bin Notification (D1-04) - Blue","palette":"2","preset":0,"state":"on","x":1846,"y":2400,"wires":[[]]},{"id":"fc4e70e48bafd945","type":"wled2","z":"c4865e43.cbd68","d":true,"g":"b6df7fdabfc8b853","address":"192.168.30.26","brightness":128,"delay":0,"color1":"#de7300","color2":"#ffffff","color3":"#ffffff","effect":"28","effectIntensity":128,"effectSpeed":128,"name":"Bin Notification (D1-04) - Brown","palette":"2","preset":0,"state":"on","x":1848,"y":2448,"wires":[[]]},{"id":"3995a4f25f28f67e","type":"wled2","z":"c4865e43.cbd68","d":true,"g":"b6df7fdabfc8b853","address":"192.168.30.26","brightness":128,"delay":0,"color1":"#c90079","color2":"#ffffff","color3":"#ffffff","effect":"28","effectIntensity":128,"effectSpeed":128,"name":"Bin Notification (D1-04) - Black","palette":"2","preset":0,"state":"on","x":1848,"y":2496,"wires":[[]]},{"id":"9564e89e2ed6dd0e","type":"wled2","z":"c4865e43.cbd68","d":true,"g":"b6df7fdabfc8b853","address":"192.168.30.26","brightness":128,"delay":0,"color1":"#c90079","color2":"#ffffff","color3":"#ffffff","effect":"28","effectIntensity":128,"effectSpeed":128,"name":"Bin Notification (D1-04) - OFF","palette":"0","preset":0,"state":"off","x":1356,"y":2700,"wires":[[]]},{"id":"d9407ba1fe4f54d5","type":"inject","z":"c4865e43.cbd68","d":true,"g":"b6df7fdabfc8b853","name":"Test","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":1684,"y":2328,"wires":[["a64389f70317cec8"]]},{"id":"7ebc44fcc6914571","type":"inject","z":"c4865e43.cbd68","d":true,"g":"b6df7fdabfc8b853","name":"Test","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":1924,"y":2328,"wires":[["3995a4f25f28f67e"]]},{"id":"2cd7c78743a59cf4","type":"inject","z":"c4865e43.cbd68","d":true,"g":"b6df7fdabfc8b853","name":"Test","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":1804,"y":2328,"wires":[["fc4e70e48bafd945"]]},{"id":"5251150565dfa639","type":"link in","z":"c4865e43.cbd68","d":true,"g":"b6df7fdabfc8b853","name":"Bin Notification Off","links":["34b1e16d64e3fb38","b830c76cadaceed7"],"x":1025,"y":2664,"wires":[["9564e89e2ed6dd0e"]]},{"id":"f00f6fdbfee29eca","type":"wled2","z":"c4865e43.cbd68","d":true,"g":"b6df7fdabfc8b853","address":"192.168.30.26","brightness":128,"delay":0,"color1":"#00ff00","color2":"#ffffff","color3":"#ffffff","effect":"28","effectIntensity":128,"effectSpeed":128,"name":"Bin Notification (D1-04) - Green","palette":"2","preset":0,"state":"on","x":1852,"y":2544,"wires":[[]]},{"id":"e43dbcc2b94bd081","type":"inject","z":"c4865e43.cbd68","d":true,"g":"b6df7fdabfc8b853","name":"Test","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":1884,"y":2676,"wires":[["f00f6fdbfee29eca"]]},{"id":"d04bbeb7e1ce89bd","type":"inject","z":"c4865e43.cbd68","d":true,"g":"b6df7fdabfc8b853","name":"off","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"off","payloadType":"str","x":318,"y":2628,"wires":[["5311e096a0e878c6"]]},{"id":"953908636faf1361","type":"alexa-local","z":"c4865e43.cbd68","d":true,"g":"b6df7fdabfc8b853","devicename":"Bin Notification","inputtrigger":true,"x":296,"y":2688,"wires":[["5311e096a0e878c6"]]},{"id":"5311e096a0e878c6","type":"switch","z":"c4865e43.cbd68","d":true,"g":"b6df7fdabfc8b853","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":542,"y":2700,"wires":[[],["9564e89e2ed6dd0e"]]},{"id":"5779b54785ec6009","type":"switch","z":"c4865e43.cbd68","d":true,"g":"39c3189beb448fe2","name":"","property":"payload.occupancy","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"false","repair":false,"outputs":2,"x":574,"y":204,"wires":[["9b8f0e57f880c054","eb1afbfb83d20c32","fec219da756d6c25"],["68bddd04e714bc5f","f766f46960a817a3"]]},{"id":"f5ab3b5fd890d312","type":"zigbee2mqtt-in","z":"c4865e43.cbd68","d":true,"g":"39c3189beb448fe2","name":"Sonoff Motion - Kids Toilet","server":"f0cc4845.3e9e28","friendly_name":"z2m_son_motion01_kids_toilet","device_id":"0x00124b0022683b4b","state":"0","outputAtStartup":true,"x":202,"y":204,"wires":[["77d315d60320408d","5779b54785ec6009"]]},{"id":"0c0c3b870936dcbf","type":"mqtt out","z":"c4865e43.cbd68","d":true,"g":"39c3189beb448fe2","name":"","topic":"","qos":"2","retain":"true","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"e96cb00d.af953","x":1642,"y":192,"wires":[]},{"id":"97e960baf71fb147","type":"debug","z":"c4865e43.cbd68","d":true,"g":"39c3189beb448fe2","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1546,"y":228,"wires":[]},{"id":"29ee8b7e8c47b369","type":"debug","z":"c4865e43.cbd68","d":true,"g":"39c3189beb448fe2","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1402,"y":96,"wires":[]},{"id":"9b8f0e57f880c054","type":"debug","z":"c4865e43.cbd68","d":true,"g":"39c3189beb448fe2","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":634,"y":156,"wires":[]},{"id":"77d315d60320408d","type":"debug","z":"c4865e43.cbd68","d":true,"g":"39c3189beb448fe2","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":262,"y":252,"wires":[]},{"id":"68bddd04e714bc5f","type":"debug","z":"c4865e43.cbd68","d":true,"g":"39c3189beb448fe2","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":634,"y":252,"wires":[]},{"id":"f766f46960a817a3","type":"trigger","z":"c4865e43.cbd68","d":true,"g":"39c3189beb448fe2","name":"","op1":"","op2":"off","op1type":"nul","op2type":"str","duration":"30","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":906,"y":276,"wires":[["d80416ceed793161","9d6cc1a2d088a627"]]},{"id":"4f0d07214b07064d","type":"debug","z":"c4865e43.cbd68","d":true,"g":"39c3189beb448fe2","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":934,"y":180,"wires":[]},{"id":"8d34614d416605fc","type":"change","z":"c4865e43.cbd68","d":true,"g":"39c3189beb448fe2","name":"Set msg.topic = MQTT topic","rules":[{"t":"set","p":"topic","pt":"msg","to":"shellies/shelly1pm-kids-toilet/relay/0/command","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1448,"y":192,"wires":[["97e960baf71fb147","0c0c3b870936dcbf"]]},{"id":"2c542c2bb7a26291","type":"change","z":"c4865e43.cbd68","d":true,"g":"39c3189beb448fe2","name":"Set msg.payload=on","rules":[{"t":"set","p":"payload","pt":"msg","to":"on","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1192,"y":132,"wires":[["29ee8b7e8c47b369","8d34614d416605fc"]]},{"id":"d80416ceed793161","type":"change","z":"c4865e43.cbd68","d":true,"g":"39c3189beb448fe2","name":"Set msg.payload=off","rules":[{"t":"set","p":"payload","pt":"msg","to":"off","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1128,"y":276,"wires":[["8d34614d416605fc","31112b097b139258"]]},{"id":"eb1afbfb83d20c32","type":"change","z":"c4865e43.cbd68","d":true,"g":"39c3189beb448fe2","name":"Set payload - cancel off timer","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":908,"y":144,"wires":[["f766f46960a817a3","4f0d07214b07064d"]]},{"id":"c22daa9632fbf86b","type":"inject","z":"c4865e43.cbd68","d":true,"g":"39c3189beb448fe2","name":"Occupancy = false","props":[{"p":"payload.occupancy","v":"false","vt":"bool"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":422,"y":132,"wires":[["5779b54785ec6009"]]},{"id":"7b3c91b17547963a","type":"inject","z":"c4865e43.cbd68","d":true,"g":"39c3189beb448fe2","name":"Occupancy = true","props":[{"p":"payload.occupancy","v":"true","vt":"bool"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":422,"y":96,"wires":[["5779b54785ec6009"]]},{"id":"9d6cc1a2d088a627","type":"debug","z":"c4865e43.cbd68","d":true,"g":"39c3189beb448fe2","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":982,"y":240,"wires":[]},{"id":"31112b097b139258","type":"debug","z":"c4865e43.cbd68","d":true,"g":"39c3189beb448fe2","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1246,"y":312,"wires":[]},{"id":"fec219da756d6c25","type":"time-range-switch","z":"c4865e43.cbd68","d":true,"g":"39c3189beb448fe2","name":"Night time?","lat":"55.8938","lon":"-3.6232","startTime":"sunsetStart","endTime":"sunriseEnd","startOffset":"-20","endOffset":"20","x":870,"y":96,"wires":[["2c542c2bb7a26291"],[]]},{"id":"08ccf5d43ba39f06","type":"inject","z":"c4865e43.cbd68","d":true,"g":"39c3189beb448fe2","name":"off","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"off","payloadType":"str","x":850,"y":312,"wires":[["d80416ceed793161"]]},{"id":"866bc4aaefe9360e","type":"inject","z":"c4865e43.cbd68","d":true,"g":"39c3189beb448fe2","name":"On","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":1030,"y":72,"wires":[["2c542c2bb7a26291"]]}]