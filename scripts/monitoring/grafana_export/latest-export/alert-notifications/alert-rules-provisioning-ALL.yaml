apiVersion: 1
groups:
    - orgId: 1
      name: Evaluated every 1 hour
      folder: Alerts
      interval: 1h
      rules:
        - uid: f4da532e-a169-40de-8c27-ccc2c413f794
          title: Folder Size Changes
          condition: A
          data:
            - refId: ChangePercent
              relativeTimeRange:
                from: 114269
                to: -104725
              datasourceUid: P4169E866C3094E38
              model:
                datasource:
                    type: prometheus
                    uid: P4169E866C3094E38
                disableTextWrap: false
                editorMode: code
                expr: max by(directory, host_system) (delta(directory_size_bytes[24h])) / (min(directory_size_bytes) by (host_system,directory))
                format: time_series
                fullMetaSearch: false
                includeNullMetadata: true
                instant: false
                interval: ""
                intervalFactor: 1
                intervalMs: 15000
                legendFormat: '{{host_system}}-{{directory}}'
                maxDataPoints: 43200
                range: true
                refId: ChangePercent
                useBackend: false
            - refId: ChangeAbs
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: P4169E866C3094E38
              model:
                datasource:
                    type: prometheus
                    uid: P4169E866C3094E38
                editorMode: code
                expr: max by(directory, host_system) (delta(directory_size_bytes[24h]))
                instant: true
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: ChangeAbs
            - refId: Percent
              relativeTimeRange:
                from: 114269
                to: -104725
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params: []
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - A
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: ChangePercent
                intervalMs: 1000
                maxDataPoints: 43200
                reducer: last
                refId: Percent
                settings:
                    mode: dropNN
                type: reduce
            - refId: A
              relativeTimeRange:
                from: 114269
                to: -104725
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 0.1
                            - 0
                        type: gt
                      operator:
                        type: and
                      query:
                        params: []
                      reducer:
                        params: []
                        type: avg
                      type: query
                datasource:
                    name: Expression
                    type: __expr__
                    uid: __expr__
                expression: ChangePercent
                intervalMs: 1000
                maxDataPoints: 43200
                refId: A
                type: threshold
          dashboardUid: da7bd295-47a6-4b76-aefb-0e26fecbc1f8
          panelId: 122
          noDataState: OK
          execErrState: OK
          for: 1h
          annotations:
            __dashboardUid__: da7bd295-47a6-4b76-aefb-0e26fecbc1f8
            __panelId__: "122"
            description: |-
                Monitor folder sizes in case they unexpectedly increase dramatically.
                Host: {{ $labels.host_system }}
                Directory: {{ $labels.directory }}
            summary: Folder {{ $labels.directory }} (on {{ $labels.host_system }}) size increased significantly in last 24 hours.
          labels: {}
          isPaused: false
    - orgId: 1
      name: Evaluated every 1 min
      folder: Alerts
      interval: 1m
      rules:
        - uid: b511643b-ad50-431d-8f1c-67afa0d2128c
          title: System Load on Gerald
          condition: LoadPerCoreThreshold
          data:
            - refId: Load
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: P4169E866C3094E38
              model:
                datasource:
                    type: prometheus
                    uid: P4169E866C3094E38
                editorMode: code
                expr: avg_over_time(node_load1{host_system="gerald"}[$__rate_interval]) * 100 / on(instance) group_left sum by (instance)(irate(node_cpu_seconds_total{host_system="gerald"}[$__rate_interval]))
                instant: true
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: Load
            - refId: Cores
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: P4169E866C3094E38
              model:
                datasource:
                    type: prometheus
                    uid: P4169E866C3094E38
                editorMode: code
                expr: count(count(node_cpu_seconds_total{host_system="gerald"}) by (cpu))
                instant: true
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: Cores
            - refId: RawLoadThreshold
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 95
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - E
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: Load
                intervalMs: 1000
                maxDataPoints: 43200
                refId: RawLoadThreshold
                type: threshold
            - refId: LoadPerCore
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 0
                            - 0
                        type: gt
                      operator:
                        type: and
                      query:
                        params: []
                      reducer:
                        params: []
                        type: avg
                      type: query
                datasource:
                    name: Expression
                    type: __expr__
                    uid: __expr__
                expression: $Load / $Cores
                intervalMs: 1000
                maxDataPoints: 43200
                refId: LoadPerCore
                type: math
            - refId: LoadPerCoreThreshold
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 80
                            - 0
                        type: gt
                      operator:
                        type: and
                      query:
                        params: []
                      reducer:
                        params: []
                        type: avg
                      type: query
                datasource:
                    name: Expression
                    type: __expr__
                    uid: __expr__
                expression: LoadPerCore
                intervalMs: 1000
                maxDataPoints: 43200
                refId: LoadPerCoreThreshold
                type: threshold
          dashboardUid: a13b0560-dd0c-4620-a56b-d0d4ffdcd963
          panelId: 324
          noDataState: Alerting
          execErrState: OK
          for: 3m
          annotations:
            __dashboardUid__: a13b0560-dd0c-4620-a56b-d0d4ffdcd963
            __panelId__: "324"
            description: System load exceeds defined threshold.
            summary: System Load on Gerald (main Proxmox host) exceeds threshold.
          labels:
            emergency: "true"
            webhook-nodered: "true"
          isPaused: false
        - uid: aexqxvyr497uod
          title: System Load on Becky
          condition: LoadPerCoreThreshold
          data:
            - refId: Load
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: P4169E866C3094E38
              model:
                datasource:
                    type: prometheus
                    uid: P4169E866C3094E38
                editorMode: code
                expr: avg_over_time(node_load1{host_system="becky"}[$__rate_interval]) * 100 / on(instance) group_left sum by (instance)(irate(node_cpu_seconds_total{host_system="becky"}[$__rate_interval]))
                instant: true
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: Load
            - refId: Cores
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: P4169E866C3094E38
              model:
                datasource:
                    type: prometheus
                    uid: P4169E866C3094E38
                editorMode: code
                expr: count(count(node_cpu_seconds_total{host_system="becky"}) by (cpu))
                instant: true
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: Cores
            - refId: RawLoadThreshold
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 95
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - E
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: Load
                intervalMs: 1000
                maxDataPoints: 43200
                refId: RawLoadThreshold
                type: threshold
            - refId: LoadPerCore
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 0
                            - 0
                        type: gt
                      operator:
                        type: and
                      query:
                        params: []
                      reducer:
                        params: []
                        type: avg
                      type: query
                datasource:
                    name: Expression
                    type: __expr__
                    uid: __expr__
                expression: $Load / $Cores
                intervalMs: 1000
                maxDataPoints: 43200
                refId: LoadPerCore
                type: math
            - refId: LoadPerCoreThreshold
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 80
                            - 0
                        type: gt
                      operator:
                        type: and
                      query:
                        params: []
                      reducer:
                        params: []
                        type: avg
                      type: query
                datasource:
                    name: Expression
                    type: __expr__
                    uid: __expr__
                expression: LoadPerCore
                intervalMs: 1000
                maxDataPoints: 43200
                refId: LoadPerCoreThreshold
                type: threshold
          dashboardUid: a13b0560-dd0c-4620-a56b-d0d4ffdcd963
          panelId: 324
          noDataState: Alerting
          execErrState: OK
          for: 3m
          annotations:
            __dashboardUid__: a13b0560-dd0c-4620-a56b-d0d4ffdcd963
            __panelId__: "324"
            description: System load exceeds defined threshold.
            summary: System Load on Becky (Proxmox host) exceeds threshold.
          labels:
            emergency: "true"
            webhook-nodered: "true"
          isPaused: false
        - uid: b26ae16a-9ee2-4d2e-a91a-a401da17011b
          title: System Load on crush
          condition: LoadPerCoreThreshold
          data:
            - refId: Load
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: P4169E866C3094E38
              model:
                datasource:
                    type: prometheus
                    uid: P4169E866C3094E38
                editorMode: code
                expr: avg_over_time(node_load1{host_system="crush"}[$__rate_interval]) * 100 / on(instance) group_left sum by (instance)(irate(node_cpu_seconds_total{host_system="crush"}[$__rate_interval]))
                instant: true
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: Load
            - refId: Cores
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: P4169E866C3094E38
              model:
                datasource:
                    type: prometheus
                    uid: P4169E866C3094E38
                editorMode: code
                expr: count(count(node_cpu_seconds_total{host_system="crush"}) by (cpu))
                instant: true
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: Cores
            - refId: RawLoadThreshold
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 110
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - E
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: Load
                intervalMs: 1000
                maxDataPoints: 43200
                refId: RawLoadThreshold
                type: threshold
            - refId: LoadPerCore
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 0
                            - 0
                        type: gt
                      operator:
                        type: and
                      query:
                        params: []
                      reducer:
                        params: []
                        type: avg
                      type: query
                datasource:
                    name: Expression
                    type: __expr__
                    uid: __expr__
                expression: $Load / $Cores
                intervalMs: 1000
                maxDataPoints: 43200
                refId: LoadPerCore
                type: math
            - refId: LoadPerCoreThreshold
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 75
                            - 0
                        type: gt
                      operator:
                        type: and
                      query:
                        params: []
                      reducer:
                        params: []
                        type: avg
                      type: query
                datasource:
                    name: Expression
                    type: __expr__
                    uid: __expr__
                expression: LoadPerCore
                intervalMs: 1000
                maxDataPoints: 43200
                refId: LoadPerCoreThreshold
                type: threshold
          dashboardUid: a13b0560-dd0c-4620-a56b-d0d4ffdcd963
          panelId: 324
          noDataState: Alerting
          execErrState: OK
          for: 3m
          annotations:
            __dashboardUid__: a13b0560-dd0c-4620-a56b-d0d4ffdcd963
            __panelId__: "324"
            description: System load exceeds defined threshold.
            summary: System Load on crush exceeds threshold.
          labels:
            webhook-nodered: "true"
          isPaused: false
        - uid: f31e7fba-e124-44e4-aee7-3518738d3038
          title: Host System Memory (Basic)
          condition: Threshold-Mem-Calc
          data:
            - refId: Used-Available-Perc
              relativeTimeRange:
                from: 86400
                to: 0
              datasourceUid: P4169E866C3094E38
              model:
                datasource:
                    type: prometheus
                    uid: P4169E866C3094E38
                disableTextWrap: false
                editorMode: code
                expr: 100 - ((avg_over_time(node_memory_MemAvailable_bytes[$__rate_interval]) * 100) / avg_over_time(node_memory_MemTotal_bytes[$__rate_interval]))
                format: time_series
                fullMetaSearch: false
                includeNullMetadata: true
                instant: true
                interval: ""
                intervalFactor: 1
                intervalMs: 15000
                legendFormat: RAM Total
                maxDataPoints: 43200
                range: false
                refId: Used-Available-Perc
                step: 240
                useBackend: false
            - refId: Used-Mem-Perc
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: P4169E866C3094E38
              model:
                datasource:
                    type: prometheus
                    uid: P4169E866C3094E38
                editorMode: code
                expr: (node_memory_MemTotal_bytes - node_memory_MemFree_bytes - node_memory_Cached_bytes - node_memory_Buffers_bytes - node_memory_SReclaimable_bytes) / node_memory_MemTotal_bytes * 100
                instant: true
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: Used-Mem-Perc
            - refId: Threshold-Avail-Calc
              relativeTimeRange:
                from: 86400
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 95
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - G
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: Used-Available-Perc
                intervalMs: 1000
                maxDataPoints: 43200
                refId: Threshold-Avail-Calc
                type: threshold
            - refId: Threshold-Mem-Calc
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 90
                            - 0
                        type: gt
                      operator:
                        type: and
                      query:
                        params: []
                      reducer:
                        params: []
                        type: avg
                      type: query
                datasource:
                    name: Expression
                    type: __expr__
                    uid: __expr__
                expression: Used-Mem-Perc
                intervalMs: 1000
                maxDataPoints: 43200
                refId: Threshold-Mem-Calc
                type: threshold
          dashboardUid: a13b0560-dd0c-4620-a56b-d0d4ffdcd963
          panelId: 78
          noDataState: OK
          execErrState: OK
          for: 3m
          annotations:
            __dashboardUid__: a13b0560-dd0c-4620-a56b-d0d4ffdcd963
            __panelId__: "78"
            description: |-
                RAM usage of host system (or VM/LXC) exceeds defined threshold in alart.
                Host: {{ $labels.host_system }}
                IP Address: {{ $labels.instance}}
            summary: System RAM usage exceeds defined threshold - {{ $labels.host_system }}
          isPaused: false
        - uid: dffe12f2-aa95-4ebd-8e74-04782c4030fb
          title: Hardware temperature monitor
          condition: AboveThreshold
          data:
            - refId: Temp
              relativeTimeRange:
                from: 86400
                to: 0
              datasourceUid: P4169E866C3094E38
              model:
                datasource:
                    type: prometheus
                    uid: P4169E866C3094E38
                editorMode: code
                expr: sum by (host_system,chip,sensor) (node_hwmon_temp_celsius{sensor!~".*crit.*|.*Crit.*"})
                format: time_series
                instant: true
                interval: ""
                intervalFactor: 1
                intervalMs: 15000
                legendFormat: '{{ chip }} {{ sensor }} temp'
                maxDataPoints: 43200
                range: false
                refId: Temp
                step: 240
            - refId: LastMeasure
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params: []
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - F
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: Temp
                intervalMs: 1000
                maxDataPoints: 43200
                reducer: last
                refId: LastMeasure
                type: reduce
            - refId: AboveThreshold
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 90
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - G
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: LastMeasure
                intervalMs: 1000
                maxDataPoints: 43200
                refId: AboveThreshold
                type: threshold
          dashboardUid: a13b0560-dd0c-4620-a56b-d0d4ffdcd963
          panelId: 158
          noDataState: OK
          execErrState: OK
          for: 5m
          annotations:
            __dashboardUid__: a13b0560-dd0c-4620-a56b-d0d4ffdcd963
            __panelId__: "158"
            description: |-
                System temperature sensor exceeds defined threshold.
                • Host: {{ $labels.host_system }}
                • Sensor: {{ $labels.chip }}
            summary: Temperature exceeds defined threshold on {{ $labels.host_system }}
          isPaused: false
        - uid: f6c66bd6-98b5-4156-a573-5f9ae521a69f
          title: Container Down Detection
          condition: C
          data:
            - refId: A
              relativeTimeRange:
                from: 1800
                to: 0
              datasourceUid: P4169E866C3094E38
              model:
                datasource:
                    type: prometheus
                    uid: P4169E866C3094E38
                editorMode: code
                expr: (time() - sum by (host_system,name) (last_over_time(container_last_seen{name!="",name!~"guac.*"}[10m])))
                instant: false
                interval: ""
                intervalMs: 15000
                legendFormat: '{{host_name}} - {{name}}'
                maxDataPoints: 43200
                range: true
                refId: A
            - refId: B
              relativeTimeRange:
                from: 1800
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params: []
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - B
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: A
                intervalMs: 1000
                maxDataPoints: 43200
                reducer: last
                refId: B
                type: reduce
            - refId: C
              relativeTimeRange:
                from: 1800
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 300
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - C
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: B
                intervalMs: 1000
                maxDataPoints: 43200
                refId: C
                type: threshold
          dashboardUid: ee4759ca-2b5e-4697-98cc-01a388fc64f0
          panelId: 730
          noDataState: NoData
          execErrState: Error
          for: 1m
          annotations:
            __dashboardUid__: ee4759ca-2b5e-4697-98cc-01a388fc64f0
            __panelId__: "730"
            description: |-
                Container down
                (Guacamole/guacd excluded from monitoring due to false alerts)
            summary: Container down!
          isPaused: true
        - uid: f8bafd32-8e1a-4769-8a11-337fabc89aca
          title: System Load on Gerald (old version)
          condition: E
          data:
            - refId: A
              relativeTimeRange:
                from: 86400
                to: 0
              datasourceUid: P4169E866C3094E38
              model:
                datasource:
                    type: prometheus
                    uid: P4169E866C3094E38
                editorMode: code
                expr: avg_over_time(node_load1{host_system="gerald"}[1m]) / count(count(node_cpu_seconds_total{host_system="crush"}) by (cpu))
                instant: false
                interval: ""
                intervalMs: 15000
                legendFormat: Load - 1m
                maxDataPoints: 43200
                range: true
                refId: A
            - refId: D
              relativeTimeRange:
                from: 86400
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params: []
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - D
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: A
                intervalMs: 1000
                maxDataPoints: 43200
                reducer: last
                refId: D
                type: reduce
            - refId: E
              relativeTimeRange:
                from: 86400
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 1
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - E
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: D
                intervalMs: 1000
                maxDataPoints: 43200
                refId: E
                type: threshold
          dashboardUid: a13b0560-dd0c-4620-a56b-d0d4ffdcd963
          panelId: 324
          noDataState: OK
          execErrState: OK
          for: 1m
          annotations:
            __dashboardUid__: a13b0560-dd0c-4620-a56b-d0d4ffdcd963
            __panelId__: "324"
            description: System load exceeds defined threshold.
            summary: System Load on Gerald (main Proxmox host) exceeds threshold.
          labels:
            webhook-nodered: "true"
          isPaused: true
        - uid: a277b280-ffde-4f1a-95c9-7f900ed8f175
          title: System Load on Crush (old version)
          condition: E
          data:
            - refId: A
              relativeTimeRange:
                from: 86400
                to: 0
              datasourceUid: P4169E866C3094E38
              model:
                datasource:
                    type: prometheus
                    uid: P4169E866C3094E38
                editorMode: code
                expr: avg_over_time(node_load1{host_system="crush"}[1m]) / count(count(node_cpu_seconds_total{host_system="crush"}) by (cpu))
                instant: false
                interval: ""
                intervalMs: 15000
                legendFormat: Load - 1m
                maxDataPoints: 43200
                range: true
                refId: A
            - refId: B
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: P4169E866C3094E38
              model:
                datasource:
                    type: prometheus
                    uid: P4169E866C3094E38
                editorMode: code
                expr: ""
                instant: true
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: B
            - refId: D
              relativeTimeRange:
                from: 86400
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params: []
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - D
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: A
                intervalMs: 1000
                maxDataPoints: 43200
                reducer: last
                refId: D
                type: reduce
            - refId: E
              relativeTimeRange:
                from: 86400
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 1
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - E
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: D
                intervalMs: 1000
                maxDataPoints: 43200
                refId: E
                type: threshold
          dashboardUid: a13b0560-dd0c-4620-a56b-d0d4ffdcd963
          panelId: 324
          noDataState: OK
          execErrState: OK
          for: 1m
          annotations:
            __dashboardUid__: a13b0560-dd0c-4620-a56b-d0d4ffdcd963
            __panelId__: "324"
            description: System load exceeds defined threshold.
            summary: System Load on Crush exceeds threshold.
          isPaused: true
    - orgId: 1
      name: Evaluated every 5 min
      folder: Alerts
      interval: 5m
      rules:
        - uid: f55c232f-b019-41b2-8c63-2b9d10965f69
          title: Cluster Node Status
          condition: C
          data:
            - refId: A
              relativeTimeRange:
                from: 300
                to: 0
              datasourceUid: P4169E866C3094E38
              model:
                datasource:
                    type: prometheus
                    uid: P4169E866C3094E38
                editorMode: code
                expr: pve_up{id=~"node.*",id!~".*pve-test.*"}
                instant: false
                interval: ""
                intervalMs: 15000
                legendFormat: '{{id}}'
                maxDataPoints: 43200
                range: true
                refId: A
            - refId: B
              relativeTimeRange:
                from: 300
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params: []
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - B
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: A
                intervalMs: 1000
                maxDataPoints: 43200
                reducer: last
                refId: B
                settings:
                    mode: ""
                type: reduce
            - refId: C
              relativeTimeRange:
                from: 300
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 1
                        type: lt
                      operator:
                        type: and
                      query:
                        params:
                            - C
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: B
                intervalMs: 1000
                maxDataPoints: 43200
                refId: C
                type: threshold
          dashboardUid: b88c0ae7-ec18-4bda-8314-05a487f44508
          panelId: 27
          noDataState: Alerting
          execErrState: Alerting
          for: 5m
          annotations:
            __dashboardUid__: b88c0ae7-ec18-4bda-8314-05a487f44508
            __panelId__: "27"
            description: |-
                Monitor 'up' state of Proxmox nodes.
                • ID: {{ $labels.id }}
            summary: '{{ $labels.id }} Proxmox node is not reporting up'
          labels:
            webhook-nodered: "true"
          isPaused: false
        - uid: e040d958-a06d-4c38-b0a1-b016cfdb4796
          title: Container RAM (Working Set) Absolute Size [excl. Minecraft]
          condition: D
          data:
            - refId: B
              relativeTimeRange:
                from: 86400
                to: 0
              datasourceUid: P4169E866C3094E38
              model:
                datasource:
                    type: prometheus
                    uid: P4169E866C3094E38
                editorMode: code
                exemplar: true
                expr: sum by (host_system,name) (container_memory_working_set_bytes{host_system!="minecraft",name=~".+",name!~""})
                format: time_series
                instant: false
                interval: ""
                intervalFactor: 1
                intervalMs: 15000
                legendFormat: '{{host_system}} - {{ name }}'
                maxDataPoints: 43200
                metric: container_cpu_user_seconds_total
                range: false
                refId: B
                step: 10
            - refId: A
              relativeTimeRange:
                from: 86400
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params: []
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - A
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: B
                intervalMs: 1000
                maxDataPoints: 43200
                reducer: last
                refId: A
                settings:
                    mode: dropNN
                type: reduce
            - refId: D
              relativeTimeRange:
                from: 86400
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 2e+09
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - D
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: A
                intervalMs: 1000
                maxDataPoints: 43200
                refId: D
                type: threshold
          dashboardUid: ee4759ca-2b5e-4697-98cc-01a388fc64f0
          panelId: 693
          noDataState: OK
          execErrState: OK
          for: 5m
          annotations:
            __dashboardUid__: ee4759ca-2b5e-4697-98cc-01a388fc64f0
            __panelId__: "693"
            description: |-
                Container 'working set' (non-evictable) RAM use exceeds threshold set for monitoring (minecraft containers are excluded from analysis).
                • Host: {{ $labels.host_system }}
                • Container: {{ $labels.name }}
            summary: Container RAM use exceeds defined threshold - {{ $labels.name }} on {{ $labels.host_system }}
          labels:
            webhook-nodered: "true"
          isPaused: false
        - uid: aexqzjrpwnf28c
          title: Container RAM 100% Memory Limit
          condition: D
          data:
            - refId: B
              relativeTimeRange:
                from: 86400
                to: 0
              datasourceUid: P4169E866C3094E38
              model:
                datasource:
                    type: prometheus
                    uid: P4169E866C3094E38
                editorMode: code
                exemplar: true
                expr: sum(container_memory_working_set_bytes{name!~""}) by (host_system,name) / sum(container_spec_memory_limit_bytes{name!~""}) by (host_system,name) < 1
                format: time_series
                instant: false
                interval: ""
                intervalFactor: 1
                intervalMs: 15000
                legendFormat: '{{host_system}} - {{ name }}'
                maxDataPoints: 43200
                metric: container_cpu_user_seconds_total
                range: false
                refId: B
                step: 10
            - refId: A
              relativeTimeRange:
                from: 86400
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params: []
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - A
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: B
                intervalMs: 1000
                maxDataPoints: 43200
                reducer: last
                refId: A
                settings:
                    mode: dropNN
                type: reduce
            - refId: D
              relativeTimeRange:
                from: 86400
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 0.95
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - D
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: A
                intervalMs: 1000
                maxDataPoints: 43200
                refId: D
                type: threshold
          dashboardUid: ee4759ca-2b5e-4697-98cc-01a388fc64f0
          panelId: 693
          noDataState: Alerting
          execErrState: OK
          for: 5m
          annotations:
            __dashboardUid__: ee4759ca-2b5e-4697-98cc-01a388fc64f0
            __panelId__: "693"
            description: |-
                Container 'working set' (non-evictable) RAM using all of assigned memory limit.
                • Host: {{ $labels.host_system }}
                • Container: {{ $labels.name }}
            summary: Container RAM using all of assigned memory limit - {{ $labels.name }} on {{ $labels.host_system }}
          labels:
            webhook-nodered: "true"
          isPaused: false
        - uid: f07289e1-1b50-4026-9522-9037fc39c05d
          title: Container FS Usage
          condition: D
          data:
            - refId: A
              relativeTimeRange:
                from: 86400
                to: 0
              datasourceUid: P4169E866C3094E38
              model:
                datasource:
                    type: prometheus
                    uid: P4169E866C3094E38
                editorMode: code
                exemplar: true
                expr: sum by (host_system,name) (container_fs_usage_bytes{name=~".+"})
                format: time_series
                instant: false
                interval: ""
                intervalFactor: 1
                intervalMs: 15000
                legendFormat: '{{host_system}} - {{name}} ({{device}})'
                maxDataPoints: 43200
                metric: container_cpu_user_seconds_total
                range: true
                refId: A
                step: 10
            - refId: C
              relativeTimeRange:
                from: 86400
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params: []
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - C
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: A
                intervalMs: 1000
                maxDataPoints: 43200
                reducer: last
                refId: C
                type: reduce
            - refId: D
              relativeTimeRange:
                from: 86400
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 3e+09
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - D
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: C
                intervalMs: 1000
                maxDataPoints: 43200
                refId: D
                type: threshold
          dashboardUid: ee4759ca-2b5e-4697-98cc-01a388fc64f0
          panelId: 21
          noDataState: NoData
          execErrState: Error
          for: 5m
          annotations:
            __dashboardUid__: ee4759ca-2b5e-4697-98cc-01a388fc64f0
            __panelId__: "21"
            description: |-
                Container disk space usage exceeds defined threshold.
                • Host: {{ $labels.host_system }}
                • Container: {{ $labels.name }}
            summary: Container Disk use exceeds threshold - {{ $labels.name }} on {{ $labels.host_system }}
          isPaused: false
        - uid: e07aeb67-e3b2-44c9-b9e3-eaa8e0e8fc69
          title: Proxmox Guest CPU Usage
          condition: C
          data:
            - refId: A
              relativeTimeRange:
                from: 300
                to: 0
              datasourceUid: P4169E866C3094E38
              model:
                datasource:
                    type: prometheus
                    uid: P4169E866C3094E38
                editorMode: code
                expr: ((pve_cpu_usage_ratio / pve_cpu_usage_limit) * on(id, instance) group_left(name, type) pve_guest_info) and on(id, instance) pve_up == 1
                format: time_series
                instant: true
                interval: ""
                intervalFactor: 4
                intervalMs: 15000
                legendFormat: '{{name}} ({{type}})'
                maxDataPoints: 43200
                range: false
                refId: A
            - refId: B
              relativeTimeRange:
                from: 300
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params: []
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - B
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: A
                intervalMs: 1000
                maxDataPoints: 43200
                reducer: last
                refId: B
                type: reduce
            - refId: C
              relativeTimeRange:
                from: 300
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 1
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - C
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: B
                intervalMs: 1000
                maxDataPoints: 43200
                refId: C
                type: threshold
          dashboardUid: b88c0ae7-ec18-4bda-8314-05a487f44508
          panelId: 2
          noDataState: OK
          execErrState: OK
          for: 5m
          annotations:
            __dashboardUid__: b88c0ae7-ec18-4bda-8314-05a487f44508
            __panelId__: "2"
            description: |-
                Proxmox guest CPU usage is high - review guest resources and adjust allocated core count if required.
                • Host: {{ $labels.host_system }}
                • ID: {{ $labels.id }}
                • Name: {{ $labels.name }}
            summary: Proxmox guest CPU usage critical - {{ $labels.name }} ({{ $labels.id }}) on {{ $labels.host_system }}
          isPaused: false
        - uid: cb4e9a30-d6be-4007-995e-c3464e391f33
          title: Guests memory usage
          condition: C
          data:
            - refId: A
              relativeTimeRange:
                from: 300
                to: 0
              datasourceUid: P4169E866C3094E38
              model:
                datasource:
                    type: prometheus
                    uid: P4169E866C3094E38
                editorMode: code
                expr: (pve_memory_usage_bytes / pve_memory_size_bytes * on(id, instance) group_left(name, type) pve_guest_info) and on(id, instance) pve_up == 1
                format: time_series
                instant: true
                interval: ""
                intervalFactor: 4
                intervalMs: 15000
                legendFormat: '{{name}} ({{type}})'
                maxDataPoints: 43200
                range: false
                refId: A
            - refId: B
              relativeTimeRange:
                from: 300
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params: []
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - B
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: A
                intervalMs: 1000
                maxDataPoints: 43200
                reducer: last
                refId: B
                type: reduce
            - refId: C
              relativeTimeRange:
                from: 300
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 0.95
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - C
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: B
                intervalMs: 1000
                maxDataPoints: 43200
                refId: C
                type: threshold
          dashboardUid: b88c0ae7-ec18-4bda-8314-05a487f44508
          panelId: 5
          noDataState: OK
          execErrState: OK
          for: 5m
          annotations:
            __dashboardUid__: b88c0ae7-ec18-4bda-8314-05a487f44508
            __panelId__: "5"
            description: |-
                Proxmox guest RAM use is high - review Proxmox memory allocation and adjust if required.
                • Host: {{ $labels.host_system }}
                • ID: {{ $labels.id }}
                • Name: {{ $labels.name }}
            summary: Proxmox guest RAM usage critical - {{ $labels.name }} ({{ $labels.id }}) on {{ $labels.host_system }}
          isPaused: false
        - uid: f7eb78b5-888e-4a42-9ffe-e84e83ad6bfa
          title: Disk Space Used
          condition: Threshold
          data:
            - refId: UsedPercent
              relativeTimeRange:
                from: 86400
                to: 0
              datasourceUid: P4169E866C3094E38
              model:
                datasource:
                    type: prometheus
                    uid: P4169E866C3094E38
                editorMode: code
                expr: 100 - ((node_filesystem_avail_bytes{device=~'/dev/.*',mountpoint!~'.*parity.*'} * 100) / node_filesystem_size_bytes{device=~'/dev/.*',mountpoint!~'.*parity.*'})
                format: time_series
                instant: false
                interval: ""
                intervalFactor: 1
                intervalMs: 15000
                legendFormat: '{{device}} : {{mountpoint}}'
                maxDataPoints: 43200
                range: true
                refId: UsedPercent
                step: 240
            - refId: LastPercent
              relativeTimeRange:
                from: 86400
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params: []
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - B
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: UsedPercent
                intervalMs: 1000
                maxDataPoints: 43200
                reducer: last
                refId: LastPercent
                type: reduce
            - refId: Threshold
              relativeTimeRange:
                from: 86400
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 92
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - C
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: LastPercent
                intervalMs: 1000
                maxDataPoints: 43200
                refId: Threshold
                type: threshold
          dashboardUid: a13b0560-dd0c-4620-a56b-d0d4ffdcd963
          panelId: 152
          noDataState: OK
          execErrState: OK
          for: 5m
          annotations:
            __dashboardUid__: a13b0560-dd0c-4620-a56b-d0d4ffdcd963
            __panelId__: "152"
            description: |-
                Used disk space critical - above configured threshold
                • Host: {{ $labels.host_system }}
                • Mountpoint: {{ $labels.mountpoint }}
                • Device: {{ $labels.device }}
            summary: (Linux) Used Disk Space Above Threshold - {{ $labels.mountpoint }} ({{ $labels.device }}) on {{ $labels.host_system }}
          isPaused: false
        - uid: f636e7cb-d289-4a8e-bfa5-d2ccb968bb8c
          title: Disk Space Used (Windows)
          condition: Threshold
          data:
            - refId: UsedSpace
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: P4169E866C3094E38
              model:
                editorMode: code
                expr: max by (host_system,hardware) (ohm_hdd_load_percent{sensor="Used Space"})
                instant: true
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: UsedSpace
            - refId: Reduce
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params: []
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - B
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: UsedSpace
                intervalMs: 1000
                maxDataPoints: 43200
                reducer: last
                refId: Reduce
                settings:
                    mode: dropNN
                type: reduce
            - refId: Threshold
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 95
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - C
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: Reduce
                intervalMs: 1000
                maxDataPoints: 43200
                refId: Threshold
                type: threshold
          dashboardUid: de66b236-f52d-4a5b-9538-b27e99991992
          panelId: 41
          noDataState: OK
          execErrState: OK
          for: 5m
          annotations:
            __dashboardUid__: de66b236-f52d-4a5b-9538-b27e99991992
            __panelId__: "41"
            description: |-
                Used disk space critical - above configured threshold
                • Host: {{ $labels.host_system }}
                • Hardware: {{ $labels.hardware }}
            summary: (Windows) Used Disk Space Above Threshold - {{ $labels.hardware }} on {{ $labels.host_system }}
          isPaused: false
        - uid: f3c034b7-1bab-459f-827d-802d723ff574
          title: ISP Download Speed
          condition: Limit
          data:
            - refId: Download
              relativeTimeRange:
                from: 10800
                to: 0
              datasourceUid: P4169E866C3094E38
              model:
                datasource:
                    type: prometheus
                    uid: P4169E866C3094E38
                editorMode: code
                expr: avg(speedtest_download_bandwidth_bytes)*8
                instant: false
                interval: ""
                intervalMs: 60000
                legendFormat: Download
                maxDataPoints: 43200
                range: true
                refId: Download
            - refId: MeanDLSpeed
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 0
                            - 0
                        type: gt
                      operator:
                        type: and
                      query:
                        params: []
                      reducer:
                        params: []
                        type: avg
                      type: query
                datasource:
                    name: Expression
                    type: __expr__
                    uid: __expr__
                expression: Download
                intervalMs: 1000
                maxDataPoints: 43200
                reducer: mean
                refId: MeanDLSpeed
                settings:
                    mode: dropNN
                type: reduce
            - refId: Limit
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 4e+09
                            - 0
                        type: lt
                      operator:
                        type: and
                      query:
                        params: []
                      reducer:
                        params: []
                        type: avg
                      type: query
                datasource:
                    name: Expression
                    type: __expr__
                    uid: __expr__
                expression: MeanDLSpeed
                intervalMs: 1000
                maxDataPoints: 43200
                refId: Limit
                type: threshold
          dashboardUid: da7bd295-47a6-4b76-aefb-0e26fecbc1f8
          panelId: 17
          noDataState: NoData
          execErrState: Error
          for: 15m
          annotations:
            __dashboardUid__: da7bd295-47a6-4b76-aefb-0e26fecbc1f8
            __panelId__: "17"
            description: Monitor ISP download speed to test if it drops below threshold.
            summary: ISP Download speed is less than configured threshold.
          isPaused: false
          notification_settings:
            receiver: Dummy
