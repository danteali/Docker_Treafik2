apiVersion: 1
groups:
    - orgId: 1
      name: Evaluated every 1 min
      folder: Alerts
      interval: 1m
      rules:
        - uid: f31e7fba-e124-44e4-aee7-3518738d3038
          title: Host System Memory (Basic)
          condition: Threshold-Mem-Calc
          data:
            - refId: Used-Available-Perc
              relativeTimeRange:
                from: 86400
                to: 0
              datasourceUid: P4169E866C3094E38
              model:
                datasource:
                    type: prometheus
                    uid: P4169E866C3094E38
                disableTextWrap: false
                editorMode: code
                expr: 100 - ((avg_over_time(node_memory_MemAvailable_bytes[$__rate_interval]) * 100) / avg_over_time(node_memory_MemTotal_bytes[$__rate_interval]))
                format: time_series
                fullMetaSearch: false
                includeNullMetadata: true
                instant: true
                interval: ""
                intervalFactor: 1
                intervalMs: 15000
                legendFormat: RAM Total
                maxDataPoints: 43200
                range: false
                refId: Used-Available-Perc
                step: 240
                useBackend: false
            - refId: Used-Mem-Perc
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: P4169E866C3094E38
              model:
                datasource:
                    type: prometheus
                    uid: P4169E866C3094E38
                editorMode: code
                expr: (node_memory_MemTotal_bytes - node_memory_MemFree_bytes - node_memory_Cached_bytes - node_memory_Buffers_bytes - node_memory_SReclaimable_bytes) / node_memory_MemTotal_bytes * 100
                instant: true
                intervalMs: 1000
                legendFormat: __auto
                maxDataPoints: 43200
                range: false
                refId: Used-Mem-Perc
            - refId: Threshold-Avail-Calc
              relativeTimeRange:
                from: 86400
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 95
                        type: gt
                      operator:
                        type: and
                      query:
                        params:
                            - G
                      reducer:
                        params: []
                        type: last
                      type: query
                datasource:
                    type: __expr__
                    uid: __expr__
                expression: Used-Available-Perc
                intervalMs: 1000
                maxDataPoints: 43200
                refId: Threshold-Avail-Calc
                type: threshold
            - refId: Threshold-Mem-Calc
              relativeTimeRange:
                from: 600
                to: 0
              datasourceUid: __expr__
              model:
                conditions:
                    - evaluator:
                        params:
                            - 90
                            - 0
                        type: gt
                      operator:
                        type: and
                      query:
                        params: []
                      reducer:
                        params: []
                        type: avg
                      type: query
                datasource:
                    name: Expression
                    type: __expr__
                    uid: __expr__
                expression: Used-Mem-Perc
                intervalMs: 1000
                maxDataPoints: 43200
                refId: Threshold-Mem-Calc
                type: threshold
          dashboardUid: a13b0560-dd0c-4620-a56b-d0d4ffdcd963
          panelId: 78
          noDataState: OK
          execErrState: OK
          for: 3m
          annotations:
            __dashboardUid__: a13b0560-dd0c-4620-a56b-d0d4ffdcd963
            __panelId__: "78"
            description: |-
                RAM usage of host system (or VM/LXC) exceeds defined threshold in alart.
                Host: {{ $labels.host_system }}
                IP Address: {{ $labels.instance}}
            summary: System RAM usage exceeds defined threshold - {{ $labels.host_system }}
          isPaused: false
